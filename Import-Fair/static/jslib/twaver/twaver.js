(function(Y,I){var L={},U={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(c,a,d,b){U.images[c]=new L.ImageAsset(c,a,d,b)},unregisterImage:function(a){delete U.images[a]},getImageAsset:function(a){return U.images[a]},showVersion:function(a){U.isCtrlDown(a)&&a.shiftKey&&a.keyCode==76&&alert("TWaver HTML5 "+L.Util.getVersion()+"\n"+J)},callLater:function(c,a,d,b){return setTimeout(function(){c.apply(a,d)},b||z.CALL_LATER_DELAY)},isEmptyObject:function(b){for(var a in b){return !1}return !0},xml:function(a){if(Y.DOMParser){return(new DOMParser).parseFromString(a,"text/xml")}var b=new ActiveXObject("Microsoft.XmlDOM");return b.async=!1,b.loadXml(a),b},num:function(a){return typeof a=="number"&&!isNaN(a)&&isFinite(a)},getter:function(b){var a=b.charAt(0).toUpperCase()+b.slice(1),c=/ble$/.test(b)||/ed$/.test(b)?"is":"get";return c+a},setter:function(b){var a=b.charAt(0).toUpperCase()+b.slice(1);return"set"+a},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){var b=[];for(var a=0;a<32;a++){b[a]=this._id[Math.floor(Math.random()*16)]}return b[12]="4",b[16]=this._id[b[16]&3|8],b.join("")},keys:function(b){var a=new B;for(var c in b){a.add(c)}return a},es:["toString","toLocaleString","valueOf"],ip:function(b,a){var c="_"+a;b[U.getter(a)]=function(){return this[c]},b[U.setter(a)]=function(f){var d=this[c];this[c]=f,this.firePropertyChange(a,d,f)}},validateLicense:function(a){J=a},ibool:function(c,a){var d="_"+a,b=a.charAt(0).toUpperCase()+a.slice(1);c["is"+b]=function(){return this[d]},c[U.setter(a)]=function(g){var f=this[d];this[d]=g,this.firePropertyChange(a,f,g)}},getValue:function(f,b,g){var d=b.charAt(0).toUpperCase()+b.slice(1),a="get"+d,c="is"+d;return g?g==="boolean"?f[c]():f[a]():f[a]?f[a]():f[c]?f[c]():f[b]},setValue:function(b,a,c){b["set"+a.charAt(0).toUpperCase()+a.slice(1)](c)},clone:function(b){if(!b){return null}var a={};for(var c in b){a[c]=b[c]}return a},classCache:{},getClass:function(a){var e=U.classCache[a];if(!e){var c=a.split("."),b=c.length;e=Y;for(var d=0;d<b;d++){e=e[c[d]]}U.classCache[a]=e}return e},newInstance:function(c){var a=U.getClass(c);if(!a){return null}var d=arguments.length,b=arguments;if(d===1){return new a}if(d===2){return new a(b[1])}if(d===3){return new a(b[1],b[2])}if(d===4){return new a(b[1],b[2],b[3])}if(d===5){return new a(b[1],b[2],b[3],b[4])}if(d===6){return new a(b[1],b[2],b[3],b[4],b[5])}if(d===7){return new a(b[1],b[2],b[3],b[4],b[5],b[6])}if(d===8){return new a(b[1],b[2],b[3],b[4],b[5],b[6],b[7])}throw"don't support args more than 7"},addMethod:function(c,a){var d=c.prototype;for(var b in a){d[b]=a[b]}},ext:function(k,p,d){var b;typeof k=="string"&&(b=k,k=U.getClass(k));if(p){var u=function(){};u.prototype=p.prototype,k.prototype=new u,k.prototype.constructor=k,k.superClass=p.prototype,p.prototype.constructor==Object.prototype.constructor&&(p.prototype.constructor=p)}b&&(k.prototype.getClassName=function(){return b});if(d){var c=k.prototype;for(var m in d){G.ext(m,c,d)}var h=U.es.length;for(var g=0;g<h;g++){m=U.es[g],d.hasOwnProperty(m)&&!d.propertyIsEnumerable(m)&&(c[m]=d[m])}}},setViewBounds:function(b,a){if(!b){return}if(b.adjustBounds){b.adjustBounds(a)}else{var c=b.style;!c&&b.getView()&&(c=b.getView().style),c&&(c.position="absolute",c.left=a.x+"px",c.top=a.y+"px",c.width=a.width+"px",c.height=a.height+"px")}},getImageSrc:function(b){var a=U.getImageAsset(b);return a?a.getSrc()?a.getSrc():a.getImage().getAttribute("src"):b},nextColorCount:0,nextColor:function(){return U.nextColorCount>=z.COLORS.length&&(U.nextColorCount=0),z.COLORS[U.nextColorCount++]},isCtrlDown:function(a){return a.ctrlKey||a.metaKey},setText:function(b,a,c){c?O.isFirefox?b.textContent=a:b.innerText=a:b.innerHTML=a},fillDescendant:function(b,a){a.add(b),b.hasChildren()&&b.getChildren().forEach(function(c){U.fillDescendant(c,a)})}},J="This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.";Y.twaver=L,Y._twaver=U,L.animate={},L.network={},L.network.interaction={},L.controls={},L.charts={},L.layout={};var O=function(){var b={},a=navigator.userAgent.toLowerCase();return b.isOpera=/opera/.test(a),b.isIE=/msie/.test(a),b.isFirefox=/firefox/i.test(a),b.isChrome=/chrome/i.test(a),b.isSafari=!b.isChrome&&/safari/i.test(a),b.isIPhone=/iphone/.test(a),b.isIPod=/ipod/.test(a),b.isIPad=/ipad/.test(a),b.isAndroid=/android/i.test(a),b.isWebOS=/webos/i.test(a),b.isTouchable="ontouchend" in document,b}();U.ua=O;var G={__accessor:function(d,a){var f=a.__accessor,c=f.length;for(var b=0;b<c;b++){U.ip(d,f[b])}},__bool:function(d,a){var f=a.__bool,c=f.length;for(var b=0;b<c;b++){U.ibool(d,f[b])}},__client:function(b,a){b.getClient=function(c){return this._clientMap[c]},b.setClient=function(d,c){var f=this._clientMap[d];return c==null?delete this._clientMap[d]:this._clientMap[d]=c,this.firePropertyChange("C:"+d,f,c)&&this.onClientChanged(d,f,c),this},b.getClientProperties=function(){return U.keys(this._clientMap)},b.onClientChanged=function(d,c,f){}},__style:function(a,b){a.getStyle=function(d,f){var c=this._styleMap[d];return f===I&&(f=!0),c==null&&f?L.Styles.getStyle(d):c},a.setStyle=function(d,c){var f=this._styleMap[d];return c==null?delete this._styleMap[d]:this._styleMap[d]=c,this.firePropertyChange("S:"+d,f,c)&&this.onStyleChanged(d,f,c),this},a.getStyleProperties=function(){return U.keys(this._styleMap)},a.onStyleChanged=function(d,c,f){}},__new:function(b,a){b.newInstance=function(){var d=U.getClass(this.getClassName());if(!d){return null}var c=arguments.length,f=arguments;if(c===0){return new d}if(c===1){return new d(f[0])}if(c===2){return new d(f[0],f[1])}if(c===3){return new d(f[0],f[1],f[2])}if(c===4){return new d(f[0],f[1],f[2],f[3])}if(c===5){return new d(f[0],f[1],f[2],f[3],f[4])}if(c===6){return new d(f[0],f[1],f[2],f[3],f[4],f[5])}if(c===7){return new d(f[0],f[1],f[2],f[3],f[4],f[5],f[6])}throw"don't support args more than 7"}},__property:function(b,a){b.getValue=function(d,c){return this._propertyType==="accessor"?U.getValue(d,this._propertyName):this._propertyType==="style"&&d.getStyle?d.getStyle(this._propertyName):this._propertyType==="client"&&d.getClient?d.getClient(this._propertyName):this._propertyType==="field"?d[this._propertyName]:null},b.setValue=function(d,c,f){if(this._propertyType==="accessor"){d[U.setter(this._propertyName)](c)}else{if(this._propertyType==="style"&&d.setStyle){return d.setStyle(this._propertyName,c)}if(this._propertyType==="client"&&d.setClient){return d.setClient(this._propertyName,c)}this._propertyType==="field"&&(d[this._propertyName]=c)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(b,a,c){G.map[b]===1?G[b](a,c):a[b]=c[b]}};U.extend=G;var ac=function(f,b,g,d,a,c){this._m11=f,this._m12=b,this._m21=g,this._m22=d,this._offsetX=a,this._offsetY=c,this._type=0;if(this._m21!=0||this._m12!=0){this._type=4}else{if(this._m11!=1||this._m22!=1){this._type=2}if(this._offsetX!=0||this._offsetY!=0){this._type|=1}(this._type&(2|1))==0&&(this._type=0)}};ac.prototype.transform=function(){var a;arguments.length===2?a={x:arguments[0],y:arguments[1]}:a=arguments[0];if(!a||!U.num(a.x)||!U.num(a.y)){throw"arguments should contain x, y"}switch(this._type){case 0:return{x:a.x,y:a.y};case 1:return{x:this._offsetX+a.x,y:this._offsetY+a.y};case 2:return{x:a.x*this._m11,y:a.y*this._m22};case 3:return{x:a.x*this._m11+this._offsetX,y:a.y*this._m22+this._offsetY}}return{x:this._m11*a.x+a.y*this._m21+this._offsetX,y:this._m22*a.y+a.x*this._m12+this._offsetY}};var X={getDistance:function(c,a){var d=a.x-c.x,b=a.y-c.y;return Math.sqrt(d*d+b*b)},getCenterPoint:function(b,a){return{x:(b.x+a.x)/2,y:(b.y+a.y)/2}},isPointInPolygon:function(g,c){g=g._as;var k=0,f=0,b=!1,d=g.length;for(k=0,f=d-1;k<d;f=k++){var h=g[k],a=g[f];h.y>c.y!=a.y>c.y&&c.x<(a.x-h.x)*(c.y-h.y)/(a.y-h.y)+h.x&&(b=!b)}return b},unionRect:function(b,a){if(b&&!a){return U.clone(b)}if(!b&&a){return U.clone(a)}if(b&&a){var c={};return c.x=Math.min(b.x,a.x),c.y=Math.min(b.y,a.y),c.width=Math.max(b.x+b.width,a.x+a.width)-c.x,c.height=Math.max(b.y+b.height,a.y+a.height)-c.y,c}return null},intersects:function(k,p){if(!k||!p){return !1}var d=p.width,b=p.height,g=k.width,v=k.height;if(g<=0||v<=0||d<=0||b<=0){return !1}var c=p.x,m=p.y,l=k.x,h=k.y;return g+=l,v+=h,d+=c,b+=m,(g<l||g>c)&&(v<h||v>m)&&(d<c||d>l)&&(b<m||b>h)},intersection:function(k,p){if(!k||!p){return !1}var d=p.x,b=p.y,g=k.x,v=k.y,c=d;c+=p.width;var m=b;m+=p.height;var l=g;l+=k.width;var h=v;return h+=k.height,d<g&&(d=g),b<v&&(b=v),c>l&&(c=l),m>h&&(m=h),c-=d,m-=b,c===0||m===0?null:{x:d,y:b,width:c,height:m}},contains:function(k,p){var d=p.x,b=p.y,g=p.width,v=p.height,c=k.width,m=k.height;if((c|m|g|v)<0){return !1}var l=k.x,h=k.y;if(d<l||b<h){return !1}c+=l,g+=d;if(g<=d){if(c>=l||g>c){return !1}}else{if(c>=l&&g>c){return !1}}m+=h,v+=b;if(v<=b){if(m>=h||v>m){return !1}}else{if(m>=h&&v>m){return !1}}return !0},getLinePoints:function(b){if(!b){return null}var a=new B;return b.forEach(function(c){a.addAll(c)}),a},getLineRect:function(b){var a=X.getLinePoints(b);return X.getRect(a)},getRect:function(g){if(!g){return null}g._as&&(g=g._as);var l=g.length;if(l<=0){return null}var d=g[0],b={x:d.x,y:d.y,width:0,height:0};for(var f=1;f<l;f++){d=g[f];var m=Math.min(b.x,d.x),c=Math.max(b.x+b.width,d.x),k=Math.min(b.y,d.y),h=Math.max(b.y+b.height,d.y);b.x=m,b.y=k,b.width=c-m,b.height=h-k}return b},addPadding:function(d,b,f,c){arguments.length===3&&(c=-1);var a=b.getStyle(f)*c;a!=0&&X.grow(d,a,a),a=b.getStyle(f+".left")*c,a!=0&&(d.x-=a,d.width+=a),a=b.getStyle(f+".right")*c,a!=0&&(d.width+=a),a=b.getStyle(f+".top")*c,a!=0&&(d.y-=a,d.height+=a),a=b.getStyle(f+".bottom")*c,a!=0&&(d.height+=a),d.width<0&&(d.width=-d.width,d.x-=d.width),d.height<0&&(d.height=-d.height,d.y-=d.height)},grow:function(d,b,f){var c=d.width+b+b;if(c<0){return}var a=d.height+f+f;if(a<0){return}d.x-=b,d.y-=f,d.width=c,d.height=a},containsPoint:function(b,a,c){return arguments.length<3&&(c=a.y,a=a.x),!b||a<b.x||c<b.y||a>b.x+b.width||c>b.y+b.height?!1:!0},getHotSpot:function(w,E,g,b,m){if(m==="oval"){var N=0.35;return{x:w+g*0.5+g*N,y:E+b/2-Math.sqrt(0.25-N*N)*b}}if(m==="circle"){var d=w+g/2,C=E+b/2,y=Math.min(g,b)/2;w=d-y,E=C-y,g=y*2,b=y*2;var v=g/2,k=b/2,x=v*k/Math.sqrt(v*v+k*k);return{x:w+g/2+x,y:E+b/2-x}}var p={x:w+g,y:E};return g>3&&(p.x-=3),b>3&&(p.y+=3),p},getCircleRect:function(b){var a=Math.min(b.width,b.height)/2;return{x:b.x+b.width/2-a,y:b.y+b.height/2-a,width:a*2,height:a*2}},getEllipsePoint:function(k,p){if(!k||!p){return null}var d=k.x+k.width/2,b=k.y+k.height/2,g=p.x-d,v=p.y-b,c=k.width/2,m=k.height/2,l=Math.sqrt(1/(1/c/c+v*v/g/g/m/m));g<0&&(l=-l);var h;return g==0?v>0?h=m:h=-m:h=l*v/g,{x:d+l,y:b+h}},createMatrix:function(f,b,h){var d=Math.sin(f),a=Math.cos(f),c=b*(1-a)+h*d,g=h*(1-a)-b*d;return new ac(a,d,-d,a,c,g)},calculatePointInfoAlongLineBySegments:function(d,b,f,c,a){return X.calculatePointInfoAlongLine(X.getPointObject(d,b),f,c,a)},calculatePointInfoAlongLine:function(N,t,b,y){t=t===I?!0:t,b=b||0,y=y||0;if(!N||N.size()<2){throw"must more than two points"}if(!t){var ag=X.reversePath(N);return X.calculatePointInfoAlongLine(ag,!0,b,y)}N._as&&(N=N._as);var k,af,ad=0,x=0,T,C,f=N.length,S;for(C=0;C<f;C++){S=N[C];if(C==0){af=S;continue}if(b<=0){T=X.calculatePointInfoOnStraightLine(X._getPoint(af),X._getControlPoint(S),b,y),k=T;break}x=X._getLength(S,af);if(ad+x>b){T=X.getPathInfo(S,af,b-ad,y,x),k=T;break}ad+=x,af=S}if(k==null){var ae,w;af=N[f-1],w=X._getPoint(af),af instanceof B&&(af=af._as),ae=af instanceof Array?X._getControlPoint(af):X._getPoint(N[f-2]);var E=Math.atan2(w.y-ae.y,w.x-ae.x);T=X.transformPoint(w,E,b-ad,y),T.angle=E,k=T}return k},reversePath:function(d){var b=new B,f=null,c;d._as&&(d=d._as);for(var a=d.length-1;a>=0;a--){c=d[a],b.add(X._getReversePath(c,f)),f=c}return b},_getPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-1]:a},_getControlPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-2]:a},_getReversePath:function(b,a){var c=X._getPoint(b);return a&&a._as&&(a=a._as),a!=null&&a instanceof Array?a.length==2?new B([a[0],c]):new B([a[1],a[0],c]):c},_getLength:function(f,b){var g=X._getPoint(b),d=X._getPoint(f);f instanceof B&&(f=f._as);if(f instanceof Array){return X.calculateCurveLength(g,f,1)}var a=d.y-g.y,c=d.x-g.x;return Math.sqrt(c*c+a*a)},getPathInfo:function(h,p,d,b,g){var v=X._getPoint(p),c=X._getPoint(h),m;h instanceof B&&(h=h._as);if(h instanceof Array){g<0&&(g=X._getLength(h,p));var k=d/g,f=X.calculatePointInfoOnCurveLine(v,h,k);v=f.point,m=f.angle,d=0}else{m=Math.atan2(c.y-v.y,c.x-v.x)}return X.transformPoint(v,m,d,b)},transformPoint:function(f,b,g,d){var a={x:g,y:d},c=X.createMatrix(b,0,0);return a=c.transform(a),a.x+=f.x,a.y+=f.y,{point:a,angle:b}},calculatePointInfoOnStraightLine:function(d,b,f,c){var a=Math.atan2(b.y-d.y,b.x-d.x);return X.transformPoint(d,a,f,c)},calculatePointInfoOnCurveLine:function(b,a,c){if(c<0||c>1){throw"Illegal arguments"}return a._as&&(a=a._as),a.length==2?X._calculatePointInfoOnCurveLine2(b,a[0],a[1],c):X._calculatePointInfoOnCurveLine3(b,a[0],a[1],a[2],c)},_calculatePointInfoOnCurveLine2:function(g,l,d,b){var f=2*(g.x+d.x-2*l.x)*b+2*l.x-2*g.x,m=2*(g.y+d.y-2*l.y)*b+2*l.y-2*g.y,c=Math.atan2(m,f),k=(g.x+d.x-2*l.x)*b*b+(2*l.x-2*g.x)*b+g.x,h=(g.y+d.y-2*l.y)*b*b+(2*l.y-2*g.y)*b+g.y;return{point:{x:k,y:h},angle:c}},_calculatePointInfoOnCurveLine3:function(h,p,d,b,g){var v,c,m;v=1-g,c=v*v*v,m=g*g*g;var k=c*h.x+3*g*v*v*p.x+3*g*g*v*d.x+m*b.x,f=c*h.y+3*g*v*v*p.y+3*g*g*v*d.y+m*b.y;return{point:{x:k,y:f},angle:Math.atan2(X._bezeSpeedY(h,p,d,b,g),X._bezeSpeedX(h,p,d,b,g))}},calculateCurveLength:function(b,a,c){return a._as&&(a=a._as),a.length==2?X._calculateCurveLength(b,a[0],a[1],c):X._calculateBezierCurveLength(b,a[0],a[1],a[2],c)},_calculateCurveLength:function(m,w,d,b){if(b<=0||b>1){return 0}var h=Math.floor(b*(Math.sqrt((m.x-w.x)*(m.x-w.x)+(m.y-w.y)*(m.y-w.y))+Math.sqrt((d.x-w.x)*(d.x-w.x)+(d.y-w.y)*(d.y-w.y)))/2),x=0;h<=0&&(h=1);var c=b/h,v,p,k=0;for(var g=0;g<h;g++){k=c*g,v=2*(m.x+d.x-2*w.x)*k+2*w.x-2*m.x,p=2*(m.y+d.y-2*w.y)*k+2*w.y-2*m.y,v*=c,p*=c,x+=Math.sqrt(v*v+p*p)}return x},_calculateBezierCurveLength:function(p,y,f,b,k){if(k<=0||k>1){return 0}var C=10000,d=Math.floor(C*k);(d&1)==1&&d++;if(d==0){return 0}var x=Math.floor(d/2),w=0,g=0,v=k/d,m;for(m=0;m<x;m++){w+=X._bezeSpeed(p,y,f,b,(2*m+1)*v)}for(m=1;m<x;m++){g+=X._bezeSpeed(p,y,f,b,2*m*v)}return(X._bezeSpeed(p,y,f,b,0)+X._bezeSpeed(p,y,f,b,1)+2*g+4*w)*v/3},_bezeSpeedX:function(f,b,g,d,a){var c=1-a;return -3*f.x*c*c+3*b.x*c*c-6*b.x*c*a+6*g.x*c*a-3*g.x*a*a+3*d.x*a*a},_bezeSpeedY:function(f,b,g,d,a){var c=1-a;return -3*f.y*c*c+3*b.y*c*c-6*b.y*c*a+6*g.y*c*a-3*g.y*a*a+3*d.y*a*a},_bezeSpeed:function(f,b,h,d,a){var c=X._bezeSpeedX(f,b,h,d,a),g=X._bezeSpeedY(f,b,h,d,a);return Math.sqrt(c*c+g*g)},getPointObject:function(g,c){if(!c||c.size()==0){return g}var k=new B;c=c._as,g=g._as;var f=0,b,d,h=c.length,a=g.length;for(b=0;b<h;b++){d=c[b];if(f==a){break}"cubicto"===d?f<a-2&&k.add([g[f++],g[f++],g[f++]]):"quadto"===d?f<a-1&&k.add([g[f++],g[f++]]):f<a&&k.add(g[f++])}for(;f<a;f++){k.add(g[f])}return k},calculateLineLength:function(k,w){if(!k||k.size()<2){return 0}if(w){return X.calculateLineLength(X.getPointObject(k,w))}k=k._as;var f,b=k.length,h,x,d,v,p,g,m=0;for(f=0;f<b;f++){d=k[f];if(f==0){h=d;continue}x=d,x instanceof B&&(x=x._as),x instanceof Array?(v=X.calculateCurveLength(h,x,1),h=x[x.length-1]):(g=d.y-h.y,p=d.x-h.x,v=Math.sqrt(p*p+g*g),h=x),m+=v}return m}};U.math=X;var Q={getPoints:function(b){var a=new B;return b.forEach(function(c){a.add({x:c.x,y:c.y}),a.add({x:c.x+c.width,y:c.y+c.height}),a.add({x:c.x+c.width,y:c.y}),a.add({x:c.x,y:c.y+c.height})}),a},rectangle:function(b){var a;return b.forEach(function(c){a=X.unionRect(a,c)}),a},oval:function(g){var l=Q.rectangle(g),d=0,b=l.height/l.width,f=b*b,m=l.x+l.width/2,c=l.y+l.height/2,k=Q.getPoints(g);k.forEach(function(s){var o=s.x-m,p=s.y-c,a=o*o+p*p/f;a>d&&(d=a)}),d=Math.sqrt(d);var h=b*d;return{x:m-d,y:c-h,width:d*2,height:h*2}},circle:function(f){var b=Q.rectangle(f),g=0,d=b.x+b.width/2,a=b.y+b.height/2,c=Q.getPoints(f);return c.forEach(function(l){var h=l.x-d,k=l.y-a,m=h*h+k*k;m>g&&(g=m)}),g=Math.sqrt(g),{x:d-g,y:a-g,width:g*2,height:g*2}},roundrect:function(b){var a=Q.rectangle(b),c=Math.min(a.width,a.height)/16;return X.grow(a,c,c),a},star:function(b){var a=Q.rectangle(b);return X.grow(a,a.width,a.height),a},triangle:function(b){var a=Q.rectangle(b);return a.x-=a.width/2,a.width*=2,a.y-=a.height,a.height*=2,a},hexagon:function(b){var a=Q.rectangle(b);return a.x-=a.width/2,a.width*=2,a},pentagon:function(b){var a=Q.rectangle(b);return a.x-=a.width/6,a.width+=a.width/3,a.y-=a.height/4,a.height+=a.height/4,a},diamond:function(b){var a=Q.rectangle(b);return a.x-=a.width/2,a.width+=a.width,a.y-=a.height/2,a.height+=a.height,a}};U.group=Q;var aa={"topleft.topleft":function(b,a){return{x:b.x-a.width,y:b.y-a.height}},"topleft.topright":function(b,a){return{x:b.x,y:b.y-a.height}},"top.top":function(b,a){return{x:b.x+b.width/2-a.width/2,y:b.y-a.height}},"topright.topleft":function(b,a){return{x:b.x+b.width-a.width,y:b.y-a.height}},"topright.topright":function(b,a){return{x:b.x+b.width,y:b.y-a.height}},topleft:function(b,a){return{x:b.x-a.width/2,y:b.y-a.height/2}},top:function(b,a){return{x:b.x-a.width/2+b.width/2,y:b.y-a.height/2}},topright:function(b,a){return{x:b.x-a.width/2+b.width,y:b.y-a.height/2}},"topleft.bottomleft":function(b,a){return{x:b.x-a.width,y:b.y}},"topleft.bottomright":function(b,a){return{x:b.x,y:b.y}},"top.bottom":function(b,a){return{x:b.x+b.width/2-a.width/2,y:b.y}},"topright.bottomleft":function(b,a){return{x:b.x-a.width+b.width,y:b.y}},"topright.bottomright":function(b,a){return{x:b.x+b.width,y:b.y}},"left.left":function(b,a){return{x:b.x-a.width,y:b.y+b.height/2-a.height/2}},left:function(b,a){return{x:b.x-a.width/2,y:b.y+b.height/2-a.height/2}},"left.right":function(b,a){return{x:b.x,y:b.y+b.height/2-a.height/2}},center:function(b,a){return{x:b.x+b.width/2-a.width/2,y:b.y+b.height/2-a.height/2}},"right.left":function(b,a){return{x:b.x+b.width-a.width,y:b.y+b.height/2-a.height/2}},right:function(b,a){return{x:b.x+b.width-a.width/2,y:b.y+b.height/2-a.height/2}},"right.right":function(b,a){return{x:b.x+b.width,y:b.y+b.height/2-a.height/2}},"bottomleft.topleft":function(b,a){return{x:b.x-a.width,y:b.y+b.height-a.height}},"bottomleft.topright":function(b,a){return{x:b.x,y:b.y+b.height-a.height}},"bottom.top":function(b,a){return{x:b.x+b.width/2-a.width/2,y:b.y+b.height-a.height}},"bottomright.topleft":function(b,a){return{x:b.x+b.width-a.width,y:b.y+b.height-a.height}},"bottomright.topright":function(b,a){return{x:b.x+b.width,y:b.y+b.height-a.height}},bottomleft:function(b,a){return{x:b.x-a.width/2,y:b.y+b.height-a.height/2}},bottom:function(b,a){return{x:b.x+b.width/2-a.width/2,y:b.y+b.height-a.height/2}},bottomright:function(b,a){return{x:b.x+b.width-a.width/2,y:b.y+b.height-a.height/2}},"bottomleft.bottomleft":function(b,a){return{x:b.x-a.width,y:b.y+b.height}},"bottomleft.bottomright":function(b,a){return{x:b.x,y:b.y+b.height}},"bottom.bottom":function(b,a){return{x:b.x+b.width/2-a.width/2,y:b.y+b.height}},"bottomright.bottomleft":function(b,a){return{x:b.x+b.width-a.width,y:b.y+b.height}},"bottomright.bottomright":function(b,a){return{x:b.x+b.width,y:b.y+b.height}},get:function(c,a,d){if(!a){throw"refRect can not be null"}d||(d={width:0,height:0});var b=aa[c];if(b){return b(a,d)}throw"Can not resolve '"+c+"' position"}};U.position=aa;var V={preventDefault:function(a){if(a.target.keepDefault){return}if(a.target.parentNode&&a.target.parentNode.keepDefault){return}if(a.shiftKey){return}a.preventDefault?a.preventDefault():a.returnValue=!1},insertAfter:function(b,a){return a?a.parentNode.insertBefore(b,a.nextSibling):b.parentNode.insertBefore(b,b.parentNode.firstChild),b},forEach:function(d,b,f){if(!V.isVisible(d)){return}var c=d.childNodes.length;for(var a=0;a<c;a++){V.forEach(d.childNodes[a],b,f)}f?b.call(f,d):b(d)},setVisible:function(b,a){b.style.display=a?"block":"none"},isVisible:function(a){return"style" in a&&a.style.display!=="none"},release:function(b){var a=b.childNodes.length;for(var c=0;c<a;c++){V.release(b.childNodes[c])}a>0&&V.clear(b),b._pool&&b._pool.release(b)},clear:function(a){while(a.firstChild){a.removeChild(a.firstChild)}},setZoom:function(b,a){var c=b.style;if(c.setProperty){if(O.isFirefox){c.setProperty("-moz-transform","scale("+a+")",null),c.setProperty("-moz-transform-origin","0 0",null);return}if(O.isOpera){c.setProperty("-o-transform","scale("+a+")",null),c.setProperty("-o-transform-origin","0 0",null);return}}c.zoom=a},setBorderRaidus:function(b,a){O.isFirefox?b.style.MozBorderRadius=a:b.style.borderRadius=a},createSelect:function(f,b){var g=document.createElement("select"),d,a,c;if(f.values){for(d=0;d<f.values.length;d++){a=f.values[d],c=document.createElement("option"),c.innerHTML=f.map[a],c.setAttribute("value",a),a===b&&c.setAttribute("selected","true"),g.appendChild(c)}}else{for(d=0;d<f.length;d++){a=f[d],c=document.createElement("option"),c.innerHTML=a,c.setAttribute("value",a),a===b&&c.setAttribute("selected","true"),g.appendChild(c)}}return g},createImg:function(b){var a=document.createElement("img");return a.style.position="absolute",typeof b=="string"&&a.setAttribute("src",b),a},createView:function(b,a){var c=document.createElement("div");return c.style.position=z.VIEW_POSITION,c.style.fontSize=z.VIEW_FONT_SIZE,c.style.fontFamily=z.VIEW_FONT_FAMILY,c.style.cursor="default",c.style.outline="none",c.style.textAlign="left",c.tabIndex=0,a||(c.onmousedown=V.preventDefault),c.style.setProperty&&(c.style.setProperty("-khtml-user-select","none",null),c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("-moz-user-select","none",null)),b&&(c.style.overflow=b),c},createDiv:function(){var a=document.createElement("div");return a.style.position="absolute",a},createCanvas:function(){var a=document.createElement("canvas");return a.style.position="absolute",a},setCanvas:function(f,b,g,d,a){arguments.length===2&&(g=b.y,d=b.width,a=b.height,b=b.x),f.style.left=b+"px",f.style.top=g+"px",f.setAttribute("width",d),f.setAttribute("height",a),f._viewRect={x:b,y:g,width:d,height:a};var c=f.getContext("2d");return c.shadowBlur!==0&&(c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowColor="rgba(0,0,0,0.0)"),c.clearRect(0,0,d,a),c.translate(-b,-g),c},setImg:function(b,a,c){b.setAttribute("src",a),b.style.left=c.x+"px",b.style.top=c.y+"px",b.style.width=c.width+"px",b.style.height=c.height+"px",b._viewRect=U.clone(c)},setDiv:function(d,a,f,c,b){c=U.num(c)?c:0,d.style.left=a.x-c+"px",d.style.top=a.y-c+"px",d.style.width=a.width+"px",d.style.height=a.height+"px",d._viewRect=U.clone(a),f?d.style.backgroundColor=f:d.style.backgroundColor="",c>0?d.style.border=c+"px "+b+" solid":d.style.border=""},addEventListener:function(f,b,g,d){var a="_"+f+"_";if(d[a]){return}var c=function(h){arguments.callee.instance[arguments.callee.method](h)};c.method=b,c.instance=d,d[a]=c,g.addEventListener(f,c,!1)},removeEventListener:function(d,b,f){var c="_"+d+"_",a=f[c];a&&(b.removeEventListener(d,a,!1),delete f[c])},isValidEvent:function(b,a){if(!a){return !1}if(a.target===b){if(O.isFirefox){if(b.clientHeight<b.scrollHeight&&a.layerX<25){return !1}if(b.clientWidth<b.scrollWidth&&a.layerY<25){return !1}}else{if(a.offsetX>b.clientWidth||a.offsetY>b.clientHeight){return !1}}}return !0},getLogicalPoint:function(k,p,c,b){c=c?c:1;var g;if(O.isTouchable&&p.changedTouches&&p.changedTouches.length>0){var v=k.getBoundingClientRect(),o=p.changedTouches[0],m=O.isAndroid?0:ab.scrollLeft(),h=O.isAndroid?0:ab.scrollTop();return g={x:(o.clientX+k.scrollLeft-v.left-m)/c,y:(o.clientY+k.scrollTop-v.top-h)/c},g}if(!V.isValidEvent(k,p)){return null}if(p.target===k){return O.isFirefox?g={x:(p.layerX+k.scrollLeft)/c,y:(p.layerY+k.scrollTop)/c}:g={x:(p.offsetX+k.scrollLeft)/c,y:(p.offsetY+k.scrollTop)/c},g}O.isFirefox?g={x:p.layerX,y:p.layerY}:O.isOpera||O.isIE?g={x:p.offsetX,y:p.offsetY}:g={x:p.offsetX/c,y:p.offsetY/c};var d=p.target;!O.isOpera&&d.tagName==="SPAN"&&d.style.position!=="absolute"&&(d=d.offsetParent);while(d&&d!==k&&d!==b){g.x+=d.offsetLeft,g.y+=d.offsetTop,d=d.offsetParent}return d?g:null},handle_mousedown:function(a,b){V.target&&V.handle_mouseup(b),Y.addEventListener("mousemove",V.handle_mousemove,!1),Y.addEventListener("mouseup",V.handle_mouseup,!1),V.target=a},handle_mousemove:function(a){V.target.handle_mousemove&&V.target.handle_mousemove(a),V.target.handleMouseMove&&V.target.handleMouseMove(a)},handle_mouseup:function(a){V.target.handle_mouseup&&V.target.handle_mouseup(a),V.target.handleMouseUp&&V.target.handleMouseUp(a),Y.removeEventListener("mousemove",V.handle_mousemove,!1),Y.removeEventListener("mouseup",V.handle_mouseup,!1),delete V.target},getClientPoint:function(a){return{x:a.clientX,y:a.clientY}},windowWidth:function(){return typeof Y.innerWidth=="number"?Y.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body&&document.body.clientWidth?document.body.clientWidth:0},windowHeight:function(){return typeof Y.innerHeight=="number"?Y.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body&&document.body.clientHeight?document.body.clientHeight:0}};U.html=V;var M={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(b,a){M.g.font=b?b:z.FONT;var c=M.cache[M.g.font];return c||(c=M.g.measureText("e").width*2+4,M.cache[M.g.font]=c),{width:M.g.measureText(a).width+4,height:c}},drawText:function(h,k,g,d,f){d||(d=z.FONT),h.font=d,h.fillStyle=f,h.textAlign="center",h.textBaseline="middle";var c,b;g?g.width===I?(c=g.x,b=g.y):(c=g.x+g.width/2,b=g.y+g.height/2):(c=0,b=0),O.isOpera&&(b-=2),h.fillText(k,c,b)},drawArc:function(ak,C,ad,N,ag,E,T,x){var ao,aj,af,am,ah,S,al,w,ae,ai,k;Math.abs(ag)>2*Math.PI&&(ag=2*Math.PI),ah=Math.ceil(Math.abs(ag)/(Math.PI/4)),ao=ag/ah,aj=-ao,af=-N;if(ah>0){S=C+Math.cos(N)*E,al=ad+Math.sin(-N)*T,x?ak.lineTo(S,al):ak.moveTo(S,al);for(var an=0;an<ah;an++){af+=aj,am=af-aj/2,w=C+Math.cos(af)*E,ae=ad+Math.sin(af)*T,ai=C+Math.cos(am)*(E/Math.cos(aj/2)),k=ad+Math.sin(am)*(T/Math.cos(aj/2)),ak.quadraticCurveTo(ai,k,w,ae)}}},dashedLine:function(y,S,k,b,v,T,g){var N=T-b,E=g-v,x=Math.sqrt(N*N+E*E);if(x==0){return}N/=x,E/=x;var m=x,C=-k.offset,w=k.drawing,d=k.patternIndex;while(C<m){C+=S[d],C>=m&&(k.offset=S[d]-(C-m),k.patternIndex=d,k.drawing=w,C=m),w?y.lineTo(b+C*N,v+C*E):y.moveTo(b+C*N,v+C*E),w=!w,d=(d+1)%S.length}},drawLinePoints:function(N,af,k,b,y){var ag=0,g,ae,T,E,x,S,C,d=af.size(),ad=0,w;k&&k.length>0?w=new Z(N,k[0],k.length>1?k[1]:k[0]):w=N;if(b){for(ad=0,C=b.size();ad<C;ad++){g=b.get(ad);if("moveto"===g&&ag<d){ae=af.get(ag++),w.moveTo(ae.x,ae.y)}else{if("lineto"===g&&ag<d){ae=af.get(ag++),w.lineTo(ae.x,ae.y)}else{if("cubicto"===g&&ag<d-2){ae=af.get(ag++),T=af.get(ag++),E=af.get(ag++),w.bezierCurveTo(ae.x,ae.y,T.x,T.y,E.x,E.y)}else{if(!("quadto"===g&&ag<d-1)){throw"Can not resolve segment '"+g+"'"}ae=af.get(ag++),T=af.get(ag++),w.quadraticCurveTo(ae.x,ae.y,T.x,T.y)}}}}}else{ae=af.get(0),w.moveTo(ae.x,ae.y);for(ag=1;ag<d;ag++){S=af.get(ag),S.size?(x=S.size(),x===2?(ae=S.get(0),T=S.get(1),w.quadraticCurveTo(ae.x,ae.y,T.x,T.y)):x===3&&(ae=S.get(0),T=S.get(1),E=S.get(2),w.bezierCurveTo(ae.x,ae.y,T.x,T.y,E.x,E.y))):w.lineTo(S.x,S.y)}}y&&w.closePath()},drawRoundRect:function(y,S,k,b,v,T,g,N,E){arguments.length===6&&(g=T,N=T,E=T);var x=S+b,m=k+v,C=b<v?b*2:v*2;T=T<C?T:C,g=g<C?g:C,N=N<C?N:C,E=E<C?E:C;var w=E*0.292893218813453,d=E*0.585786437626905;y.moveTo(x,m-E),y.quadraticCurveTo(x,m-d,x-w,m-w),y.quadraticCurveTo(x-d,m,x-E,m),w=N*0.292893218813453,d=N*0.585786437626905,y.lineTo(S+N,m),y.quadraticCurveTo(S+d,m,S+w,m-w),y.quadraticCurveTo(S,m-d,S,m-N),w=T*0.292893218813453,d=T*0.585786437626905,y.lineTo(S,k+T),y.quadraticCurveTo(S,k+d,S+w,k+w),y.quadraticCurveTo(S+d,k,S+T,k),w=g*0.292893218813453,d=g*0.585786437626905,y.lineTo(x-g,k),y.quadraticCurveTo(x-d,k,x-w,k+w),y.quadraticCurveTo(x,k+d,x,k+g),y.lineTo(x,m-E)},drawVector:function(g,c,k,f,b,d,h){arguments.length===4&&(b=f.y,d=f.width,h=f.height,f=f.x);var a=M["_"+c];a&&(g.beginPath(),k&&k.length>0&&(g=new Z(g,k[0],k.length>1?k[1]:k[0])),a(g,f,b,d,h))},_rectangle:function(d,b,f,c,a){d.rect(b,f,c,a)},_circle:function(g,c,k,f,b){var d=c+f/2,h=k+b/2,a=Math.min(f,b)/2;g instanceof Z?M.drawArc(g,d,h,0,Math.PI*2,a,a,!1):g.arc(d,h,a,0,Math.PI*2,!0)},_oval:function(p,y,g,b,k){if(p instanceof Z){M.drawArc(p,y+b/2,g+k/2,0,Math.PI*2,b/2,k/2,!1)}else{var C=0.5522848,d=b/2*C,x=k/2*C,w=y+b,m=g+k,h=y+b/2,v=g+k/2;p.moveTo(y,v),p.bezierCurveTo(y,v-x,h-d,g,h,g),p.bezierCurveTo(h+d,g,w,v-x,w,v),p.bezierCurveTo(w,v+x,h+d,m,h,m),p.bezierCurveTo(h-d,m,y,v+x,y,v)}},_roundrect:function(d,b,f,c,a){M.drawRoundRect(d,b,f,c,a,Math.min(Math.min(c,a)/4,10))},_star:function(g,l,d,b,f){var m=b*2,c=f*2,k=l+b/2,h=d+f/2;g.moveTo(k-m/4,h-c/12),g.lineTo(l+b*0.306,d+f*0.579),g.lineTo(k-m/6,h+c/4),g.lineTo(l+b/2,d+f*0.733),g.lineTo(k+m/6,h+c/4),g.lineTo(l+b*0.693,d+f*0.579),g.lineTo(k+m/4,h-c/12),g.lineTo(l+b*0.611,d+f*0.332),g.lineTo(k+0,h-c/4),g.lineTo(l+b*0.388,d+f*0.332),g.closePath()},_triangle:function(d,b,f,c,a){d.moveTo(b+c/2,f),d.lineTo(b+c,f+a),d.lineTo(b,f+a),d.closePath()},_hexagon:function(d,b,f,c,a){d.moveTo(b,f+a/2),d.lineTo(b+c/4,f+a),d.lineTo(b+c*3/4,+f+a),d.lineTo(b+c,f+a/2),d.lineTo(b+c*3/4,f),d.lineTo(b+c/4,f),d.closePath()},_pentagon:function(g,l,d,b,f){var m=b*2,c=f*2,k=l+b/2,h=d+f/2;g.moveTo(k-m/4,h-c/12),g.lineTo(k-m/6,h+c/4),g.lineTo(k+m/6,h+c/4),g.lineTo(k+m/4,h-c/12),g.lineTo(k+0,h-c/4),g.closePath()},_diamond:function(d,b,f,c,a){d.moveTo(b+c/2,f),d.lineTo(b,f+a/2),d.lineTo(b+c/2,f+a),d.lineTo(b+c,f+a/2),d.closePath()},fill:function(g,l,d,b,f,m,c,k){var h=M[d];h?arguments.length===5?g.fillStyle=h(g,l,b,f.x,f.y,f.width,f.height):g.fillStyle=h(g,l,b,f,m,c,k):g.fillStyle=l},"linear.southwest":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b+h,f+d,b);return a.addColorStop(0,k),a.addColorStop(1,c),a},"linear.southeast":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f+d,b+h,f,b);return a.addColorStop(0,k),a.addColorStop(1,c),a},"linear.northwest":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f+d,b+h,f,b);return a.addColorStop(0,c),a.addColorStop(1,k),a},"linear.northeast":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f+d,b,f,b+h);return a.addColorStop(0,k),a.addColorStop(1,c),a},"linear.north":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b,f,b+h);return a.addColorStop(0,k),a.addColorStop(1,c),a},"linear.south":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b,f,b+h);return a.addColorStop(0,c),a.addColorStop(1,k),a},"linear.west":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b,f+d,b);return a.addColorStop(0,k),a.addColorStop(1,c),a},"linear.east":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b,f+d,b);return a.addColorStop(0,c),a.addColorStop(1,k),a},"radial.center":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.5,0.5)},"radial.southwest":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.75,0.25)},"radial.southeast":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.75,0.75)},"radial.northwest":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.25,0.25)},"radial.northeast":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.75,0.25)},"radial.north":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.5,0.25)},"radial.south":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.5,0.75)},"radial.west":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.25,0.5)},"radial.east":function(f,b,h,d,a,c,g){return M.createRadialGradient(f,b,h,d,a,c,g,0.75,0.5)},"spread.horizontal":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b,f+d,b);return a.addColorStop(0,c),a.addColorStop(0.5,k),a.addColorStop(1,c),a},"spread.vertical":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b,f,b+h);return a.addColorStop(0,c),a.addColorStop(0.5,k),a.addColorStop(1,c),a},"spread.diagonal":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f+d,b,f,b+h);return a.addColorStop(0,c),a.addColorStop(0.5,k),a.addColorStop(1,c),a},"spread.antidiagonal":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b,f+d,b+h);return a.addColorStop(0,c),a.addColorStop(0.5,k),a.addColorStop(1,c),a},"spread.north":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b-h/4,f,b+h+h/4);return a.addColorStop(0,c),a.addColorStop(1/3,k),a.addColorStop(2/3,c),a.addColorStop(1,k),a},"spread.south":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f,b-h/4,f,b+h+h/4);return a.addColorStop(0,k),a.addColorStop(1/3,c),a.addColorStop(2/3,k),a.addColorStop(1,c),a},"spread.west":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f-d/4,b,f+d+d/4,b);return a.addColorStop(0,c),a.addColorStop(1/3,k),a.addColorStop(2/3,c),a.addColorStop(1,k),a},"spread.east":function(g,c,k,f,b,d,h){var a=g.createLinearGradient(f-d/4,b,f+d+d/4,b);return a.addColorStop(0,k),a.addColorStop(1/3,c),a.addColorStop(2/3,k),a.addColorStop(1,c),a},createRadialGradient:function(k,p,d,b,g,v,c,m,l){var h=k.createRadialGradient(b+v*m,g+c*l,Math.min(v,c)/24,b+v/2,g+c/2,Math.max(v,c)/2);return h.addColorStop(0,d),h.addColorStop(1,p),h},drawPath:function(N,ai,p,f,aj,k,ah,af){var x=N._element,T=N.getBodyRect();f&&X.addPadding(T,x,p+".padding",1);var C=U.clone(T),S=x.getStyle(p+".outline.width");S>0&&X.grow(C,S/2,S/2);var v=N.setShadow(N,ai,C),E=x.getStyle(p+".fill"),ae;if(E){N._innerColor&&!F.hasDefault(N._element)?ae=N._innerColor:ae=x.getStyle(p+".fill.color");var ad=x.getStyle(p+".gradient");ad?M.fill(v,ae,ad,x.getStyle(p+".gradient.color"),T):v.fillStyle=ae}var ag=x.getStyle(p+".shape");return E&&(v.beginPath(),k?M.drawLinePoints(v,k,null,ah,af):M.drawVector(v,ag,null,T),v.fill()),S>0&&(v.lineWidth=S,v.lineCap=x.getStyle(p+".cap"),v.lineJoin=x.getStyle(p+".join"),v.strokeStyle=x.getStyle(p+".outline.color"),v.beginPath(),k?M.drawLinePoints(v,k,aj,ah,af):M.drawVector(v,ag,aj,T),v.stroke()),C},draw3DRect:function(w,E,g,b,m,N,d){if(g===0){return}arguments.length<=4&&(d=b.height,N=b.width,m=b.y,b=b.x);var C=g>0;g=Math.abs(g);var y,v;w.lineWidth=1,w.lineCap="square";if(g===1){y=M.brighter(E),v=M.darker(E),w.strokeStyle=C?y:v,w.beginPath(),w.moveTo(b,m),w.lineTo(b,m+d),w.moveTo(b,m),w.lineTo(b+N,m),w.closePath(),w.stroke(),w.strokeStyle=C?v:y,w.beginPath(),w.moveTo(b,m+d),w.lineTo(b+N,m+d),w.moveTo(b+N,m),w.lineTo(b+N,m+d),w.closePath(),w.stroke()}else{var k=g*2,x=50/k;for(var p=0;p<k;p++){y=M.brighter(E,50-p*x),v=M.darker(E,50-p*x),b+=0.5,m+=0.5,N-=1,d-=1,w.strokeStyle=C?y:v,w.beginPath(),w.moveTo(b,m),w.lineTo(b,m+d),w.moveTo(b,m),w.lineTo(b+N,m),w.closePath(),w.stroke(),w.strokeStyle=C?v:y,w.beginPath(),w.moveTo(b,m+d),w.lineTo(b+N,m+d),w.moveTo(b+N,m),w.lineTo(b+N,m+d),w.closePath(),w.stroke()}}},brighter:function(b,a){return a||(a=50),M.adjustBrightness2(b,a)},darker:function(b,a){return a||(a=50),M.adjustBrightness2(b,-a)},adjustBrightness2:function(d,b){var g,a,c;if(b===0){return f}var f=L.ImageAsset._getValue(d);return b<0?(b=(100+b)/100,g=Math.ceil((f>>16&255)*b),a=Math.ceil((f>>8&255)*b),c=Math.ceil((f&255)*b)):(b/=100,g=f>>16&255,a=f>>8&255,c=f&255,g+=(255-g)*b,a+=(255-a)*b,c+=(255-c)*b,g=Math.min(Math.ceil(g),255),a=Math.min(Math.ceil(a),255),c=Math.min(Math.ceil(c),255)),"rgba("+g+","+a+","+c+",1)"},getColorArray:function(b){var a=L.ImageAsset._canvas;a.width=3,a.height=3;var c=a.getContext("2d");return c.clearRect(0,0,3,3),c.fillStyle=b,c.beginPath(),c.rect(0,0,3,3),c.closePath(),c.fill(),c.getImageData(1,1,1,1).data},hit:function(g,l,d){if(!g){return !1}var b=g._viewRect;if(!b){return !1}l-=b.x,d-=b.y;if(l<0||d<0||l>=b.width||d>=b.height){return !1}try{var f=g.getContext("2d").getImageData(l,d,1,1),m=f.data;for(var c=0,k=m.length;c<k;c+=4){if(m[c+3]!==0){return !0}}}catch(h){return !0}return !1},intersects:function(f,b){if(!f){return !1}b=X.intersection(b,f._viewRect);if(!b){return !1}b.x-=f._viewRect.x,b.y-=f._viewRect.y;try{var d=f.getContext("2d").getImageData(b.x,b.y,b.width,b.height),a=d.data;for(var c=0;n=a.length,c<n;c+=4){if(a[c+3]!==0){return !0}}}catch(g){}return !1}};U.g=M;var Z=function(b,a,c){this.g=b,this.onLength=a,this.offLength=c,this.isLine=!0,this.overflow=0,this.dashLength=a+c,this.pen={x:0,y:0}};U.ext(Z,Object,{_curveaccuracy:6,moveTo:function(b,a){this.pen={x:b,y:a},this.g.moveTo(b,a),this.start||(this.start={x:b,y:a})},lineTo:function(y,S){var k=y-this.pen.x,b=S-this.pen.y,v=Math.atan2(b,k),T=Math.cos(v),g=Math.sin(v),N=this.lineLength(this.pen.x,this.pen.y,y,S);if(this.overflow){if(this.overflow>N){this.isLine?this._lineTo(y,S):this.moveTo(y,S),this.overflow-=N;return}this.isLine?this._lineTo(this.pen.x+T*this.overflow,this.pen.y+g*this.overflow):this.moveTo(this.pen.x+T*this.overflow,this.pen.y+g*this.overflow),N-=this.overflow,this.overflow=0,this.isLine=!this.isLine;if(!N){return}}var E=Math.floor(N/this.dashLength);if(E){var x=T*this.onLength,m=g*this.onLength,C=T*this.offLength,w=g*this.offLength;for(var d=0;d<E;d++){this.isLine?(this._lineTo(this.pen.x+x,this.pen.y+m),this.moveTo(this.pen.x+C,this.pen.y+w)):(this.moveTo(this.pen.x+C,this.pen.y+w),this._lineTo(this.pen.x+x,this.pen.y+m))}N-=this.dashLength*E}this.isLine?N>this.onLength?(this._lineTo(this.pen.x+T*this.onLength,this.pen.y+g*this.onLength),this.moveTo(y,S),this.overflow=this.offLength-(N-this.onLength),this.isLine=!1):(this._lineTo(y,S),N==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-N,this.moveTo(y,S))):N>this.offLength?(this.moveTo(this.pen.x+T*this.offLength,this.pen.y+g*this.offLength),this._lineTo(y,S),this.overflow=this.onLength-(N-this.offLength),this.isLine=!0):(this.moveTo(y,S),N==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-N)},quadraticCurveTo:function(C,ad,m,b){var w=this.pen.x,ae=this.pen.y,k=this.curveLength(w,ae,C,ad,m,b),T=0,S=0,y;if(this.overflow){if(this.overflow>k){this.isLine?this._curveTo(C,ad,m,b):this.moveTo(m,b),this.overflow-=k;return}T=this.overflow/k,y=this.curveSliceUpTo(w,ae,C,ad,m,b,T),this.isLine?this._curveTo(y[2],y[3],y[4],y[5]):this.moveTo(y[4],y[5]),this.overflow=0,this.isLine=!this.isLine;if(!k){return}}var v=k-k*T,N=Math.floor(v/this.dashLength),x=this.onLength/k,g=this.offLength/k;if(N){for(var E=0;E<N;E++){this.isLine?(S=T+x,y=this.curveSlice(w,ae,C,ad,m,b,T,S),this._curveTo(y[2],y[3],y[4],y[5]),T=S,S=T+g,y=this.curveSlice(w,ae,C,ad,m,b,T,S),this.moveTo(y[4],y[5])):(S=T+g,y=this.curveSlice(w,ae,C,ad,m,b,T,S),this.moveTo(y[4],y[5]),T=S,S=T+x,y=this.curveSlice(w,ae,C,ad,m,b,T,S),this._curveTo(y[2],y[3],y[4],y[5])),T=S}}v=k-k*T,this.isLine?v>this.onLength?(S=T+x,y=this.curveSlice(w,ae,C,ad,m,b,T,S),this._curveTo(y[2],y[3],y[4],y[5]),this.moveTo(m,b),this.overflow=this.offLength-(v-this.onLength),this.isLine=!1):(y=this.curveSliceFrom(w,ae,C,ad,m,b,T),this._curveTo(y[2],y[3],y[4],y[5]),k==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-v,this.moveTo(m,b))):v>this.offLength?(S=T+g,y=this.curveSlice(w,ae,C,ad,m,b,T,S),this.moveTo(y[4],y[5]),y=this.curveSliceFrom(w,ae,C,ad,m,b,S),this._curveTo(y[2],y[3],y[4],y[5]),this.overflow=this.onLength-(v-this.offLength),this.isLine=!0):(this.moveTo(m,b),v==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-v)},bezierCurveTo:function(d,b,f,b,c,a){this.pen={x:c,y:a},this.g.bezierCurveTo(d,b,f,b,c,a)},rect:function(c,a,d,b){this.pen={x:c,y:a},this.moveTo(c,a),this.lineTo(c,a+b),this.lineTo(c+d,a+b),this.lineTo(c+d,a),this.lineTo(c,a)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(f,b,g,d){var a=g-f,c=d-b;return Math.sqrt(a*a+c*c)},curveLength:function(aj,x,T,E,af,C,S){var w=0,am=aj,ai=x,ae,al,ag,N,ak,k,ad,ah=S>0?S:this._curveaccuracy;for(var b=1;b<=ah;b++){ag=b/ah,N=1-ag,ak=N*N,k=2*ag*N,ad=ag*ag,ae=ak*aj+k*T+ad*af,al=ak*x+k*E+ad*C,w+=this.lineLength(am,ai,ae,al),am=ae,ai=al}return w},curveSlice:function(g,l,d,b,f,m,c,k){if(c==0){return this.curveSliceUpTo(g,l,d,b,f,m,k)}if(k==1){return this.curveSliceFrom(g,l,d,b,f,m,c)}var h=this.curveSliceUpTo(g,l,d,b,f,m,k);return h.push(c/k),this.curveSliceFrom.apply(this,h)},curveSliceUpTo:function(g,l,d,b,f,m,c){if(c!=1){var k=d+(f-d)*c,h=b+(m-b)*c;d=g+(d-g)*c,b=l+(b-l)*c,f=d+(k-d)*c,m=b+(h-b)*c}return[g,l,d,b,f,m]},curveSliceFrom:function(g,l,d,b,f,m,c){if(c!=1){var k=g+(d-g)*c,h=l+(b-l)*c;d+=(f-d)*c,b+=(m-b)*c,g=k+(d-k)*c,l=h+(b-h)*c}return[g,l,d,b,f,m]},_lineTo:function(b,a){if(b==this.pen.x&&a==this.pen.y){return}this.pen={x:b,y:a},this.g.lineTo(b,a)},_curveTo:function(c,a,d,b){if(c==d&&a==b&&d==this.pen.x&&b==this.pen.y){return}this.pen={x:d,y:b},this.g.quadraticCurveTo(c,a,d,b)}}),U.Dashline=Z;var F={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(b){if(b instanceof K){var a=b.getStyle("body.type");return F.DEFAULTS[a]===1}return !0},hasVector:function(b){if(b instanceof K){var a=b.getStyle("body.type");return F.VECTORS[a]===1}return !1},hasAgentLinks:function(c){var a=c.getChildrenSize();for(var d=0;d<a;d++){var b=c.getChildAt(d);if(b instanceof K&&F.hasAgentLinks(b)){return !0}}return c.hasAgentLinks()},getParents:function(d,b,f){f||(f=!0);var c=new B,a=d.getParent();while(a!=null&&a!==b){c.add(a,0),a=a.getParent()}return f&&a!=null&&a===b&&c.add(a,0),c},getSubNetwork:function(d){if(!d){return null}if(d instanceof L.Link){var b=d.getFromAgent(),g=d.getToAgent();if(!b||!g){return null}var a=F.getSubNetwork(b),c=F.getSubNetwork(g);return a===c?a:null}var f=d.getParent();if(!f){return null}while(f instanceof L.Link&&!f.ISubNetwork){f=f.getParent()}return f.ISubNetwork?f:F.getSubNetwork(f)},figureSameSubNetworkAgent:function(b){if(!b){return null}var a=b.getParent();while(a instanceof R){if(!(a.getParent() instanceof R)){return a.isExpanded()?b:a}a.isExpanded()||(b=a),a=a.getParent()}return b},figureSpanSubNetworkAgent:function(g,l){if(!g||!l){return null}var d=F.getSubNetwork(g),b=F.getSubNetwork(l);if(d!=b){while(b!=null&&d!=b){b=F.getSubNetwork(b)}if(d===b){return g}var f=new B;f.add(g,0);var m=g.getParent();while(m instanceof K){if(!!l.isDescendantOf(m)){break}f.add(m,0),m=m.getParent()}var c=f.size();for(var k=0;k<c;k++){var h=f.get(k);if(h instanceof R&&!h.isExpanded()){return h}if(h.ISubNetwork){return h}}return g}return g},figureFromAgent:function(b){if(b.isLooped()){return b.getFromNode()}var a=F.figureSameSubNetworkAgent(b.getFromNode()),c=F.figureSameSubNetworkAgent(b.getToNode());return a===c?b.getFromNode():F.figureSpanSubNetworkAgent(a,c)},figureToAgent:function(b){if(b.isLooped()){return b.getToNode()}var a=F.figureSameSubNetworkAgent(b.getFromNode()),c=F.figureSameSubNetworkAgent(b.getToNode());return a===c?b.getToNode():F.figureSpanSubNetworkAgent(c,a)},getBundleLinks:function(g,c){if(!g||!c){return null}var k,f,b,d;if(g===c){d=g.getLoopedLinks();if(!d){return null}d=new B(d)}else{var h=g.getAgentLinks(),a=c.getAgentLinks();if(!h||!a){return null}f=h.size();for(k=0;k<f;k++){b=h.get(k),a.contains(b)&&(d||(d=new B),d.add(b))}}if(d!=null){for(k=0;k<d.size();k++){b=d.get(k),b.getStyle("link.bundle.enable")||(b._setBundleLinks(null),d.removeAt(k),k--)}}return d},resetBundleLinks:function(m,w){var d=F.getBundleLinks(m,w);if(!d||d.size()===0){return}var h=null;if(d.size()===1){h=d.get(0),h._setBundleLinks(null);return}var x,b,v=new B;for(x=0;x<d.size();x++){h=d.get(x),b=h.getStyle("link.bundle.id"),v.indexOf(b)<0&&v.add(b)}v.sort();var r,k=new B,g;for(g=0;g<v.size();g++){b=v.get(g);var p=new B;for(x=0;x<d.size();x++){h=d.get(x),b===h.getStyle("link.bundle.id")&&p.add(h)}r=new L.BundleLinks(p,k),k.add(r)}for(g=0;g<k.size();g++){r=k.get(g);for(x=0;x<r.getLinks().size();x++){h=r.getLinks().get(x),h._setBundleLinks(r)}}},moveElements:function(f,b,h,d){var a=F.filterMovingElements(f,d),c=a.size();for(var g=0;g<c;g++){a.get(g).translate(b,h)}},filterMovingElements:function(k,r){var c=new B,g=k.size();for(var v=0;v<g;v++){var b=k.get(v);if(!(b instanceof K)){continue}if(r&&!r(b)){continue}var p=!0,m=c.toArray();for(var h=0;h<m.length;h++){var d=m[h];p&&d instanceof L.Follower&&b instanceof L.Follower&&b.isLoopedHostOn(d)?p=!1:d instanceof L.Follower&&d.isHostOn(b)?c.remove(d):p&&b instanceof L.Follower&&d instanceof K&&b.isHostOn(d)?p=!1:F.isDescendantOfGroup(d,b)?c.remove(d):p&&F.isDescendantOfGroup(b,d)&&(p=!1)}p&&c.add(b)}return c},isDescendantOfGroup:function(b,a){if(!!b&&a instanceof R){if(!a.hasChildren()){return !1}b=b.getParent();while(b instanceof R){if(b===a){return !0}b=b.getParent()}return !1}return !1}};U.element=F;var P={between:function(b,a,c){return c>=b&&c<=a?!0:c>=a&&c<=b?!0:!1},considerEast:function(b,a,c){return a?P.between(a.x,c.x,b.x)?c.x>a.x:Math.abs(a.x-b.x)>Math.abs(c.x-b.x):!0},considerWest:function(b,a,c){return a?P.between(a.x,c.x,b.x)?c.x<a.x:Math.abs(a.x-b.x)>Math.abs(c.x-b.x):!0},considerNorth:function(b,a,c){return a?P.between(a.y,c.y,b.y)?c.y<a.y:Math.abs(a.y-b.y)>Math.abs(c.y-b.y):!0},considerSouth:function(b,a,c){return a?P.between(a.y,c.y,b.y)?c.y>a.y:Math.abs(a.y-b.y)>Math.abs(c.y-b.y):!0},getHorizontalPoint:function(b,a,c){return P.between(a.x,c.x,b.x)?{x:b.x,y:a.y}:Math.abs(b.x-a.x)<Math.abs(b.x-c.x)?{x:a.x,y:a.y}:{x:c.x,y:c.y}},getVerticalPoint:function(b,a,c){return P.between(a.y,c.y,b.y)?{x:a.x,y:b.y}:Math.abs(b.y-a.y)<Math.abs(b.y-c.y)?{x:a.x,y:a.y}:{x:c.x,y:c.y}},getPoint:function(f,b,h,d,a){var c=Math.abs(d.x-h.x)>Math.abs(d.y-h.y);if("south"===a){return c&&P.considerSouth(b,f,h)?P.getHorizontalPoint(b,h,d):null}if("north"===a){return c&&P.considerNorth(b,f,h)?P.getHorizontalPoint(b,h,d):null}if("west"===a){return !c&&P.considerWest(b,f,h)?P.getVerticalPoint(b,h,d):null}if("east"===a){return !c&&P.considerEast(b,f,h)?P.getVerticalPoint(b,h,d):null}if("nearby"===a){var g;return c?g=P.getHorizontalPoint(b,h,d):g=P.getVerticalPoint(b,h,d),!f||X.getDistance(f,b)>X.getDistance(g,b)?g:null}return null},getBusPoint:function(g,l,d){var b,f=g.size();if(f>0){var m=g.get(0);for(var c=1;c<f;c++){var k=g.get(c),h=P.getPoint(b,l,m,k,d);h&&(b=h),m=k}b||(b={x:m.x,y:m.y})}return b}};U.bus=P;var W={createFromPoint:function(g){var p=g._element;if(!p.getFromAgent()){return{x:0,y:0}}var d=p.getStyle("link.from.position"),r=p.getStyle("link.from.xoffset"),b=p.getStyle("link.from.yoffset"),m;if(!U.isCalculatingBus){U.isCalculatingBus=!0;if(p.getFromAgent() instanceof L.Bus){var k=p.getFromAgent();if(F.hasVector(k)){var f=k.getStyle("vector.shape");if(f==="oval"){m=X.getEllipsePoint(k.getRect(),W.createToPoint(g))}else{if(f==="circle"){m=X.getEllipsePoint(X.getCircleRect(k.getRect()),W.createToPoint(g))}else{if(f==="rectangle"||f==="roundrect"){var h=new B;h.add({x:k.x,y:k.y}),h.add({x:k.x+k.width,y:k.y}),h.add({x:k.x+k.width,y:k.y+k.height}),h.add({x:k.x,y:k.y+k.height}),h.add({x:k.x,y:k.y}),m=P.getBusPoint(h,W.createToPoint(g),k.getStyle("bus.style"))}}}}else{m=P.getBusPoint(k.getPoints(),W.createToPoint(g),k.getStyle("bus.style"))}}U.isCalculatingBus=!1}return m?(m.x+=r,m.y+=b):m=g._network.getPosition(d,p.getFromAgent(),null,r,b),m},createToPoint:function(g){var p=g._element;if(!p.getToAgent()){return{x:0,y:0}}var d=p.getStyle("link.to.position"),r=p.getStyle("link.to.xoffset"),b=p.getStyle("link.to.yoffset"),m;if(!U.isCalculatingBus){U.isCalculatingBus=!0;if(p.getToAgent() instanceof L.Bus){var k=p.getToAgent();if(F.hasVector(k)){var f=k.getStyle("vector.shape");if(f==="oval"){m=X.getEllipsePoint(k.getRect(),W.createFromPoint(g))}else{if(f==="circle"){m=X.getEllipsePoint(X.getCircleRect(k.getRect()),W.createFromPoint(g))}else{if(f==="rectangle"||f==="roundrect"){var h=new B;h.add({x:k.x,y:k.y}),h.add({x:k.x+k.width,y:k.y}),h.add({x:k.x+k.width,y:k.y+k.height}),h.add({x:k.x,y:k.y+k.height}),h.add({x:k.x,y:k.y}),m=P.getBusPoint(h,W.createFromPoint(g),k.getStyle("bus.style"))}}}}else{m=P.getBusPoint(k.getPoints(),W.createFromPoint(g),k.getStyle("bus.style"))}}U.isCalculatingBus=!1}return m?(m.x+=r,m.y+=b):m=g._network.getPosition(d,p.getToAgent(),null,r,b),m},fillLoopedPoints:function(g,c,k){var f,b=W.getBundleGap(g,!0),d=b,h=g.getStyle("link.looped.type"),a=g.getStyle("link.looped.direction");if(a==="north"){return h==="arc"?W.drawArc(c.x+c.width/2,c.y,0,Math.PI,b,b,!1,k):(f={x:c.x+c.width/2,y:c.y},k.add({x:f.x+d,y:f.y}),k.add({x:f.x+d,y:f.y-b}),k.add({x:f.x-d,y:f.y-b}),k.add({x:f.x-d,y:f.y})),{x:c.x+c.width/2,y:c.y-b}}if(a==="northeast"){return h==="arc"?W.drawArc(c.x+c.width,c.y,Math.PI*1.5,Math.PI*1.5,b,b,!1,k):(f={x:c.x+c.width,y:c.y},k.add({x:f.x,y:f.y+d}),k.add({x:f.x+d,y:f.y+d}),k.add({x:f.x+d,y:f.y-b}),k.add({x:f.x-d,y:f.y-b}),k.add({x:f.x-d,y:f.y})),{x:c.x+c.width+b*0.707,y:c.y-b*0.707}}if(a==="east"){return h==="arc"?W.drawArc(c.x+c.width,c.y+c.height/2,Math.PI*1.5,Math.PI,b,b,!1,k):(f={x:c.x+c.width,y:c.y+c.height/2},k.add({x:f.x,y:f.y-d}),k.add({x:f.x+b,y:f.y-d}),k.add({x:f.x+b,y:f.y+d}),k.add({x:f.x,y:f.y+d})),{x:c.x+c.width+b,y:c.y+c.height/2}}if(a==="southeast"){return h==="arc"?W.drawArc(c.x+c.width,c.y+c.height,Math.PI,Math.PI*1.5,b,b,!1,k):(f={x:c.x+c.width,y:c.y+c.height},k.add({x:f.x,y:f.y-d}),k.add({x:f.x+d,y:f.y-d}),k.add({x:f.x+d,y:f.y+b}),k.add({x:f.x-d,y:f.y+b}),k.add({x:f.x-d,y:f.y})),{x:c.x+c.width+b*0.707,y:c.y+c.height+b*0.707}}if(a==="south"){return h==="arc"?W.drawArc(c.x+c.width/2,c.y+c.height,Math.PI,Math.PI,b,b,!1,k):(f={x:c.x+c.width/2,y:c.y+c.height},k.add({x:f.x-d,y:f.y}),k.add({x:f.x-d,y:f.y+b}),k.add({x:f.x+d,y:f.y+b}),k.add({x:f.x+d,y:f.y})),{x:c.x+c.width/2,y:c.y+c.height+b}}if(a==="southwest"){return h==="arc"?W.drawArc(c.x,c.y+c.height,Math.PI*0.5,Math.PI*1.5,b,b,!1,k):(f={x:c.x,y:c.y+c.height},k.add({x:f.x,y:f.y-d}),k.add({x:f.x-d,y:f.y-d}),k.add({x:f.x-d,y:f.y+b}),k.add({x:f.x+d,y:f.y+b}),k.add({x:f.x+d,y:f.y})),{x:c.x-b*0.707,y:c.y+c.height+b*0.707}}if(a==="west"){return h==="arc"?W.drawArc(c.x,c.y+c.height/2,Math.PI*0.5,Math.PI,b,b,!1,k):(f={x:c.x,y:c.y+c.height/2},k.add({x:f.x,y:f.y-d}),k.add({x:f.x-b,y:f.y-d}),k.add({x:f.x-b,y:f.y+d}),k.add({x:f.x,y:f.y+d})),{x:c.x-b,y:c.y+c.height/2}}if(a==="northwest"){return h==="arc"?W.drawArc(c.x,c.y,0,Math.PI*1.5,b,b,!1,k):(f={x:c.x,y:c.y},k.add({x:f.x,y:f.y+d}),k.add({x:f.x-d,y:f.y+d}),k.add({x:f.x-d,y:f.y-b}),k.add({x:f.x+d,y:f.y-b}),k.add({x:f.x+d,y:f.y})),{x:c.x-b*0.707,y:c.y-b*0.707}}throw"Can not resolve link looped direction '"+a+"'"},drawArc:function(am,N,af,T,ai,S,ae,E){var aq,al,ah,ao,aj,ad,an,C,ag,ak,k;Math.abs(T)>2*Math.PI&&(T=2*Math.PI),aj=Math.ceil(Math.abs(T)/(Math.PI/4)),aq=T/aj,al=-aq,ah=-af;if(aj>0){ad=am+Math.cos(af)*ai,an=N+Math.sin(-af)*S,E.add({x:ad,y:an});for(var ap=0;ap<aj;ap++){ah+=al,ao=ah-al/2,C=am+Math.cos(ah)*ai,ag=N+Math.sin(ah)*S,ak=am+Math.cos(ao)*(ai/Math.cos(al/2)),k=N+Math.sin(ao)*(S/Math.cos(al/2));var x=new B;x.add({x:ak,y:k}),x.add({x:C,y:ag}),E.add(x)}}},fillBundlePoints:function(ag,w,S,C,ae){var x=ag._element.getBundleCount(),N=ag._element.getBundleIndex(),k=ag.getStyle("link.bundle.expanded"),ak=W.getBundleGap(ag,!1);if(ak===0&&w!=="parallel"){return ae.add(S),ae.add(C),X.getCenterPoint(S,C)}var ad=W.getBundleOffset(ag),ai=X.getDistance(S,C);(w==="arc"||w==="triangle")&&ae.add({x:0,y:0}),w==="arc"&&ae.add({x:0,y:ak}),ae.add({x:ad,y:ak}),ae.add({x:ai-ad,y:ak}),w==="arc"&&ae.add({x:ai,y:ak}),(w==="arc"||w==="triangle")&&ae.add({x:ai,y:0});var af=Math.atan2(C.y-S.y,C.x-S.x),E=X.createMatrix(af,0,0);for(var ah=0,g=ae.size();ah<g;ah++){var T=ae.get(ah);T=E.transform(T),T.x+=S.x,T.y+=S.y,ae.set(ah,T)}if(w==="arc"){var f=X.getCenterPoint(ae.get(2),ae.get(3)),aj=new B;return aj.add(ae.get(1)),aj.add(ae.get(2)),ae.set(1,aj),aj=new B,aj.add(ae.get(4)),aj.add(ae.get(5)),ae.set(4,aj),ae.removeAt(5),ae.removeAt(2),f}return W.calculateCenterPoint(ae)},calculateCenterPoint:function(d){var b=d.size();if(d==null||b<1){return{x:0,y:0}}if(b%2===0){var f=b/2,c=d.get(f-1),a=d.get(f);return{x:(c.x+a.x)/2,y:(c.y+a.y)/2}}return d.get((b-1)/2)},getBundleOffset:function(b){var a=X.getDistance(b.getFromPoint(),b.getToPoint()),c=b.getStyle("link.bundle.offset");return a>c*2?c:a/2},getBundleGap:function(ah,w){var N=ah._element;if(!N.getBundleLinks()){return w?N.getStyle("link.looped.gap"):0}var y=w?"link.looped.gap":"link.bundle.gap",ad=null,x=0,E=0,k=N.getBundleLinks().getSiblings(),ak=0,ag=N.getStyle("link.bundle.independent");for(var T=0,aj=k.size();T<aj;T++){var ae=k.get(T);if(ag&&ae!==N.getBundleLinks()){continue}for(var C=0,ai=ae.getLinks().size();C<ai;C++){var b=ae.getLinks().get(C);if(ag!==b.getStyle("link.bundle.independent")){continue}if(ah._network.isVisible(b)){if(ad==null){ad=b,ak=b.getStyle(y)}else{var S=b.getStyle(y);E+=ak/2+S/2,ak=S}b===N&&(x=E)}}}if(w){return E-x+ak}var af=x-E/2;return ad!=null&&N.getFromAgent()!==ad.getFromAgent()&&(af=-af),af},isTargetPriority:function(b,a,c){if(b){if(a.height<c.height){return a.height+c.height<Math.max(a.y+a.height,c.y+c.height)-Math.min(a.y,c.y)+a.height/2}}else{if(a.width<c.width){return a.width+c.width<Math.max(a.x+a.width,c.x+c.width)-Math.min(a.x,c.x)+a.width/2}}return !0},calculateOrthogonalAndFlexionalLinkPoints:function(w,E,g,b){var m=W.isHorizontal(w,E,g,b),N=new B;if(W.isFlexionalTypeLink(w)){W.flexional(m,E,g,N,b.getStyle("link.extend"))}else{W.orthogonal(w,E,g,N,m,b);var d=W.isSplitByPercent(w,b),C=d?W.calculateSplitValueByPercent(w,m,E,g,b.getStyle("link.split.percent")):b.getStyle("link.split.value");C===0&&(m=!m)}var y;N.size()===0?W.isTargetPriority(m,E,g)?(y={x:g.x+g.width/2,y:g.y+g.height/2},N.add(W.rectanglePerimeter(E,!0,y)),N.add(W.rectanglePerimeter(g,!1,N.get(N.size()-1)))):(y={x:E.x+E.width/2,y:E.y+E.height/2},y=W.rectanglePerimeter(g,!1,y),N.add(W.rectanglePerimeter(E,!0,y)),N.add(y)):(y=N.get(0),N.add(W.rectanglePerimeter(E,!0,y),0),N.add(W.rectanglePerimeter(g,!1,N.get(N.size()-1))));var v=N.size();if(v<2){return N}var k=N.get(0);for(var x=1;x<v-1;x++){var p=N.get(x);p.x===k.x&&p.y===k.y&&(N.remove(p),v--,x--),k=p}return N},isHorizontal:function(f,b,g,d){if(f){if(f==="flexional.horizontal"||f==="orthogonal.horizontal"||f==="orthogonal.H.V"||f==="extend.left"||f==="extend.right"){return !0}if(f==="flexional.vertical"||f==="orthogonal.vertical"||f==="orthogonal.V.H"||f==="extend.top"||f==="extend.bottom"){return !1}}var a=W.calculateXGap(b,g),c=W.calculateYGap(b,g);return a>=c},flexional:function(d,b,f,c,a){d?W.flexionalHorizontal(b,f,c,a):W.flexionalVertical(b,f,c,a)},isSplitByPercent:function(b,a){return a.getStyle("link.split.by.percent")},isExtendTypeLink:function(a){return a&&(a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right")},isFlexionalTypeLink:function(a){return a&&(a==="flexional"||a==="flexional.horizontal"||a==="flexional.vertical")},calculateControlPoint:function(w,E,g,b,m){if(w==="orthogonal.H.V"||w==="orthogonal.V.H"){return{x:b.x+b.width/2,y:b.y+b.height/2}}var N;if(W.isExtendTypeLink(w)){var d=Math.min(g.y,b.y),C=Math.min(g.x,b.x),y=Math.max(g.y+g.height,b.y+b.height),v=Math.max(g.x+g.width,b.x+b.width);N=m.getStyle("link.extend");if(w==="extend.top"){return{x:(C+v)/2,y:d-N}}if(w==="extend.left"){return{x:C-N,y:(d+y)/2}}if(w==="extend.bottom"){return{x:(C+v)/2,y:y+N}}if(w==="extend.right"){return{x:v+N,y:(d+y)/2}}}var k=W.isSplitByPercent(w,m);N=k?W.calculateSplitValueByPercent(w,E,g,b,m.getStyle("link.split.percent")):m.getStyle("link.split.value");if(N===Number.NEGATIVE_INFINITY||N===Number.POSITIVE_INFINITY){return{x:b.x+b.width/2,y:b.y+b.height/2}}if(N===0){return{x:g.x+g.width/2,y:g.y+g.height/2}}if(E){var x=g.x+g.x+g.width<b.x+b.x+b.width;return{x:W.calculateSplitLocation(x,N,g.x,g.width),y:g.y+g.height/2}}var p=g.y+g.y+g.height<b.y+b.y+b.height;return{x:g.x+g.width/2,y:W.calculateSplitLocation(p,N,g.y,g.height)}},calculateGap:function(d,b,f,c){var a=Math.max(b,c)-Math.min(d,f);return a-(b-d+c-f)},calculateXGap:function(b,a){var c=Math.max(b.x+b.width,a.x+a.width)-Math.min(b.x,a.x);return c-b.width-a.width},calculateYGap:function(b,a){var c=Math.max(b.y+b.height,a.y+a.height)-Math.min(b.y,a.y);return c-b.height-a.height},calculateSplitValueByPercent:function(f,b,g,d,a){var c=W.calculateSplitGapByPercent(a,b,g,d);return c*a},calculateSplitGapByPercent:function(d,b,f,c,a){return b?W._calculateSplitGapByPercent(d,f.x,f.x+f.width,c.x,c.x+c.width):W._calculateSplitGapByPercent(d,f.y,f.y+f.height,c.y,c.y+c.height)},_calculateSplitGapByPercent:function(f,b,h,d,a){var c=W.calculateGap(b,h,d,a),g=b+h<d+a;if(c>0){if(f===1){return c+(a-d)/2}if(f>=0&&f<1){return c}if(f<0){return g?d-b:h-a}}return g&&f>0||!g&&f<0?Math.abs(h-a):Math.abs(b-d)},calculateSplitPercentByControlPoint:function(c,a,d,b){return a?W.calculateSplitPercent(c.x,d.x,d.x+d.width,b.x,b.x+b.width):W.calculateSplitPercent(c.y,d.y,d.y+d.height,b.y,b.y+b.height)},calculateSplitPercent:function(f,b,h,d,a){if(f>=b&&f<=h){return 0}var c=W.calculateGap(b,h,d,a);if(c>0&&f>=d&&f<=a){return 1}var g=b+h<d+a;if(c>0){if(f>Math.min(h,a)&&f<Math.max(b,d)){return Math.abs(f-(g?h:b))/c}if(g){if(f<b){return(f-b)/(d-b)}}else{if(f>h){return(h-f)/(h-a)}}}return f>h?(g?f-h:h-f)/Math.abs(h-a):(g?f-b:b-f)/Math.abs(b-d)},calculateSplitLocation:function(c,a,d,b){return c===a>0?d+b+Math.abs(a):d-Math.abs(a)},calculateAngle:function(b,a){if(b!==0&&a!==0){return Math.atan2(b,a)}if(b===0){if(a>0){return 0}if(a<0){return Math.PI}}return b>0?Math.PI/2:-Math.PI/2},drawCorner:function(ak,C){var ad=ak.size();if(ad<3){return}var N=C.getStyle("link.corner");if(N==="none"){return}var ag=C.getStyle("link.xradius"),E=C.getStyle("link.yradius"),T,x,ao=ak.get(0),aj=ak.get(1),af,am;for(var ah=2;ah<ad;ah++){var S=ak.get(ah),al=aj.x-ao.x,w=aj.y-ao.y,ae=S.x-aj.x,ai=S.y-aj.y,k=w===0;if(al===0&&ai===0||w===0&&ae===0){k?(T=Math.min(ah===2?Math.abs(al):Math.abs(al)/2,ag),x=Math.min(ah===ad-1?Math.abs(ai):Math.abs(ai)/2,E),af={x:aj.x-(al>0?T:-T),y:aj.y},am={x:aj.x,y:aj.y+(ai>0?x:-x)}):(T=Math.min(ah===ad-1?Math.abs(ae):Math.abs(ae)/2,ag),x=Math.min(ah===2?Math.abs(w):Math.abs(w)/2,E),af={x:aj.x,y:aj.y-(w>0?x:-x)},am={x:aj.x+(ae>0?T:-T),y:aj.y}),ak.remove(aj),ah--,ad--;if(af.x!==ao.x||af.y!==ao.y){ak.add(af,ah),ah++,ad++}if(N==="bevel"){ak.add(am,ah),ah++,ad++}else{if(N==="round"){var an=new B;an.add(aj),an.add(am),ak.add(an,ah),ah++,ad++}}}ao=aj,aj=S}am&&am.x===aj.x&&am.y===aj.y&&ak.remove(aj)},orthogonal:function(g,l,d,b,f,m){var c=m.getStyle("link.control.point"),k=c==null;if(c){var h=X.unionRect(l,d);X.containsPoint(h,c)||(f=W.calculateIsHorizontalByControlPoint(c.x,c.y,h.y,h.x,h.y+h.height,h.x+h.width))}else{c=W.calculateControlPoint(g,f,l,d,m)}f?W.sideToSide(l,d,c,b,k):W.topToBottom(l,d,c,b,k)},calculateIsHorizontalByControlPoint:function(f,b,g,d,a,c){return b<g&&g-b>d-f&&g-b>f-c||b>a&&b-a>d-f&&b-a>f-c?!1:!0},contains:function(b,a,c){return a>=b.x&&a<=b.x+b.width&&c>=b.y&&c<=b.y+b.height},topToBottom:function(p,y,g,b,k){var C=Math.max(p.y,y.y),d=Math.min(p.y+p.height,y.y+y.height),x=g?g.y:d+(C-d)/2,w=p.x+p.width/2,m=y.x+y.width/2;!k&&g&&(g.x>=p.x&&g.x<=p.x+p.width&&(w=g.x),g.x>=y.x&&g.x<=y.x+y.width&&(m=g.x)),!W.contains(y,w,x)&&!W.contains(p,w,x)&&b.add({x:w,y:x}),!W.contains(y,m,x)&&!W.contains(p,m,x)&&b.add({x:m,y:x});if(b.size()===0){if(g){!W.contains(y,g.x,x)&&!W.contains(p,g.x,x)&&b.add({x:g.x,y:x})}else{var h=Math.max(p.x,y.x),v=Math.min(p.x+p.width,y.x+y.width);b.add({x:h+(v-h)/2,y:x})}}},sideToSide:function(p,y,g,b,k){var C=Math.max(p.x,y.x),d=Math.min(p.x+p.width,y.x+y.width),x=g?g.x:d+(C-d)/2,w=p.y+p.height/2,m=y.y+y.height/2;!k&&g&&(g.y>=p.y&&g.y<=p.y+p.height&&(w=g.y),g.y>=y.y&&g.y<=y.y+y.height&&(m=g.y)),!W.contains(y,x,w)&&!W.contains(p,x,w)&&b.add({x:x,y:w}),!W.contains(y,x,m)&&!W.contains(p,x,m)&&b.add({x:x,y:m});if(b.size()===0){if(g){!W.contains(y,x,g.y)&&!W.contains(p,x,g.y)&&b.add({x:x,y:g.y})}else{var h=Math.max(p.y,y.y),v=Math.min(p.y+p.height,y.y+y.height);b.add({x:x,y:h+(v-h)/2})}}},flexionalHorizontal:function(E,af,m,b){var x=af.x+af.width<E.x,ag=E.x+E.width<af.x,k=x?E.x:E.x+E.width,ae=E.y+E.height/2,T=ag?af.x:af.x+af.width,C=af.y+af.height/2,w=b,S=x?-w:w,y={x:k+S,y:ae};S=ag?-w:w;var g={x:T+S,y:C};if(x===ag){var N=x?Math.min(k,T)-b:Math.max(k,T)+b;m.add({x:N,y:ae}),m.add({x:N,y:C})}else{if(y.x<g.x===x){var ad=ae+(C-ae)/2;m.add(y),m.add({x:y.x,y:ad}),m.add({x:g.x,y:ad}),m.add(g)}else{m.add(y),m.add(g)}}},flexionalVertical:function(E,af,m,b){var x=af.y+af.height<E.y,ag=E.y+E.height<af.y,k=E.x+E.width/2,ae=x?E.y:E.y+E.height,T=af.x+af.width/2,C=ag?af.y:af.y+af.height,w=b,S=x?-w:w,y={x:k,y:ae+S};S=ag?-w:w;var g={x:T,y:C+S};if(x===ag){var N=x?Math.min(ae,C)-b:Math.max(ae,C)+b;m.add({x:k,y:N}),m.add({x:T,y:N})}else{if(y.y<g.y===x){var ad=k+(T-k)/2;m.add(y),m.add({x:ad,y:y.y}),m.add({x:ad,y:g.y}),m.add(g)}else{m.add(y),m.add(g)}}},rectanglePerimeter:function(w,E,g){var b=w.x+w.width/2,m=w.y+w.height/2,N=g.x-b,d=g.y-m,C=Math.atan2(d,N),y={x:0,y:0},v=Math.PI,k=Math.PI/2,x=k-C,p=Math.atan2(w.height,w.width);return C<-v+p||C>v-p?(y.x=w.x,y.y=m-w.width*Math.tan(C)/2):C<-p?(y.y=w.y,y.x=b-w.height*Math.tan(x)/2):C<p?(y.x=w.x+w.width,y.y=m+w.width*Math.tan(C)/2):(y.y=w.y+w.height,y.x=b+w.height*Math.tan(x)/2),g.x>=w.x&&g.x<=w.x+w.width?y.x=g.x:g.y>=w.y&&g.y<=w.y+w.height&&(y.y=g.y),g.x<w.x?y.x=w.x:g.x>w.x+w.width&&(y.x=w.x+w.width),g.y<w.y?y.y=w.y:g.y>w.y+w.height&&(y.y=w.y+w.height),y},isSplitTypeLink:function(a){return a&&(a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.vertical")},isOrthogonalOrFlexionalLink:function(b){if(b instanceof L.ShapeLink){return !1}if(b.isLooped()){return !1}var a=b.getStyle("link.type");return W.isOrthogonalOrFlexionalType(a)},isOrthogonalLink:function(b){if(b instanceof L.ShapeLink){return !1}if(b.isLooped()){return !1}var a=b.getStyle("link.type");return W.isOrthogonalType(a)},isOrthogonalOrFlexionalType:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right"||a==="flexional"||a==="flexional.horizontal"||a==="flexional.vertical"},isOrthogonalType:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right"},hasControlPoint:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.vertical"||a==="extend.bottom"||a==="extend.left"||a==="extend.right"||a==="extend.top"},getControlPoint:function(f,b){if(!f){throw"link can't be null"}var h=f.getStyle("link.type");if(!W.hasControlPoint(h)){return null}var d=f.getStyle("link.control.point");if(d){return d}var a,c;b==null?(a=f.getFromAgent().getRect(),c=f.getToAgent().getRect()):(a=W.getLinkSourceBounds(b),c=W.getLinkTargetBounds(b));if(a==null||c==null){return null}var g=W.isHorizontal(h,a,c,f);return W.calculateControlPoint(f.getStyle("link.type"),g,a,c,f)},getSplitValueByControlPoint:function(g,c,k,f,b){if(c==="extend.top"){return Math.min(k.y,f.y)-g.y}if(c==="extend.left"){return Math.min(k.x,f.x)-g.x}if(c==="extend.bottom"){return g.y-Math.max(k.y+k.height,f.y+f.height)}if(c==="extend.right"){return g.x-Math.max(k.x+k.width,f.x+f.width)}var d;if(b){var h=k.x+k.x+k.width<f.x+f.x+f.width;return d=h?g.x-k.x+k.width:k.x-g.x,d>0?d:d>-k.width?0:d+k.width}var a=k.y+k.y+k.height<f.y+f.y+f.height;return d=a?g.y-k.y-k.height:k.y-g.y,d>0?d:d>-k.height?0:d+k.height},isHorizontalByControlPoint:function(f,b,g,d,a){var c=X.unionRect(g,d);return X.containsPoint(c,f)?W.isHorizontal(b,g,d,a):W.calculateIsHorizontalByControlPoint(f.x,f.y,c.y,c.x,c.y+c.height,c.x+c.width)},setParamsByControlPoint:function(g,l,d,b,f){var m=W.isHorizontalByControlPoint(g,b,l,d,f),c=f.getStyle("link.control.point");(c||b==="orthogonal"||b==="orthogonal.horizontal"||b==="orthogonal.vertical")&&f.setStyle("link.type",m?"orthogonal.horizontal":"orthogonal.vertical");if(c){f.setStyle("link.control.point",g);return}var k=W.getSplitValueByControlPoint(g,b,l,d,m);if(W.isExtendTypeLink(b)){f.setStyle("link.extend",k);return}var h=W.isSplitByPercent(b,f);if(!h){f.setStyle("link.split.value",k);return}if(k===0){f.setStyle("link.split.percent",0);return}f.setStyle("link.split.percent",W.calculateSplitPercentByControlPoint(g,m,l,d))},getLinkNodeBounds:function(f,b,h,d,a){if(f==null){return null}var c;if(!d){var g=f.getNetwork().getPosition(a,f,null,b,h);c={x:g.x,y:g.y,width:1,height:1}}else{c=f.getBodyRect(),c.x+=b,c.y+=h}return c},getLinkSourceBounds:function(f){var b=f._element,h=f.getNetwork().getElementUI(b.getFromAgent());if(h==null){return null}var d=b.getStyle("link.from.position"),a=b.getStyle("link.from.xoffset"),c=b.getStyle("link.from.yoffset"),g=b.getStyle("link.from.at.edge");return W.getLinkNodeBounds(h,a,c,g,d)},getLinkTargetBounds:function(f){var b=f._element,h=f.getNetwork().getElementUI(b.getToAgent());if(h==null){return null}var d=b.getStyle("link.to.position"),a=b.getStyle("link.to.xoffset"),c=b.getStyle("link.to.yoffset"),g=b.getStyle("link.to.at.edge");return W.getLinkNodeBounds(h,a,c,g,d)},orthogonalAndFlexional:function(d,b){var f=W.getLinkSourceBounds(d);if(f==null){return null}var c=W.getLinkTargetBounds(d);if(c==null){return null}var a=W.calculateOrthogonalAndFlexionalLinkPoints(b,f,c,d._element);return W.offsetLink(d,a),d.setHotSpot(W.calculateCenterPoint(a)),b!=="flexional"&&W.drawCorner(a,d._element),a},offsetLink:function(N,ag){var w=N._element,b=w.isBundleAgent();if(b){return}var ah=W.getBundleGap(N,!1);if(ah===0){return}var k,af,ad=!1,E=!1,y=ag.get(0),T=U.clone(y);for(var C=1,g=ag.size();C<g;C++){var S=ag.get(C),ae=S.x-T.x,x=S.y-T.y;T=U.clone(S),af=W.calculateAngle(ae,x);if(ae===0){(af-k)%Math.PI===0&&(af-k)%(2*Math.PI)!==0&&(ad=!ad,ad&&(x=-x)),(af-k)%Math.PI!==0&&(y.x+=x<0?ah:-ah),S.x+=x<0?ah:-ah}else{if(x===0){(af-k)%Math.PI===0&&(af-k)%(2*Math.PI)!==0&&(E=!E,E&&(ae=-ae));if(!k||(af-k)%Math.PI!==0){y.y-=ae<0?ah:-ah}S.y-=ae<0?ah:-ah}}k=af,y=S}}};U.link=W;var A={findMoveToBottomDatas:function(d,b,f){for(var c=0;c<f.size();c++){var a=f.get(c);d.contains(a)&&b.add(a)}for(c=0;c<f.size();c++){a=f.get(c),A.findMoveToBottomDatas(d,b,a.getChildren())}},findMoveToTopDatas:function(d,b,f){for(var c=0;c<f.size();c++){var a=f.get(f.size()-1-c);d.contains(a)&&b.add(a)}for(c=0;c<f.size();c++){a=f.get(c),A.findMoveToTopDatas(d,b,a.getChildren())}},findMoveUpDatas:function(f,b,g){var d=!1;for(var a=0;a<g.size();a++){var c=g.get(a);f.contains(c)?d&&b.add(c):d=!0}for(a=0;a<g.size();a++){c=g.get(a),A.findMoveUpDatas(f,b,c.getChildren())}},findMoveDownDatas:function(f,b,g){var d=!1;for(var a=0;a<g.size();a++){var c=g.get(g.size()-1-a);f.contains(c)?d&&b.add(c):d=!0}for(a=0;a<g.size();a++){c=g.get(a),A.findMoveDownDatas(f,b,c.getChildren())}}};U.box=A;var ab={scrollLeft:function(){return ab._filterResults(Y.pageXOffset?Y.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)},scrollTop:function(){return ab._filterResults(Y.pageYOffset?Y.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)},_filterResults:function(c,a,d){var b=c?c:0;return a&&(!b||b>a)&&(b=a),d&&(!b||b>d)?d:b},isSingleTouch:function(a){return a.touches&&a.touches.length==1},isMultiTouch:function(a){return a.touches&&a.touches.length>1},getDistance:function(b){if(!ab.isMultiTouch(b)){return 0}var a=b.touches[0],c=b.touches[1];return Math.sqrt(Math.pow(a.clientX-c.clientX,2)+Math.pow(a.clientY-c.clientY,2))}};U.touch=ab;var D={_string:function(d,a,f,c){var b=f._stringPool.get();b.style.whiteSpace="nowrap",b.style.verticalAlign="middle",b.style.padding="0px 2px",U.setText(b,d,c),b.setAttribute("title",d),a.appendChild(b)},_boolean:function(c,a,d){var b=d._booleanPool.get();a._editInfo?(b._editInfo=a._editInfo,delete a._editInfo,b.disabled=!1):b.disabled=!0,b.type="checkbox",b.style.margin="0px 2px",b.style.verticalAlign="middle",b.checked=c,a.appendChild(b),a.style.textAlign===""&&(a.style.textAlign="center")},_color:function(c,a,d){var b=d._colorPool.get();b.style.width="100%",b.style.height="100%",b.style.backgroundColor=c,b.setAttribute("title",c),a.appendChild(b)},render:function(f,b,g,d,a){if(b==null){return}var c=D["_"+f];c?c(b,g,d,a):typeof b=="boolean"?D._boolean(b,g,d,a):D._string(b,g,d,a)}};U.render=D;var H={toolTipDiv:null,getToolTipDiv:function(){if(!H.toolTipDiv){H.toolTipDiv=document.createElement("div");var b=z,a=H.toolTipDiv.style;a.position="absolute",a.color=b.TOOLTIP_COLOR,a.background=b.TOOLTIP_BACKGROUND,a.fontSize=b.TOOLTIP_FONT_SIZE,a.padding=b.TOOLTIP_PADDING,a.border=b.TOOLTIP_BORDER,a.borderRadius=b.TOOLTIP_BORDER_RADIUS,a.boxShadow=b.TOOLTIP_BOX_SHADOW,a.zIndex=100000,a.setProperty&&a.setProperty("-webkit-box-shadow",b.TOOLTIP_BOX_SHADOW,null)}return H.toolTipDiv},isToolTipVisible:function(){return H.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){var a=H.getToolTipDiv();a.parentNode&&a.parentNode.removeChild(a)},showToolTip:function(d,b){if(!d||!b){H.hideToolTip();return}var f,c,a;d.target?(f=d.clientX,c=d.clientY):(f=d.x,c=d.y),a=H.getToolTipDiv(),a.innerHTML=b,a.style.left=f+z.TOOLTIP_XOFFSET+"px",a.style.top=c+z.TOOLTIP_YOFFSET+"px",a.parentNode||document.body.appendChild(a)}};U.popup=H;var q={handleClicked:function(b,a,c){c?b.fireInteractionEvent({kind:"clickElement",event:a,element:c}):b.fireInteractionEvent({kind:"clickBackground",event:a})},handleDoubleClicked:function(b,a,c){if(b.isEditingElement()){return}c?b.fireInteractionEvent({kind:"doubleClickElement",event:a,element:c}):b.fireInteractionEvent({kind:"doubleClickBackground",event:a}),c?c instanceof L.Link&&b.isDoubleClickToLinkBundle()?c.ISubNetwork&&b.isDoubleClickToSubNetwork()&&!U.isCtrlDown(a)?(b.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&b.setCurrentSubNetwork(c,b.isSubNetworkAnimate(),function(){b.fireInteractionEvent({kind:"enterSubNetwork",event:a,element:c})}):c.reverseBundleExpanded()&&b.fireInteractionEvent({kind:"bundleLink",event:a,element:c}):c.ISubNetwork&&b.isDoubleClickToSubNetwork()?(b.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&b.setCurrentSubNetwork(c,b.isSubNetworkAnimate(),function(){b.fireInteractionEvent({kind:"enterSubNetwork",event:a,element:c})}):c instanceof R&&b.isDoubleClickToGroupExpand()&&(c.reverseExpanded(),b.fireInteractionEvent({kind:"expandGroup",event:a,element:c})):b.isDoubleClickToUpSubNetwork()&&b.upSubNetwork(b.isSubNetworkAnimate(),function(){b.fireInteractionEvent({kind:"upSubNetwork",event:a})})},handleKeyDown:function(b,a){U.isCtrlDown(a)&&a.keyCode==65?(b.isKeyboardSelectEnabled()&&b.selectAll().size()>0&&b.fireInteractionEvent({kind:"selectAll"}),V.preventDefault(a)):a.keyCode==46?(b.isKeyboardRemoveEnabled()&&b.removeSelection()&&b.fireInteractionEvent({kind:"removeElement"}),V.preventDefault(a)):U.showVersion(a)}};U.interaction=q,L.Pool=function(b,a){typeof b=="string"?this.func=function(){return document.createElement(b)}:this.func=b,this.tagName=b,a!=null&&(this.redundancy=a)},U.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){this.currentIndex++;if(this.currentIndex===this.size()){var a=this.func();return a._pool=this,a.style.margin="0px",a.style.padding="0px",this.list||(this.list=new B),this.list.add(a),a}return this.list.get(this.currentIndex)},release:function(a){this.list&&this.list.remove(a)>=0&&(delete a._selectData,delete a._expandData,delete a._checkData,delete a._editInfo,delete a.keepDefault,a.style.margin="0px",a.style.padding="0px",a.style.backgroundColor="",a.removeAttribute("title"),this.tagName==="img"&&a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height"),a.removeAttribute("src")),this.list.add(a),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list){while(this.redundancy+this.currentIndex<this.list.size()-1){delete this.list.removeAt(this.list.size()-1)._pool}}},size:function(){return this.list?this.list.size():0}}),L.Util={getVersion:function(){return"1.3.7"},registerImage:function(c,a,d,b){U.registerImage(c,a,d,b)},unregisterImage:function(a){U.unregisterImage(a)},getImageAsset:function(a){return U.getImageAsset(a)},validateLicense:function(a){U.validateLicense(a)},moveElements:function(h,f,l,d,g){if(f===0&&l===0){return}if(!h||h.isEmpty()){return}var k=L.animate.AnimateManager,c,b;k.endAnimate(),h=F.filterMovingElements(h),d&&(c=new B,b=new B),h.forEach(function(a){a instanceof K&&(d?(c.add(a),b.add({x:a.getX()+f,y:a.getY()+l})):a.translate(f,l))}),d?k.start(new L.animate.AnimateLocation(c,b,g)):g&&g()},isTypeOf:function(b,a){if(b===a){return !0}var c=b.superClass;while(c){if(c===a.prototype){return !0}c=c.constructor.superClass}return !1},setFocus:function(f){if(document.activeElement===f){return}var b,g,d=document.documentElement,a=document.body,c;d&&(O.isIE||O.isOpera||d.scrollLeft||d.scrollTop)?(b=d.scrollLeft,g=d.scrollTop,c=d):a&&(b=a.scrollLeft,g=a.scrollTop,c=a),f.focus(),c&&(c.scrollLeft=b,c.scrollTop=g)},isOpera:O.isOpera,isIE:O.isIE,isFirefox:O.isFirefox,isChrome:O.isChrome,isSafari:O.isSafari,isIPhone:O.isIPhone,isIPod:O.isIPod,isIPad:O.isIPad,isAndroid:O.isAndroid,isWebOS:O.isWebOS,isTouchable:O.isTouchable,ext:function(b,a,c){U.ext(b,a,c)},grow:function(b,a,c){X.grow(b,a,c)},containsPoint:function(b,a,c){return X.containsPoint.apply(null,arguments)},intersects:function(b,a){return X.intersects(b,a)},unionRect:function(b,a){return X.unionRect(b,a)},createDiv:function(){return V.createDiv()},createCanvas:function(){return V.createCanvas()},setCanvas:function(d,b,f,c,a){return V.setCanvas.apply(null,arguments)},drawVector:function(f,b,h,d,a,c,g){M.drawVector.apply(null,arguments)},fill:function(g,c,k,f,b,d,h,a){M.fill.apply(null,arguments)},getClass:function(a){return U.getClass(a)},getAllClassNames:function(){var b=[],a;for(a in U.classCache){b.push(a)}return b},newInstance:function(a){return U.newInstance.apply(null,arguments)},isDeserializing:function(){return U.isDeserializing},addEventListener:function(c,a,d,b){V.addEventListener(c,a,d,b)},removeEventListener:function(b,a,c){V.removeEventListener(b,a,c)},drawArrow:function(p,y,g,b,k,C,d,x,w,m,h,v){j.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(d,b,f,c,a){return X.calculatePointInfoAlongLineBySegments(d,b,f,c,a)},getSubNetwork:function(a){return F.getSubNetwork(a)}},U.ext("twaver.Util",Object,{});var B=function(){this._as=[];if(arguments.length===1){var b=arguments[0];b instanceof B&&(b=b._as);if(b instanceof Array){var a=b.length;for(var c=0;c<a;c++){this._as.push(b[c])}}else{b!=null&&this._as.push(b)}}else{if(arguments.length>1){a=arguments.length;for(c=0;c<a;c++){this._as.push(arguments[c])}}}};L.List=B,U.ext("twaver.List",Object,{size:function(){return this._as.length},isEmpty:function(){return this._as.length===0},add:function(a,b){return b===I?this._as.push(a):this._as.splice(b,0,a)},addAll:function(b){b instanceof B&&(b=b._as);if(b instanceof Array){var a=b.length;for(var c=0;c<a;c++){this._as.push(b[c])}}else{this._as.push(b)}},get:function(a){return this._as[a]},remove:function(b){var a=this._as.indexOf(b);return a>=0&&a<this._as.length&&this.removeAt(a),a},removeAt:function(a){return this._as.splice(a,1)[0]},set:function(b,a){return this._as[b]=a},clear:function(){return this._as.splice(0,this._as.length)},contains:function(a){return this.indexOf(a)>=0},indexOf:function(a){return this._as.indexOf(a)},forEach:function(d,b){var f=this._as.length;for(var c=0;c<f;c++){var a=this._as[c];b?d.call(b,a):d(a)}},forEachReverse:function(d,b){var f=this._as.length;for(var c=f-1;c>=0;c--){var a=this._as[c];b?d.call(b,a):d(a)}},toArray:function(f,b){if(f){var g=[],d=this._as.length;for(var a=0;a<d;a++){var c=this._as[a];b?f.call(b,c)&&g.push(c):f(c)&&g.push(c)}return g}return this._as.concat()},toList:function(f,b){if(f){var g=new B,d=this._as.length;for(var a=0;a<d;a++){var c=this._as[a];b?f.call(b,c)&&g.add(c):f(c)&&g.add(c)}return g}return new B(this)},sort:function(a){return a?this._as.sort(a):this._as.sort(),this},toString:function(){return this._as.toString()}});var j={shapeMap:{},init:function(){j.register("arrow.standard",j.createStandardArrow()),j.register("arrow.delta",j.createDeltaArrow()),j.register("arrow.diamond",j.createDiamondArrow()),j.register("arrow.short",j.createShortArrow()),j.register("arrow.slant",j.createSlantArrow())},createStandardArrow:function(){var a=new B;return a.add({x:-1,y:-5/9}),a.add({x:-0.75,y:0}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDeltaArrow:function(){var a=new B;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDiamondArrow:function(){var a=new B;return a.add({x:-7/12,y:5/9}),a.add({x:-14/12,y:0}),a.add({x:-7/12,y:-5/9}),a.add({x:0,y:0}),a.add({x:-7/12,y:5/9}),a},createShortArrow:function(){var a=new B;return a.add({x:-8/12,y:6/9}),a.add({x:-5/12,y:0}),a.add({x:-8/12,y:-6/9}),a.add({x:0,y:0}),a.add({x:-8/12,y:6/9}),a},createSlantArrow:function(){var a=new B;return a.add({x:-1,y:-5/9}),a.add({x:-6.5/12,y:0}),a.add({x:-0.75,y:4/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},register:function(b,a){j.shapeMap[b]=a},getShape:function(a){if(a){return j.shapeMap[a]}throw"shape type can't be null"},getArrowRect:function(S,ah,k,a,C,ai,f){var ag=j.getShape(k);if(!ag||ag.size()<=0){return null}var x=X.calculatePointInfoAlongLine(S,ah,ai,f),ad=x.point,E=x.angle,b=ag._as,T,af=b.length,w=new B,N,ae;ae=new ac(a,0,0,C,ad.x,ad.y);for(T=0;T<af;T++){w.add(ae.transform(b[T]))}ae=X.createMatrix(E+Math.PI,ad.x,ad.y);for(T=0;T<af;T++){N=w.get(T),N instanceof B&&(N=N._as),N instanceof Array?(N[0]=ae.transform(N[0]),N[1]=ae.transform(N[1])):w.set(T,ae.transform(N))}return X.getLineRect(w)},drawArrow:function(S,ah,w,b,C,ai,k,ag,ae,y,ad,E){ae=ae||0,y=y||0,ad=ad||0;var f=ad>=0&&E;if(!k&&!f){return}var T=j.getShape(ai);if(!T||T.size()<=0){return}var af=X.calculatePointInfoAlongLine(b,C,ae,y),x=af.point,N=af.angle;k&&(S.fillStyle=ag),S.beginPath(),f&&(S.lineWidth=ad,S.strokeStyle=E),j._drawArrow(S,T,N,x,ah,w),k&&S.fill(),f&&S.stroke()},_drawArrow:function(v,y,f,a,k,C){y=y._as;var d,x=y.length,g=new B,w,m;m=new ac(k,0,0,C,a.x,a.y);for(d=0;d<x;d++){g.add(m.transform(y[d]))}g=g._as,m=X.createMatrix(f+Math.PI,a.x,a.y);var b=g[0];b=m.transform(b),v.moveTo(b.x,b.y);for(d=1;d<x;d++){w=g[d],w instanceof B&&(w=w._as),w instanceof Array?(w[0]=m.transform(w[0]),w[1]=m.transform(w[1]),v.quadraticCurveTo(w[0].x,w[0].y,w[1].x,w[1].y)):(w=m.transform(w),v.lineTo(w.x,w.y))}},drawLinkArrow:function(b,a,c){if(c.size()<2){return}b._element.getStyle("arrow.from")&&j._drawFromArrow(b,a,c),b._element.getStyle("arrow.to")&&j._drawToArrow(b,a,c)},_drawFromArrow:function(p,y,g){var b=p._element,k=b.getStyle("arrow.from.fill"),C=b.getStyle("arrow.from.outline.width");if(k||C>=0){var d=b.getStyle("arrow.from.width"),x=b.getStyle("arrow.from.height"),w=b.getStyle("arrow.from.xoffset");if(w>0&&w<1){var m;p.getLineLength?m=p.getLineLength():m=p._element.getLineLength(),w*=m}else{p.getLineLength&&(w+=j.calculateArrowXOffsetAtEdge(g,p,!0))}var h=b.getStyle("arrow.from.yoffset"),v=b.getStyle("arrow.from.shape");j.drawArrow(y,d,x,g,!0,v,k,b.getStyle("arrow.from.color"),w,h,C,b.getStyle("arrow.from.outline.color"))}},_drawToArrow:function(p,y,g){var b=p._element,k=b.getStyle("arrow.to.fill"),C=b.getStyle("arrow.to.outline.width");if(k||C>=0){var d=b.getStyle("arrow.to.width"),x=b.getStyle("arrow.to.height"),w=b.getStyle("arrow.to.xoffset");if(w>0&&w<1){var m;p.getLineLength?m=p.getLineLength():m=p._element.getLineLength(),w*=m}else{p.getLineLength&&(w+=j.calculateArrowXOffsetAtEdge(g,p,!1))}var h=b.getStyle("arrow.to.yoffset"),v=b.getStyle("arrow.to.shape");j.drawArrow(y,d,x,g,!1,v,k,b.getStyle("arrow.to.color"),w,h,C,b.getStyle("arrow.to.outline.color"))}},calculateArrowXOffsetAtEdge:function(h,p,d){if(h==null||h.size()<2){return 0}var b=p._element,g=d?b.getStyle("arrow.from.at.edge"):b.getStyle("arrow.to.at.edge");if(!g){return 0}var v=d?p._network.getElementUI(b.getFromAgent()):p._network.getElementUI(b.getToAgent());if(!v){return 0}var c=v._bodyRect;if(c==null){return 0}var m=X._getPoint(h.get(d?0:h.size()-1)),k=0,f=p.getLineLength();while(j._containsByInt(c,Math.floor(m.x),Math.floor(m.y),!1)&&k<f){m=X.calculatePointInfoAlongLine(h,d,k++).point}return k},_containsByInt:function(c,d,b,a){return a=a===I?!0:a,a?d>=Math.floor(c.x)&&d<=Math.floor(c.x+c.width)&&b>=Math.floor(c.y)&&b<=Math.floor(c.y+c.height):d>Math.floor(c.x)&&d<Math.floor(c.x+c.width)&&b>Math.floor(c.y)&&b<Math.floor(c.y+c.height)}};j.init(),U.arrow=j,L.EventDispatcher=function(){},U.ext("twaver.EventDispatcher",null,{contains:function(d,b){if(this._ls){for(var f=0,c=this._ls.size(),a;f<c;f++){a=this._ls.get(f);if(d===a.l&&b===a.s){return !0}}}return !1},add:function(c,a,d){var b={l:c,s:a,a:d};this._ls||(this._ls=new B),this._f?(this._addPendings||(this._addPendings=new B),this._addPendings.add(b)):b.a?this._ls.add(b,0):this._ls.add(b)},remove:function(b,a){this._ls&&(this._f?(this._removePendings||(this._removePendings=new B),this._removePendings.add({l:b,s:a})):this._remove(b,a))},_remove:function(d,b){for(var f=0,c=this._ls.size(),a;f<c;f++){a=this._ls.get(f);if(a.l===d&&a.s===b){this._ls.removeAt(f);return}}},fire:function(c){if(this._ls){var a,d=this._ls.size(),b;this._f=!0;for(a=0;a<d;a++){b=this._ls.get(a),b.s?b.l.call(b.s,c):b.l(c)}this._f=!1;if(this._removePendings){d=this._removePendings.size();for(a=0;a<d;a++){b=this._removePendings.get(a),this._remove(b.l,b.s)}delete this._removePendings}if(this._addPendings){d=this._addPendings.size();for(a=0;a<d;a++){b=this._addPendings.get(a),b.a?this._ls.add(b,0):this._ls.add(b)}delete this._addPendings}}}}),L.ImageAsset=function(c,a,d,b){this._name=c,this._width=d,this._height=b,typeof a=="string"?this._src=a:typeof a=="function"?this._func=a:this._image=a},U.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},getImage:function(b){if(!b||!this._image){return this._image}this._map||(this._map={});var a=this._map[b];if(a){return a}var c=L.ImageAsset._getValue(b);return a=L.ImageAsset._getImage(this._image,c,this.getWidth(),this.getHeight()),this._map[b]=a,a},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func}}),L.ImageAsset._canvas=document.createElement("canvas"),L.ImageAsset._colors={},L.ImageAsset._getValue=function(d){var b=L.ImageAsset._colors[d];if(b!=null){return b}var f=L.ImageAsset._canvas;f.width=3,f.height=3;var a=f.getContext("2d");a.clearRect(0,0,3,3),a.fillStyle=d,a.beginPath(),a.rect(0,0,3,3),a.closePath(),a.fill();var c=a.getImageData(1,1,1,1).data;return b=(c[0]<<16)+(c[1]<<8)+c[2],L.ImageAsset._colors[d]=b,b},L.ImageAsset._getImage=function(y,T,b,v){var ad=document.createElement("canvas");ad.width=b,ad.height=v;var k=ad.getContext("2d");k.drawImage(y,0,0);try{var S=k.getImageData(0,0,b,v),N=S.data;for(var x=0;n=N.length,x<n;x+=4){var m=N[x+0],E=N[x+1],w=N[x+2],g=m*77+E*151+w*28>>8;g=g<<16|g<<8|g,g&=T,N[x+0]=g>>16&255,N[x+1]=g>>8&255,N[x+2]=g&255}k.putImageData(S,0,0)}catch(C){return y}return ad};var z={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, sans-serif, helvetica",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",ZOOM_MAX:5,ZOOM_MIN:0.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:0.5,PIECHART_DONUT_RATE:0.5,PIECHART_VALUE_POSITION:0.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:0.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:0.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:0.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:0.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:0.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:0.2,RADARCHART_AREA_SELECT_FILL_ALPHA:0.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:0.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:0.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:0.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:0.5,SPLITPANE_MASK_BACKGROUND:"",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,LINK_BUNDLE_AGENT_FUNCTION:null,ELEMENTUI_FUNCTION:function(b,a){var c=a.getElementUIClass();return c?new c(b,a):null},CANVASUI_FUNCTION:function(b,a){var c=a.getCanvasUIClass();return c?new c(b,a):null},SORT_FUNCTION:function(d,f){if(d===f){return 0}if(d==null&&f!=null){return 1}if(d!=null&&f==null){return -1}if(d==null&&f==null){return 0}var c=typeof d,a=typeof f,b;return c==="string"&&a==="string"&&(b=d.localeCompare(f)),c==="number"&&a==="number"&&(b=d-f),b===I&&(b=(""+d).localeCompare(""+f)),b>0?1:b<0?-1:0}};(function(){var a=z;if(Y.OverrideTWaverDefaults){for(var b in OverrideTWaverDefaults){a[b]=OverrideTWaverDefaults[b]}}a.VIEW_FONT_SIZE&&a.VIEW_FONT_FAMILY?a.FONT=a.VIEW_FONT_SIZE+" "+a.VIEW_FONT_FAMILY:a.FONT=document.createElement("canvas").getContext("2d").font,a.CHART_VALUE_FONT||(a.CHART_VALUE_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_XSCALE_TEXT_FONT||(a.BARCHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_YSCALE_TEXT_FONT||(a.BARCHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_XAXIS_TEXT_FONT||(a.BARCHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BARCHART_YAXIS_TEXT_FONT||(a.BARCHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.LINECHART_XSCALE_TEXT_FONT||(a.LINECHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.LINECHART_YSCALE_TEXT_FONT||(a.LINECHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.LINECHART_XAXIS_TEXT_FONT||(a.LINECHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.LINECHART_YAXIS_TEXT_FONT||(a.LINECHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_XAXIS_TEXT_FONT||(a.BUBBLECHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_YAXIS_TEXT_FONT||(a.BUBBLECHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_XSCALE_TEXT_FONT||(a.BUBBLECHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_YSCALE_TEXT_FONT||(a.BUBBLECHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.RADARCHART_AXIS_TEXT_FONT||(a.RADARCHART_AXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.RADARCHART_SCALE_TEXT_FONT||(a.RADARCHART_SCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.DIALCHART_SCALE_TEXT_FONT||(a.DIALCHART_SCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY)})(),L.Defaults=z,U.ext("twaver.Defaults",Object,{}),L.SerializationSettings=function(){var a=L.SerializationSettings;this.isDataBoxSerializable=a.isDataBoxSerializable,this.isLayerBoxSerializable=a.isLayerBoxSerializable,this.isStyleSerializable=a.isStyleSerializable,this.isClientSerializable=a.isClientSerializable,this._pm=U.clone(a._pm),this._sm=U.clone(a._sm),this._cm=U.clone(a._cm)},function(){var a=L.SerializationSettings;a.isDataBoxSerializable=!0,a.isLayerBoxSerializable=!0,a.isStyleSerializable=!0,a.isClientSerializable=!0,a._pm={},a._sm={},a._cm={},a.setPropertyType=function(b,c){a._pm[b]=c},a.getPropertyType=function(b){return a._pm[b]},a.setStyleType=function(b,c){a._sm[b]=c},a.getStyleType=function(b){return a._sm[b]},a.setClientType=function(b,c){a._cm[b]=c},a.getClientType=function(b){return a._cm[b]}}(),U.ext("twaver.SerializationSettings",Object,{setPropertyType:function(b,a){this._pm[b]=a},getPropertyType:function(a){return this._pm[a]},setStyleType:function(b,a){this._sm[b]=a},getStyleType:function(a){return this._sm[a]},setClientType:function(b,a){this._cm[b]=a},getClientType:function(a){return this._cm[a]}}),L.Styles={_m:{},setStyle:function(b,a){a==null?delete L.Styles._m[b]:L.Styles._m[b]=a},getStyle:function(a){return L.Styles._m[a]},getStyleProperties:function(){return U.keys(L.Styles._m)}},function(){var a=function(c,b){L.SerializationSettings.setPropertyType(c,b)};a("name","cdata"),a("icon","string"),a("toolTip","cdata"),a("parent","data"),a("layerId","string"),a("alarmState","alarmstate"),a("image","string"),a("location","point"),a("width","number"),a("height","number"),a("expanded","boolean"),a("host","data"),a("fromNode","data"),a("toNode","data"),a("points","list.point"),a("segments","list.string"),a("angle","number"),a=function(c,b,d){d==null&&(b!=null?d=typeof b:d="string"),L.Styles.setStyle(c,b),L.SerializationSettings.setStyleType(c,d)},a("chart.color",null),a("chart.value",0),a("chart.values",null,"list.number"),a("chart.value.color","#000000"),a("chart.value.font",null),a("chart.line.width",2),a("chart.marker.size",6),a("chart.marker.shape","circle"),a("chart.bubble.shape","circle"),a("chart.names",null,"list.string"),a("chart.xaxis.values",null,"list.number"),a("chart.yaxis.values",null,"list.number"),a("dialchart.rear.extension",0),a("dialchart.base.width",5),a("dialchart.top.width",0),a("dialchart.radius",0.8),a("inner.color",null),a("outer.shape","rectangle"),a("outer.color",null),a("outer.width",2),a("outer.padding",1),a("outer.padding.left",0),a("outer.padding.right",0),a("outer.padding.top",0),a("outer.padding.bottom",0),a("outer.cap","butt"),a("outer.join","miter"),a("shadow.color",null),a("shadow.xoffset",3),a("shadow.yoffset",3),a("shadow.blur",6),a("select.style","shadow"),a("select.color","rgba(0, 0, 0, 0.7)"),a("select.shape","rectangle"),a("select.width",2),a("select.padding",2),a("select.padding.left",0),a("select.padding.right",0),a("select.padding.top",0),a("select.padding.bottom",0),a("select.cap","butt"),a("select.join","miter"),a("whole.alpha",1),a("body.type","default"),a("network.label",null,"cdata"),a("image.padding",0),a("image.padding.left",0),a("image.padding.right",0),a("image.padding.top",0),a("image.padding.bottom",0),a("vector.shape","rectangle"),a("vector.fill",!0),a("vector.fill.color","#CCCCFF"),a("vector.outline.width",-1),a("vector.outline.pattern",null,"array.number"),a("vector.outline.color","#5B5B5B"),a("vector.gradient","none"),a("vector.gradient.color","#FFFFFF"),a("vector.padding",0),a("vector.padding.left",0),a("vector.padding.right",0),a("vector.padding.top",0),a("vector.padding.bottom",0),a("vector.cap","butt"),a("vector.join","miter"),a("vector.deep",0),a("group.shape","rectangle"),a("group.fill",!0),a("group.fill.color","#CCCCFF"),a("group.outline.width",-1),a("group.outline.color","#5B5B5B"),a("group.gradient","none"),a("group.gradient.color","#FFFFFF"),a("group.padding",5),a("group.padding.left",0),a("group.padding.right",0),a("group.padding.top",0),a("group.padding.bottom",0),a("group.cap","butt"),a("group.join","miter"),a("group.deep",1),a("label.alpha",1),a("label.color","#000000"),a("label.font",null),a("label.position","bottom.bottom"),a("label.direction","below"),a("label.corner.radius",0),a("label.pointer.length",0),a("label.pointer.width",8),a("label.xoffset",0),a("label.yoffset",2),a("label.padding",0),a("label.padding.left",0),a("label.padding.right",0),a("label.padding.top",0),a("label.padding.bottom",0),a("label.fill",!1),a("label.fill.color","#C0C0C0"),a("label.gradient","none"),a("label.gradient.color","#FFFFFF"),a("label.outline.width",-1),a("label.outline.color","#000000"),a("label.cap","butt"),a("label.join","miter"),a("label.shadowable",!0),a("icons.names",null,"array.string"),a("icons.colors",null,"array.string"),a("icons.position","topleft.bottomright"),a("icons.orientation","right"),a("icons.xoffset",0),a("icons.yoffset",0),a("icons.xgap",1),a("icons.ygap",1),a("alarm.alpha",1),a("alarm.color","#000000"),a("alarm.font",null),a("alarm.position","hotspot"),a("alarm.direction","aboveright"),a("alarm.corner.radius",5),a("alarm.pointer.length",10),a("alarm.pointer.width",8),a("alarm.xoffset",0),a("alarm.yoffset",0),a("alarm.padding",0),a("alarm.padding.left",0),a("alarm.padding.right",0),a("alarm.padding.top",0),a("alarm.padding.bottom",0),a("alarm.gradient","none"),a("alarm.gradient.color","#FFFFFF"),a("alarm.outline.width",-1),a("alarm.outline.color","#000000"),a("alarm.cap","butt"),a("alarm.join","miter"),a("alarm.shadowable",!0),a("link.color","#658DC1"),a("link.width",3),a("link.cap","butt"),a("link.join","miter"),a("link.type","arc"),a("link.pattern",null,"array.number"),a("link.extend",20),a("link.control.point",null,"point"),a("link.bundle.id",0),a("link.bundle.enable",!0),a("link.bundle.expanded",!0),a("link.bundle.independent",!1),a("link.bundle.offset",20),a("link.bundle.gap",12),a("link.looped.gap",6),a("link.looped.direction","northwest"),a("link.looped.type","arc"),a("link.from.position","center"),a("link.from.xoffset",0),a("link.from.yoffset",0),a("link.from.at.edge",!0),a("link.to.position","center"),a("link.to.xoffset",0),a("link.to.yoffset",0),a("link.to.at.edge",!0),a("link.split.by.percent",!0),a("link.split.percent",0.5),a("link.split.value",20),a("link.corner","round"),a("link.xradius",8),a("link.yradius",8),a("link.handler.alpha",1),a("link.handler.color","#000000"),a("link.handler.font",null),a("link.handler.position","topleft.topleft"),a("link.handler.direction","below"),a("link.handler.corner.radius",0),a("link.handler.pointer.length",0),a("link.handler.pointer.width",8),a("link.handler.xoffset",0),a("link.handler.yoffset",0),a("link.handler.padding",0),a("link.handler.padding.left",0),a("link.handler.padding.right",0),a("link.handler.padding.top",0),a("link.handler.padding.bottom",0),a("link.handler.fill",!1),a("link.handler.fill.color","#C0C0C0"),a("link.handler.gradient","none"),a("link.handler.gradient.color","#FFFFFF"),a("link.handler.outline.width",-1),a("link.handler.outline.color","#000000"),a("link.handler.cap","butt"),a("link.handler.join","miter"),a("link.handler.shadowable",!0),a("follower.row.index",0),a("follower.column.index",0),a("follower.row.span",1),a("follower.column.span",1),a("follower.padding",0),a("follower.padding.left",0),a("follower.padding.right",0),a("follower.padding.top",0),a("follower.padding.bottom",0),a("grid.row.count",1),a("grid.column.count",1),a("grid.row.percents",null,"array.number"),a("grid.column.percents",null,"array.number"),a("grid.border",1),a("grid.border.left",0),a("grid.border.right",0),a("grid.border.top",0),a("grid.border.bottom",0),a("grid.padding",1),a("grid.padding.left",0),a("grid.padding.right",0),a("grid.padding.top",0),a("grid.padding.bottom",0),a("grid.fill",!0),a("grid.fill.color","#C0C0C0"),a("grid.deep",1),a("grid.cell.deep",-1),a("shapelink.type","lineto"),a("shapenode.closed",!1),a("shapenode.pattern",null,"array.number"),a("bus.style","nearby"),a("arrow.from",!1),a("arrow.from.fill",!0),a("arrow.from.shape","arrow.standard"),a("arrow.from.color","#000000"),a("arrow.from.xoffset",0),a("arrow.from.yoffset",0),a("arrow.from.width",12),a("arrow.from.height",9),a("arrow.from.outline.color","#000000"),a("arrow.from.outline.width",-1),a("arrow.from.at.edge",!0),a("arrow.to",!1),a("arrow.to.fill",!0),a("arrow.to.shape","arrow.standard"),a("arrow.to.color","#000000"),a("arrow.to.xoffset",0),a("arrow.to.yoffset",0),a("arrow.to.width",12),a("arrow.to.height",9),a("arrow.to.outline.color","#000000"),a("arrow.to.outline.width",-1),a("arrow.to.at.edge",!0)}(),U.ext("twaver.Styles",Object,{}),L.PropertyChangeDispatcher=function(){this._dispatcher=new L.EventDispatcher},U.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(b,a,c){this._dispatcher.add(b,a,c)},removePropertyChangeListener:function(b,a){this._dispatcher.remove(b,a)},firePropertyChange:function(c,a,d){if(a==d){return !1}var b={property:c,oldValue:a,newValue:d,source:this};return this._dispatcher.fire(b),this.onPropertyChanged(b),!0},onPropertyChanged:function(a){}}),L.animate.Animate=function(){},U.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(a){}}),L.animate.AnimateProperty=function(f,b,g){this.objects=f,this.newValues=b,this.finishFunction=g,this.oldValues=new B;var d=this.objects.size();for(var a=0;a<d;a++){var c=this.objects.get(a);this.oldValues.add(this.getPropertyValue(c))}},U.ext("twaver.animate.AnimateProperty",L.animate.Animate,{action:function(f){var b=this.objects.size();for(var g=0;g<b;g++){var d=this.objects.get(g),a=this.oldValues.get(g),c=this.newValues.get(g);this.currentAction(d,a,c,f)}},getPropertyValue:function(a){},currentAction:function(c,a,d,b){}}),L.animate.AnimateBounds=function(b,a,c){this.node=b,this.newBounds=a,this.oldBounds=b.getRect(),this.finishFunction=c},U.ext("twaver.animate.AnimateBounds",L.animate.Animate,{shouldBeFinished:!0,action:function(b){var a=this.oldBounds,c=this.newBounds;node.setLocation(a.x+(c.x-a.x)*b,a.y+(c.y-a.y)*b),node.setSize(a.width+(c.width-a.width)*b,a.height+(c.height-a.height)*b)}}),L.animate.AnimateCenterLocation=function(b,a,c){L.animate.AnimateCenterLocation.superClass.constructor.call(this,b,a,c)},U.ext("twaver.animate.AnimateCenterLocation",L.animate.AnimateProperty,{getPropertyValue:function(a){return a.getCenterLocation()},currentAction:function(f,b,g,d){var a=b.x+(g.x-b.x)*d,c=b.y+(g.y-b.y)*d;f.setCenterLocation(a,c)}}),L.animate.AnimateLocation=function(b,a,c){L.animate.AnimateLocation.superClass.constructor.call(this,b,a,c)},U.ext("twaver.animate.AnimateLocation",L.animate.AnimateProperty,{getPropertyValue:function(a){return a.getLocation()},currentAction:function(f,b,g,d){var a=b.x+(g.x-b.x)*d,c=b.y+(g.y-b.y)*d;f.setLocation(a,c)}}),L.animate.AnimateScrollPosition=function(b,a,c){this.view=b,this.oldHorizontalOffset=b.scrollLeft,this.oldVerticalOffset=b.scrollTop,this.newHorizontalOffset=a,this.newVerticalOffset=c},U.ext("twaver.animate.AnimateScrollPosition",L.animate.Animate,{action:function(a){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*a,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*a}}),L.animate.AnimateZoom=function(b,a,c){this.view=b,this.oldZoom=b.getZoom(),this.newZoom=a,this.finishFunction=c},U.ext("twaver.animate.AnimateZoom",L.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*a,!1)}}),L.animate.AnimateXZoom=function(b,a,c){this.view=b,this.oldXZoom=b.getXZoom(),this.newXZoom=a,this.finishFunction=c},U.ext("twaver.animate.AnimateXZoom",L.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1)}}),L.animate.AnimateYZoom=function(b,a,c){this.view=b,this.oldYZoom=b.getYZoom(),this.newYZoom=a,this.finishFunction=c},U.ext("twaver.animate.AnimateYZoom",L.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),L.animate.AnimateXYZoom=function(c,a,d,b){this.view=c,this.oldXZoom=c.getXZoom(),this.newXZoom=a,this.oldYZoom=c.getYZoom(),this.newYZoom=d,this.finishFunction=b},U.ext("twaver.animate.AnimateXYZoom",L.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),L.animate.AnimateSubNetwork=function(b,a,c){this.network=b,this.subNetwork=a,this.finishFunction=c},U.ext("twaver.animate.AnimateSubNetwork",L.animate.Animate,{shouldBeFinished:!0,action:function(a){a>0.5?(this.network.getView().style.opacity=a*2-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-a*2}}),L.animate.AnimateManager={timer:null,animate:null,start:function(b,a){var c=L.animate.AnimateManager;b.current<0&&(b.current=0),a?U.callLater(c.startImpl,null,[b],a):c.startImpl(b)},startImpl:function(b){var a=L.animate.AnimateManager;a.animate&&a.endAnimate(),a.animate=b,a.timer=setTimeout(a.tick,b.getCurrentDelay())},tick:function(){var b=L.animate.AnimateManager,a=b.animate;if(!a){return}if(a.current<0){a.current++;return}a.current<a.step&&(a.current++,a.action(a.current/a.step),b.timer=setTimeout(b.tick,a.getCurrentDelay())),a.current>=a.step&&b.endAnimate()},endAnimate:function(){var b=L.animate.AnimateManager;if(b.animate){b.animate.shouldBeFinished&&b.animate.current<b.animate.step&&(b.animate.current=b.animate.step,b.animate.action(b.animate.current/b.animate.step));var a=b.animate.finishFunction;b.animate=null,b.timer&&(clearTimeout(b.timer),b.timer=null),a&&a()}else{b.timer&&(clearTimeout(b.timer),b.timer=null)}}},L.DataBox=function(a){L.DataBox.superClass.constructor.apply(this,arguments),arguments.length===1&&(this._name=a),this._dataList=new B,this._dataMap={},this._rootList=new B,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new L.EventDispatcher,this._dataPropertyChangeDispatcher=new L.EventDispatcher,this._hierarchyChangeDispatcher=new L.EventDispatcher,this._selectionModel=new L.SelectionModel(this)},U.ext("twaver.DataBox",L.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:z.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(b){var a=this._limit;this._limit=b,this.firePropertyChange("limit",a,b),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(b){arguments.length===0&&(b=1);while(b>0&&this._dataList.size()>0){var a=this._dataList.get(0);this.remove(a),b--}},getSiblings:function(b){if(!this.contains(b)){throw b+" dosen't belong to this dataBox"}var a=b.getParent();return a?a.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(a){return a.getParent()?a.getParent().getChildren().indexOf(a):this._rootList.indexOf(a)},getDatas:function(){return this._dataList},getDataAt:function(a){return this._dataList.get(a)},toDatas:function(b,a){return this._dataList.toList(b,a)},forEach:function(b,a){this._dataList.forEach(b,a)},forEachReverse:function(b,a){this._dataList.forEachReverse(b,a)},forEachByDepthFirst:function(f,b,g){if(b){this._depthFirst(f,b,g)}else{var d=this._rootList.size();for(var a=0;a<d;a++){var c=this._rootList.get(a);if(this._depthFirst(f,c,g)===!1){return}}}},_depthFirst:function(f,b,g){var d=b.getChildrenSize();for(var a=0;a<d;a++){var c=b.getChildAt(a);if(this._depthFirst(f,c,g)===!1){return !1}}if(g){if(f.call(g,b)===!1){return !1}}else{if(f(b)===!1){return !1}}},forEachByBreadthFirst:function(c,a,d){var b=new B;a?b.add(a):this._rootList.forEach(b.add,b);while(b.size()>0){a=b.removeAt(0),a.getChildren().forEach(b.add,b);if(d){if(c.call(d,a)===!1){return}}else{if(c(a)===!1){return}}}},add:function(b,a){if(!b){return}arguments.length===1&&(a=-1);var c=b.getId();if(this._dataMap.hasOwnProperty(c)){throw"Data with ID '"+c+"' already exists"}this._dataMap[c]=b,this._dataList.add(b),b.getParent()||(this._rootMap[c]=b,a>=0?this._rootList.add(b,a):this._rootList.add(b)),b.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:b}),this._checkLimit()},remove:function(a){this.removeById(a.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(a){this.remove(a)},this)},removeById:function(b){var a=this.getDataById(b);if(!a){return}a instanceof L.Link&&(a.setFromNode(null),a.setToNode(null)),a instanceof K&&a.getLinks()&&a.getLinks().toList().forEach(function(c){this.remove(c)},this),a instanceof K&&a.getFollowers()&&a.getFollowers().toList().forEach(function(c){c.setHost(null)}),a instanceof L.Follower&&a.getHost()&&a.setHost(null),a.toChildren().forEach(function(c){this.remove(c)},this),a.getParent()&&a.getParent().removeChild(a),this._dataList.remove(a),delete this._dataMap[b],this._rootMap[b]&&(delete this._rootMap[b],this._rootList.remove(a)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:a}),a.removePropertyChangeListener(this.handleDataPropertyChange,this)},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(b){b.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var a=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:a})}},getDataById:function(a){return this._dataMap[a]},containsById:function(a){return this._dataMap.hasOwnProperty(a)},contains:function(a){return a?this._dataMap[a.getId()]===a:!1},moveTo:function(c,a){if(!this.contains(c)){throw c+" dosen't belong to this dataBox"}var d=this.getSiblings(c),b=d.indexOf(c);if(b===a||b<0){return}a>=0&&a<=d.size()&&(d.remove(c),a>d.size()&&a--,d.add(c,a),this._hierarchyChangeDispatcher.fire({data:c,oldIndex:b,newIndex:a}))},moveUp:function(b){var a=this.getSiblings(b);this.moveTo(b,a.indexOf(b)-1)},moveDown:function(b){var a=this.getSiblings(b);this.moveTo(b,a.indexOf(b)+1)},moveToTop:function(a){this.moveTo(a,0)},moveToBottom:function(b){var a=this.getSiblings(b);this.moveTo(b,a.size())},moveSelectionUp:function(b){b||(b=this._selectionModel);var a=new B;A.findMoveUpDatas(b,a,this._rootList),a.forEach(this.moveUp,this)},moveSelectionDown:function(b){b||(b=this._selectionModel);var a=new B;A.findMoveDownDatas(b,a,this._rootList),a.forEach(this.moveDown,this)},moveSelectionToTop:function(b){b||(b=this._selectionModel);var a=new B;A.findMoveToTopDatas(b,a,this._rootList),a.forEach(this.moveToTop,this)},moveSelectionToBottom:function(b){b||(b=this._selectionModel);var a=new B;A.findMoveToBottomDatas(b,a,this._rootList),a.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(b){var a=b.source;if(b.property==="parent"){var c=a.getId();a.getParent()?this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(a)):this._rootMap[c]||(this._rootMap[c]=a,this._rootList.add(a))}this.onDataPropertyChanged(a,b),this._dataPropertyChangeDispatcher.fire(b)},onDataPropertyChanged:function(b,a){},addDataBoxChangeListener:function(b,a,c){this._dataBoxChangeDispatcher.add(b,a,c)},removeDataBoxChangeListener:function(b,a){this._dataBoxChangeDispatcher.remove(b,a)},addDataPropertyChangeListener:function(b,a,c){this._dataPropertyChangeDispatcher.add(b,a,c)},removeDataPropertyChangeListener:function(b,a){this._dataPropertyChangeDispatcher.remove(b,a)},addHierarchyChangeListener:function(b,a,c){this._hierarchyChangeDispatcher.add(b,a,c)},removeHierarchyChangeListener:function(b,a){this._hierarchyChangeDispatcher.remove(b,a)}}),L.ElementBox=function(a){L.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new L.AlarmBox(this),this._layerBox=new L.LayerBox(this),this._alarmStatePropagator=new L.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new L.EventDispatcher},L.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},U.ext("twaver.ElementBox",L.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(b,a){if(!b){return}if(!b.IElement){throw"Only IElement can be added into ElementBox"}L.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(b)},onDataPropertyChanged:function(b,a){L.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[a.property]&&this.adjustElementIndex(b),L.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(b,a,c){this._indexChangeDispatcher.add(b,a,c)},removeIndexChangeListener:function(b,a){this._indexChangeDispatcher.remove(b,a)},sendToTop:function(b){if(!this.contains(b)){return}if(b!==this.getDatas().get(this.size()-1)){var a=this.getDatas().indexOf(b);this.getDatas().removeAt(a),this.getDatas().add(b),this._indexChangeDispatcher.fire({element:b,oldIndex:a,newIndex:this.size()-1})}b instanceof L.Link&&(b.getFromAgent()&&!b.getFromAgent().isAdjustedToBottom()&&this.sendToTop(b.getFromAgent()),b.getToAgent()&&!b.getToAgent().isAdjustedToBottom()&&this.sendToTop(b.getToAgent())),b instanceof K&&b.getFollowers()&&b.getFollowers().forEach(function(c){if(c.isRelatedTo(b)){return}if(b instanceof L.Follower&&c.isLoopedHostOn(b)){return}this.sendToTop(c)},this);if(b.ISubNetwork){return}if(b instanceof R&&!b.isExpanded()){return}b.getChildren().forEach(function(c){c instanceof L.Link||this.sendToTop(c)},this)},sendToBottom:function(c,b){if(c===b){return}if(!this.contains(c)){return}if(b&&!this.contains(b)){return}var d=this.getDatas().remove(c),a=0;b&&(a=this.getDatas().indexOf(b)),this.getDatas().add(c,a),d!=a&&(this._indexChangeDispatcher.fire({element:c,oldIndex:d,newIndex:a}),c.getParent()&&!c.getParent().ISubNetwork&&!(c.getParent() instanceof L.Link)&&this.sendToBottom(c.getParent(),c))},fireIndexChange:function(b,a,c){this._indexChangeDispatcher.fire({element:b,oldIndex:a,newIndex:c})},adjustElementIndex:function(a){if(!this.contains(a)){return}a.isAdjustedToBottom()?(this.sendToBottom(a),a.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(a)},forEachByLayer:function(f,b,h){var d=this.size(),a=this.getDatas();if(!b){this._layerBox.forEachByDepthFirst(function(e){for(var k=0;k<d;k++){var l=a.get(k);if(this._layerBox.getLayerByElement(l)===e){if(h){if(f.call(h,l)===!1){return}}else{if(f(l)===!1){return}}}}},null,this)}else{for(var c=0;c<d;c++){var g=a.get(c);if(this._layerBox.getLayerByElement(g)===b){if(h){if(f.call(h,g)===!1){return}}else{if(f(g)===!1){return}}}}}},forEachByLayerReverse:function(c,a,d){var b=new B;this.forEachByLayer(function(f){b.add(f,0)},a),b.forEach(c,d)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator}}),L.SelectionModel=function(a){L.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new B,this._selectionChangeDispatcher=new L.EventDispatcher,this._selectionMap={},this._setDataBox(a)},U.ext("twaver.SelectionModel",L.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(b){if(this._selectionMode===b){return}if(b!=="noneSelection"&&b!=="singleSelection"&&b!=="multipleSelection"){return}this.clearSelection();var a=this._selectionMode;this._selectionMode=b,this.firePropertyChange("selectionMode",a,this._selectionMode)},getDataBox:function(){return this._dataBox},_setDataBox:function(b){if(!b){throw"dataBox can not be null"}if(this._dataBox===b){return}this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var a=this._dataBox;this._dataBox=b,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",a,this._dataBox)},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(b){if(b.kind==="remove"){var a=b.data;this.contains(a)&&(this._selectionList.remove(a),delete this._selectionMap[a.getId()],this.fireSelectionChange("remove",new B(a)))}else{b.kind==="clear"&&this.clearSelection()}},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(b){if(this._filterFunction===b){return}this.clearSelection();var a=this._filterFunction;this._filterFunction=b,this.firePropertyChange("filterFunction",a,this._filterFunction)},fireSelectionChange:function(b,a,c){c&&(this._selectionList.forEach(function(d){c.contains(d)?c.remove(d):c.add(d)}),a=c.toList()),this._selectionChangeDispatcher.fire({kind:b,datas:new B(a)})},addSelectionChangeListener:function(b,a,c){this._selectionChangeDispatcher.add(b,a,c)},removeSelectionChangeListener:function(b,a){this._selectionChangeDispatcher.remove(b,a)},_filterList:function(d,b){var f=new B(d);for(var c=0;c<f.size();c++){var a=f.get(c);if(this._filterFunction&&!this._filterFunction(a)||b&&this.contains(a)||!b&&!this.contains(a)||!this._dataBox.contains(a)){f.removeAt(c),c--}}return f},appendSelection:function(d){if(this._selectionMode==="noneSelection"){return}var b=this._filterList(d,!0);if(b.isEmpty()){return}var f=null;this._selectionMode==="singleSelection"&&(f=new B(this._selectionList),this._selectionList.clear(),this._selectionMap={},b=new B(b.get(b.size()-1)));for(var c=0;c<b.size();c++){var a=b.get(c);this._selectionList.add(a),this._selectionMap[a.getId()]=a}this.fireSelectionChange("append",b,f)},removeSelection:function(c){var a=this._filterList(c);if(a.size()===0){return}for(var d=0;d<a.size();d++){var b=a.get(d);this._selectionList.remove(b),delete this._selectionMap[b.getId()]}this.fireSelectionChange("remove",a)},toSelection:function(b,a){return this._selectionList.toList(b,a)},getSelection:function(){return this._selectionList},setSelection:function(d){if(this._selectionMode==="noneSelection"){return}if(this._selectionList.size()===0&&d==null){return}var b=new B(this._selectionList);this._selectionList.clear(),this._selectionMap={};var f=this._filterList(d,!0);this._selectionMode==="singleSelection"&&f.size()>1&&(f=new B(f.get(f.size()-1)));for(var c=0;c<f.size();c++){var a=f.get(c);this._selectionList.add(a),this._selectionMap[a.getId()]=a}this.fireSelectionChange("set",null,b)},clearSelection:function(){if(this._selectionList.size()>0){var a=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",a)}},selectAll:function(){if(this._selectionMode==="noneSelection"){return}var c=this._dataBox.toDatas(),a=0,d=null;if(this._filterFunction){for(a=0;a<c.size();a++){d=c.get(a),this._filterFunction(d)||(c.removeAt(a),a--)}}var b=new B(this._selectionList);this._selectionList.clear(),this._selectionMap={},this._selectionMode==="singleSelection"&&c.size()>1&&(c=new B(c.get(c.size()-1)));for(a=0;a<c.size();a++){d=c.get(a),this._selectionList.add(d),this._selectionMap[d.getId()]=d}this.fireSelectionChange("all",null,b)},size:function(){return this._selectionList.size()},contains:function(a){return a?this._selectionMap[a.getId()]!=null:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(a){return a?this._selectionMode==="noneSelection"?!1:this._filterFunction&&!this._filterFunction(a)?!1:!0:!1}}),L.QuickFinder=function(d,a,f,c,b){this._map={};if(!d){throw"dataBox can not be null"}if(!a){throw"propertyName can not be null"}this._dataBox=d,this._propertyName=a,this._propertyType=f||"accessor",this._propertyType==="accessor"&&(this._getter=U.getter(a)),this._valueFunction=c||this.getValue,this._filterFunction=b||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},U.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(a){a.kind==="add"?this._addData(a.data):a.kind==="remove"?this._removeData(a.data):a.kind==="clear"&&(this._map={})},handleDataPropertyChange:function(b){if(!this._filterFunction.call(this,b.source)){return}if(this._propertyType!=="accessor"||this._propertyName!==b.property){if(this._propertyType!=="style"||!b.source.IStyle||"S:"+this._propertyName!==b.property){if(this._propertyType!=="client"||"C:"+this._propertyName!==b.property){return}}}var a=this._getMap(b.oldValue);a&&a.remove(b.source),this._addData(b.source)},_getMap:function(a){return a=a==null?this._NULL_:a,this._map[a]},find:function(b){var a=this._getMap(b);return a?a.toList():new B},findFirst:function(b){var a=this._getMap(b);return !a||a.isEmpty()?null:a.get(0)},_addData:function(b){if(!this._filterFunction.call(this,b)){return}var a=this._valueFunction.call(this,b),c=this._getMap(a);c||(c=new B,a=a==null?this._NULL_:a,this._map[a]=c),c.add(b)},_removeData:function(b){if(!this._filterFunction.call(this,b)){return}var a=this._valueFunction.call(this,b),c=this._getMap(a);c&&(c.remove(b),c.isEmpty()&&(a=a==null?this._NULL_:a,delete this._map[a]))},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(a){return this._propertyType==="style"&&!a.IStyle?!1:this._propertyType==="accessor"&&this._valueFunction===this.getValue&&!a[this._getter]?!1:!0},getValue:function(a){return this._propertyType==="accessor"?a[this._getter]():this._propertyType==="style"&&a.getStyle?a.getStyle(this._propertyName):this._propertyType==="client"&&a.getClient?a.getClient(this._propertyName):null}}),L.PropertyPropagator=function(b,a,c){if(!b){throw"dataBox can not be null"}if(!a){throw"propertyName can not be null"}this._dataBox=b,this._propertyName=a,this._propertyType=c||"accessor",this._propertyType==="accessor"&&(this._getter=U.getter(a),this._setter=U.setter(a)),this._enable=!1,this._isPropagating=!1},U.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(a){if(this._enable===a){return}this._enable=a,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(b){this.propagate(b)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this))},handleDataBoxChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(b){if(this.isInterestedProperty(b)){this.propagate(b.source)}else{if(b.property==="parent"){var a=b.oldValue;a&&this.propagate(a),this.propagate(b.source)}}},isInterestedProperty:function(a){return this._propertyType==="accessor"&&this._propertyName===a.property?!0:this._propertyType==="style"&&a.IElement&&"S:"+this._propertyName===a.property?!0:this._propertyType==="client"&&"C:"+this._propertyName===a.property?!0:!1},propagate:function(a){if(!a||this._isPropagating){return}this._isPropagating=!0,this.propagateToTop(a),this._isPropagating=!1},propagateToTop:function(a){this.propagateToParent(null,a);while(a&&a.getParent()){this.propagateToParent(a,a.getParent()),a=a.getParent()}},propagateToParent:function(b,a){}}),L.AlarmStatePropagator=function(a){L.AlarmStatePropagator.superClass.constructor.call(this,a,"alarmState")},U.ext("twaver.AlarmStatePropagator",L.PropertyPropagator,{handleDataPropertyChange:function(a){a.property==="enablePropagation"?this.propagate(a.source):L.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,a)},propagateToParent:function(b,a){var c=null;a.getChildren().forEach(function(f){var d=f.getAlarmState().getHighestOverallAlarmSeverity();L.AlarmSeverity.compare(d,c)>0&&(c=d)}),a.getAlarmState().setPropagateSeverity(c)}}),L.AlarmSeverity=function(d,b,f,c,a){this.value=d,this.name=b,this.nickName=f,this.color=c,this.displayName=a},U.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var a=L.AlarmSeverity;a.severities=new B,a._vm={},a._nm={},a._cp=function(c,b){if(c&&b){var d=c.value-b.value;return d>0?1:d<0?-1:0}return c&&!b?1:!c&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(c,g,e,b,d){var f=new a(c,g,e,b,d);return a._vm[c]=f,a._nm[g]=f,a.severities.add(f),a.severities.sort(a._cp),f},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(b){return b?b.value===0:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),L.AlarmState=function(a){this._e=a,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},U.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var b=null;for(var a in this._am){a=L.AlarmSeverity.getByName(a);if(L.AlarmSeverity.isClearedAlarmSeverity(a)){continue}if(this.getAcknowledgedAlarmCount(a)===0){continue}b?b=L.AlarmSeverity.compare(b,a)>0?b:a:b=a}this._haa=b},_c2:function(){var b=null;for(var a in this._nm){a=L.AlarmSeverity.getByName(a);if(L.AlarmSeverity.isClearedAlarmSeverity(a)){continue}if(this.getNewAlarmCount(a)===0){continue}b?b=L.AlarmSeverity.compare(b,a)>0?b:a:b=a}this._hna=b},_c3:function(){if(!this._hna){this._hls=!1;return}for(var a in this._nm){a=L.AlarmSeverity.getByName(a);if(L.AlarmSeverity.isClearedAlarmSeverity(a)){continue}if(this.getNewAlarmCount(a)===0){continue}if(L.AlarmSeverity.compare(this._hna,a)>0){this._hls=!0;return}}this._hls=!1},_c4:function(){var b=this._haa,a=this._hna,c=this._ps;this._hoa=b,L.AlarmSeverity.compare(a,this._hoa)>0&&(this._hoa=a),L.AlarmSeverity.compare(c,this._hoa)>0&&(this._hoa=c)},_c5:function(){var b=this._haa,a=this._hna;this._hta=b,L.AlarmSeverity.compare(a,this._hta)>0&&(this._hta=a)},increaseAcknowledgedAlarm:function(b,a){a==null&&(a=1);if(a===0){return}var c=this._am[b.name];c==null&&(c=0),c+=a,this._am[b.name]=c,this._f()},increaseNewAlarm:function(b,a){a==null&&(a=1);if(a===0){return}var c=this._nm[b.name];c==null&&(c=0),c+=a,this._nm[b.name]=c,this._f()},decreaseAcknowledgedAlarm:function(b,a){a==null&&(a=1);if(a===0){return}var c=this._am[b.name];c==null&&(c=0),c-=a;if(c<0){throw"Alarm count can not be negative"}this._am[b.name]=c,this._f()},decreaseNewAlarm:function(b,a){a==null&&(a=1);if(a===0){return}var c=this._nm[b.name];c==null&&(c=0),c-=a;if(c<0){throw"Alarm count can not be negative"}this._nm[b.name]=c,this._f()},acknowledgeAlarm:function(a){this.decreaseNewAlarm(a,1),this.increaseAcknowledgedAlarm(a,1)},acknowledgeAllAlarms:function(b){if(b){var a=this.getNewAlarmCount(b);this.decreaseNewAlarm(b,a),this.increaseAcknowledgedAlarm(b,a)}else{for(var c in this._nm){this.acknowledgeAllAlarms(L.AlarmSeverity.getByName(c))}}},_c6:function(){this._aac=0;for(var a in this._am){a=L.AlarmSeverity.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)}},getAcknowledgedAlarmCount:function(b){if(b){var a=this._am[b.name];return a==null?0:a}return this._aac},getAlarmCount:function(a){return this.getAcknowledgedAlarmCount(a)+this.getNewAlarmCount(a)},_c7:function(){this._nac=0;for(var a in this._nm){a=L.AlarmSeverity.getByName(a),this._nac+=this.getNewAlarmCount(a)}},getNewAlarmCount:function(b){if(b){var a=this._nm[b.name];return a==null?0:a}return this._nac},setNewAlarmCount:function(b,a){this._nm[b.name]=a,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(b,a){this._am[b.name]=a,this._f()},removeAllAcknowledgedAlarms:function(a){a?delete this._am[a.name]:this._am={},this._f()},isEmpty:function(){return this._hoa==null},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(b){this._ep||(b=null);if(this._ps===b){return}var a=this._ps;this._ps=b,this._f(),this._e.firePropertyChange("propagateSeverity",a,b)},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(b){var a=this._ep;this._ep=b,this._e.firePropertyChange("enablePropagation",a,b)&&(b||this.setPropagateSeverity(null))}}),L.AlarmBox=function(a){if(!a){throw"elementBox can not be null."}L.AlarmBox.superClass.constructor.call(this),this._elementBox=a,this._alarmElementMapping=new L.AlarmElementMapping(this,a),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},U.ext("twaver.AlarmBox",L.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(b){var a=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=b,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",a,b),b&&this.toDatas(function(c){return c.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(b){if(!b){throw"alarmElementMapping can not be null"}if(this._alarmElementMapping===b){return}var a=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=b,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",a,b)},handleElementBoxChange:function(a){a.kind==="add"?this.handleElementAdded(a.data):a.kind==="remove"?(this.handleElementRemoved(a.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(a.data)):a.kind==="clear"&&(a.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(a){a.kind==="add"?this._increaseAlarmState(a.data):a.kind==="remove"?this._decreaseAlarmState(a.data):a.kind==="clear"&&a.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(b){var a=b.source;a.isCleared()||(b.property==="alarmSeverity"?this.handleAlarmSeverityChange(a,b):b.property==="acked"&&this.handleAckedChange(a,b)),b.property==="cleared"&&(a.isCleared()?(this._decreaseAlarmState(a,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(a)):this._increaseAlarmState(a,!0))},handleAckedChange:function(d,b){if(!d.getAlarmSeverity()){return}var f=this.getCorrespondingElements(d);if(f){for(var c=0;c<f.size();c++){var a=f.get(c);b.oldValue?a.getAlarmState().decreaseAcknowledgedAlarm(d.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(d.getAlarmSeverity()),b.newValue?a.getAlarmState().increaseAcknowledgedAlarm(d.getAlarmSeverity()):a.getAlarmState().increaseNewAlarm(d.getAlarmSeverity())}}},handleAlarmSeverityChange:function(f,b){var h=b.oldValue,d=b.newValue,a=this.getCorrespondingElements(f);if(a){for(var c=0;c<a.size();c++){var g=a.get(c);h&&(f.isAcked()?g.getAlarmState().decreaseAcknowledgedAlarm(h):g.getAlarmState().decreaseNewAlarm(h)),d&&(f.isAcked()?g.getAlarmState().increaseAcknowledgedAlarm(d):g.getAlarmState().increaseNewAlarm(d))}}},getCorrespondingAlarms:function(a){return this._alarmElementMapping.getCorrespondingAlarms(a)},getCorrespondingElements:function(a){return this._alarmElementMapping.getCorrespondingElements(a)},handleElementAdded:function(d){var b=this.getCorrespondingAlarms(d);if(b){for(var f=0;f<b.size();f++){var c=b.get(f);if(c.isCleared()){continue}var a=c.getAlarmSeverity();a&&(c.isAcked()?d.getAlarmState().increaseAcknowledgedAlarm(a):d.getAlarmState().increaseNewAlarm(a))}}},_increaseAlarmState:function(f,b){if(f.isCleared()&&!b){return}var g=f.getAlarmSeverity();if(g){var d=this.getCorrespondingElements(f);if(d){for(var a=0;a<d.size();a++){var c=d.get(a);f.isAcked()?c.getAlarmState().increaseAcknowledgedAlarm(g):c.getAlarmState().increaseNewAlarm(g)}}}},_decreaseAlarmState:function(f,b){if(f.isCleared()&&!b){return}var g=f.getAlarmSeverity();if(!g){return}var d=this.getCorrespondingElements(f);if(d){for(var a=0;a<d.size();a++){var c=d.get(a);f.isAcked()?c.getAlarmState().decreaseAcknowledgedAlarm(g):c.getAlarmState().decreaseNewAlarm(g)}}},handleElementRemoved:function(b){var a=this.getCorrespondingAlarms(b);a&&a.forEach(function(c){!c.isCleared()&&c.getAlarmSeverity()&&(c.isAcked()?b.getAlarmState().decreaseAcknowledgedAlarm(c.getAlarmSeverity()):b.getAlarmState().decreaseNewAlarm(c.getAlarmSeverity()))})},removeAlarmsByElement:function(b){var a=this.getCorrespondingAlarms(b);a&&a.forEach(this.remove,this)},add:function(b,a){if(!b.IAlarm){throw"Only IAlarm can be added into AlarmBox"}if(this._removeAlarmWhenAlarmIsCleared&&b.isCleared()){return}L.AlarmBox.superClass.add.apply(this,arguments)}}),L.AlarmElementMapping=function(b,a){if(!a){throw"ElementBox can not be null"}if(!b){throw"AlarmBox can not be null"}this._elementBox=a,this._alarmBox=b,this._alarmsFinder=new L.QuickFinder(b,"elementId")},U.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(a){return this._alarmsFinder.find(a.getId())},getCorrespondingElements:function(b){var a=this._elementBox.getDataById(b.getElementId());return new B(a)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),L.AlarmStateStatistics=function(a){L.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(a)},U.ext("twaver.AlarmStateStatistics",L.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(b){if(!b){throw"ElementBox can not be null"}if(this._elementBox===b){return}var a=this._elementBox;a&&(a.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),a.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=b,this.reset(),b.addDataPropertyChangeListener(this.handleElementPropertyChange,this),b.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",a,b)},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(a){a.property==="alarmState"&&(this.increase(a.source),this.fireAlarmStateChange())},handleElementBoxChange:function(a){a.kind==="add"?(this.increase(a.data),this.fireAlarmStateChange()):a.kind==="remove"?(this.decrease(a.data),this.fireAlarmStateChange()):a.kind==="clear"&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,L.AlarmSeverity.forEach(function(b){var a=this.getSumInfo(b);this.sumAcked+=a.ackedCount,this.sumNew+=a.newCount,this.sumTotal+=a.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(b){if(!b){return this.sumNew}var a=this.getSumInfo(b);return a.newCount},getAcknowledgedAlarmCount:function(b){if(!b){return this.sumAcked}var a=this.getSumInfo(b);return a.ackedCount},getTotalAlarmCount:function(b){if(!b){return this.sumTotal}var a=this.getSumInfo(b);return a.totalCount},getSumInfo:function(b){var a=this.severtiyMap[b.name];return a||(a={},a.newCount=0,a.ackedCount=0,a.totalCount=0,this.severtiyMap[b.name]=a),a},decrease:function(b){var a=this.elementMap[b.getId()];a&&(delete this.elementMap[b.getId()],L.AlarmSeverity.forEach(function(d){var f=a[d.name],c=this.getSumInfo(d);c.newCount=c.newCount-f.newCount,c.ackedCount=c.ackedCount-f.ackedCount,c.totalCount=c.totalCount-f.totalCount},this))},increase:function(b){this.decrease(b);if(this._filterFunction&&!this._filterFunction(b)){return}var a={};this.elementMap[b.getId()]=a,L.AlarmSeverity.forEach(function(e){var d={};d.newCount=b.getAlarmState().getNewAlarmCount(e),d.ackedCount=b.getAlarmState().getAcknowledgedAlarmCount(e),d.totalCount=b.getAlarmState().getAlarmCount(e),a[e.name]=d;var c=this.getSumInfo(e);c.newCount=c.newCount+d.newCount,c.ackedCount=c.ackedCount+d.ackedCount,c.totalCount=c.totalCount+d.totalCount},this)},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(b){var a=this._filterFunction;this._filterFunction=b,this.reset(),this.firePropertyChange("filterFunction",a,b)},getFilterFunction:function(){return _filterFunction}}),L.LayerBox=function(a){L.LayerBox.superClass.constructor.call(this),this._elementBox=a,this._defaultLayer=new L.Layer(z.LAYER_DEFAULT_ID,z.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},U.ext("twaver.LayerBox",L.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(b,a){if(!b.ILayer){throw"Only ILayer can be added into LayerBox"}L.LayerBox.superClass.add.apply(this,arguments)},removeById:function(a){if(a===this._defaultLayer.getId()){throw"Cannot remove default layer"}L.LayerBox.superClass.removeById.call(this,a)},getLayerByElement:function(b){if(!b){return null}var a=this.getDataById(b.getLayerId());return a?a:this._defaultLayer},clear:function(){this.toDatas().forEach(function(a){a!=this._defaultLayer&&this.removeById(a.getId())},this)}}),L.BundleLinks=function(f,c){this._links=f,this._siblings=c;var h,b,d=L.Styles.getStyle("link.bundle.expanded");for(h=0;h<f.size();h++){b=f.get(h);var g=b.getStyle("link.bundle.expanded",!1);if(g!=null){d=g;break}}d==null&&(d=!0);if(z.LINK_BUNDLE_AGENT_FUNCTION){var a=z.LINK_BUNDLE_AGENT_FUNCTION(f);a==null?a=f.get(0):a!=f.get(0)&&(f.remove(a),f.add(a,0))}for(h=0;h<f.size();h++){f.get(h).setStyle("link.bundle.expanded",d)}},U.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(b,a){this._siblings.forEach(function(c){c.getLinks().forEach(b,a)})}}),L.Data=function(b){L.Data.superClass.constructor.apply(this,arguments),this._childList=new B,this._childMap={},this._clientMap={};if(b===I||b===null){this._id=U.id()}else{if(typeof b=="string"||typeof b=="number"||typeof b=="boolean"){this._id=b}else{for(var d in b){if(d==="clients"){for(var a in b.clients){this._clientMap[a]=b.clients[a]}}else{if(d==="styles"){for(var c in b.styles){this._styleMap[c]=b.styles[c]}}else{b[d]!=null&&(this["_"+d]=b[d])}}}this._id==null&&(this._id=U.id())}}},U.ext("twaver.Data",L.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","icon","toolTip"],_icon:z.ICON_DATA,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(b,a){return this._childList.toList(b,a)},addChild:function(a,b){b===I&&(b=this._childList.size());if(!a||a===this){return !1}if(this._childMap[a.getId()]){return !1}if(this.isDescendantOf(a)){return !1}a.getParent()&&a.getParent().removeChild(a);if(b<0||b>this._childList.size()){b=this._childList.size()}return this._childList.add(a,b),this._childMap[a._id]=a,a.setParent(this),this.firePropertyChange("children",null,a),this.onChildAdded(a,b),!0},onChildAdded:function(b,a){},removeChild:function(b){if(!b){return !1}if(!this._childMap[b._id]){return !1}var a=this._childList.remove(b);return delete this._childMap[b._id],this.firePropertyChange("children",b,null),b.setParent(null),this.onChildRemoved(b,a),!0},onChildRemoved:function(b,a){},getChildAt:function(a){return this._childList.get(a)},clearChildren:function(){if(this._childList.size()===0){return !1}var b=this._childList.toArray(),a=b.length;for(var c=0;c<a;c++){this.removeChild(b[c])}return this.onChildrenCleared(b),!0},onChildrenCleared:function(a){},getParent:function(){return this._parent},setParent:function(b){if(this._isUpdatingParent||this._parent===b||this===b){return}if(b&&b.isDescendantOf(this)){return}var a=this._parent;this._parent=b,this._isUpdatingParent=!0,a&&a.removeChild(this),b&&b.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",a,b),this.onParentChanged(a,b)},onParentChanged:function(b,a){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(a){return a?this.isDescendantOf(a)||a.isDescendantOf(this):!1},isParentOf:function(a){return a?this._childMap[a._id]!=null:!1},isDescendantOf:function(b){if(!b){return !1}if(!b.hasChildren()){return !1}var a=this._parent;while(a){if(b===a){return !0}a=a.getParent()}return !1},toString:function(){return this.getName()?this.getName():this._id}}),L.Alarm=function(d,b,f,a,c){L.Alarm.superClass.constructor.call(this,d),this._elementId=b,this._alarmSeverity=f,this._acked=a||!1,this._cleared=c||!1},U.ext("twaver.Alarm",L.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),L.Layer=function(a){L.Layer.superClass.constructor.call(this,a)},U.ext("twaver.Layer",L.Data,{ILayer:!0,__accessor:["visible","movable","editable"],_visible:!0,_movable:!0,_editable:!0}),L.Element=function(a){this._styleMap=this._styleMap||{},this._alarmState=new L.AlarmState(this),L.Element.superClass.constructor.call(this,a)},U.ext("twaver.Element",L.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__style:1,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return !1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null}}),L.Dummy=function(a){L.Dummy.superClass.constructor.call(this,a)},U.ext("twaver.Dummy",L.Element,{IDummy:!0});var K=function(a){this._location={x:0,y:0},K.superClass.constructor.call(this,a)};L.Node=K,K.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},U.ext("twaver.Node",L.Element,{_icon:z.ICON_NODE,_image:z.IMAGE_NODE,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(a){this._followers||(this._followers=new B),this._followers.add(a)},_removeFollower:function(a){this._followers.remove(a),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(a){this._allLinks||(this._allLinks=new B),this._fromLinks||(this._fromLinks=new B),this._allLinks.add(a),this._fromLinks.add(a),this._resetLinkSet()},_addToLink:function(a){this._allLinks||(this._allLinks=new B),this._toLinks||(this._toLinks=new B),this._allLinks.add(a),this._toLinks.add(a),this._resetLinkSet()},_removeFromLink:function(a){this._allLinks.remove(a),this._fromLinks.remove(a),this._allLinks.size()===0&&delete this._allLinks,this._fromLinks.size()===0&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(a){this._allLinks.remove(a),this._toLinks.remove(a),this._allLinks.size()===0&&delete this._allLinks,this._toLinks.size()===0&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){delete this._loopedLinks;if(!this._allLinks||this._allLinks.size()===0){delete this._links;return}var a;this._allLinks.forEach(function(b){b.isLooped()&&(a||(a={}),a[b._id]||(this._loopedLinks||(this._loopedLinks=new B),this._loopedLinks.add(b),a[b._id]=b))},this),a?(this._links=new B,this._allLinks.forEach(function(b){a[b._id]?a[b._id]!==!1&&(a[b._id]=!1,this._links.add(b)):this._links.add(b)},this)):this._links=this._allLinks},hasAgentLinks:function(){return this._agentLinks!=null&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(a){this._fromAgentLinks||(this._fromAgentLinks=new B),this._allAgentLinks||(this._allAgentLinks=new B),this._fromAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()},_addToAgentLink:function(a){this._toAgentLinks||(this._toAgentLinks=new B),this._allAgentLinks||(this._allAgentLinks=new B),this._toAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()},_removeFromAgentLink:function(a){this._fromAgentLinks.remove(a),this._allAgentLinks.remove(a),this._fromAgentLinks.size()===0&&delete this._fromAgentLinks,this._allAgentLinks.size()===0&&delete this._allAgentLinks,this._resetAgentLinkSet()},_removeToAgentLink:function(a){this._toAgentLinks.remove(a),this._allAgentLinks.remove(a),this._toAgentLinks.size()===0&&delete this._toAgentLinks,this._allAgentLinks.size()===0&&delete this._allAgentLinks,this._resetAgentLinkSet()},_resetAgentLinkSet:function(){delete this._agentLinks;if(!this._allAgentLinks||this._allAgentLinks.size()===0){return}var a={};this._allAgentLinks.forEach(function(b){a[b._id]?this._agentLinks||(this._agentLinks=new B):a[b._id]=b},this),this._agentLinks?this._allAgentLinks.forEach(function(b){a[b._id]&&(this._agentLinks.add(b),delete a[b._id])},this):this._agentLinks=this._allAgentLinks},getImage:function(){return this._image},setImage:function(c){var a=this._image,d=this.getWidth(),b=this.getHeight();this._image=c,this.firePropertyChange("image",a,c),this.firePropertyChange("width",d,this.getWidth()),this.firePropertyChange("height",b,this.getHeight())},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(a){this.setLocation(a,this._location.y)},setY:function(a){this.setLocation(this._location.x,a)},getLocation:function(){return this._location},setLocation:function(c,a){var d;arguments.length===2?d={x:arguments[0],y:arguments[1]}:d=arguments[0];if(!U.num(d.x)||!U.num(d.y)){return}if(d.x===this._location.x&&d.y===this._location.y){return}var b=this._location;this._location=d,this.firePropertyChange("location",b,d)},getCenterLocation:function(){return{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(b,a){var c;arguments.length===2?c={x:arguments[0],y:arguments[1]}:c=U.clone(arguments[0]);if(!U.num(c.x)||!U.num(c.y)){return}c.x-=this.getWidth()/2,c.y-=this.getHeight()/2,this.setLocation(c)},translate:function(b,a){this.setLocation(this.getX()+b,this.getY()+a)},getWidth:function(){if(U.num(this._width)&&this._width>=0){return this._width}var b=U.getImageAsset(this._image);if(b){var a=b.getWidth();if(U.num(a)&&a>=0){return a}}return z.NODE_WIDTH},setWidth:function(b){var a=this._width;this._width=b,this.firePropertyChange("width",a,b)},getHeight:function(){if(U.num(this._height)&&this._height>=0){return this._height}var b=U.getImageAsset(this._image);if(b){var a=b.getHeight();if(U.num(a)&&a>=0){return a}}return z.NODE_HEIGHT},setHeight:function(b){var a=this._height;this._height=b,this.firePropertyChange("height",a,b)},setSize:function(){arguments.length===2?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){return{x:this.getX(),y:this.getY(),width:this.getWidth(),height:this.getHeight()}},onParentChanged:function(b,a){K.superClass.onParentChanged.call(this,b,a),this._checkLinkAgent()},_checkLinkAgent:function(){if(this._links){var b=this._links.size();for(var a=0;a<b;a++){this._links.get(a)._checkAgentNode()}}},onPropertyChanged:function(b){K.superClass.onPropertyChanged.call(this,b);if(this._followers){var a=this._followers.size();for(var c=0;c<a;c++){this._followers.get(c).handleHostPropertyChange(b)}}this.getParent() instanceof R&&K.IS_INTERESTED_NODE_PROPERTY[b.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return L.network.NodeUI},getCanvasUIClass:function(){return L.canvas.NodeUI}}),L.Link=function(b,a,c){L.Link.superClass.constructor.call(this,b instanceof K?null:b),b instanceof K&&(c=a,a=b),this.setFromNode(a),this.setToNode(c)},L.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},U.ext("twaver.Link",L.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:z.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(b){if(this._fromNode===b){return}var a=this._fromNode;this._fromNode=b,a&&a._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",a,b)},setToNode:function(b){if(this._toNode===b){return}var a=this._toNode;this._toNode=b,a&&a._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",a,b)},isLooped:function(){return this._fromNode===this._toNode&&this._fromNode!=null&&this._toNode!=null},_checkAgentNode:function(){var b=F.figureFromAgent(this),a;this._fromAgent!=b&&(a=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=b,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",a,this._fromAgent),F.resetBundleLinks(a,this._toAgent),F.resetBundleLinks(this._fromAgent,this._toAgent));var c=F.figureToAgent(this);this._toAgent!=c&&(a=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=c,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",a,this._toAgent),F.resetBundleLinks(a,this._fromAgent),F.resetBundleLinks(this._toAgent,this._fromAgent))},_setBundleLinks:function(a){this._bundleLinks=a,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var f,b,h=this._bundleLinks.getLinks(),d=!this.getStyle("link.bundle.expanded");for(f=0;f<h.size();f++){b=h.get(f),b.setStyle("link.bundle.expanded",d)}var a=this._bundleLinks.getSiblings();for(f=0;f<a.size();f++){var c=a.get(f);if(c!=this._bundleLinks){h=c.getLinks();for(var g=0;g<h.size();g++){b=h.get(g),b.firePropertyChange("bundleLinks",null,c)}}}return !0}return !1},isBundleAgent:function(){return this._bundleLinks!=null&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(b,a,c){L.Link.superClass.onStyleChanged.call(this,b,a,c),L.Link.IS_INTERESTED_BUNDLE_STYLE[b]&&F.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return L.network.LinkUI},getCanvasUIClass:function(){return L.canvas.LinkUI}}),L.Follower=function(a){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,L.Follower.superClass.constructor.call(this,a)},L.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},L.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},U.ext("twaver.Follower",K,{_host:null,getHost:function(){return this._host},setHost:function(b){if(this===b||this._host===b){return}var a=this._host;a&&a._removeFollower(this),this._host=b,this._host&&this._host._addFollower(this),this.firePropertyChange("host",a,b),this.onHostChanged(a,b)},onStyleChanged:function(b,a,c){L.Follower.superClass.onStyleChanged.call(this,b,a,c),L.Follower.IS_INTERESTED_FOLLOWER_STYLE[b]&&this.updateFollower(null)},setLocation:function(){if(this._isUpdatingLocation){return}this._isUpdatingLocation=!0,L.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1},onHostChanged:function(b,a){this.updateFollower(null)},handleHostPropertyChange:function(a){this.updateFollower(a)},updateFollower:function(a){if(this._isUpdatingFollower||U.isDeserializing){return}this._isUpdatingFollower=!0,this.updateFollowerImpl(a),this._isUpdatingFollower=!1},updateFollowerImpl:function(m){var w=this.getHost();if(w instanceof L.Grid){if(!m||L.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[m.property]){var d=this.getStyle("follower.row.index"),g=this.getStyle("follower.column.index"),x=w.getCellRect(d,g);if(!x){return}var b=this.getStyle("follower.row.span"),v=this.getStyle("follower.column.span");if(b!=1||v!=1){var r=w.getCellRect(d+b-1,g+v-1);r&&(x=X.unionRect(x,r))}X.addPadding(x,this,"follower.padding"),this.setLocation(x.x,x.y),this.setWidth(x.width),this.setHeight(x.height)}}else{if(m!=null&&m.property==="location"){var f=m.oldValue,p=m.newValue,k=this.getLocation();this.setLocation(k.x+(p.x-f.x),k.y+(p.y-f.y))}}},isHostOn:function(b){if(!b){return !1}var a={},c=this._host;while(c&&c!=this&&!a[c.getId()]){if(c===b){return !0}a[c.getId()]=c,c instanceof L.Follower?c=c.getHost():c=null}return !1},isLoopedHostOn:function(a){return this.isHostOn(a)&&a.isHostOn(this)}});var R=function(a){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,R.superClass.constructor.call(this,a)};L.Group=R,U.ext("twaver.Group",L.Follower,{_image:z.IMAGE_GROUP,_icon:z.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&F.hasAgentLinks(this)},onChildAdded:function(b,a){R.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(b,a){R.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(this._isAdjusting||U.isDeserializing){return}var c,a=0,d=this.getChildrenSize(),b;for(;a<d;a++){b=this.getChildAt(a),b instanceof K&&(c=X.unionRect(c,this.getChildRect(b)))}c&&(this._isUpdatingLocationFromChildren=!0,this.setLocation(c.x+c.width/2-this.getWidth()/2,c.y+c.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)},getChildRect:function(b){var a;return b instanceof K&&(b instanceof R?(b.isExpanded()&&b.getChildren().forEach(function(c){a=X.unionRect(a,b.getChildRect(c))}),a||(a=b.getRect())):a=b.getRect()),a},setLocation:function(){if(this._isAdjusting){return}var b;arguments.length===2?b={x:arguments[0],y:arguments[1]}:b=arguments[0];if(!U.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var a=b.x-this.getX(),c=b.y-this.getY();F.moveElements(this.getChildren(),a,c),this._isAdjusting=!1}R.superClass.setLocation.call(this,b)},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(b){if(this._expanded===b){return}var a=this._expanded;this._expanded=b,this.firePropertyChange("expanded",a,this._expanded),this._checkLinkAgent()},_checkLinkAgent:function(){R.superClass._checkLinkAgent.call(this);var b=this.getChildrenSize();for(var a=0;a<b;a++){var c=this.getChildAt(a);c instanceof K&&c._checkLinkAgent()}},getElementUIClass:function(){return L.network.GroupUI},getCanvasUIClass:function(){return L.canvas.GroupUI}}),L.SubNetwork=function(a){L.SubNetwork.superClass.constructor.call(this,a)},U.ext("twaver.SubNetwork",L.Follower,{ISubNetwork:!0,_image:z.IMAGE_SUBNETWORK,_icon:z.ICON_SUBNETWORK,_checkLinkAgent:function(){L.SubNetwork.superClass._checkLinkAgent.call(this);var b=this.getChildrenSize();for(var a=0;a<b;a++){var c=this.getChildAt(a);c instanceof K&&c._checkLinkAgent()}}}),L.Grid=function(a){L.Grid.superClass.constructor.call(this,a)},U.ext("twaver.Grid",L.Follower,{_icon:z.ICON_GRID,_image:null,getCellObject:function(f,b){arguments.length===1&&(b=f.y,f=f.x);var h=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");for(var a=0;a<h;a++){for(var c=0;c<d;c++){var g=this.getCellRect(a,c);if(X.containsPoint(g,f,b)){return{rowIndex:a,columnIndex:c,rect:g}}}}return null},getCellRect:function(h,p){var d=this.getStyle("grid.row.count"),b=this.getStyle("grid.column.count");if(d<=0||b<=0){return null}if(h<0||h>=d){return null}if(p<0||p>=b){return null}var g=this.getRect();X.addPadding(g,this,"grid.border");var v=0,c=this.getStyle("grid.row.percents"),m=this.getStyle("grid.column.percents");if(c&&c.length===d){var k=0;for(v=0;v<h;v++){k+=g.height*c[v]}g.y+=k,g.height=g.height*c[h]}else{g.height=g.height/d,g.y+=g.height*h}if(m&&m.length===b){var f=0;for(v=0;v<p;v++){f+=g.width*m[v]}g.x+=f,g.width=g.width*m[p]}else{g.width=g.width/b,g.x+=g.width*p}return X.addPadding(g,this,"grid.padding"),g},getElementUIClass:function(){return L.network.GridUI},getCanvasUIClass:function(){return L.canvas.GridUI}}),L.ShapeNode=function(a){this._isUpdatingShapeNode=!1,this._points=new B,L.ShapeNode.superClass.constructor.call(this,a)},U.ext("twaver.ShapeNode",L.Follower,{_icon:z.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return L.network.ShapeNodeUI},getCanvasUIClass:function(){return L.canvas.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new B),this._points=a,this.firePointsChange()},getSegments:function(){return this._segments},setSegments:function(a){a||(a=new B),this._segments=a,this._reCalculateLineLength(),this.firePointsChange()},addPoint:function(b,a){this._points.add(b,a),this.firePointsChange()},setPoint:function(b,a){this._points.set(b,a),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},setWidth:function(b){b<1&&(b=1);if(!this._isUpdatingShapeNode&&!U.isDeserializing){this._isUpdatingShapeNode=!0;for(var a=0;a<this._points.size();a++){var c=this._points.get(a);c.x=(c.x-this.getX())*b/this.getWidth()+this.getX()}this.firePointsChange(),this._isUpdatingShapeNode=!1}L.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(b){b<1&&(b=1);if(!this._isUpdatingShapeNode&&!U.isDeserializing){this._isUpdatingShapeNode=!0;for(var a=0;a<this._points.size();a++){var c=this._points.get(a);c.y=(c.y-this.getY())*b/this.getHeight()+this.getY()}this.firePointsChange(),this._isUpdatingShapeNode=!1}L.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!U.isDeserializing){var c;arguments.length===2?c={x:arguments[0],y:arguments[1]}:c=arguments[0];if(!U.num(c.x)||!U.num(c.y)){return}var a=c.x-this.getX(),f=c.y-this.getY();if(a===0&&f===0){return}this._isUpdatingShapeNode=!0;for(var b=0;b<this._points.size();b++){var d=this._points.get(b);d.x+=a,d.y+=f}this.firePointsChange(),this._isUpdatingShapeNode=!1}L.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(){if(!this._isUpdatingShapeNode&&!U.isDeserializing){var a=X.getRect(this._points);a&&(this._isUpdatingShapeNode=!0,this.setLocation(a.x,a.y),this.setWidth(a.width),this.setHeight(a.height),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",null,this._points)},_reCalculateLineLength:function(){this._points!=null&&this._points.size()>0?this._lineLength=X.calculateLineLength(this._points,this._segments):this._lineLength=0},getLineLength:function(){return this._lineLength}}),L.Bus=function(a){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,L.Bus.superClass.constructor.call(this,a)},U.ext("twaver.Bus",L.ShapeNode,{_icon:z.ICON_BUS,firePointsChange:function(){var c=this._points.size();if(!U.isDeserializing&&c>=2){var a=this._points.get(0);for(var d=1;d<c;d++){var b=this._points.get(d);Math.abs(b.x-a.x)>Math.abs(b.y-a.y)?b.y=a.y:b.x=a.x,a=b}}L.Bus.superClass.firePointsChange.apply(this,arguments)}}),L.ShapeLink=function(b,a,c){this._points=new B,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,L.ShapeLink.superClass.constructor.call(this,b,a,c)},U.ext("twaver.ShapeLink",L.Link,{_icon:z.ICON_SHAPELINK,getElementUIClass:function(){return L.network.ShapeLinkUI},getCanvasUIClass:function(){return L.canvas.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new B),this._points=a,this.firePointsChange()},addPoint:function(b,a){this._points.add(b,a),this.firePointsChange()},setPoint:function(b,a){this._points.set(b,a),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},firePointsChange:function(){this.firePropertyChange("points",null,this._points)}}),L.ShapeSubNetwork=function(a){L.ShapeSubNetwork.superClass.constructor.call(this,a)},U.ext("twaver.ShapeSubNetwork",L.ShapeNode,{ISubNetwork:!0,_icon:z.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){L.ShapeSubNetwork.superClass._checkLinkAgent.call(this);var b=this.getChildrenSize();for(var a=0;a<b;a++){var c=this.getChildAt(a);c instanceof K&&c._checkLinkAgent()}}}),L.LinkSubNetwork=function(a){L.LinkSubNetwork.superClass.constructor.call(this,a)},U.ext("twaver.LinkSubNetwork",L.Link,{ISubNetwork:!0,_icon:z.ICON_LINKSUBNETWORK}),L.RotatableNode=function(a){L.RotatableNode.superClass.constructor.call(this,a)},U.ext("twaver.RotatableNode",L.Follower,{_angle:0,getAngle:function(){return this._angle},setAngle:function(b){var a=this._angle;this._angle=b,this.firePropertyChange("angle",a,b)},getWidth:function(){return this._angle==0?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(a){},getHeight:function(){return this._angle==0?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(a){},getElementUIClass:function(){return L.network.RotatableNodeUI},getCanvasUIClass:function(){return L.canvas.RotatableNodeUI},_getRotateRect:function(){var f=this._getOrignalWidth(),b=this._getOrignalHeight(),g=X.createMatrix(this._angle*Math.PI/180,f/2,b/2),d=[{x:0,y:0},{x:f,y:0},{x:f,y:b},{x:0,y:b}];for(var a=0,c=d.length;a<c;a++){d[a]=g.transform(d[a])}return X.getRect(d)},_getOrignalWidth:function(){return L.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return L.RotatableNode.superClass.getHeight.call(this)}}),L.controls.ControlBase=function(){L.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new B},U.ext("twaver.controls.ControlBase",L.PropertyChangeDispatcher,{addPool:function(a){this._pools.contains(a)||this._pools.add(a)},removePool:function(a){this._pools.remove(a)},adjustBounds:function(b){var a=this._view.style;a.position="absolute",a.left=b.x+"px",a.top=b.y+"px",a.width=b.width+"px",a.height=b.height+"px",this.invalidate&&this.invalidate()},getView:function(){return this._view},invalidate:function(a){this._invalidate||(this._invalidate=!0,U.callLater(this.validate,this,null,a))},validate:function(){if(!this._invalidate){return}this._invalidate=!1,this._view.offsetWidth===0&&this._view.offsetHeight===0&&this._reinvalidateCount!==null?(this._reinvalidateCount===I&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl()},validateImpl:function(){}}),L.controls.ViewBase=function(){L.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new L.EventDispatcher,this._viewDispatcher=new L.EventDispatcher},U.ext("twaver.controls.ViewBase",L.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:z.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return this._selectionModel==null},setShareSelectionModel:function(b){var a=this._selectionModel==null;if(a===b){return}b?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new L.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",a,b)},removeSelection:function(){if(this.getSelectionModel().size()===0){return null}var a=this.getSelectionModel().toSelection();return a.forEach(function(b){this._box.remove(b)},this),a},selectAll:function(){var a=new B;return this._box.forEach(function(b){this.isVisible(b)&&a.add(b)},this),this.getSelectionModel().setSelection(a),a},isSelected:function(a){return this.getSelectionModel().contains(a)},isSelectable:function(a){return this.getSelectionModel().isSelectable(a)},getLabel:function(a){return a.getName()},getToolTip:function(a){return a.getToolTip()},getIcon:function(a){return a.getIcon()},getSelectColor:function(a){return z.SELECT_COLOR},addViewListener:function(b,a,c){this._viewDispatcher.add(b,a,c)},removeViewListener:function(b,a){this._viewDispatcher.remove(b,a)},fireViewEvent:function(a){this._viewDispatcher.fire(a)},addInteractionListener:function(b,a,c){this._interactionDispatcher.add(b,a,c)},removeInteractionListener:function(b,a){this._interactionDispatcher.remove(b,a)},fireInteractionEvent:function(a){this._interactionDispatcher.fire(a)},invalidate:function(a){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),U.callLater(this.validate,this,null,a))},validate:function(){if(!this._invalidate){return}this._invalidate=!1,this._view.offsetWidth===0&&this._view.offsetHeight===0&&this._reinvalidateCount!==null?(this._reinvalidateCount===I&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating)}}),L.controls.View=function(){L.controls.View.superClass.constructor.apply(this,arguments)},U.ext("twaver.controls.View",L.controls.ViewBase,{_zoom:1,_maxZoom:z.ZOOM_MAX,_minZoom:z.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(a){return V.isValidEvent(this._view,a)},getAlarmFillColor:function(b){if(b.IElement){var a=b.getAlarmState().getHighestNewAlarmSeverity();if(a){return a.color}}return null},getInnerColor:function(b){if(b.IElement){var a=b.getAlarmState().getHighestNativeAlarmSeverity();return a?a.color:b.getStyle("inner.color")}return null},getOuterColor:function(b){if(b.IElement){var a=b.getAlarmState().getPropagateSeverity();return a?a.color:b.getStyle("outer.color")}return null},zoomOverview:function(b){var a=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(a,b)},getLogicalPoint:function(a){return V.getLogicalPoint(this._view,a,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(f,c,h){h&&L.animate.AnimateManager.endAnimate();var b=this._view.scrollWidth-this._view.clientWidth,d=this._view.scrollHeight-this._view.clientHeight,g=(f-this._view.clientWidth/this._zoom/2)*this._zoom,a=(c-this._view.clientHeight/this._zoom/2)*this._zoom;g<0&&(g=0),a<0&&(a=0),g>b&&(g=b),a>d&&(a=d),h?L.animate.AnimateManager.start(new L.animate.AnimateScrollPosition(this._view,g,a)):(this._view.scrollLeft=g,this._view.scrollTop=a)},panByOffset:function(f,b){f*=this.getZoom(),b*=this.getZoom();var h=this._view.scrollLeft+f,d=this._view.scrollTop+b,a=this._view.scrollWidth-this._view.clientWidth,c=this._view.scrollHeight-this._view.clientHeight;h<0&&(h=0),h>a&&(h=a),d<0&&(d=0),d>c&&(d=c);var g={x:(h-this._view.scrollLeft)/this.getZoom(),y:(d-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=h,this._view.scrollTop=d,g},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(b){if(b<0){return}var a=this._maxZoom;this._maxZoom=b,this.firePropertyChange("maxZoom",a,b),this.getZoom()>b&&this.setZoom(b)},getMinZoom:function(){return this._minZoom},setMinZoom:function(b){if(b<0){return}var a=this._minZoom;this._minZoom=b,this.firePropertyChange("minZoom",a,b),this.getZoom()<b&&this.setZoom(b,!1)},getZoom:function(){return this._zoom},onZoomChanged:function(b,a){},zoomIn:function(a){this.setZoom(this._zoom*z.ZOOM_INCREMENT,a)},zoomOut:function(a){this.setZoom(this._zoom/z.ZOOM_INCREMENT,a)},zoomReset:function(a){this.setZoom(1,a)},setZoom:function(c,a){if(!U.num(c)||c<=0){return}c<this._minZoom&&(c=this._minZoom),c>this._maxZoom&&(c=this._maxZoom);if(c===this._zoom){return}a==null&&(a=z.ZOOM_ANIMATE);if(a){L.animate.AnimateManager.start(new L.animate.AnimateZoom(this,c))}else{var f=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,b=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,d=this._zoom;this._zoom=c,V.setZoom(this._rootDiv,c),this.firePropertyChange("zoom",d,c),this.onZoomChanged(d,c),this.centerByLogicalPoint(f,b,!1)}}}),function(){var a=function(f,c,g,b){var d=document.createElement("img");d.src=b,L.Util.registerImage(f,d,c,g)};a("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),a("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),a("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),a("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),a("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),a("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),a("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),a("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),a("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),a("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),a("node_image",30,32,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII="),a("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),a("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),a("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),a("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),a=function(d,c,f,b){L.Util.registerImage(d,b,c,f)},a("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),a("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),a("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),a("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),a("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs=")}()})(window);(function(Q,D){var J=_twaver.arrow,G=_twaver.box,M=_twaver.bus,F=_twaver.Dashline,I=_twaver.element,B=_twaver.g,V=_twaver.group,P=_twaver.html,L=_twaver.link,T=_twaver.math,N=_twaver.Matrix,H=_twaver.interaction,R=_twaver.popup,A=_twaver.position,K=_twaver.render,O=_twaver.touch,k=_twaver.ua,U=twaver.Defaults,z=twaver.List,C=twaver.Node,j=twaver.Group,q={_hitCanvas:null,getHitCanvas:function(b,a){this._hitCanvas==null&&(this._hitCanvas=P.createCanvas()),arguments.length==0&&(b=2,a=2),this._hitCanvas.setAttribute("width",""+b-1),this._hitCanvas.setAttribute("height",""+a-1),this._hitCanvas.setAttribute("width",""+b),this._hitCanvas.setAttribute("height",""+a);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,b,a),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(b,c,a){c!=D&&(b.fillStyle=c,b.fill()),a!=D&&(b.strokeStyle=a,b.stroke())},text:function(f,b,g,d,a,c){f.textAlign="center",f.textBaseline="middle",a!=null&&(f.fillStyle=a,f.fillText(b,g,d)),c&&(f.strokeStyle=c,f.strokeText(b,g,d))},circle:function(f,b,g,d,a,c){f.arc(b,g,d,0,2*Math.PI,!0),f.closePath(),this.render(f,a,c)},rect:function(f,b,h,d,a,c,g){f.rect(b,h,d,a),f.closePath(),this.render(f,c,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(f,b,h,d,a,c){var g=0;return a<=0?g|=this.OUT_LEFT|this.OUT_RIGHT:f<h?g|=this.OUT_LEFT:f>h+a&&(g|=this.OUT_RIGHT),c<=0?g|=this.OUT_TOP|this.OUT_BOTTOM:b<d?g|=this.OUT_TOP:b>d+c&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(v,E,g,b,m,S,d,y){var x,p;if((p=this.outcode(g,b,m,S,d,y))==0){return !0}while((x=this.outcode(v,E,m,S,d,y))!=0){if((x&p)!=0){return !1}if((x&(this.OUT_LEFT|this.OUT_RIGHT))!=0){var h=m;(x&this.OUT_RIGHT)!=0&&(h+=d),E+=(h-v)*(b-E)/(g-v),v=h}else{var w=S;(x&this.OUT_BOTTOM)!=0&&(w+=y),v+=(w-E)*(g-v)/(b-E),E=w}}return !0}};twaver.canvas={},twaver.canvas.interaction={},twaver.canvas.Network=function(a){twaver.canvas.Network.superClass.constructor.apply(this,arguments),this._view=P.createView("auto"),this._rootCanvas=P.createCanvas(),this._topCanvas=P.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._zoom=1,this._elementUIMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new twaver.List,this._topAttachmentList=new twaver.List,this.setElementBox(a?a:new twaver.ElementBox),k.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(twaver.Defaults.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("mouseout",function(b){R.hideToolTip()})},_twaver.ext("twaver.canvas.Network",twaver.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation"],_currentSubNetwork:null,_subNetworkAnimate:twaver.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:twaver.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:twaver.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:twaver.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:U.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:twaver.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:twaver.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:twaver.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:twaver.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:twaver.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:twaver.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:twaver.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:twaver.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:twaver.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:twaver.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:twaver.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:twaver.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:twaver.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:twaver.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:twaver.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointFillColor:twaver.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:twaver.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:twaver.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:twaver.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:twaver.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:twaver.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:twaver.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:twaver.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:twaver.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:twaver.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:twaver.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:twaver.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:U.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,adjustBounds:function(d){var b=!1,f=this._view.style;f.left==d.x+"px"&&f.top==d.y+"px"&&f.width==d.width+"px"&&f.height==d.height+"px"&&(b=!0),twaver.canvas.Network.superClass.adjustBounds.apply(this,arguments);if(b==1){return}var c=this._view.offsetWidth,a=this._view.offsetHeight;this._rootCanvas.setAttribute("width",c),this._rootCanvas.setAttribute("height",a),this._topCanvas.setAttribute("width",c),this._topCanvas.setAttribute("height",a),this.setViewRect(this.viewRect.x,this.viewRect.y,c,a),this.invalidateElementVisibility()},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(this._invalidateElementVisibility==1){this._invalidateElementVisibility=!1;var f=this.getElementBox().getDatas(),b=f.size(),g={},d,a,c;for(d=0;d<b;d++){a=f.get(d),g[a.getId()]=this.isVisible(a)}if(this._visibleMap){for(d=0;d<b;d++){a=f.get(d),g[a.getId()]!==this._visibleMap[a.getId()]&&(c=this.getElementUI(a),c&&c.invalidate())}}for(d=0;d<b;d++){a=f.get(d),c=this.getElementUI(a),c&&c.validate()}this._visibleMap=g,this.paintRoot()}this._repaintTopFlag==1&&(this._repaintTopFlag=!1,this.paintTopCanvas())},getElementBox:function(){return this._box},setElementBox:function(b){if(!b){throw"ElementBox can not be null"}if(this._box===b){return}var a=this._box;a&&(a.removeDataBoxChangeListener(this.handleElementBoxChange,this),a.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),a.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),a.removeIndexChangeListener(this.handleIndexChange,this),a.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),a.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),a.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||a.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=b,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(b):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",a,this._box)},handleElementBoxChange:function(b){var a=b.data;if(b.kind==="add"){this.createElementUI(a),this.invalidateBundleLink(a)}else{if(b.kind==="remove"){var c=this.getElementUI(a);c&&delete this._elementUIMap[a.getId()],a===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else{b.kind==="clear"&&(this._elementUIMap={},this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null))}}this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(b){var a=b.source,c=this.getElementUI(a);c&&c.handlePropertyChange(b),this.invalidateBundleLink(a),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){a.property==="editable"&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(b){b.datas.forEach(function(c){var d=this.getElementUI(c);d&&d.handleSelectionChange(b)},this);var a=this.getSelectionModel().getLastData();a&&(b.kind==="append"||b.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(a),this.isSendToTopOnSelected()&&this.sendToTop(a)),this.invalidateElementVisibility()},sendToTop:function(b){if(!this._box.contains(b)){return}var a=b;while(this.isVisible(a.getParent())){a=a.getParent();if(!a){break}}a!==b&&this._box.adjustElementIndex(a),this._box.adjustElementIndex(b)},getViewRect:function(){return this.viewRect?_twaver.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(f,b){var g=this.viewRect.x,d=this.viewRect.y,a=this.viewRect.width,c=this.viewRect.height;this.setViewRect(g+f,d+b,a,c)},setViewRect:function(d,b,f,c){this.isLimitViewInCanvas()==1&&(d<0&&(d=0),f>this.realWidth?d=0:d+f>this.realWidth&&(d=this.realWidth-f),b<0&&(b=0),c>this.realHeight?b=0:b+c>this.realHeight&&(b=this.realHeight-c));var a=this.viewRect;if(this.viewRect!=null&&d==this.viewRect.x&&b==this.viewRect.y&&f==this.viewRect.width&&c==this.viewRect.height){return}this.viewRect={x:d,y:b,width:f,height:c},this.firePropertyChange("viewRect",a,this.viewRect),this.invalidateElementVisibility()},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){a==null&&(a=300),this._invalidateCanvasSizeFlag==0&&(this._invalidateCanvasSizeFlag=!0,_twaver.callLater(this.validateCanvasSize,this,null,a))},validateCanvasSize:function(){if(this._invalidateCanvasSizeFlag==0){return}this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize()},_validateCanvasSize:function(){if(this.isMovingElement()){return}if(this.isAutoValidateCanvasSize()==0){this.realWidth=0,this.realHeight=0;return}var f=this.getElementBox().getDatas(),b=f.size();if(b>0){var g={x:0,y:0,width:0,height:0};for(var d=0;d<b;d++){var a=f.get(d);if(this.isVisible(a)){var c=this.getElementUI(a);c&&(c.validate(),g=T.unionRect(g,c.getViewRect()))}}g.x<0&&(g.width+=g.x,g.x=0),g.y<0&&(g.height+=g.y,g.y=0);if(this.realWidth==(g.x+g.width)*this.getZoom()&&this.realHeight==(g.y+g.height)*this.getZoom()){return}this.realWidth=(g.x+g.width)*this.getZoom(),this.realHeight=(g.y+g.height)*this.getZoom()}else{this.realWidth=0,this.realHeight=0}this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(a){return a==null?null:this._elementUIMap[a.getId()]},createElementUI:function(b){var a=this._elementUIMap[b.getId()];a||(a=this._elementUIFunction(this,b),a&&(this._elementUIMap[b.getId()]=a))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(b){if(!b){throw"ElementUIFunction can not be null"}if(this._elementUIFunction===b){return}var a=this._elementUIFunction;this._elementUIFunction=b,this.firePropertyChange("elementUIFunction",a,b),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())},invalidateElementUI:function(b,a){var c=this.getElementUI(b);c&&c.invalidate(a)},invalidateElementUIs:function(b){for(var a in this._elementUIMap){var c=this._elementUIMap[a];c.invalidate(b)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){a instanceof twaver.Link&&a.getBundleLinks()&&a.getBundleLinks().forEachSiblingLink(function(b){if(b!==a){var c=this.getElementUI(b);c&&c.invalidate(!1)}},this)},paintRoot:function(){var g=this._rootCanvas.getContext("2d");g.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new twaver.List,this._topAttachmentList=new twaver.List;if(this.getElementBox()==null){return}var m=this.getElementBox().getDatas(),d=m.size();if(d==0){return}g.save(),g.scale(this.getZoom(),this.getZoom()),g.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom());var b={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},f=this.getElementBox().getLayerBox(),p,c,l,h;this.getElementBox().getLayerBox().forEachByDepthFirst(function(e){for(p=0;p<d;p++){c=m.get(p),f.getLayerByElement(c)===e&&this.isVisible(c)&&(l=this.getElementUI(c),l!=null&&this._isInView(l,b)&&(l.paint(g),this.visibleList.add(c)))}},null,this),d=this._topAttachmentList.size();for(p=0;p<d;p++){h=this._topAttachmentList.get(p),h.getElementUI().paintAttachment(g,h)}g.restore()},_isInView:function(b,a){return T.intersects(a,b.getViewRect())},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(c){var a=this.markerList.size();for(var d=0;d<a;d++){var b=this.markerList.get(d);b.paint(c)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint:function(f){var b;if(k.isTouchable&&f.changedTouches&&f.changedTouches.length>0){var g=this._view.getBoundingClientRect(),d=f.changedTouches[0],a=k.isAndroid?0:O.scrollLeft(),c=k.isAndroid?0:O.scrollTop();return b={x:(d.clientX+this.viewRect.x-g.left-a)/this._zoom,y:(d.clientY+this.viewRect.y-g.top-c)/this._zoom},b}return k.isFirefox?b={x:(f.layerX+this.viewRect.x)/this.getZoom(),y:(f.layerY+this.viewRect.y)/this.getZoom()}:b={x:(f.offsetX+this.viewRect.x)/this.getZoom(),y:(f.offsetY+this.viewRect.y)/this.getZoom()},b},getElementAt:function(g){if(this.visibleList==null){return null}var m;g.target?m=this.getLogicalPoint(g):m=g;if(this._topAttachmentList!=null){var d=this._topAttachmentList.size();for(var b=d-1;b>=0;b--){var f=this._topAttachmentList.get(b);if(f.hit(m.x,m.y)){return f.getElement()}}}if(this.visibleList!=null){var p=this.visibleList.size();for(var c=p-1;c>=0;c--){var l=this.visibleList.get(c),h=this.getElementUI(l);if(h&&h.hit(m.x,m.y)){return l}}}return null},hitTest:function(c){var a=this.getElementAt(c);if(!a){return null}var d=this.getElementUI(a);if(!d){return null}var b;return c.target?b=this.getLogicalPoint(c):b=c,d.hitTest(b.x,b.y)},getElementsAtRect:function(g,c,l){var f=new twaver.List;if(this.visibleList==null){return f}var b=this.visibleList.size();for(var d=b-1;d>=0;d--){var h=this.visibleList.get(d),a=this.getElementUI(h);a&&(!l||l(a._element))&&(c?a.intersects(g)&&f.add(h):T.contains(g,a.getViewRect())&&f.add(h))}return f},getPosition:function(f,b,h,d,a){var c,g=b instanceof twaver.canvas.ElementUI?b:this.getElementUI(b);if(g){if(f==="from"||f==="to"){if(g.getFromPosition){c=f==="from"?g.getFromPosition(d,a):g.getToPosition(d,a);if(c){return{x:c.x-h.width/2,y:c.y-h.height/2}}}}else{f==="hotspot"?c=g.getHotSpot():c=A.get(f,g.getBodyRect(),h)}}!c&&b.getRect&&(c=A.get(f,b.getRect(),h));if(c){return{x:c.x+d,y:c.y+a}}throw"position '"+f+"' object '"+b+"'"},isValidEvent:function(b){if(!b){return !1}var a,c;if(b.currentTarget===this._view){k.isFirefox?(a=b.layerX,c=b.layerY):(a=b.offsetX,c=b.offsetY);if(this.isHScrollBarVisible()==1&&c>=this.viewRect.height-this.getScrollBarWidth()){return !1}if(this.isVScrollBarVisible()==1&&a>=this.viewRect.width-this.getScrollBarWidth()){return !1}}return !0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof twaver.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){var b=this.getSelectionModel().getSelection();for(var a=0;a<b.size();a++){var c=b.get(a);if(this.isMovable(c)){return !0}}return !1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(d,b,f,c){if(d===0&&b===0){return}var a=this.getMovableSelectedElementsRect();if(a==null){return}this._limitElementInPositiveLocation&&(a.x+d<0&&(d=-a.x),a.y+b<0&&(b=-a.y)),twaver.Util.moveElements(this.getMovableSelectedElements(),d,b,f,c,this)},getMovableSelectedElementsRect:function(){var f=this.getMovableSelectedElements();if(f.size()===0){return null}var b=null;for(var g=0,d=f.size();g<d;g++){var a=f.get(g);if(a instanceof C){var c=this.getElementUI(a);c&&(b=T.unionRect(b,c.getViewRect()))}}return b},isVisible:function(b){if(!this._box.contains(b)){return !1}if(this._visibleFunction&&!this._visibleFunction(b)){return !1}if(!this.getLayerByElement(b).isVisible()){return !1}if(I.getSubNetwork(b)!==this._currentSubNetwork){return !1}if(b instanceof twaver.Link){if(!this.isNoAgentLinkVisible()){if(!b.getFromAgent()||!b.getToAgent()){return !1}if(!this.isVisible(b.getFromAgent())||!this.isVisible(b.getToAgent())){return !1}}if(b.getBundleIndex()>0&&b.getBundleCount()>1&&!b.getStyle("link.bundle.expanded")){return !1}}else{var a=b.getParent();while(a&&!a.ISubNetwork){if(a instanceof twaver.Group){if(!a.isExpanded()||!this.isVisible(a)){return !1}}a=a.getParent()}}return b.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(b){var a=this._visibleFunction;this._visibleFunction=b,this.firePropertyChange("visibleFunction",a,b),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(b){var a=this._editableFunction;this._editableFunction=b,this.firePropertyChange("editableFunction",a,b),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(b){var a=b.getStyle("shadow.color");return !a&&this.isSelected(b)&&b.getStyle("select.style")==="shadow"?b.getStyle("select.color"):a},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(b){var a=b.getAlarmState().getHighestNewAlarmSeverity();if(a){var c=b.getAlarmState().getNewAlarmCount(a)+a.nickName;return b.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(b){var a=this._interactions;a&&a.forEach(function(c){c.tearDown()}),this._interactions=b,b&&b.forEach(function(c){c.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",a,b)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a){this.setInteractions([new twaver.canvas.interaction.SelectInteraction(this),new twaver.canvas.interaction.MoveInteraction(this,a),new twaver.canvas.interaction.ScrollInteraction(this),new twaver.canvas.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new twaver.canvas.interaction.TouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new twaver.canvas.interaction.SelectInteraction(this),new twaver.canvas.interaction.EditInteraction(this,a),new twaver.canvas.interaction.MoveInteraction(this,a),new twaver.canvas.interaction.ScrollInteraction(this),new twaver.canvas.interaction.DefaultInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new twaver.canvas.interaction.CreateElementInteraction(this,a),new twaver.canvas.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new twaver.canvas.interaction.CreateLinkInteraction(this,a),new twaver.canvas.interaction.ScrollInteraction(this),new twaver.canvas.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new twaver.canvas.interaction.CreateShapeLinkInteraction(this,a),new twaver.canvas.interaction.ScrollInteraction(this),new twaver.canvas.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new twaver.canvas.interaction.CreateShapeNodeInteraction(this,a),new twaver.canvas.interaction.ScrollInteraction(this),new twaver.canvas.interaction.DefaultInteraction(this)])},setPanInteractions:function(){this.setInteractions([new twaver.canvas.interaction.PanInteraction(this),new twaver.canvas.interaction.ScrollInteraction(this),new twaver.canvas.interaction.DefaultInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(b){var a=this._hasEditInteraction;this._hasEditInteraction=b,this.firePropertyChange("hasEditInteraction",a,b)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(b){if(b){var a=b.getToolTip();return a?a:b.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(b){this._toolTipEnabled=b;if(b){if(!this._toolTipListener){var a=this;this._toolTipListener=function(f){var g=a.getElementAt(f);if(g){var d=a.getToolTip(g);R.showToolTip(f,d);var c=R.getToolTipDiv();c.clientWidth+c.offsetLeft>a._view.clientWidth+a._view.offsetLeft&&(c.style.left=a._view.offsetLeft+a._view.clientWidth-c.clientWidth+"px"),c.clientHeight+c.offsetTop>a._view.clientHeight+a._view.offsetTop&&(c.style.top=a._view.offsetTop+a._view.clientHeight-c.clientHeight+"px");return}R.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else{this._toolTipListener&&(R.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))}},setZoom:function(b){var a=this._zoom;if(this._zoom==b){return}var c={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*b,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*b};this._zoom=b,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(c.x-this.viewRect.width/2,c.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",a,this._zoom)},getZoom:function(){return this._zoom},zoomOverview:function(f){if(this.realWidth<=0||this.realHeight<=0){return}var b=this.realWidth/this.getZoom(),g=this.realHeight/this.getZoom(),d=this.viewRect.width/b,a=this.viewRect.height/g,c=Math.min(d,a);this.setZoom(c)},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(this.getZoom()*1.2)},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(b,a){this._currentSubNetwork&&this.setCurrentSubNetwork(I.getSubNetwork(this._currentSubNetwork),b,a)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(c,a,d){twaver.animate.AnimateManager.endAnimate();if(a){if(this._currentSubNetwork===c){return}if(c&&!this._box.contains(c)){throw c+" is not contained in this network's elementBox"}var b=new twaver.animate.AnimateSubNetwork(this,c,d);twaver.animate.AnimateManager.start(b)}else{this._setCurrentSubNetwork(c),d&&d()}},_setCurrentSubNetwork:function(b){if(this._currentSubNetwork===b){return}if(b&&!this._box.contains(b)){throw b+" is not contained in this network's elementBox"}var a=this._currentSubNetwork;this._currentSubNetwork=b,this.firePropertyChange("currentSubNetwork",a,b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},makeVisible:function(g){var c=this.getElementUI(g);if(!c){return}var h=I.getSubNetwork(g);if(h!==this._currentSubNetwork){var f=this;this.setCurrentSubNetwork(h,this.isSubNetworkAnimate(),function(){_twaver.callLater(f.makeVisible,f,[g])});return}var b=g;while((b=b.getParent())&&b!==h){b instanceof twaver.Group&&b.setExpanded(!0)}var d=c.getViewRect();if(!d){return}var a={x:d.x*this.getZoom(),y:d.y*this.getZoom(),width:d.width*this.getZoom(),height:d.height*this.getZoom()};T.intersects(this.viewRect,a)||this.isVisible(g)&&_twaver.callLater(this.centerByLogicalPoint,this,[a.x+a.width/2,a.y+a.height/2])},centerByLogicalPoint:function(d,b,f){var c=d-this.viewRect.width/2,a=b-this.viewRect.height/2;this.setViewRect(c,a,this.viewRect.width,this.viewRect.height)},panByOffset:function(b,a){this.setViewOffSet(b,a)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},toCanvas:function(ae,x,Y){Y||(Y=P.createCanvas()),Y.setAttribute("width",ae),Y.setAttribute("height",x),Y._viewRect?(Y._viewRect.width=ae,Y._viewRect.height=x):Y._viewRect={x:0,y:0,width:ae,height:x};var S=Y.getContext("2d");S.clearRect(0,0,ae,x);if(this._view.clientWidth===0||this._view.clientHeight===0){return Y}var ab=ae/this.realWidth*this._zoom,E=x/this.realHeight*this._zoom;S.scale(ab,E);var X=new twaver.List,w=this.getElementBox().getDatas(),ah=w.size(),aa=this.getElementBox().getLayerBox(),ag=aa.getRoots(),ac=ag.size(),W,af,f,Z,ad,b;for(W=0;W<ac;W++){af=ag.get(W);for(f=0;f<ah;f++){Z=w.get(f),aa.getLayerByElement(Z)===af&&this.isVisible(Z)&&(ad=this.getElementUI(Z),ad!=null&&ad.paint(S))}}ah=X.size();for(f=0;f<ah;f++){b=X.get(f),b.getElementUI().paintAttachment(S,b)}return Y},toCanvasByRegion:function(ae,x,Y){Y||(Y=P.createCanvas());var S=ae.width*x,ab=ae.height*x;Y.setAttribute("width",S),Y.setAttribute("height",ab),Y._viewRect?(Y._viewRect.width=S,Y._viewRect.height=ab):Y._viewRect={x:0,y:0,width:S,height:ab};var E=Y.getContext("2d");E.clearRect(0,0,S,ab);if(this._view.clientWidth===0||this._view.clientHeight===0){return Y}E.scale(x,x),E.fillStyle=this._view.style.backgroundColor||"#FFFFFF",E.fill();var X=new twaver.List,w=this.getElementBox().getDatas(),ah=w.size(),aa=this.getElementBox().getLayerBox(),ag=aa.getDatas(),ac=ag.size(),W,af,f,Z,ad,b;for(W=0;W<ac;W++){af=ag.get(W);for(f=0;f<ah;f++){Z=w.get(f),aa.getLayerByElement(Z)===af&&this.isVisible(Z)&&(ad=this.getElementUI(Z),ad!=null&&ad.paint(E))}}ah=X.size();for(f=0;f<ah;f++){b=X.get(f),b.getElementUI().paintAttachment(E,b)}return Y},getGroupChildrenRects:function(b){var a=new z;return b.getChildren().forEach(function(d){if(d instanceof C){var f=this.getElementUI(d);if(f){var c=f.getViewRect();c&&a.add(c)}}},this),a}}),twaver.canvas.Overview=function(b){twaver.canvas.Overview.superClass.constructor.apply(this,b),this._view=P.createView(),this._rootDiv=P.createDiv(),this._imageCanvas=P.createCanvas(),this._imageDiv=P.createDiv(),this._maskCanvas=P.createCanvas(),this._selectDiv=P.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,P.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(b);var a;k.isTouchable?a=twaver.canvas.OverviewTouchInteraction:a=twaver.canvas.OverviewInteraction,a&&new a(this)},_twaver.ext("twaver.canvas.Overview",twaver.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:U.OVERVIEW_FILL_COLOR,_outlineColor:U.OVERVIEW_OUTLINE_COLOR,_outlineWidth:U.OVERVIEW_OUTLINE_WIDTH,_selectColor:U.OVERVIEW_SELECT_COLOR,_selectWidth:U.OVERVIEW_SELECT_WIDTH,_padding:U.OVERVIEW_PADDING,_animate:U.OVERVIEW_ANIMATE,_maxPackingWidth:U.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:U.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){if(a===this._network){return}this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),P.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),P.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(a){(a.property==="zoom"||a.property==="currentSubNetwork"||a.property==="elementBox"||a.property==="dataBox"||a.property==="canvasSizeChange")&&this.invalidate()},_handleNetworkViewChange:function(a){a.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){if(!this._isNetworkDirty||!this._isMaskDirty){this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),_twaver.callLater(this.validate,this,null,a)}},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,_twaver.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network.getViewRect().width!==0&&this._network.getViewRect().height!==0){var p=this._maxPackingWidth>0&&this._maxPackingHeight>0,v;p?v={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:v={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},T.grow(v,-this._padding,-this._padding);var d=Math.min(v.width/this._network.getCanvasSize().width,v.height/this._network.getCanvasSize().height);p&&(P.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),v.width=this._imageDiv._viewRect.width,v.height=this._imageDiv._viewRect.height);var b=this._network.getCanvasSize().width*d,g=this._network.getCanvasSize().height*d,w=v.x+(v.width-b)/2,c=v.y+(v.height-g)/2;if(this._isNetworkDirty){var u={x:w,y:c,width:b,height:g};this._network.toCanvas(u.width,u.height,this._imageCanvas),P.setDiv(this._imageDiv,u,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var f={x:this._network.getViewRect().x*d,y:this._network.getViewRect().y*d,width:b*this._network._view.clientWidth/this._network.getCanvasSize().width,height:g*this._network._view.clientHeight/this._network.getCanvasSize().height},m=P.setCanvas(this._maskCanvas,w,c,b,g);m.lineWidth=0,m.fillStyle=this._fillColor,B.drawVector(m,"rectangle",null,w,c,b,g),m.closePath(),m.fill(),m.stroke(),m.clearRect(w+f.x,c+f.y,f.width,f.height),m.lineWidth=this._outlineWidth,m.strokeStyle=this._outlineColor,B.drawVector(m,"rectangle",null,w+f.x+this._outlineWidth,c+f.y+this._outlineWidth,f.width-this._outlineWidth*2,f.height-this._outlineWidth*2),m.closePath(),m.stroke(),this._isMaskDirty=!1}}else{this._isNetworkDirty=!1,this._isMaskDirty=!1}},getLogicalPoint:function(a){return P.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(b,a){var c=this._imageDiv._viewRect;T.containsPoint(c,b)&&(this._network.centerByLogicalPoint((b.x-c.x)/c.width*this._network.getCanvasSize().width,(b.y-c.y)/c.height*this._network.getCanvasSize().height,a),this._invalidateMask())}}),twaver.canvas.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,P.addEventListener("touchstart","handleTouchstart",this.view,this)},_twaver.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(a){P.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),O.isMultiTouch(a)&&(this.distance=O.getDistance(a),this.zoom=this.network.getZoom()),P.addEventListener("touchmove","handleTouchmove",this.view,this),P.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(b){this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(b);if(O.isSingleTouch(b)){this.overview.centerNetwork(this.endPoint,!1)}else{if(this.distance){var a=O.getDistance(b)/this.distance;this.network.setZoom(this.zoom*a,!1)}}},handleTouchend:function(b){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(b);var a=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;a?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),a?_twaver.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,P.removeEventListener("touchmove",this.view,this),P.removeEventListener("touchend",this.view,this))}}),twaver.canvas.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,P.addEventListener("mousedown","handleMousedown",this.view,this)},_twaver.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(a){this.clear(),this.endPoint=this.overview.getLogicalPoint(a),_twaver.isCtrlDown(a)&&(this.startPoint=this.endPoint,P.setVisible(this.overview._selectDiv,!0)),P.addEventListener("mousemove","handleMousemove",this.view,this),P.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(g){this.endPoint=this.overview.getLogicalPoint(g);if("detail" in g&&g.detail===2){_twaver.callLater(this.network.zoomReset,this.network,[this.overview._animate])}else{if(P.isVisible(this.overview._selectDiv)&&this.startPoint){var m=this.overview._imageDiv._viewRect,d=this.overview._selectDiv._viewRect.x,b=this.overview._selectDiv._viewRect.y,f=m.width/this.overview._selectDiv._viewRect.width,p=m.height/this.overview._selectDiv._viewRect.height,c=Math.min(f,p);this.network.setZoom(c*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var l=this.network.getCanvasSize().width*((d-m.x+this.overview._selectDiv._viewRect.width/2)/m.width),h=this.network.getCanvasSize().height*((b-m.y+this.overview._selectDiv._viewRect.height/2)/m.height);_twaver.callLater(this.network.centerByLogicalPoint,this.network,[l,h,this.overview._animate]),P.setVisible(this.overview._selectDiv,!1),P.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else{this.overview.centerNetwork(this.endPoint,this.overview._animate)}}this.clear()},handleMousemove:function(f){var b=this.overview.getLogicalPoint(f);this.endPoint=b;if(P.isVisible(this.overview._selectDiv)&&this.startPoint){var h=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var a=this.overview._imageDiv._viewRect;h<a.x&&(h=a.x),h>a.x+a.width&&(h=a.x+a.width),d<a.y&&(d=a.y),d>a.y+a.height&&(d=a.y+a.height);var c=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);h+c>a.x+a.width&&(c=a.x+a.width-h),d+g>a.y+a.height&&(g=a.y+a.height-d),P.setDiv(this.overview._selectDiv,{x:h,y:d,width:c,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else{this.overview.centerNetwork(b,!1)}},clear:function(){this.endPoint&&(this.endPoint=null,P.removeEventListener("mousemove",this.view,this),P.removeEventListener("mouseup",this.view,this))}}),twaver.canvas.ElementUI=function(b,a){this._network=b,this._element=a,this._attachments=new twaver.List,this._bodyBounds=new twaver.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},_twaver.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},invalidate:function(a){a===D&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag){return}this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(this._invalidateFlag==0){return}this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(b){b.validate()});var a;this._bodyBounds.forEach(function(b){a=T.unionRect(a,b)}),this._unionBodyBounds=_twaver.clone(a),this._attachments.forEach(function(b){a=T.unionRect(a,b.getViewRect())}),this._viewRect=a},validateImpl:function(){},setShadow:function(b,a){var c=b.isShadowable()&&this._shadowColor&&!this._editAttachment;return a.shadowOffsetX===this._shadowXOffset&&a.shadowOffsetY===this._shadowYOffset&&a.shadowBlur===this._shadowBlur?a:(c&&(a.shadowOffsetX=this._shadowXOffset,a.shadowOffsetY=this._shadowYOffset,a.shadowBlur=this._shadowBlur,a.shadowColor=this._shadowColor),a)},clearShadow:function(a){if(a.shadowOffsetX!=0||a.shadowOffsetY!=0||a.shadowBlur!=0){a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0}},appendShadowBound:function(b,a){var c=b.isShadowable()&&this._shadowColor&&!this._editAttachment;return c&&(this._shadowXOffset>0?a.width+=this._shadowXOffset:(a.x+=this._shadowXOffset,a.width+=-this._shadowXOffset),this._shadowYOffset>0?a.height+=this._shadowYOffset:(a.y+=this._shadowYOffset,a.height+=-this._shadowYOffset),T.grow(a,this._shadowBlur,this._shadowBlur)),a},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},addAttachment:function(a){this._attachments.add(a),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);a!=null&&a!==""?this._labelAttachment||(this._labelAttachment=new twaver.canvas.LabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);a!=null&&a!==""?this._alarmAttachment||(this._alarmAttachment=new twaver.canvas.AlarmAttachment(this,U.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new twaver.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new twaver.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return !0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(b){var a=this._element.getStyle(b);return a?a:twaver.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore()},paintBody:function(a){},paintAttachments:function(c){c.beginPath();var a=this._attachments.size();for(var d=0;d<a;d++){var b=this._attachments.get(d);this._hitTest==1&&b.isShowOnTop()==0&&this.paintAttachment(c,b),this._intersectTest==1&&this.paintAttachment(c,b),this._hitTest==0&&this._intersectTest==0&&(b.isShowOnTop()?this._network._topAttachmentList.add(b):this.paintAttachment(c,b))}},paintAttachment:function(b,a){b.beginPath(),a.paint(b),this.clearShadow(b)},getViewRect:function(){return _twaver.clone(this._viewRect)},getUnionBodyBounds:function(){return _twaver.clone(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),_twaver.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?_twaver.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(b,a){return !1},intersects:function(a){return T.contains(a,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(l){var v=q.getHitCanvas(l.width,l.height),d=q.getCtx(v);d.save(),d.translate(-l.x,-l.y),this.paintBody(d);try{var b=d.getImageData(0,0,l.width,l.height),g=b.data;for(var w=0;w<b.width;w++){for(var c=0;c<b.height;c++){var p=4*(c*b.width+w),m=g[p+3];if(m!==0){return d.restore(),1}}}}catch(h){q.disposeHitCanvas();if(T.contains(this.getUnionBodyBounds(),l)){return 0}}return d.restore(),-1},hitCanvasRectAtAttachments:function(l){var v=q.getHitCanvas(l.width,l.height),d=q.getCtx(v);d.save(),d.translate(-l.x,-l.y),this.paintAttachments(d);try{var b=d.getImageData(0,0,l.width,l.height),g=b.data;for(var w=0;w<b.width;w++){for(var c=0;c<b.height;c++){var p=4*(c*b.width+w),m=g[p+3];if(m!==0){return d.restore(),1}}}}catch(h){q.disposeHitCanvas()}return d.restore(),-1},hitCanvasRect:function(c){this._intersectTest=!0,this._hitTest==1&&(this._intersectTest=!1);var a=T.intersection(c,this._viewRect),d=this.hitCanvasRectAtBody(a);if(d==1){return this._intersectTest=!1,!0}var b=this.hitCanvasRectAtAttachments(a);return b==1?(this._intersectTest=!1,!0):(this._intersectTest=!1,d==0)},hitCanvasPoint:function(b,a){if(!T.containsPoint(this._viewRect,b,a)){return !1}this._hitTest=!0;var c=this.hitCanvasRect({x:b-1,y:a-1,width:2,height:2});return this._hitTest=!1,c},hitTest:function(g,c){if(!T.containsPoint(this._viewRect,g,c)){return null}var l={x:g-1,y:c-1,width:2,height:2},f=T.intersection(l,this._viewRect),b=this.hitCanvasRectAtBody(f);if(b==1){return this}var d=this._attachments.size();for(var h=0;h<d;h++){var a=this._attachments.get(h);if(a.hit(g,c)){return a}}return b==0?this:null}}),twaver.canvas.NodeUI=function(b,a){twaver.canvas.NodeUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.NodeUI",twaver.canvas.ElementUI,{invalidate:function(){twaver.canvas.NodeUI.superClass.invalidate.call(this);var a=this._element.getAgentLinks();a&&a.forEach(function(b){this._network.invalidateElementUI(b,!1)},this)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){twaver.canvas.NodeUI.superClass.validateImpl.call(this);var b=this.getStyle("vector.shape"),a=this.getBodyRect();this._hotSpot=T.getHotSpot(a.x,a.y,a.width,a.height,b),this.validateBodyBounds()},validate:function(){if(this._invalidateFlag==0){return}twaver.canvas.NodeUI.superClass.validate.call(this);var a=this._element.getParent();a instanceof twaver.Group&&this._network.invalidateElementUI(a,!1)},validateBodyBounds:function(){var a=this.getStyle("body.type");a==="default"?this.addBodyBounds(this.getDefaultBodyRect()):a==="vector"?this.addBodyBounds(this.getVectorBody()):a==="default.vector"?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):a==="vector.default"&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var c=this._element,a=_twaver.getImageAsset(c.getImage()),d=this.getBodyRect();if(!a){return d}T.addPadding(d,this._element,"image.padding",1);var b=_twaver.clone(d);return this.appendShadowBound(this,b),d=b,d},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(d){var b=this._element,f=b.getStyle(d+".width");if(f>0){var c=this.getBodyRect();T.addPadding(c,b,d+".padding",1);var a=_twaver.clone(c);return T.grow(a,f/2,f/2),a}return null},getPathRect:function(f,b){var g=this._element,d=this.getBodyRect();b&&T.addPadding(d,g,f+".padding",1);var a=_twaver.clone(d),c=g.getStyle(f+".outline.width");return c>0&&T.grow(a,c/2,c/2),this.appendShadowBound(this,a),a},paintBody:function(b){var a=this.getStyle("body.type");a==="default"?this.drawDefaultBody(b):a==="vector"?this.drawVectorBody(b):a==="default.vector"?(this.drawVectorBody(b),this.drawDefaultBody(b)):a==="vector.default"&&(this.drawDefaultBody(b),this.drawVectorBody(b)),this._outerColor&&this.drawOuterBorder(b),this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(b)},drawOuterBorder:function(c){var a=this._element,d=a.getStyle("outer.width");if(d>0){var b=this.getBodyRect();T.addPadding(b,a,"outer.padding",1),c.lineWidth=d,c.lineCap=a.getStyle("outer.cap"),c.lineJoin=a.getStyle("outer.join"),c.strokeStyle=this._outerColor,B.drawVector(c,a.getStyle("outer.shape"),null,b),c.stroke()}},drawDefaultBody:function(c){var a=this._element,d=_twaver.getImageAsset(a.getImage()),b=a.getRect();if(!d){return}T.addPadding(b,this._element,"image.padding",1),d.getImage()&&(this.setShadow(this,c),c.drawImage(d.getImage(this.getInnerColor()),b.x,b.y,b.width,b.height))},drawSelectBorder:function(d){var b=this._element,f=b.getStyle("select.width");if(f>0){var c=this.getBodyRect();T.addPadding(c,b,"select.padding",1);var a=_twaver.clone(c);T.grow(a,f/2,f/2),d.lineWidth=f,d.lineCap=b.getStyle("select.cap"),d.lineJoin=b.getStyle("select.join"),d.strokeStyle=b.getStyle("select.color"),B.drawVector(d,b.getStyle("select.shape"),null,c),d.stroke()}},drawVectorBody:function(b){this.drawPath(b,"vector",!0,this._element.getStyle("vector.outline.pattern"));var a=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color");a!==0&&c&&this.getStyle("vector.shape")==="rectangle"&&B.draw3DRect(b,c,a,this.getBodyRect())},drawPath:function(E,Y,g,b,w,Z,W){var y=this._element,u=this.getBodyRect();g&&T.addPadding(u,y,Y+".padding",1);var x=y.getStyle(Y+".outline.width");this.setShadow(this,E);var c=y.getStyle(Y+".fill"),S;if(c){this._innerColor&&!I.hasDefault(this._element)?S=this._innerColor:S=y.getStyle(Y+".fill.color");var X=y.getStyle(Y+".gradient");X?B.fill(E,S,X,y.getStyle(Y+".gradient.color"),u):E.fillStyle=S}var o=y.getStyle(Y+".shape");c&&(E.beginPath(),w?B.drawLinePoints(E,w,null,Z,W):B.drawVector(E,o,null,u),E.fill()),x>0&&(E.lineWidth=x,E.lineCap=y.getStyle(Y+".cap"),E.lineJoin=y.getStyle(Y+".join"),E.strokeStyle=y.getStyle(Y+".outline.color"),E.beginPath(),w?B.drawLinePoints(E,w,b,Z,W):B.drawVector(E,o,b,u),E.stroke())},hit:function(b,a){return T.containsPoint(this.getViewRect(),b,a)?this.hitCanvasPoint(b,a):!1},intersects:function(b){var a=twaver.canvas.NodeUI.superClass.intersects.apply(this,arguments);return a==1?!0:T.intersects(b,this.getViewRect())?this.hitCanvasRect(b):!1}}),twaver.canvas.LinkUI=function(b,a){twaver.canvas.LinkUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.LinkUI",twaver.canvas.ElementUI,{isEditable:function(){return L.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,twaver.canvas.LinkUI.superClass.invalidate.call(this,a)},validateImpl:function(){this.validateBodyBounds(),twaver.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var l=this.getLinkPoints();if(!l||l.size()<2){return}var f=this._element,h=T.getLineRect(l),d=f.getStyle("link.width"),g=d;if(this._outerColor){var m=f.getStyle("outer.width");g+=m*2}var c=!this._editAttachment&&f.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(c){var b=f.getStyle("select.width");g+=b*2}T.grow(h,g/2,g/2),f.getStyle("arrow.from")&&(h=T.unionRect(h,J.getArrowRect(l,!0,f.getStyle("arrow.from.shape"),f.getStyle("arrow.from.width"),f.getStyle("arrow.from.height"),f.getStyle("arrow.from.xoffset"),f.getStyle("arrow.from.yoffset")))),f.getStyle("arrow.to")&&(h=T.unionRect(h,J.getArrowRect(l,!1,f.getStyle("arrow.to.shape"),f.getStyle("arrow.to.width"),f.getStyle("arrow.to.height"),f.getStyle("arrow.to.xoffset"),f.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,h),this.addBodyBounds(h)},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(h){var p=this.getLinkPoints();if(!p||p.size()<2){return}var b=this._element,d=b.getStyle("link.width"),v=d;if(this._outerColor){var c=b.getStyle("outer.width");v+=c*2}var m=!this._editAttachment&&b.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(m){var l=b.getStyle("select.width");v+=l*2}this.setShadow(this,h),h.lineCap=b.getStyle("link.cap"),h.lineJoin=b.getStyle("link.join");var g=b.getStyle("link.pattern");m&&this.drawLinePoints(h,p,v,b.getStyle("select.color"),g),this._outerColor&&this.drawLinePoints(h,p,d+c*2,this._outerColor,g),this.drawLinePoints(h,p,d,this._innerColor||b.getStyle("link.color"),g),J.drawLinkArrow(this,h,p)},drawLinePoints:function(d,b,f,c,a){d.lineWidth=f,d.strokeStyle=c,d.beginPath(),B.drawLinePoints(d,b,a),d.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=T.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(b,a){var c=this.getFromPoint();return c?{x:c.x+b,y:c.y+a}:null},getToPosition:function(b,a){var c=this.getToPoint();return c?{x:c.x+b,y:c.y+a}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=L.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=L.createToPoint(this)),this._toPoint},createLinkPoints:function(){var d=this.getFromPoint(),b=this.getToPoint(),f=this.getStyle("link.type");if(L.isOrthogonalOrFlexionalLink(this._element)){return L.orthogonalAndFlexional(this,f)}var c=new twaver.List;if(this._element.isLooped()){var a=this._network.getElementUI(this._element.getFromAgent());if(a==null){return null}this._hotSpot=L.fillLoopedPoints(this,a.getBodyRect(),c)}else{if(f!=="arc"&&f!=="triangle"&&f!=="parallel"){throw"Can not resolve link type '"+f+"'"}this._hotSpot=L.fillBundlePoints(this,f,d,b,c)}return c},checkAttachments:function(){twaver.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);a!=null&&a!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new twaver.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return L.getControlPoint(this._element,this)},setControlPoint:function(c){if(!c){return}var a=this.getStyle("link.type");if(!L.hasControlPoint(a)){return}var d=L.getLinkSourceBounds(this),b=L.getLinkTargetBounds(this);L.setParamsByControlPoint(c,d,b,a,this._element)},getLineLength:function(){return this._lineLength},hit:function(b,a){return T.containsPoint(this.getViewRect(),b,a)?this.hitCanvasPoint(b,a):!1},intersects:function(f){var b=twaver.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(b==1){return !0}if(T.intersects(f,this.getViewRect())==0){return !1}var h=this.getLinkPoints(),d=h.size();if(d==2){for(var a=0;a<d;a+=2){var c=h.get(a);if(a+1<d){var g=h.get(a+1);if(q.intersectsLine(c.x,c.y,g.x,g.y,f.x,f.y,f.width,f.height)){return !0}}}}return this.hitCanvasRect(f)}}),twaver.canvas.GroupUI=function(b,a){twaver.canvas.GroupUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.GroupUI",twaver.canvas.NodeUI,{isEditable:function(){return !this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):twaver.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):twaver.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(b){this.drawPath(b,"group",!1,this._element.getStyle("vector.outline.pattern"));var a=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");a!==0&&c&&this.getStyle("group.shape")==="rectangle"&&B.draw3DRect(b,c,a,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var c=this._element;if(c.isExpanded()){var a=this.getChildrenRects();if(!a.isEmpty()){var d=c.getStyle("group.shape"),b=V[d];if(!b){throw"Can not resolve group shape '"+d+"'"}this._shapeRect=b(a)}}return this._shapeRect?(T.addPadding(this._shapeRect,c,"group.padding",1),this._shapeRect):twaver.canvas.GroupUI.superClass.createBodyRect.call(this)}}),twaver.canvas.ShapeNodeUI=function(b,a){twaver.canvas.ShapeNodeUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.ShapeNodeUI",twaver.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(a){if(this._element._points.size()<2){return}this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),J.drawLinkArrow(this,a,T.getPointObject(this._element._points,this._element._segments))}}),twaver.canvas.ShapeLinkUI=function(b,a){twaver.canvas.ShapeLinkUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.ShapeLinkUI",twaver.canvas.LinkUI,{isEditable:function(){return !0},createLinkPoints:function(){var W=this.getFromPoint(),ac=this.getToPoint(),w=new twaver.List,b=this.getStyle("shapelink.type");w.add(W),this._element._points!=null&&w.addAll(this._element._points),w.add(ac);var y=w.size(),ad=Math.ceil(y/2);if(y%2===0){var m=w.get(ad),ab=w.get(ad-1);this._hotSpot={x:(m.x+ab.x)/2,y:(m.y+ab.y)/2}}else{this._hotSpot=_twaver.clone(w.get(ad))}var Z,S,x;if(b!=="lineto"){if(b==="quadto"){Z=new twaver.List(w.get(0));for(S=1,y=w.size();S<y;S++){S<y-1?Z.add(new twaver.List([w.get(S++),w.get(S)])):Z.add(w.get(S))}w=Z}else{if(b==="cubicto"){Z=new twaver.List(w.get(0));for(S=1,y=w.size();S<y;S++){S<y-2?Z.add(new twaver.List([w.get(S++),w.get(S++),w.get(S)])):S<y-1?Z.add(new twaver.List([w.get(S++),w.get(S)])):Z.add(w.get(S))}w=Z}else{if(b!=="orthogonalto"){throw"Can not resolve shapelink type '"+b+"'"}x=w.get(0),Z=new twaver.List(x);for(S=1,y=w.size();S<y;S++){if(S<y-1){var Y=_twaver.clone(w.get(S)),E=Y.x,g=Y.y,X=E-x.x,aa=g-x.y;Math.abs(X)>Math.abs(aa)?(Y.x=E,Y.y=x.y):(Y.x=x.x,Y.y=g),x=Y,Z.add(x)}else{Z.add(w.get(S))}}w=Z}}}return w}}),twaver.canvas.GridUI=function(b,a){twaver.canvas.GridUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.GridUI",twaver.canvas.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?twaver.network.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage()){twaver.canvas.GridUI.superClass.validateBodyBounds.call(this)}else{var b=this.getBodyRect(),a=_twaver.clone(b);this.appendShadowBound(this,a),this.addBodyBounds(a)}},drawGridBody:function(u){var x=this.getStyle("grid.fill"),g=this.getStyle("grid.deep"),b=this.getStyle("grid.cell.deep");if(!x&&g===0&&b===0){return}u.beginPath();var m=this._element.getRect(),y=this.getDyeColor("grid.fill.color");this.setShadow(this,u),x&&(u.fillStyle=y,u.rect(m.x,m.y,m.width,m.height),u.fill()),u.closePath(),this.clearShadow(u),u.beginPath(),g!=0&&B.draw3DRect(u,y,g,m.x,m.y,m.width,m.height),u.closePath();if(b!=0){var d=this.getStyle("grid.row.count"),w=this.getStyle("grid.column.count");for(var p=0;p<d;p++){for(var h=0;h<w;h++){var v=this._element.getCellRect(p,h);v!=null&&(u.beginPath(),B.draw3DRect(u,y,b,v.x,v.y,v.width,v.height),u.closePath())}}}}}),twaver.canvas.RotatableNodeUI=function(b,a){twaver.canvas.RotatableNodeUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.RotatableNodeUI",twaver.canvas.NodeUI,{isEditable:function(){return !1},getDefaultBodyRect:function(){var b=this._element,a=_twaver.getImageAsset(b.getImage()),c=this.getBodyRect();return a?(T.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(f){var b=this._element,h=_twaver.getImageAsset(b.getImage()),d=this.getBodyRect();T.addPadding(d,this._element,"image.padding",1);if(h.getImage()){var a=this._element._getOrignalWidth(),c=this._element._getOrignalHeight(),g=this._element._getRotateRect();f.save(),f.translate(d.x-g.x+a/2,d.y-g.y+c/2),f.rotate(this._element._angle*Math.PI/180),f.drawImage(h.getImage(this._innerColor),-a/2,-c/2,a,c),f.restore()}else{if(!h.getSrc()&&!h.getFunction()){throw"ImageAsset '"+b.getImage()+" ' is empty"}}}}),twaver.canvas.Attachment=function(b,a){this._ui=b,this._element=this._ui.getElement(),this._network=b.getNetwork(),this._showOnTop=a},_twaver.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return _twaver.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},hit:function(b,a){return T.containsPoint(this._viewRect,b,a)?this.hitCanvasRect({x:b-1,y:a-1,width:2,height:2}):!1},hitCanvasRect:function(l){var v=q.getHitCanvas(l.width,l.height),d=q.getCtx(v);d.save(),d.translate(-l.x,-l.y),this.paint(d);try{var b=d.getImageData(0,0,l.width,l.height),g=b.data;for(var w=0;w<b.width;w++){for(var c=0;c<b.height;c++){var p=4*(c*b.width+w),m=g[p+3];if(m!==0){return d.restore(),!0}}}}catch(h){q.disposeHitCanvas()}return d.restore(),!1}}),twaver.canvas.BasicAttachment=function(b,a){twaver.canvas.BasicAttachment.superClass.constructor.call(this,b,a),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},_twaver.ext("twaver.canvas.BasicAttachment",twaver.canvas.Attachment,{paint:function(d){twaver.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),f=this.getOutlineWidth();this.getElementUI().setShadow(this,d);if(f>0||b){B.drawRoundRect(d,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(d.moveTo(this._pointers[0].x,this._pointers[0].y),d.lineTo(this._pointers[1].x,this._pointers[1].y),d.lineTo(this._pointers[2].x,this._pointers[2].y)),d.closePath(),f>0&&(d.lineWidth=f,d.strokeStyle=this.getOutlineColor(),d.lineCap=this.getCap(),d.lineJoin=this.getJoin(),d.stroke());if(b){var c=this.getFillColor(),a=this.getGradient();a?B.fill(d,c,a,this.getGradientColor(),this._viewRect):d.fillStyle=c,d.fill()}}},validate:function(){twaver.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();this._viewRect=T.getRect(this._pointers),this._viewRect=T.unionRect(this._viewRect,this._roundRect),a>0&&T.grow(this._viewRect,a/2,a/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var y=this.getContentWidth(),W=this.getContentHeight(),g=this.getCornerRadius(),b=this.getPointerLength(),v=this.getPointerWidth(),X=this.getPosition(),d=this.getXOffset(),S=this.getYOffset(),E=this._roundRect;E.width=y+g*2,E.height=W;var x;if(b>0){var m=this.getDirection();x=this._network.getPosition(X,this._ui,null,d,S);var w;if(m==="aboveleft"){E.y=x.y-b-E.height,E.x=x.x-(E.width-g),w=Math.max(x.x-v,E.x+g/2),this._pointers=[x,{x:x.x,y:x.y-b},{x:w,y:x.y-b}]}else{if(m==="aboveright"){E.y=x.y-b-E.height,E.x=x.x-g,w=Math.min(x.x+v,E.x+E.width-g/2),this._pointers=[x,{x:x.x,y:x.y-b},{x:w,y:x.y-b}]}else{if(m==="belowleft"){E.y=x.y+b,E.x=x.x-(E.width-g),w=Math.max(x.x-v,E.x+g/2),this._pointers=[x,{x:x.x,y:x.y+b},{x:w,y:x.y+b}]}else{if(m==="belowright"){E.y=x.y+b,E.x=x.x-g,w=Math.min(x.x+v,E.x+E.width-g/2),this._pointers=[x,{x:x.x,y:x.y+b},{x:w,y:x.y+b}]}else{if(m==="leftabove"){E.y=x.y+g-E.height,E.x=x.x-b-E.width,w=Math.max(x.y-v,E.y+g/2),this._pointers=[x,{x:x.x-b,y:x.y},{x:x.x-b,y:w}]}else{if(m==="leftbelow"){E.y=x.y-g,E.x=x.x-b-E.width,w=Math.min(x.y+v,E.y+E.height-g/2),this._pointers=[x,{x:x.x-b,y:x.y},{x:x.x-b,y:w}]}else{if(m==="rightabove"){E.y=x.y+g-E.height,E.x=x.x+b,w=Math.max(x.y-v,E.y+g/2),this._pointers=[x,{x:x.x+b,y:x.y},{x:x.x+b,y:w}]}else{if(m==="rightbelow"){E.y=x.y-g,E.x=x.x+b,w=Math.min(x.y+v,E.y+E.height-g/2),this._pointers=[x,{x:x.x+b,y:x.y},{x:x.x+b,y:w}]}else{if(m==="above"){E.y=x.y-b-E.height,E.x=x.x-E.width/2,w=Math.min(y/2,v/2),this._pointers=[x,{x:x.x-w,y:x.y-b},{x:x.x+w,y:x.y-b}]}else{if(m==="below"){E.y=x.y+b,E.x=x.x-E.width/2,w=Math.min(y/2,v/2),this._pointers=[x,{x:x.x-w,y:x.y+b},{x:x.x+w,y:x.y+b}]}else{if(m==="left"){E.y=x.y-E.height/2,E.x=x.x-b-E.width,w=Math.min(W/2,v/2),this._pointers=[x,{x:x.x-b,y:x.y+w},{x:x.x-b,y:x.y-w}]}else{if(m!=="right"){throw"Can not resolve '"+m+"' attachment direction"}E.y=x.y-E.height/2,E.x=x.x+b,w=Math.min(W/2,v/2),this._pointers=[x,{x:x.x+b,y:x.y+w},{x:x.x+b,y:x.y-w}]}}}}}}}}}}}}else{x=this._network.getPosition(X,this._ui,{width:E.width,height:E.height},d,S),E.x=x.x,E.y=x.y,this._pointers=null}this._contentRect.x=E.x+(E.width-y)/2,this._contentRect.y=E.y+(E.height-W)/2,this._contentRect.width=y,this._contentRect.height=W;var c=this.getPadding();c!=0&&T.grow(E,c,c),c=this.getPaddingLeft(),c!=0&&(E.x-=c,E.width+=c),c=this.getPaddingRight(),c!=0&&(E.width+=c),c=this.getPaddingTop(),c!=0&&(E.y-=c,E.height+=c),c=this.getPaddingBottom(),c!=0&&(E.height+=c),E.width<0&&(E.width=E.width,E.x-=E.width),E.height<0&&(E.height=-E.height,E.y-=E.height)},getContentWidth:function(){return twaver.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return twaver.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return twaver.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return twaver.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return twaver.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return twaver.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return twaver.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return twaver.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return twaver.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return twaver.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return twaver.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return twaver.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return twaver.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return twaver.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return twaver.Defaults.ATTACHMENT_FILL},getFillColor:function(){return twaver.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return twaver.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return twaver.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return twaver.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return twaver.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return twaver.Defaults.ATTACHMENT_CAP},getJoin:function(){return twaver.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return twaver.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return _twaver.clone(this._roundRect)},getContentRect:function(){return _twaver.clone(this._contentRect)}}),twaver.canvas.LabelAttachment=function(b,a){twaver.canvas.LabelAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.LabelAttachment",twaver.canvas.BasicAttachment,{paint:function(a){twaver.canvas.LabelAttachment.superClass.paint.apply(this,arguments),B.drawText(a,this.text,this._contentRect,this.font,this.getStyle("label.color"))},validate:function(){this.font=this.getFont("label.font"),this.text=this.getLabel(),this._textSize=B.getTextSize(this.font,this.text),twaver.canvas.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),twaver.canvas.AlarmAttachment=function(b,a){twaver.canvas.AlarmAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.AlarmAttachment",twaver.canvas.BasicAttachment,{paint:function(a){twaver.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),B.drawText(a,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=B.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),twaver.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),twaver.canvas.LinkHandlerAttachment=function(b,a){twaver.canvas.LinkHandlerAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.LinkHandlerAttachment",twaver.canvas.BasicAttachment,{paint:function(a){twaver.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),B.drawText(a,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=B.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),twaver.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),twaver.canvas.IconsAttachment=function(b,a){twaver.canvas.IconsAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.IconsAttachment",twaver.canvas.Attachment,{isShadowable:function(){return twaver.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){twaver.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element);if(!this.iconsNames||this.iconsNames.length==0){return}this.iconsColors=this._network.getIconsColors(this._element),this.iconsOrientation=this._element.getStyle("icons.orientation"),this.iconsPosition=this._element.getStyle("icons.position"),this.iconsXoffset=this._element.getStyle("icons.xoffset"),this.iconsYoffset=this._element.getStyle("icons.yoffset"),this.iconsXgap=this._element.getStyle("icons.xgap"),this.iconsYgap=this._element.getStyle("icons.ygap");var a=this._getIconsSize(this.iconsNames,this.iconsOrientation,this.iconsXgap,this.iconsYgap);if(!a){return}this.location=this._network.getPosition(this.iconsPosition,this._ui,a,this.iconsXoffset,this.iconsYoffset),this._viewRect={x:this.location.x,y:this.location.y,width:a.width,height:a.height},this.iconsOrientation==="top"?this.location.y+=a.height:this.iconsOrientation==="left"&&(this.location.x+=a.width)},paint:function(g){twaver.canvas.IconsAttachment.superClass.paint.apply(this,arguments);if(!this.iconsNames||this.iconsNames.length==0){return}var c=this.location.x,l=this.location.y,f=0;for(var b in this.iconsNames){var d=null,h=null;this.iconsColors&&this.iconsColors.length>f&&(h=this.iconsColors[f++]);var a=_twaver.getImageAsset(this.iconsNames[b]);if(a==null){continue}if(this.iconsOrientation==="right"){d={x:c,y:l,width:a.getWidth(),height:a.getHeight()},c+=d.width+this.iconsXgap}else{if(this.iconsOrientation==="left"){d={x:c-a.getWidth(),y:l,width:a.getWidth(),height:a.getHeight()},c-=d.width+this.iconsXgap}else{if(this.iconsOrientation==="top"){d={x:c,y:l-a.getHeight(),width:a.getWidth(),height:a.getHeight()},l-=d.height+this.iconsYgap}else{if(this.iconsOrientation!=="bottom"){throw"Can not resolve '"+this.iconsOrientation+"' orientation"}d={x:c,y:l,width:a.getWidth(),height:a.getHeight()},l+=d.height+this.iconsYgap}}}g.drawImage(a.getImage(h),d.x,d.y,d.width,d.height)}},_getIconsSize:function(l,v,d,b){var g=0,w=0,c=null,p=null,m=null;for(var h in l){p=_twaver.getImageAsset(l[h]);if(!p){continue}if(v==="right"){c={x:g,y:w,width:p.getWidth(),height:p.getHeight()},g+=c.width+d}else{if(v==="left"){c={x:g-p.getWidth(),y:w,width:p.getWidth(),height:p.getHeight()},g-=c.width+d}else{if(v==="top"){c={x:g,y:w-p.getHeight(),width:p.getWidth(),height:p.getHeight()},w-=c.height+b}else{if(v!=="bottom"){throw"Can not resolve '"+v+"' orientation"}c={x:g,y:w,width:p.getWidth(),height:p.getHeight()},w+=c.height+b}}}m==null?m=_twaver.clone(c):m=T.unionRect(m,c)}return m?{width:Math.abs(m.width),height:Math.abs(m.height)}:null}}),twaver.canvas.EditAttachment=function(b,a){twaver.canvas.EditAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.canvas.EditAttachment",twaver.canvas.Attachment,{paint:function(a){twaver.canvas.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(a),this.paintEditPoints(a)},paintResizingPoints:function(g){var m=this.resizingPoints.size();if(m<=0){return}var d=this.editPointSize*2,b=this.editPointSize*2,f=this._network.getResizePointFillColor(),p=this._network.getResizePointOutlineWidth(),c=this._network.getResizePointOutlineColor();g.lineWidth=p;for(var l=0;l<m;l++){var h=this.resizingPoints.get(l);q.rect(g,h.x-this.editPointSize,h.y-this.editPointSize,d,b)}g.fillStyle=f,g.strokeStyle=c,g.fill(),g.stroke()},paintEditPoints:function(f){var b=this.editPoints.size();if(b<=0){return}var h=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),a=this._network.getEditPointOutlineWidth();f.beginPath(),f.lineWidth=a;for(var c=0;c<b;c++){var g=this.editPoints.get(c);f.beginPath(),q.circle(f,g.x,g.y,this.editPointSize,d,h),f.closePath()}},validate:function(){twaver.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizingPoints=new twaver.List,this.editPoints=new twaver.List,this._element instanceof twaver.Node&&this._addResizingPoint(this._element),this._element instanceof twaver.ShapeNode&&this._addShapeNodePoint(this._element),this._ui instanceof twaver.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof twaver.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(c){var a=c.getRect();if(!a){return}var d=new twaver.List([{x:a.x,y:a.y},{x:a.x+a.width/2,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x,y:a.y+a.height/2},{x:a.x+a.width,y:a.y+a.height/2},{x:a.x,y:a.y+a.height},{x:a.x+a.width/2,y:a.y+a.height},{x:a.x+a.width,y:a.y+a.height}]),b=this._network.getResizePointOutlineWidth();this._addPoints(a,d,b,!0)},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addShapeLinkPoints:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(b){if(L.isOrthogonalLink(b._element)){var a=b.getControlPoint();if(a){var c=new twaver.List;c.add(a),this._addEditPoints(c)}}},_addEditPoints:function(b){var a=T.getRect(b);if(!a){return}var c=this._network.getEditPointOutlineWidth();this._addPoints(a,b,c,!1)},_addPoints:function(d,b,f,c){var a=this.editPointSize+f;T.grow(d,a,a),this._viewRect=d,c==1?this.resizingPoints=b:this.editPoints=b}}),twaver.canvas.interaction.BaseInteraction=function(a){this.network=a},_twaver.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(b){var a=b.x*this.network.getZoom()-this.network.getViewRect().x,c=b.y*this.network.getZoom()-this.network.getViewRect().y;return{x:a,y:c}},convertFromUIToMarkerRect:function(c,a,d){var b=this.network.getZoom();return{x:c.x*b-this.network.getViewRect().x+a*b,y:c.y*b-this.network.getViewRect().y+d*b,width:c.width*b,height:c.height*b}},getMarkerPoint:function(b){var a;if(k.isTouchable&&b.changedTouches&&b.changedTouches.length>0){var c=b.changedTouches[0];return a={x:c.clientX,y:c.clientY},a}return k.isFirefox?a={x:b.layerX,y:b.layerY}:a={x:b.offsetX,y:b.offsetY},a},paint:function(a){},addListener:function(){for(var b=0;b<arguments.length;b++){var a=arguments[b];P.addEventListener(a,"handle_"+a,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++){P.removeEventListener(arguments[a],this.network.getView(),this)}}}),twaver.canvas.interaction.SelectInteraction=function(a){twaver.canvas.interaction.SelectInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.canvas.interaction.SelectInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(l){if(this.startPoint==null||this.endPoint==null){return}var v=this.convertPointFromView(this.startPoint),d=this.convertPointFromView(this.endPoint),b=v.x,g=v.y,w=d.x,c=d.y,p=T.getRect([{x:b,y:g},{x:w,y:c}]);if(p!=null){l.beginPath();var m=this.network.getSelectOutlineWidth(),h=this.getIntersectMode()?this.network.getSelectFillColor():null;l.strokeStyle=this.network.getSelectOutlineColor(),l.lineWidth=m,q.rect(l,p.x,p.y,p.width,p.height,h,this.network.getSelectOutlineColor()),l.closePath()}},handle_mousedown:function(b){if(!this.network.isValidEvent(b)||this.network.isMovingElement()||this.network.isEditingElement()){return}if(b.shiftKey){return}var a=this.network.getElementAt(b),c=this.network.getSelectionModel();a?_twaver.isCtrlDown(b)?c.contains(a)?c.removeSelection(a):c.appendSelection(a):c.contains(a)||c.setSelection(a):(_twaver.isCtrlDown(b)||c.clearSelection(),this.end(b),this.startPoint=this.network.getLogicalPoint(b),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(b){if(this.network.isMovingElement()||this.network.isEditingElement()){this.end(b);return}var a=this.network.getLogicalPoint(b);if(!a){return}this.network.setSelectingElement(!0),this.endPoint==null?this.network.fireInteractionEvent({kind:"selectStart",event:b}):this.network.fireInteractionEvent({kind:"selectBetween",event:b}),this.endPoint=a,this.repaint()},end:function(d){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var b=T.getRect([this.startPoint,this.endPoint]),f=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(f&&f.size()>0){var c=this.network.getSelectionModel(),a=c.toSelection();f.forEach(function(g){c.contains(g)?a.remove(g):a.add(g)},this),c.setSelection(a)}this.network.fireInteractionEvent({kind:"selectEnd",event:d})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),twaver.canvas.interaction.MoveInteraction=function(b,a){this.lazyMode=a,twaver.canvas.interaction.MoveInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.canvas.interaction.MoveInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(v){if(this.lazyMode){if(this.pressPoint==null||this.dragPoint==null){return}v.beginPath();var E=this.dragPoint.x-this.pressPoint.x,g=this.dragPoint.y-this.pressPoint.y,b=this.network.getMovableSelectedElements(),m=b.size(),S=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,d=this.network.getLazyMoveOutlineWidth(),y=this.network.getLazyMoveOutlineColor();v.strokeStyle=y,v.lineWidth=d,v.fillStyle=S;for(var x=0;x<m;x++){var p=b.get(x),h=this.network.getElementUI(p);if(h){var w=this.convertFromUIToMarkerRect(h.getViewRect(),E,g);q.rect(v,w.x,w.y,w.width,w.height)}}v.fill(),v.stroke()}},handle_mousedown:function(b){if(!this.network.isValidEvent(b)||this.network.isSelectingElement()||this.network.isEditingElement()){return}var a=this.network.getElementAt(b);if(!this.network.isMovable(a)){return}this.end(b),this.lastPoint=this.network.getLogicalPoint(b),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove")},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(b){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()){this.end(b);return}var a=this.network.getLogicalPoint(b);if(!a){return}this.xoffset=a.x-this.lastPoint.x,this.yoffset=a.y-this.lastPoint.y;if(Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1){return}this.lazyMode?this.dragPoint==null?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:b}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:b}):(this.network.moveSelectedElements(this.xoffset,this.yoffset),this.lastPoint=a,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:b}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:b}))),this.lazyMode&&(this.dragPoint=a,this.repaint())},end:function(d){if(this.lazyMode){if(this.dragPoint!=null&&this.pressPoint!=null){var b=this,f=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:d}),b.network.setMovingElement(!1)},c=this.dragPoint.x-this.pressPoint.x,a=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(c,a,this.network.isLazyMoveAnimate(),f)}}else{this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:d}))}this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),twaver.canvas.interaction.ScrollInteraction=function(a){twaver.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,a),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},_twaver.ext("twaver.canvas.interaction.ScrollInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),k.isFirefox?P.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):P.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),P.addEventListener("mouseup","handleMouseUp",Q,this),P.addEventListener("mousemove","handleMouseMove",Q,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),k.isFirefox?P.removeEventListener("DOMMouseScroll",this.network.getView(),this):P.removeEventListener("mousewheel",this.network.getView(),this),P.removeEventListener("mouseup",Q,this),P.removeEventListener("mousemove",Q,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this)},handleViewRectChange:function(a){(a.property=="viewRect"||a.property=="canvasSizeChange")&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){this.hThumbRect=null,this.vThumbRect=null;if(this.network.isScrollBarVisible()==0){this.repaint();return}var E=this.network.getViewRect().height,Y=this.network.getViewRect().width,m=this.network.getViewRect().x,b=this.network.getViewRect().y,w=this.network.getCanvasSize(),Z=w.width,g=w.height;if(Z>Y){if(m<0||m+Y>Z){this.repaint();return}}if(g>E){if(b<0||b+E>g){this.repaint();return}}var X=0,W=E<g,y=Y<Z,v=this.getScrollBarWidth();if(E<g){y?X=E*(E-v)/g:X=E*E/g;var S=b/(g-E)*(E-X-v);this.vThumbRect={x:Y-v,y:S,width:v,height:X}}var x=0;if(Y<Z){W?x=Y*(Y-v)/Z:x=Y*Y/Z;var d=m/(Z-Y)*(Y-x-v);this.hThumbRect={x:d,y:E-v,width:x,height:v}}this.network.setHScrollBarVisible(this.hThumbRect!=null),this.network.setVScrollBarVisible(this.vThumbRect!=null),this.repaint()},scrollXOffset:function(f){var b=this.network.getViewRect().height,g=this.network.getViewRect().width,d=this.network.getViewRect().x,a=this.network.getViewRect().y,c=30;f&&(c=-30),this.network.setViewRect(d+c,a,g,b)},scrollYOffset:function(f){var b=this.network.getViewRect().height,g=this.network.getViewRect().width,d=this.network.getViewRect().x,a=this.network.getViewRect().y,c=30;f&&(c=-30),this.network.setViewRect(d,a+c,g,b)},handle_mousedown:function(b){if(this.network.isValidEvent(b)==1){return}var a=this.getMarkerPoint(b);this.hBarDownPoint=null,this.vBarDownPoint=null,this.vThumbRect!=null&&T.containsPoint(this.vThumbRect,a.x,a.y)&&(this.vBarDownPoint={x:b.screenX,y:b.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),this.hThumbRect!=null&&T.containsPoint(this.hThumbRect,a.x,a.y)&&(this.hBarDownPoint={x:b.screenX,y:b.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)},handle_mouseover:function(a){if(this.scrollBarVisible==1){return}this.scrollBarVisible=!0,this.repaint()},handle_mouseout:function(a){if(this.scrollBarVisible==0){return}this.scrollBarVisible=!1,this.repaint()},handleMouseUp:function(a){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(g){var c={x:g.screenX,y:g.screenY},l=this.network.getCanvasSize(),f=this.network.getViewRect().height,b=this.network.getViewRect().width,d=this.getScrollBarWidth();if(this.hBarDownPoint!=null){var h=c.x-this.hBarDownPoint.x;this.hBarDownPoint=c,this.network.setViewOffSet(h*l.width/(b-d),0);return}if(this.vBarDownPoint!=null){var a=c.y-this.vBarDownPoint.y;this.vBarDownPoint=c,this.network.setViewOffSet(0,a*l.height/(f-d));return}},handleMouseWheel:function(b){var a=!1,c=!1;b.wheelDelta!==b.wheelDeltaX?(b.wheelDelta?b.wheelDelta>0&&(a=!0):b.detail<0&&(a=!0),this.scrollYOffset(a)):(b.wheelDelta?b.wheelDelta>0&&(c=!0):b.detail<0&&(c=!0),this.scrollXOffset(c))},paintRoundRect:function(h,d,m,g,c,f,l,b){h.beginPath(),h.globalAlpha=m,h.fillStyle=d,B.drawRoundRect(h,g,c,f,l,b),h.fill()},end:function(){},paint:function(f){if(this.network.isScrollBarVisible()==0){return}if(this.scrollBarVisible==0&&this.hBarDownPoint==null&&this.vBarDownPoint==null){return}var b=this.getScrollBarWidth(),g=this.network.getViewRect().height,d=this.network.getViewRect().width;f.save();var a,c=this.getScrollBarColor();this.hThumbRect!=null&&(a=f.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),a.addColorStop(0,c),a.addColorStop(1,"#666666"),this.paintRoundRect(f,this.getScrollBarColor(),0.5,0,g-b,d-b,b,b/2),this.paintRoundRect(f,a,0.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),this.vThumbRect!=null&&(a=f.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),a.addColorStop(0,c),a.addColorStop(1,"#666666"),this.paintRoundRect(f,this.getScrollBarColor(),0.5,d-b,0,b,g-b,b/2),this.paintRoundRect(f,a,0.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),f.restore()}}),twaver.canvas.interaction.DefaultInteraction=function(a){twaver.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.canvas.interaction.DefaultInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown")},tearDown:function(){this.removeListener("mousedown","keydown")},handle_mousedown:function(b){if(!this.network.isValidEvent(b)){return}this.network.isFocusOnClick()&&twaver.Util.setFocus(this.network.getView());var a=this.network.getElementAt(b);b.detail===2?this.handleDoubleClicked(b,a):this.handleClicked(b,a)},handleClicked:function(b,a){H.handleClicked(this.network,b,a)},handleDoubleClicked:function(b,a){H.handleDoubleClicked(this.network,b,a)},handle_keydown:function(a){H.handleKeyDown(this.network,a)}}),twaver.canvas.interaction.PanInteraction=function(a){twaver.canvas.interaction.PanInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.canvas.interaction.PanInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(a){if(!this.network.isValidEvent(a)){return}this.lastPoint=this.getMarkerPoint(a),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(c){if(!this.lastPoint){return}var a=this.getMarkerPoint(c);if(!a){return}var d=a.x-this.lastPoint.x,b=a.y-this.lastPoint.y;this.network.panByOffset(-d,-b),this.lastPoint=a},_clear:function(a){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),twaver.canvas.interaction.CreateElementInteraction=function(b,a){a||(a=twaver.Node),twaver.Util.isTypeOf(a,twaver.Node)?this.elementFunction=function(c){var d=new a;return d instanceof twaver.Node&&d.setCenterLocation(c),d}:this.elementFunction=a,twaver.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.canvas.interaction.CreateElementInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(b){var a=this.network.getLogicalPoint(b);if(a){var c=this.elementFunction(a);c&&this.network.addElementByInteraction(c)}}}),twaver.canvas.interaction.EditInteraction=function(b,a){this.lazyMode=a,this.pointIndex=-1,twaver.canvas.interaction.EditInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.canvas.interaction.EditInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(b){if(this.lazyMode==1&&this.resizingRect!=null){b.lineWidth=this.network.getResizeLineWidth();var a=this.convertFromUIToMarkerRect(this.resizingRect,0,0);q.rect(b,a.x,a.y,a.width,a.height,null,this.network.getResizeLineColor())}},clear:function(){this.network.setEditingElement(!1),this.isStart=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(!this.network.isEditingElement()){return}this.isStart||(this.node&&this.resizeDirection?(this.isStart=!0,this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})))},handle_mouseup:function(c){if(this.isStart){var a=this.network.getLogicalPoint(c);if(this.resizingRect){if(this.lazyMode){if(this.network.ResizeAnimate){var d=this,b=new twaver.animaate.AnimateBounds(this.node,this.resizingRect,function(){d.network.fireInteractionEvent({kind:"lazyResizeEnd",event:c,element:d.node,resizeDirection:d.resizeDirection})});twaver.animate.AnimateManager.start(b)}else{this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:c,element:this.node,resizeDirection:this.resizeDirection})}}else{this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:c,element:this.node,resizeDirection:this.resizeDirection})}}else{this.shapeNode&&this.pointIndex>=0&&a?(this.shapeNode.setPoint(this.pointIndex,a),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:c,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&a?(this.shapeLink.setPoint(this.pointIndex,a),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:c,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&a&&(this.linkUI.setControlPoint(a),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:c,element:this.linkUI._element}))}}this.clear()},handle_mousemove:function(d){if(!this.network.isValidEvent(d)){return}if(this.isStart&&this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(d);return}if(this.isStart&&this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(d);return}if(this.isStart&&this.node&&this.resizeDirection){this._handleResizing(d);return}if(this.isStart&&this.linkUI){this._handleMovingLinkControlPoint(d);return}if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var b=this.network.getElementAt(d),f=this.network.getElementUI(b);if(!f||!f.getEditAttachment()){this.clear();return}var c=this.network.getLogicalPoint(d);if(b instanceof twaver.Node){this.node=b;if(this._isEditingShapeNode(c)||this._isResizingNode(c)){this.network.setEditingElement(!0);return}}else{if(b instanceof twaver.ShapeLink){this.shapeLink=b;if(this._isEditingShapeLink(c)){this.network.setEditingElement(!0);return}}else{if(f instanceof twaver.canvas.LinkUI&&L.isOrthogonalLink(f._element)){this.linkUI=f;var a=this.linkUI.getControlPoint();a&&this._contains(c,a)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}}}this.clear()},_handleMovingShapeNodePoint:function(b){var a=this.network.getLogicalPoint(b);this.shapeNode.setPoint(this.pointIndex,a),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:b,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(b){var a=this.network.getLogicalPoint(b);this.shapeLink.setPoint(this.pointIndex,a),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:b,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this.linkUI.setControlPoint(this.network.getLogicalPoint(a)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(b){var a=this.network.getLogicalPoint(b),c=this.node.getRect();this.resizeDirection==="northwest"&&(this.resizingRect=this._getRect(a.x,a.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="north"&&(this.resizingRect=this._getRect(c.x,a.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="northeast"&&(this.resizingRect=this._getRect(c.x,a.y,a.x,c.y+c.height)),this.resizeDirection==="west"&&(this.resizingRect=this._getRect(a.x,c.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="east"&&(this.resizingRect=this._getRect(c.x,c.y,a.x,c.y+c.height)),this.resizeDirection==="southwest"&&(this.resizingRect=this._getRect(a.x,c.y,c.x+c.width,a.y)),this.resizeDirection==="south"&&(this.resizingRect=this._getRect(c.x,c.y,c.x+c.width,a.y)),this.resizeDirection==="southeast"&&(this.resizingRect=this._getRect(c.x,c.y,a.x,a.y)),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:b,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:b,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(d){if(this.node instanceof twaver.ShapeNode){this.shapeNode=this.node;var b=this.shapeNode.getPoints();for(var f=0,c=b.size();f<c;f++){var a=b.get(f);if(this._contains(d,a)){return this._setCrossCursor(),this.pointIndex=f,!0}}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(d){var b=this.shapeLink.getPoints();for(var f=0,c=b.size();f<c;f++){var a=b.get(f);if(this._contains(d,a)){return this._setCrossCursor(),this.pointIndex=f,!0}}return this.pointIndex=-1,!1},_isResizingNode:function(b){var a=this.node.getRect();return this._isResizing(b,a.x,a.y,"northwest","nwse-resize")?!0:this._isResizing(b,a.x+a.width/2,a.y,"north","ns-resize")?!0:this._isResizing(b,a.x+a.width,a.y,"northeast","nesw-resize")?!0:this._isResizing(b,a.x,a.y+a.height/2,"west","ew-resize")?!0:this._isResizing(b,a.x+a.width,a.y+a.height/2,"east","ew-resize")?!0:this._isResizing(b,a.x,a.y+a.height,"southwest","nesw-resize")?!0:this._isResizing(b,a.x+a.width/2,a.y+a.height,"south","ns-resize")?!0:this._isResizing(b,a.x+a.width,a.y+a.height,"southeast","nwse-resize")?!0:!1},_isResizing:function(d,b,f,c,a){return this._contains(d,{x:b,y:f})?(this.resizeDirection!==c&&(this._removeCursor(),this._setCursor(a),this.resizeDirection=c),!0):!1},_getRect:function(g,c,l,f){var b=g<l?g:l,d=c<f?c:f,h=Math.abs(g-l),a=Math.abs(c-f);return{x:b,y:d,width:h,height:a}},_contains:function(c,a){var d=this.network.getEditPointSize(),b={x:a.x-d,y:a.y-d,width:d*2,height:d*2};return T.containsPoint(b,c)}}),twaver.canvas.interaction.CreateLinkInteraction=function(b,a){a||(a=twaver.Link),twaver.Util.isTypeOf(a,twaver.Link)?this.linkFunction=function(d,f){var c=new a;return c instanceof twaver.Link&&(c.setFromNode(d),c.setToNode(f)),c}:this.linkFunction=a,twaver.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.canvas.interaction.CreateLinkInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(c){c.beginPath();var a,d;c.lineWidth=this.network.getEditLineWidth();var b=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(a=this.network.getElementUI(this.currentNode).getViewRect(),d=this.convertFromUIToMarkerRect(a,0,0),q.rect(c,d.x,d.y,d.width,d.height,null,b)),this.fromNode&&(a=this.network.getElementUI(this.fromNode).getViewRect(),d=this.convertFromUIToMarkerRect(a,0,0),q.rect(c,d.x,d.y,d.width,d.height,null,b)),this.currentPoint&&this.paintLine(c),c.closePath()},paintLine:function(f){var b=this.network.getEditLineColor(),h=this.convertPointFromView(this.fromNode.getCenterLocation()),d=h.x,a=h.y,c=this.currentPoint.x,g=this.currentPoint.y;f.strokeStyle=b,f.beginPath(),f.moveTo(d,a),f.lineTo(c,g),f.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(b){if(!this.network.isValidEvent(b)){return}if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var a=this.createLink();a&&this.network.addElementByInteraction(a)}this.clear()}else{this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()}},handle_mousemove:function(b){var a=this.getMarkerPoint(b);if(!a){return}if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var c=null;this.fromNode?(this.currentNode=this.getToNode(b),this.currentPoint=a,this.repaint()):(c=this.getFromNode(b),this.currentNode!==c&&(this.currentNode=c,this.repaint()))},getFromNode:function(b){var a=this.network.getElementAt(b);return a instanceof twaver.Node?a:null},getToNode:function(b){var a=this.network.getElementAt(b);return a instanceof twaver.Node?a:null}}),twaver.canvas.interaction.CreateShapeLinkInteraction=function(b,a){twaver.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,b),a||(a=twaver.ShapeLink),twaver.Util.isTypeOf(a,twaver.ShapeLink)?this.linkFunction=function(f,g,d){var c=new a;return c instanceof twaver.ShapeLink&&(c.setFromNode(f),c.setToNode(g),d&&c.setPoints(d)),c}:this.linkFunction=a},_twaver.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",twaver.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,twaver.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(c){var a=this.network.getLogicalPoint(c);if(!a){return}if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var d=this.createLink();d&&this.network.addElementByInteraction(d),this.clear()}else{this.points||(this.points=new twaver.List);if(this.points.size()>0){var b=this.points.get(this.points.size()-1);if(b.x===a.x&&b.y===a.y){return}}this.points.add(a)}}else{this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null}this.repaint()},paintLine:function(d){if(this.currentPoint){var b=new twaver.List,f;f=this.convertPointFromView(this.fromNode.getCenterLocation()),b.add(f,0);if(this.points&&this.points.size()>0){var c=this.points.size();for(var a=0;a<c;a++){f=this.convertPointFromView(this.points.get(a)),b.add(f)}}f=this.convertPointFromView(this.currentPoint),b.add(f),d.lineWidth=this.network.getEditLineWidth(),d.strokeStyle=this.network.getEditLineColor(),d.beginPath(),B.drawLinePoints(d,b),d.stroke()}}}),twaver.canvas.interaction.CreateShapeNodeInteraction=function(b,a){a||(a=twaver.ShapeNode),twaver.Util.isTypeOf(a,twaver.ShapeNode)?this.shapeNodeFunction=function(c){var d=new a;return d instanceof twaver.ShapeNode&&c&&d.setPoints(c),d}:this.shapeNodeFunction=a,twaver.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(d){if(this.points&&this.points.size()>0&&this.currentPoint){var b=new twaver.List,f=this.points.size(),c;for(var a=0;a<f;a++){c=this.convertPointFromView(this.points.get(a)),b.add(c)}c=this.convertPointFromView(this.currentPoint),b.add(c),d.lineWidth=this.network.getEditLineWidth(),d.strokeStyle=this.network.getEditLineColor(),d.beginPath(),B.drawLinePoints(d,b),d.stroke()}},handle_mousedown:function(d){var b=this.network.getLogicalPoint(d);if(!b){return}if(d.detail===2){if(this.points){var f=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(f),this.clear();var c=this;setTimeout(function(){c.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new twaver.List);if(this.points.size()>0){var a=this.points.get(this.points.size()-1);if(a.x===b.x&&a.y===b.y){return}}this.points.add(b)}this.repaint()},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.repaint())}}),twaver.canvas.interaction.TouchInteraction=function(a){twaver.canvas.interaction.TouchInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.canvas.interaction.TouchInteraction",twaver.canvas.interaction.BaseInteraction,{setUp:function(){P.addEventListener("touchstart","handleTouchstart",this.network.getView(),this)},tearDown:function(){P.removeEventListener("touchstart",this.network.getView(),this)},handleTouchstart:function(b){P.preventDefault(b);if(O.isSingleTouch(b)){this.lastPoint=this.network.getLogicalPoint(b);var a=this.network.getElementAt(this.lastPoint);this.isClickBackground=!a,this.isClickBackground?this.lastPoint=this.getMarkerPoint(b):this.network.getSelectionModel().contains(a)||this.network.getSelectionModel().setSelection(a)}O.isMultiTouch(b)&&(this.distance=O.getDistance(b),this.zoom=this.network.getZoom()),P.addEventListener("touchmove","handleTouchmove",this.network.getView(),this),P.addEventListener("touchend","handleTouchend",this.network.getView(),this)},handleTouchmove:function(d){this.moved||(this.moved=!0);if(O.isSingleTouch(d)){var b=this.getMarkerPoint(d);if(b==null){return}var f,c;if(this.isClickBackground){f=b.x-this.lastPoint.x,c=b.y-this.lastPoint.y,this.network.panByOffset(-f,-c),this.lastPoint=b}else{if(!this.network.hasMovableSelectedElements()){this.touchEnd();return}b=this.network.getLogicalPoint(d),f=b.x-this.lastPoint.x,c=b.y-this.lastPoint.y,this.lastPoint=b,this.network.moveSelectedElements(f,c)}}else{if(this.distance){var a=O.getDistance(d)/this.distance;this.network.setZoom(this.zoom*a,!1)}}},handleTouchend:function(a){!this.moved&&this.isClickBackground&&this.network.getSelectionModel().clearSelection(),this.touchEnd()},touchEnd:function(){delete this.lastPoint,delete this.isClickBackground,delete this.zoom,delete this.distance,delete this.moved,P.removeEventListener("touchmove",this.network.getView(),this),P.removeEventListener("touchend",this.network.getView(),this)}})})(window);(function(q,y){var b=_twaver.extend,z=_twaver.g,g=_twaver.html,x=_twaver.math,w=_twaver.popup,m=_twaver.render,j=_twaver.touch,v=_twaver.ua,k=twaver.List,d=twaver.Defaults;twaver.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},twaver.charts.ChartBase=function(c){twaver.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new k,this._view=g.createView("hidden"),this._canvas=g.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(c?c:new twaver.ElementBox),this.invalidate();var a;v.isTouchable?a=twaver.charts.ChartTouchInteraction:a=twaver.charts.ChartInteraction,a&&new a(this),this.setToolTipEnabled(d.CHART_TOOLTIP_ENABLED)},_twaver.ext("twaver.charts.ChartBase",twaver.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:d.CHART_BACKGROUND_VISIBLE,_backgroundFill:d.CHART_BACKGROUND_FILL,_backgroundFillColor:d.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:d.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:d.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:d.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:d.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:d.CHART_SELECT_TOLERANCE,_doubleClickToReset:d.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:d.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_xGap:d.CHART_XGAP,_yGap:d.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:d.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:d.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:d.ZOOM_MAX,_minZoom:d.ZOOM_MIN,_xZoomEnabled:d.CHART_XZOOM_ENABLED,_yZoomEnabled:d.CHART_YZOOM_ENABLED,_valueVisible:d.CHART_VALUE_VISIBLE,_valueFont:d.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(c){if(c){if(!this._toolTipListener){var a=this;this._toolTipListener=function(f){w.showToolTip(f,a.getToolTip(f))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else{this._toolTipListener&&(w.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))}},getToolTip:function(l){if(this._toolTipInfos){var c=this.getLogicalPoint(l);c.x-=this._xTranslate,c.y-=this._yTranslate;var o=this._toolTipInfos.size();for(var h=o-1;h>=0;h--){var a=this._toolTipInfos.get(h);if(a.rect&&x.containsPoint(a.rect,c)){return this.getToolTipByData(a.data,a)}}}else{var f=this.tryGetDataAt(l);if(f){return this.getToolTipByData(f,{value:this.getValue(f)})}}return null},getToolTipByData:function(a,c){return c.value!==y?this.formatValueText(c.value,a):null},addToolTipInfo:function(l,c,u,h,a,f,p){this._toolTipInfos&&this._toolTipInfos.add({data:f,rect:{x:l,y:c,width:u,height:h},value:a,index:p})},getLogicalPoint:function(a){return g.getLogicalPoint(this._canvas,a,1)},getTextSize:function(c,a){var f=z.getTextSize(c,a);return f.width&&(f.width+=4),f},getUniqueColor:function(t,B){if(t==null){return null}var p;if(!B){p=this._nonDataColors[t];if(p){return p}}var l=z.getColorArray(t);if(!B){return l[3]!=255?p=t:p="rgba("+l[0]+","+l[1]+","+l[2]+",0.99)",this._nonDataColors[t]=p,p}var A="rgb("+l[0]+","+l[1]+","+l[2]+")";if(this._uniqueColors[A]!==y&&this._uniqueColors[A]!==B){var h=1,c=-1,s=1;v.isOpera&&(l=[l[0],l[1],l[2]]);for(;;){l[0]+=h,l[0]>=255?(l[0]=255,h=-1):l[0]<=0&&(l[0]=0,h=1),A="rgb("+l[0]+","+l[1]+","+l[2]+")";if(this._uniqueColors[A]===y||this._uniqueColors[A]===B){break}l[1]+=c,l[1]>=255?(l[1]=255,c=-1):l[1]<=0&&(l[1]=0,c=1),A="rgb("+l[0]+","+l[1]+","+l[2]+")";if(this._uniqueColors[A]===y||this._uniqueColors[A]===B){break}l[2]+=s,l[2]>=255?(l[2]=255,s=-1):l[2]<=0&&(l[2]=0,s=1),A="rgb("+l[0]+","+l[1]+","+l[2]+")";if(this._uniqueColors[A]===y||this._uniqueColors[A]===B){break}}}return this._uniqueColors[A]=B,A},tryGetDataAt:function(D,H){if(H==null||H<0){H=this._selectTolerance}D.target&&(D=g.getLogicalPoint(this._canvas,arguments[0],1));if(!D){return null}var o=D.x-H,A=D.y-H,I=H*2+1,G=H*2+1;try{var F=this._canvas.getContext("2d").getImageData(o,A,I,G).data;for(var C=0;n=F.length,C<n;C+=4){if(F[C+3]===255){var p="rgb("+F[C]+","+F[C+1]+","+F[C+2]+")",E=this._uniqueColors[p];if(E){return E}}}}catch(B){}return null},_getPoint:function(){var c,a;if(arguments.length===2){c=arguments[0],a=arguments[1]}else{if(arguments[0].target){var f=g.getLogicalPoint(this._canvas,arguments[0],1);if(!f){return null}c=f.x,a=f.y}else{c=arguments[0].x,a=arguments[0].y}}return{x:c,y:a}},getDataAt:function(){var l=this._getPoint.apply(this,arguments),c=l.x,u=l.y;if(c<0||u<0||c>this._canvasWidth||u>this._canvasHeight){return null}try{var h=this._canvas.getContext("2d").getImageData(c,u,1,1).data;if(h[3]===255){var a="rgb("+h[0]+","+h[1]+","+h[2]+")",f=this._uniqueColors[a];if(f){return f}}}catch(p){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(c,a){this._backgroundRect=_twaver.clone(a),a!=null&&a.width>0&&a.height>0&&this._backgroundVisible&&(this._backgroundFill&&z.fill(c,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),a),this._backgroundOutlineWidth>0&&(c.lineWidth=this._backgroundOutlineWidth,c.strokeStyle=this._backgroundOutlineColor),c.beginPath(),c.rect(a.x,a.y,a.width,a.height),c.closePath(),this._backgroundFill&&c.fill(),this._backgroundOutlineWidth>0&&c.stroke())},getName:function(a){return a.getName()},getColor:function(a){return a.getStyle?a.getStyle("chart.color"):a.getClient("chart.color")},getValue:function(a){return a.getStyle?a.getStyle("chart.value"):0},getValueColor:function(a){return a.getStyle?a.getStyle("chart.value.color"):twaver.Styles.getStyle("chart.value.color")},setValueFont:function(c){if(c===this._valueFont){return}var a=c;this._valueFont=c,this.firePropertyChange("valueFont",a,c)},getValueFont:function(c){if(c){var a=c.getStyle?c.getStyle("chart.value.font"):twaver.Styles.getStyle("chart.value.font");if(a){return a}}return this._valueFont},formatValueText:function(c,a){return c},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(a){return this._internalVisibleFunction&&!this._internalVisibleFunction(a)?!1:this._visibleFunction?this._visibleFunction(a):!0},onPropertyChanged:function(a){twaver.charts.IS_INVALIDATE_PROPERTY[a.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(c){if(!c){throw"DataBox can not be null"}if(this._box===c){return}var a=this._box;a&&(a.removeDataBoxChangeListener(this.handleDataBoxChange,this),a.removeDataPropertyChangeListener(this.handlePropertyChange,this),a.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||a.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=c,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(c):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",a,this._box)},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){this.invalidateModel()},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new k,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(c,a){c.forEach(function(f){a.add(f),this._buildChildren(f.getChildren(),a)},this)},invalidateModel:function(){if(this._invalidateModel){return}this._invalidateModel=!0,this.invalidate()},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(c){c.IStyle?c.getStyle("chart.color")||c.setStyle("chart.color",_twaver.nextColor()):c.getClient("chart.color")||c.setClient("chart.color",_twaver.nextColor())}),this.validateModel());var a=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),a.clearRect(0,0,this._canvasWidth,this._canvasHeight),this._canvasWidth>0&&this._canvasHeight>0&&(a.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new k:null,this.validateDisplay(a,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,a.translate(-this._xTranslate,-this._yTranslate))},validateModel:function(){},validateDisplay:function(c,a,f){},drawLine:function(l,c,u,h,a,f,p){u>0&&(l.lineWidth=u,l.strokeStyle=this.getUniqueColor(c),l.beginPath(),l.moveTo(h,a),l.lineTo(f,p),l.stroke())},drawValueTexts:function(a){this._valueTexts&&this._valueTexts.forEach(function(c){z.drawText(a,c.text,c,c.font,c.color)})},drawVerticalText:function(h,c,l,f,a){a=this.getUniqueColor(a),h.translate(l.x,l.y),h.rotate(-Math.PI/2),z.drawText(h,c,null,f,a),h.rotate(Math.PI/2),h.translate(-l.x,-l.y)},_getValueTextInfo:function(h,c){if(this._valueTexts){var l=this.formatValueText(c,h);if(l&&l!==""){var f=this.getValueColor(h),a={text:l,font:this.getValueFont(h),color:this.getUniqueColor(f,h)};return this._valueTexts.add(a),a}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(c){if(c<0){return}var a=this._maxZoom;this._maxZoom=c,this.firePropertyChange("maxZoom",a,c),this.getXZoom()>c&&this.setXZoom(c,!1),this.getYZoom()>c&&this.setYZoom(c,!1)},getMinZoom:function(){return this._minZoom},setMinZoom:function(c){if(c<0){return}var a=this._minZoom;this._minZoom=c,this.firePropertyChange("minZoom",a,c),this.getXZoom()<c&&this.setXZoom(c),this.getYZoom()<c&&this.setYZoom(c)},zoomIn:function(a){a==null&&(a=d.ZOOM_ANIMATE),a?twaver.animate.AnimateManager.start(new twaver.animate.AnimateXYZoom(this,this._xZoom*d.ZOOM_INCREMENT,this._yZoom*d.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(a){a==null&&(a=d.ZOOM_ANIMATE),a?twaver.animate.AnimateManager.start(new twaver.animate.AnimateXYZoom(this,this._xZoom/d.ZOOM_INCREMENT,this._yZoom/d.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(a){a==null&&(a=d.ZOOM_ANIMATE),a?twaver.animate.AnimateManager.start(new twaver.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(c,a){},xZoomIn:function(a){this.setXZoom(this._xZoom*d.ZOOM_INCREMENT,a)},xZoomOut:function(a){this.setXZoom(this._xZoom/d.ZOOM_INCREMENT,a)},xZoomReset:function(a){this.setXZoom(1,a)},setXZoom:function(f,a){if(!_twaver.num(f)||f<=0){return}f<this._minZoom&&(f=this._minZoom),f>this._maxZoom&&(f=this._maxZoom);if(f===this.xZoom){return}a==null&&(a=d.ZOOM_ANIMATE);if(a){twaver.animate.AnimateManager.start(new twaver.animate.AnimateXZoom(this,f))}else{var h=this._xZoom,c=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/h*(f-h);this._xZoom=f,this.firePropertyChange("xZoom",h,f),this.onXZoomChanged(h,f),this.setXTranslate(c)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(c,a){},yZoomIn:function(a){this.setYZoom(this._yZoom*d.ZOOM_INCREMENT,a)},yZoomOut:function(a){this.setYZoom(this._yZoom/d.ZOOM_INCREMENT,a)},yZoomReset:function(a){this.setYZoom(1,a)},setYZoom:function(f,a){if(!_twaver.num(f)||f<=0){return}f<this._minZoom&&(f=this._minZoom),f>this._maxZoom&&(f=this._maxZoom);if(f===this.YZoom){return}a==null&&(a=d.ZOOM_ANIMATE);if(a){twaver.animate.AnimateManager.start(new twaver.animate.AnimateYZoom(this,f))}else{var h=this._yZoom,c=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/h*(f-h);this._yZoom=f,this.firePropertyChange("yZoom",h,f),this.onYZoomChanged(h,f),this.setYTranslate(c)}}}),twaver.charts.ScaleChart=function(a){twaver.charts.ScaleChart.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.charts.ScaleChart",twaver.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,this._upperLimit!=null&&(this._max=this._upperLimit),this._lowerLimit!=null&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},formatYScaleText:function(a){return a.toFixed(2)},_initRange:function(){this._lowerLimit==null&&(this._min>=this._max&&(this._min=this._max-Math.abs(this._max)*0.1),this._min=this._min-(this._max-this._min)*0.1),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(c){var a=this._map[c.getId()];a.values.forEach(function(f){f==null?a.proportions.add(null):a.proportions.add(this._range==0?0:f/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(c){var a=new k(this.getValues(c));a.size()>this._columnCount&&(this._columnCount=a.size());var f={data:c,values:a,proportions:new k,color:this.getUniqueColor(this.getColor(c),c)};this._initInfo&&this._initInfo(c,f),this._map[c.getId()]=f,(this._upperLimit==null||this._lowerLimit==null)&&a.forEach(function(h){h!=null&&(this._upperLimit==null&&h>this._max&&(this._max=h),this._lowerLimit==null&&h<this._min&&(this._min=h))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(X,J,P){var L=0;this._xAxisText&&(L=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var U=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(c){var a=this.getTextSize(this._xScaleTextFont,c),f=this._xScaleTextOrientation==="vertical"?a.width:a.height;f>U&&(U=f)},this);var O=P-this._yGap-L-U,H=O-this._yGap,ab=this._upperLimit==null?H*0.9:H,W=0;this._yAxisText&&(W=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var R,Z;this._yScaleValueGap>0?(R=Math.max(this._yScaleValueGap/this._range*ab,1),Z=this._yScaleValueGap):(R=Math.max(this._yScalePixelGap,1),Z=this._range*(R/ab));var M=0,Y=new k,G,Q;if(this._yScaleTextVisible){G=this._yScaleMinTextVisible?0:R;var V=this._min+(this._yScaleMinTextVisible?0:Z);while(G<=H+1){Q=this.formatYScaleText(V);if(Q){var B=this.getTextSize(this._yScaleTextFont,Q);B.width>M&&(M=B.width),Y.add({text:Q,size:B,cursor:G})}G+=R,V+=Z}}var aa={x:this._xGap+W+M,y:this._yGap,width:J-this._xGap-W-M-this._xGap,height:P-this._yGap-U-L-this._yGap};this.drawBackground(X,aa),this._columnCount>0?this._columnWidth=aa.width/(this._columnCount*3+1)*2:this._columnWidth=aa.width/2,this._columnWidth===0&&(this._columnWidth=1);if(this._yScaleLineWidth>0){G=0;while(G<=H+1){this.drawLine(X,this._yScaleLineColor,this._yScaleLineWidth,aa.x,O-G,aa.x+aa.width,O-G),G+=R}}this._xAxisText&&z.drawText(X,this._xAxisText,{x:aa.x+aa.width/2,y:O+U+L/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(X,this._yAxisText,{x:this._xGap+W/2,y:H/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(X,this._yAxisLineColor,this._yAxisLineWidth,aa.x,aa.y+aa.height,aa.x,aa.y);var F=this.getUniqueColor(this._yScaleTextColor);Y.forEach(function(a){var c={x:this._xGap+W+M-a.size.width/2,y:O-a.cursor};z.drawText(X,a.text,c,this._yScaleTextFont,F)},this);var I=aa.y+aa.height+U/2;F=this.getUniqueColor(this._xScaleTextColor);var s=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null;for(var D=0;D<this._columnCount;D++){var h=aa.x+this._columnWidth*(1+D*1.5);if(this._xScaleTexts&&D<this._xScaleTexts.size()){Q=this._xScaleTexts.get(D);if(Q){var A={x:h,y:I};this._xScaleTextOrientation==="vertical"?this.drawVerticalText(X,Q,A,this._yScaleTextFont,F):z.drawText(X,Q,A,this._xScaleTextFont,F)}}this._type!=="default"&&s&&this.drawLine(X,s,this._xScaleLineWidth,h,aa.y+aa.height,h,aa.y)}var K=O+this._min/Z*R;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(X,aa,ab,K),this.drawLine(X,this._xAxisLineColor,this._xAxisLineWidth,aa.x,aa.y+aa.height,aa.x+aa.width,aa.y+aa.height)}}),twaver.charts.PieChart=function(a){this._sum=0,this._map={},twaver.charts.PieChart.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.charts.PieChart",twaver.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:d.PIECHART_TYPE,_lineRate:d.PIECHART_LINE_RATE,_donutRate:d.PIECHART_DONUT_RATE,_startAngle:d.PIECHART_START_ANGLE,_shadowColor:d.PIECHART_SHADOW_COLOR,_shadowOffset:d.PIECHART_SHADOW_OFFSET,_selectOffset:d.PIECHART_SELECT_OFFSET,_valuePosition:d.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(f){var c=this.getValue(f);this._map[f.getId()]={data:f,value:c,color:this.getUniqueColor(this.getColor(f),f)},this._sum+=c},this);var a=this._startAngle;this._publishedDatas.forEach(function(c){var e=this._map[c.getId()];e.proportion=this._sum===0?0:e.value/this._sum,this._type!=="line"&&(e.startAngle=a,e.arc=e.proportion*Math.PI*2,a+=e.arc)},this)},validateDisplay:function(E,H,u){var p={x:this._xGap,y:this._yGap,width:H-this._xGap*2,height:u-this._yGap*2};this.drawBackground(E,p),x.grow(p,-4,-4);if(p.width<=0||p.height<=0){return}var B=this._shadowOffset;B>0&&(E.shadowOffsetX=B,E.shadowOffsetY=B,E.shadowBlur=B*1.5,E.shadowColor=this._shadowColor);if(this._type==="oval"||this._type==="circle"){var s=p.x+p.width/2,G=p.y+p.height/2,D=p.width/2,A=p.height/2;this._type==="circle"&&(D=A=Math.min(D,A)),this._publishedDatas.forEach(function(f){var o=this._map[f.getId()];if(o.arc===0){return}var h=0,e=0;if(this.isSelected(f)){var a=o.startAngle+o.arc/2;h=Math.cos(a)*this._selectOffset,e=Math.sin(a)*this._selectOffset*A/D}E.fillStyle=o.color,E.beginPath(),E.moveTo(s+h,G-e),z.drawArc(E,s+h,G-e,o.startAngle,o.arc,D,A,!0),E.closePath(),E.fill();var l=this._getValueTextInfo(f,o.value);if(l){var a=o.startAngle+o.arc/2;l.x=s+h+Math.cos(a)*D*this._valuePosition,l.y=G-e-Math.sin(a)*A*this._valuePosition}},this)}else{if(this._type==="donut"||this._type==="ovalDonut"){var s=p.x+p.width/2,G=p.y+p.height/2,D=p.width/2,A=p.height/2;this._type==="donut"&&(D=A=Math.min(D,A)),this._publishedDatas.forEach(function(N){var f=this._map[N.getId()];if(f.arc===0){return}var a=0,o=0;if(this.isSelected(N)){var M=f.startAngle+f.arc/2;a=Math.cos(M)*this._selectOffset,o=Math.sin(M)*this._selectOffset*A/D}var K=s+Math.cos(f.startAngle)*D*this._donutRate,I=G-Math.sin(f.startAngle)*A*this._donutRate,e=s+Math.cos(f.startAngle+f.arc)*D*this._donutRate,J=G-Math.sin(f.startAngle+f.arc)*A*this._donutRate;E.fillStyle=f.color,E.beginPath(),E.moveTo(K+a,I-o),z.drawArc(E,s+a,G-o,f.startAngle,f.arc,D,A,!0),E.lineTo(e+a,J-o),z.drawArc(E,s+a,G-o,f.startAngle+f.arc,-f.arc,D*this._donutRate,A*this._donutRate,!0),E.closePath(),E.fill();var L=this._getValueTextInfo(N,f.value);if(L){var M=f.startAngle+f.arc/2,l=this._donutRate+(1-this._donutRate)*this._valuePosition;L.x=s+a+Math.cos(M)*D*l,L.y=G-o-Math.sin(M)*A*l}},this)}else{if(this._type==="line"){var F=p.height*this._lineRate;p.y=p.y+p.height/2-F/2,p.height=F;var C=p.x;this._publishedDatas.forEach(function(c){var h=this._map[c.getId()],a=p.width*h.proportion;if(a===0){return}E.beginPath(),E.fillStyle=h.color;var e=this.isSelected(c)?-this._selectOffset:0;E.rect(C,p.y+e,a,p.height),E.closePath(),E.fill();var f=this._getValueTextInfo(c,h.value);f&&(f.x=C+a/2,f.y=p.y+p.height+e-p.height*this._valuePosition),C+=a},this)}}}this._shadowOffset>0&&(E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowBlur=0),this.drawValueTexts(E)}}),twaver.charts.BarChart=function(a){twaver.charts.BarChart.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.charts.BarChart",twaver.charts.ScaleChart,{__accessor:["type"],_upperLimit:d.BARCHART_UPPER_LIMIT,_lowerLimit:d.BARCHART_LOWER_LIMIT,_type:d.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:d.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:d.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:d.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:d.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:d.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:d.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:d.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:d.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:d.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:d.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:d.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:d.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:d.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:d.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:d.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:d.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:d.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:d.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:d.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var a=this._type+"ValidateModel";this[a]&&(this._reset(),this[a]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(c){var a=this.getValue(c);this._upperLimit==null&&a>this._max&&(this._max=a),this._lowerLimit==null&&a<this._min&&(this._min=a),this._map[c.getId()]={data:c,value:a,color:this.getUniqueColor(this.getColor(c),c)}},this),this._initRange(),this._publishedDatas.forEach(function(c){var a=this._map[c.getId()];a.proportion=this._range==0?0:a.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){this._publishedDatas.forEach(function(l){var h=new k(this.getValues(l));h.size()>this._columnCount&&(this._columnCount=h.size());var o={data:l,values:h,proportions:new k,color:this.getUniqueColor(this.getColor(l),l)};this._map[l.getId()]=o},this);if(this._upperLimit==null||this._lowerLimit==null){for(var c=0;c<this._columnCount;c++){var a=0,f=0;this._publishedDatas.forEach(function(h){var e=this._map[h.getId()];if(e.values.size()>c){var l=e.values.get(c);l!=null&&(l>=0?a+=l:f+=l)}},this),this._upperLimit==null&&a>this._max&&(this._max=a),this._lowerLimit==null&&f<this._min&&(this._min=f)}}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(l){var h=new k(this.getValues(l));h.size()>this._columnCount&&(this._columnCount=h.size());var o={data:l,values:h,proportions:new k,color:this.getUniqueColor(this.getColor(l),l)};this._map[l.getId()]=o},this);var c=new k;for(var a=0;a<this._columnCount;a++){var f=0;this._publishedDatas.forEach(function(o){var l=this._map[o.getId()];if(l.values.size()>a){var h=l.values.get(a);h!=null&&(f+=h)}},this),c.add(f)}for(var a=0;a<this._columnCount;a++){this._publishedDatas.forEach(function(p){var h=this._map[p.getId()],e=c.get(a);if(e!==0&&h.values.size()>a){var l=h.values.get(a);if(l!=null){h.proportions.add(l/e);return}}h.proportions.add(null)},this)}this._min=0,this._max=1,this._range=1},drawRect:function(l,f,s,h,c,p,a){l.fillStyle=f,s&&this._selectInfos.add({x:h,y:c,w:p,h:a,color:this.getUniqueColor(z.darker(f))}),l.beginPath(),l.rect(h,c,p,a),l.closePath(),l.fill()},drawContent:function(f,a,h,c){this._selectInfos=new k,this._toolTipInfos=this.isToolTipEnabled()?new k:null,this._type==="default"?this.drawDefaultContent(f,a,h,c):this._type==="group"?this.drawGroupContent(f,a,h,c):this._type==="percent"?this.drawPercentContent(f,a,h,c):this._type==="stack"?this.drawStackContent(f,a,h,c):this._type==="layer"&&this.drawLayerContent(f,a,h,c),this.drawValueTexts(f),this._selectInfos.forEach(function(e){f.lineWidth=2,f.strokeStyle=e.color,f.beginPath(),f.rect(e.x,e.y,e.w,e.h),f.closePath(),f.stroke()},this),delete this._selectInfos},drawDefaultContent:function(I,M,D,A){var F=this._publishedDatas.size(),N=this._columnWidth;for(var C=0;C<F;C++){var L=this._publishedDatas.get(C),K=this._map[L.getId()],H=M.x+N*(0.5+C*1.5),E=Math.abs(D*K.proportion),J=K.proportion>0?A-E:A;this.drawRect(I,K.color,this.isSelected(L),H,J,N,E),this.addToolTipInfo(H,J,N,E,K.value,L);var G=this._getValueTextInfo(L,K.value);if(G){var B=this.getTextSize(G.font,G.text);G.x=H+N/2,G.y=J-B.height/2+1}}},drawPercentContent:function(f,a,h,c){this.drawStackContent(f,a,h,c)},drawStackContent:function(p,C,h,c){var l=this._columnCount,D=this._columnWidth;for(var f=0;f<l;f++){var B=c,A=C.x+D*(0.5+f*1.5);this._publishedDatas.forEach(function(o){var s=this._map[o.getId()];if(f<s.proportions.size()){var e=s.proportions.get(f);if(e!=null){var u=h*e;B-=u,this.drawRect(p,s.color,this.isSelected(o),A,B,D,u),this.addToolTipInfo(A,B,D,u,s.values.get(f),o);var a=this._getValueTextInfo(o,s.values.get(f));a&&(a.x=A+D/2,a.y=B+u/2)}}},this)}},drawLayerContent:function(D,G,p,c){var B=this._publishedDatas.size(),H=this._columnCount,h=this._columnWidth,F=h*3/8/B;for(var E=0;E<H;E++){var C=G.x+h*(0.5+E*1.5),A=0;this._publishedDatas.forEach(function(I){var J=this._map[I.getId()];if(E<J.proportions.size()){var o=J.proportions.get(E);if(o!=null){var f=p*o,a=c-f,l=C+h/2-h/8-F*(B-A),u=(h/8+F*(B-A))*2;this.drawRect(D,J.color,this.isSelected(I),l,a,u,f),this.addToolTipInfo(l,a,u,f,J.values.get(E),I);var e=this._getValueTextInfo(I,J.values.get(E));if(e){var r=this.getTextSize(e.font,e.text);e.x=l+u/2,e.y=a-r.height/2+1}}}A++},this)}},drawGroupContent:function(D,G,p,c){var B=this._publishedDatas.size(),H=this._columnCount,h=this._columnWidth,F=h/B;for(var E=0;E<H;E++){var C=G.x+h*(0.5+E*1.5),A=0;this._publishedDatas.forEach(function(e){var a=this._map[e.getId()];if(E<a.proportions.size()){var l=a.proportions.get(E);if(l!=null){var u=p*l,I=c-u;this.drawRect(D,a.color,this.isSelected(e),C+F*A,I,F,u),this.addToolTipInfo(C+F*A,I,F,u,a.values.get(E),e);var f=this._getValueTextInfo(e,a.values.get(E));if(f){var r=this.getTextSize(f.font,f.text);f.x=C+F*A+F/2,f.y=I-r.height/2+1}}}A++},this)}}}),twaver.charts.LineChart=function(a){twaver.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},_twaver.ext("twaver.charts.LineChart",twaver.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:d.LINECHART_INTERRUPTABLE,_upperLimit:d.LINECHART_UPPER_LIMIT,_lowerLimit:d.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:d.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:d.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:d.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:d.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:d.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:d.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:d.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:d.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:d.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:d.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:d.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:d.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:d.LINECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:d.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:d.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:d.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:d.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:d.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:d.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:d.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:d.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):twaver.Styles.getStyle("chart.line.width")},getMarkerShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):twaver.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):twaver.Styles.getStyle("chart.marker.size")},_initInfo:function(c,a){a.markerShape=this.getMarkerShape(c),a.markerSize=this.getMarkerSize(c),a.lineWidth=this.getLineWidth(c),this.isSelected(c)&&(a.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var u=this._getPoint.apply(this,arguments),h=this.tryGetDataAt(u);if(!h){return -1}var B=this._map[h.getId()],p=B.points,f=B.markerSize;for(var l=0,A=p.size(),c;l<A;l++){c=p.get(l);if(c&&x.getDistance(u,c)<=f){return l}}return -1},drawContent:function(f,a,h,c){this._toolTipInfos=this.isToolTipEnabled()?new k:null,this._publishedDatas.forEach(function(A){var r=this._map[A.getId()],J=r.markerSize>0?new k:null;f.strokeStyle=r.color,f.lineWidth=r.lineWidth,f.beginPath();var G=r.proportions,B=null,t=G.size(),D=new k;r.points=D;for(var e=0;e<t;e++){var C=G.get(e);if(C!=null){var I={x:a.x+this._columnWidth*(1+e*1.5),y:c-h*C};D.add(I),B==null?f.moveTo(I.x,I.y):f.lineTo(I.x,I.y);var s=r.values.get(e),F=this._getValueTextInfo(A,s);if(F){var E=this.getTextSize(F.font,F.text);F.x=I.x,F.y=I.y-E.height/2+2}J&&J.add({point:I,value:s,data:A,index:e}),B=I}else{this._interruptable&&(B=null,D.add(null))}}f.stroke();if(J){var H=r.markerSize/2;J.forEach(function(p){f.fillStyle=r.color;var L=p.point.x-H,K=p.point.y-H,o=r.markerSize,l=r.markerSize;z.drawVector(f,r.markerShape,null,L,K,o,l),f.fill(),this.addToolTipInfo(L,K,o,l,p.value,p.data,p.index)},this)}},this),this.drawValueTexts(f)}}),twaver.charts.BubbleChart=function(a){twaver.charts.BubbleChart.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.charts.BubbleChart",twaver.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:d.BUBBLECHART_UPPER_LIMIT,_lowerLimit:d.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:d.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:d.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:d.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:d.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:d.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:d.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:d.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:d.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:d.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:d.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:d.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:d.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:d.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:d.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:d.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:d.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:d.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:d.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:d.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:d.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:d.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:d.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:d.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:d.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:d.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,this._xAxisUpperLimit!=null&&(this._xMax=this._xAxisUpperLimit),this._xAxisLowerLimit!=null&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(a){return a.getStyle?a.getStyle("chart.bubble.shape"):twaver.Styles.getStyle("chart.bubble.shape")},getSize:function(c,a){return a},getNames:function(a){return a.getStyle?a.getStyle("chart.names"):twaver.Styles.getStyle("chart.names")},getXAxisValues:function(a){return a.getStyle?a.getStyle("chart.xaxis.values"):twaver.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(a){return a.getStyle?a.getStyle("chart.yaxis.values"):twaver.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){this._xAxisLowerLimit==null&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-Math.abs(this._xMax)*0.1),this._xMin=this._xMin-(this._xMax-this._xMin)*0.1),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(c){var a=this._map[c.getId()];a.xAxisValues.forEach(function(f){f==null?a.xAxisProportions.add(null):a.xAxisProportions.add(this._xRange==0?0:f/this._xRange)},this),a.yAxisValues.forEach(function(f){f==null?a.yAxisProportions.add(null):a.yAxisProportions.add(this._range==0?0:f/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=this._xScaleTexts==null?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(h){var c=new k(this.getYAxisValues(h)),l=new k(this.getXAxisValues(h)),f=new k(this.getValues(h));f.size()>this._columnCount&&(this._columnCount=f.size());var a={data:h,values:f,yAxisValues:c,xAxisValues:l,yAxisProportions:new k,xAxisProportions:new k,color:this.getUniqueColor(this.getColor(h),h),anchorShape:this.getShape(h)};this._map[h.getId()]=a,(this._upperLimit==null||this._lowerLimit==null)&&c.forEach(function(o){o!=null&&(this._upperLimit==null&&o>this._max&&(this._max=o),this._lowerLimit==null&&o<this._min&&(this._min=o))},this),(this._upperLimit==null||this._lowerLimit==null)&&l.forEach(function(o){o!=null&&(this._xAxisUpperLimit==null&&o>this._xMax&&(this._xMax=o),this._xAxisLowerLimit==null&&o<this._xMin&&(this._xMin=o))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(f,a,h,c){this._toolTipInfos=this.isToolTipEnabled()?new k:null,this._publishedDatas.forEach(function(I){var F=this._map[I.getId()],B=F.yAxisProportions,O=F.xAxisProportions,K=F.values,H=F.yAxisProportions.size(),M=this._selectShadowOffset;this.isSelected(I)&&M>0?(f.shadowOffsetX=M,f.shadowOffsetY=M,f.shadowBlur=M*2,f.shadowColor=this._selectShadowColor):(f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=0,f.shadowColor=F.color),f.fillStyle=F.color;for(var J=0;J<H;J++){var D=B.get(J),L=O.get(J);if(D!=null){var A={x:a.x+a.width*L,y:c-h*D},G=K.get(J),r=this.getSize(I,G),M=r/2,N=A.x-M,t=A.y-M,C=r,e=r;z.drawVector(f,F.anchorShape,null,N,t,C,e),f.fill(),this.addToolTipInfo(N,t,C,e,G,I,J);var s=this._getValueTextInfo(I,G);if(s){var r=this.getTextSize(s.font,s.text);s.x=A.x,s.y=A.y}}}},this),this.drawValueTexts(f)}}),twaver.charts.DialChart=function(a){twaver.charts.DialChart.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.charts.DialChart",twaver.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:d.DIALCHART_UPPER_LIMIT,_lowerLimit:d.DIALCHART_LOWER_LIMIT,_startAngle:d.DIALCHART_START_ANGLE,_endAngle:d.DIALCHART_END_ANGLE,_innerRadius:d.DIALCHART_INNER_RADIUS,_colorRangeFillColor:d.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:d.DIALCHART_OUTLINE_WIDTH,_outlineColor:d.DIALCHART_OUTLINE_COLOR,_scaleInside:d.DIALCHART_SCALE_INSIDE,_majorScaleCount:d.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:d.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:d.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:d.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:d.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:d.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:d.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:d.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:d.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:d.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:d.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:d.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:d.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:d.DIALCHART_PIVOT_RADIUS,_pivotFill:d.DIALCHART_PIVOT_FILL,_pivotFillColor:d.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:d.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:d.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:d.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:d.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:d.DIALCHART_VALUE_POSITION,_innerDarkerRadius:d.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:d.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:d.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:d.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(a){return a.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var c=this._startAngle;c!=0&&(c=(c%360+360)%360,c==0&&(c=360)),this._positiveStartAngle=c;var a=this._endAngle;a!=0&&(a=(a%360+360)%360,a==0&&(a=360)),this._positiveEndAngle=a,this._whole=Math.abs(c-a)==360,this._startAngleByRadian=c*Math.PI/180,this._endAngleByRadian=a*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(h){var f=this.getValue(h);this._map[h.getId()]={data:h,value:f,color:this.getUniqueColor(this.getColor(h),h),angle:this._startAngleByRadian+(this._clockwise?-1:1)*f/this._valueRange*this._angleRange}},this)},validateDisplay:function(ae,P,X){var R={x:this._xGap,y:this._yGap,width:P-this._xGap*2,height:X-this._yGap*2};this.drawBackground(ae,R);if(this._startAngleByRadian==this._endAngleByRadian){return}var ab,W=this._lowerLimit,ai=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,ad=0,Z=0,ag,V=null,af=null;if(this._scaleTextVisible){V=new k;for(ab=0;ab<this._majorScaleCount;ab++){ab==0&&!this._scaleLowerLimitTextVisible||ab==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(ag=null,V.add({text:"",size:{width:0,height:0}})):(af=this.formatScaleText(W),ag=this.getTextSize(this._scaleTextFont,af),V.add({text:af,size:ag})),!this._scaleInside&&ag!=null&&(ag.width>ad&&(ad=ag.width),ag.height>Z&&(Z=ag.height)),W+=ai}}this._angleRange<=Math.PI&&(ad=Math.max(ad,this._pivotRadius),Z=Math.max(Z,this._pivotRadius)),x.grow(R,-ad,-Z),this._calcluateCenterAndRadius(R),ae.lineWidth=0;if(this._colorRangeList==null||this._colorRangeList.size()==0){this._drawArcGroup(ae,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(ae,this._startAngleByRadian,this._endAngleByRadian,!0,!0)}else{var J=this._angleRange/this._colorRangeList.size(),Y=this._startAngleByRadian;for(ab=0;ab<this._colorRangeList.size();ab++){var ac=this.getUniqueColor(this._colorRangeList.get(ab)),G=Y+(this._clockwise?-1:1)*J;this._drawArcGroup(ae,Y,G,ac),this._drawArcOutLine(ae,Y,Y+(this._clockwise?-1:1)*J,ab==0,ab==this._colorRangeList.size()-1),Y+=(this._clockwise?-1:1)*J}}var ah=this._startAngleByRadian,I=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0,K,s,H,h,B,Q,aa,F;Q=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,aa=Q+this._majorScaleLineLength*(this._scaleInside?1:-1),F=Q+this._minorScaleLineLength*(this._scaleInside?1:-1);for(ab=0;ab<this._majorScaleCount;ab++){s=this._center.x+Math.cos(ah)*Q,H=this._center.y+Math.sin(-ah)*Q,h=this._center.x+Math.cos(ah)*aa,B=this._center.y+Math.sin(-ah)*aa,ae.lineWidth=this._majorScaleLineWidth,ae.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),ae.beginPath(),ae.moveTo(s,H),ae.lineTo(h,B),ae.closePath(),ae.stroke();if(this._scaleTextVisible&&!(ab==0&&!this._scaleLowerLimitTextVisible||ab==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible)){var U=V.get(ab);if(U){var u=this.getScaleTextPosition(ah/Math.PI*180,s,H,U.size.width,U.size.height);U.x=u.x,U.y=u.y}}if(this._whole||!this._whole&&ab<this._majorScaleCount-1){var D=ah,aj=this._minorScaleCount>0?I/(this._minorScaleCount+1):0;for(K=0;K<this._minorScaleCount;K++){D+=(this._clockwise?-1:1)*aj,s=this._center.x+Math.cos(D)*Q,H=this._center.y+Math.sin(-D)*Q,h=this._center.x+Math.cos(D)*F,B=this._center.y+Math.sin(-D)*F,ae.lineWidth=this._minorScaleLineWidth,ae.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),ae.beginPath(),ae.moveTo(s,H),ae.lineTo(h,B),ae.closePath(),ae.stroke()}}ah+=(this._clockwise?-1:1)*I}this._pivotFill&&z.fill(ae,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,this._pivotRadius*2,this._pivotRadius*2),ae.lineWidth=this._pivotOutlineWidth,ae.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),ae.beginPath(),ae.arc(this._center.x,this._center.y,this._pivotRadius,0,Math.PI*2,!0),ae.closePath(),this._pivotFill&&ae.fill(),V&&V.forEach(function(a){a&&z.drawText(ae,a.text,a,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(am){var E=this._map[am.getId()],e=this._getDataStyle("dialchart.rear.extension",am),M=this._getDataStyle("dialchart.base.width",am),an=this._getDataStyle("dialchart.top.width",am),C=this._getDataStyle("dialchart.radius",am);C>=-1&&C<=1&&(C*=this._innerRadiusByPixel),ae.fillStyle=E.color,ae.lineWidth=0;var ak=x.createMatrix(-E.angle,this._center.x,this._center.y),O=ak.transform(this._center.x+C,this._center.y+an/2),L=ak.transform(this._center.x+C,this._center.y-an/2),T=ak.transform(this._center.x-e,this._center.y-M/2),N=ak.transform(this._center.x-e,this._center.y+M/2),A=this._selectShadowOffset;this.isSelected(am)&&A>0?(ae.shadowOffsetX=A,ae.shadowOffsetY=A,ae.shadowBlur=A*2,ae.shadowColor=this._selectShadowColor):(ae.shadowOffsetX=0,ae.shadowOffsetY=0,ae.shadowBlur=0,ae.shadowColor=E.color),ae.beginPath(),ae.moveTo(O.x,O.y),ae.lineTo(L.x,L.y),ae.lineTo(T.x,T.y),ae.lineTo(N.x,N.y),ae.lineTo(O.x,O.y),ae.closePath(),ae.fill();var S=this._getValueTextInfo(am,E.value);if(S){var al=ak.transform(this._center.x+C*this._valuePosition,this._center.y);S.x=al.x,S.y=al.y}},this),this.drawValueTexts(ae)},_getDataStyle:function(c,a){return a.getStyle?a.getStyle(c):a.getClient(c)},_calcluateCenterAndRadius:function(f){var a=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,h=this._clockwise?this._positiveStartAngle:this._positiveEndAngle,c=Math.abs(this._positiveEndAngle-this._positiveStartAngle);0<=a&&a<90?0<=h&&h<=90?(this._outerRadius=Math.min(f.width,f.height),this._center={x:f.x+(f.width-this._outerRadius)/2,y:f.y+(f.height+this._outerRadius)/2}):90<h&&h<=180?(this._outerRadius=Math.min(f.width/2,f.height),this._center={x:f.x+f.width/2,y:f.y+(f.height+this._outerRadius)/2}):(this._center={x:f.x+f.width/2,y:f.y+f.height/2},this._outerRadius=Math.min(f.width,f.height)/2):90<=a&&a<180?90<=h&&h<=180?(this._outerRadius=Math.min(f.width,f.height),this._center={x:f.x+(f.width+this._outerRadius)/2,y:f.y+(f.height+this._outerRadius)/2}):180<h&&h<=270?(this._outerRadius=Math.min(f.width,f.height/2),this._center={x:f.x+(f.width+this._outerRadius)/2,y:f.y+f.height/2}):(this._center={x:f.x+f.width/2,y:f.y+f.height/2},this._outerRadius=Math.min(f.width,f.height)/2):180<=a&&a<270?180<=h&&h<=270?(this._outerRadius=Math.min(f.width,f.height),this._center={x:f.x+(f.width+this._outerRadius)/2,y:f.y+(f.height-this._outerRadius)/2}):(this._outerRadius=Math.min(f.width/2,f.height),this._center={x:f.x+f.width/2,y:f.y+(f.height-this._outerRadius)/2}):(this._outerRadius=Math.min(f.width,f.height),this._center={x:f.x+(f.width-this._outerRadius)/2,y:f.y+(f.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(H,M,C,s,E){if(this._outlineWidth<=0){return}var B=Math.abs(M-C),L=this._center.x+Math.cos(M)*this._innerRadiusByPixel,K=this._center.y+Math.sin(-M)*this._innerRadiusByPixel,G=this._center.x+Math.cos(M)*this._outerRadius,D=this._center.y+Math.sin(-M)*this._outerRadius,J=this._center.x+Math.cos(C)*this._innerRadiusByPixel,F=this._center.y+Math.sin(-C)*this._innerRadiusByPixel,A=this._center.x+Math.cos(C)*this._outerRadius,I=this._center.y+Math.sin(-C)*this._outerRadius;this._clockwise?(H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor),H.beginPath(),H.moveTo(this._center.x,this._center.y),z.drawArc(H,this._center.x,this._center.y,C,B,this._outerRadius,this._outerRadius,!1),H.stroke(),!this._whole&&s?(H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor)):H.lineWidth=0,H.lineTo(L,K),H.stroke(),H.beginPath(),H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor),H.moveTo(this._center.x,this._center.y),z.drawArc(H,this._center.x,this._center.y,M,-B,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),H.stroke(),!this._whole&&E?(H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor)):H.lineWidth=0,H.lineTo(A,I),H.stroke()):(H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor),H.beginPath(),H.moveTo(this._center.x,this._center.y),z.drawArc(H,this._center.x,this._center.y,M,B,this._outerRadius,this._outerRadius,!1),H.stroke(),!this._whole&&E?(H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor)):H.lineWidth=0,H.lineTo(J,F),H.stroke(),H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor),H.beginPath(),H.moveTo(this._center.x,this._center.y),z.drawArc(H,this._center.x,this._center.y,C,-B,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),H.stroke(),!this._whole&&s?(H.lineWidth=this._outlineWidth,H.strokeStyle=this.getUniqueColor(this._outlineColor)):H.lineWidth=0,H.lineTo(G,D),H.stroke())},_drawArcGroup:function(f,a,h,c){this._outerBrighterRadiusByPixel!=0&&this._drawArc(f,a,h,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,z.brighter(c)),this._drawArc(f,a,h,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,c),this._innerDarkerRadiusByPixel!=0&&this._drawArc(f,a,h,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,z.darker(c,20))},_drawArc:function(H,N,C,s,E,B){var M=Math.abs(N-C);H.lineWidth=0,H.fillStyle=B;var K=this._center.x+Math.cos(N)*s,G=this._center.y+Math.sin(-N)*s,D=this._center.x+Math.cos(N)*E,J=this._center.y+Math.sin(-N)*E,F=this._center.x+Math.cos(C)*s,A=this._center.y+Math.sin(-C)*s,I=this._center.x+Math.cos(C)*E,L=this._center.y+Math.sin(-C)*E;H.beginPath(),this._clockwise?(H.moveTo(F,A),z.drawArc(H,this._center.x,this._center.y,C,M,E,E,!0),H.lineTo(K,G),z.drawArc(H,this._center.x,this._center.y,N,-M,s,s,!0),H.closePath()):(H.moveTo(K,G),z.drawArc(H,this._center.x,this._center.y,N,M,E,E,!0),H.lineTo(F,A),z.drawArc(H,this._center.x,this._center.y,C,-M,s,s,!0),H.closePath()),H.fill()},getScaleTextPosition:function(l,c,o,h,a){l=(l%360+360)%360;var f={x:c,y:o};return l==0&&(f=this._scaleInside?{x:c-h/2,y:o}:{x:c+h/2,y:o}),l==180&&(f=this._scaleInside?{x:c+h/2,y:o}:{x:c-h/2,y:o}),l==90&&(f=this._scaleInside?{x:c,y:o+a/2}:{x:c,y:o-a/2}),l==270&&(f=this._scaleInside?{x:c,y:o-a/2}:{x:c,y:o+a/2}),l>270&&l<360&&(f=this._scaleInside?{x:c-h/2,y:o-a/2}:{x:c+h/2,y:o+a/2}),l>180&&l<270&&(f=this._scaleInside?{x:c+h/2,y:o-a/2}:{x:c-h/2,y:o+a/2}),l>90&&l<180&&(f=this._scaleInside?{x:c+h/2,y:o+a/2}:{x:c-h/2,y:o-a/2}),l>0&&l<90&&(f=this._scaleInside?{x:c-h/2,y:o+a/2}:{x:c+h/2,y:o-a/2}),f}}),twaver.charts.RadarChart=function(a){twaver.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},_twaver.ext("twaver.charts.RadarChart",twaver.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:d.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:d.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:d.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:d.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:d.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:d.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:d.RADARCHART_AXIS_VISIBLE,_axisLineColor:d.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:d.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:d.RADARCHART_AXIS_START_ANGLE,_ringVisible:d.RADARCHART_RING_VISIBLE,_ringType:d.RADARCHART_RING_TYPE,_ringLineColor:d.RADARCHART_RING_LINE_COLOR,_ringLineWidth:d.RADARCHART_RING_LINE_WIDTH,_scaleCount:d.RADARCHART_SCALE_COUNT,_scaleMaxValue:d.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:d.RADARCHART_SCALE_MINVALUE,_anchorVisible:d.RADARCHART_ANCHOR_VISIBLE,_areaFill:d.RADARCHART_AREA_FILL,_areaFillAlpha:d.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:d.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(c,a){return c.toFixed(2)},getAnchorSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):twaver.Styles.getStyle("chart.marker.size")},getAnchorShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):twaver.Styles.getStyle("chart.marker.shape")},getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):twaver.Styles.getStyle("chart.line.width")},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},tryGetDataAt:function(E,J){if(J==null||J<0){J=this._selectTolerance}E.target&&(E=g.getLogicalPoint(this._canvas,arguments[0],1));if(!E){return null}if(!this._areaFill){var o=E.x-J,B=E.y-J,K=J*2+1,H=J*2+1;try{var D=this._canvas.getContext("2d").getImageData(o,B,K,H).data;for(var A=0;n=D.length,A<n;A+=4){if(D[A+3]===255){var G="rgb("+D[A]+","+D[A+1]+","+D[A+2]+")",C=this._uniqueColors[G];if(C){return C}}}}catch(u){}return null}if(!this._center){return null}E={x:E.x-this._xTranslate,y:E.y-this._yTranslate};for(var A=this._publishedDatas.size()-1;A>=0;A--){var C=this._publishedDatas.get(A),F=this._map[C.getId()],I=x.isPointInPolygon(F.points,E);if(I){return C}}return null},getDataAt:function(){var B,E;if(arguments.length===2){B=arguments[0],E=arguments[1]}else{if(arguments[0].target){var o=g.getLogicalPoint(this._canvas,arguments[0],1);if(!o){return}B=o.x,E=o.y}else{B=arguments[0].x,E=arguments[0].y}}if(B<0||E<0||B>this._canvasWidth||E>this._canvasHeight){return null}if(!this._areaFill){try{var h=this._canvas.getContext("2d").getImageData(B,E,1,1).data;if(h[3]===255){var u="rgb("+h[0]+","+h[1]+","+h[2]+")",F=this._uniqueColors[u];if(F){return F}}}catch(D){}return null}for(var A=this._publishedDatas.size()-1;A>=0;A--){var F=this._publishedDatas.get(A),p=this._map[F.getId()],C=x.isPointInPolygon(p.points,{x:B-this._xTranslate,y:E-this._yTranslate});if(C){return F}}return null},validateModel:function(){this._map={},this._axisTexts=new k,this._axisMaxValues=new k,this._axisMinValues=new k,this._axisRangeValues=new k,this._axisCount=this._axisList==null?0:this._axisList.size();if(this._axisCount==0){return}this._averageAngleByRadian=Math.PI*2/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(f){if(typeof f=="string"){this._axisTexts.add(f),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue)}else{this._axisTexts.add(f.text);var c=isNaN(f.max)?this._scaleMaxValue:f.max,h=isNaN(f.min)?this._scaleMinValue:f.min;this._axisMaxValues.add(c),this._axisMinValues.add(h),this._axisRangeValues.add(c-h)}},this),this._publishedDatas.forEach(function(f){var c=new k(this.getValues(f)),h={data:f,values:c,proportions:new k,color:this.getUniqueColor(this.getColor(f),f),anchorShape:this.getAnchorShape(f),anchorSize:this.getAnchorSize(f),lineWidth:this.getLineWidth(f),points:new k};this.isSelected(f)&&(h.lineWidth+=2),this._map[f.getId()]=h},this);for(var a=0;a<this._axisCount;a++){this._publishedDatas.forEach(function(e){var p=this._map[e.getId()],h=0;if(p.values.size()>a){var f=p.values.get(a),l=this._axisMinValues.get(a),c=this._axisRangeValues.get(a);c>0&&(h=(f-l)/c)}p.proportions.add(h)},this)}},validateDisplay:function(aa,K,R){var O={x:this._xGap,y:this._yGap,width:K-this._xGap*2,height:R-this._yGap*2};this.drawBackground(aa,O);if(O.width<=0||O.height<=0||this._axisCount<3){return}var X=0,Q=0,I=0,ae=null,Z=null,V=null,ac=null;if(this._axisTextVisible){ac=new k;for(I=0;I<this._axisCount;I++){V=this._axisTexts.get(I),ae=this.getTextSize(this._axisTextFont,V),ac.add({text:V,size:ae}),ae.width>X&&(X=ae.width),ae.height>Q&&(Q=ae.height)}}var P=O.width/2-X>O.height/2-Q?O.height/2-Q*2:O.width/2-X,ab={x:O.x+O.width/2,y:O.y+O.height/2};this._center={x:ab.x+this._xTranslate,y:ab.y+this._yTranslate};var H=null;this._scaleTextVisible&&(H=new k);var U=this._axisStartAngle/180*Math.PI;for(I=0;I<this._axisCount;I++){var Y=U*180/Math.PI,D=ab.x+Math.cos(U)*P,ad=ab.y+Math.sin(-U)*P,G=null;H&&(G=new k,H.add(G)),this._ringVisible&&this._ringLineWidth>0&&(aa.lineWidth=this._ringLineWidth,aa.strokeStyle=this._ringLineColor);for(var J=1;J<=this._scaleCount;J++){var s=J/this._scaleCount,F=P*s,h=ab.x+Math.cos(U)*F,A=ab.y+Math.sin(-U)*F;if(this._ringVisible&&this._ringLineWidth>0){var M=ab.x+Math.cos(U+this._averageAngleByRadian)*F,W=ab.y+Math.sin(-U-this._averageAngleByRadian)*F;this._ringType=="line"?this.drawLine(aa,this._ringLineColor,this._ringLineWidth,h,A,M,W):this._ringType=="arc"&&(aa.beginPath(),aa.moveTo(ab.x,ab.y),z.drawArc(aa,ab.x,ab.y,U,this._averageAngleByRadian,F,F,!0),aa.closePath(),aa.stroke())}G&&(V=this.formatScaleText(this._axisMinValues.get(I)+this._axisRangeValues.get(I)*s,I),ae=this.getTextSize(this._scaleTextFont,V),Z=this.getScaleTextPosition(Y,h,A,ae.width,ae.height),G.add({text:V,x:Z.x,y:Z.y}))}this._axisVisible&&this.drawLine(aa,this._axisLineColor,this._axisLineWidth,ab.x,ab.y,D,ad);if(ac){var B=ac.get(I);Z=this.getAxisTextPosition(Y,D,ad,B.size.width,B.size.height),B.x=Z.x,B.y=Z.y}U+=this._averageAngleByRadian}this._publishedDatas.forEach(function(c){var l=this._map[c.getId()];l.points.clear();var e=l.anchorSize>0?new k:null,a=l.proportions;aa.lineWidth=0,aa.globalAlpha=this.isSelected(c)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(aa.fillStyle=l.color),this._drawItem(aa,a,ab,P,e,l),this._areaFill&&aa.fill(),aa.lineWidth=l.lineWidth,aa.strokeStyle=l.color,aa.globalAlpha=1,this._drawItem(aa,a,ab,P),aa.lineWidth=0;if(e!=null&&e.size()>0){var f=l.anchorSize/2;e.forEach(function(o){aa.fillStyle=l.color,z.drawVector(aa,l.anchorShape,null,o.x-f,o.y-f,l.anchorSize,l.anchorSize),aa.fill()})}},this),H&&H.forEach(function(a){a.forEach(function(c){z.drawText(aa,c.text,c,this._scaleTextFont,this._scaleTextColor)},this)},this),ac&&ac.forEach(function(a){z.drawText(aa,a.text,a,this._axisTextFont,this._axisTextColor)},this)},_drawItem:function(C,F,p,c,G,h){var E=this._axisStartAngle/180*Math.PI,D=null;C.beginPath();for(i=0;i<this._axisCount;i++){var B=F.get(i),A={x:p.x+Math.cos(E)*c*B,y:p.y+Math.sin(-E)*c*B};D==null?C.moveTo(A.x,A.y):C.lineTo(A.x,A.y),G!=null&&this._anchorVisible&&G.add(A),h&&h.points.add(A),i==0&&(D=A),E+=this._averageAngleByRadian}D!=null&&C.lineTo(D.x,D.y),C.closePath(),C.stroke()},getAxisTextPosition:function(l,c,o,h,a){l=(l%360+360)%360;var f={x:c,y:o};return l==0&&(f={x:c+h/2,y:o}),l==180&&(f={x:c-h/2,y:o}),l==90&&(f={x:c,y:o-a/2}),l==270&&(f={x:c,y:o+a/2}),l>270&&l<360&&(f={x:c+h/2,y:o+a/2}),l>180&&l<270&&(f={x:c-h/2,y:o+a/2}),l>90&&l<180&&(f={x:c-h/2,y:o-a/2}),l>0&&l<90&&(f={x:c+h/2,y:o-a/2}),f},getScaleTextPosition:function(l,c,o,h,a){l=(l%360+360)%360;var f={x:c,y:o};return l==0&&(f={x:c,y:o+a/2}),l==180&&(f={x:c-h/2,y:o+a/2}),l==90&&(f={x:c+h/2,y:o}),l==270&&(f={x:c+h/2,y:o}),l>270&&l<360&&(f={x:c+h/2,y:o-a/2}),l>180&&l<270&&(f={x:c-h/2,y:o-a/2}),l>90&&l<180&&(f={x:c-h/2,y:o+a/2}),l>0&&l<90&&(f={x:c+h/2,y:o+a/2}),f}}),twaver.charts.LegendPane=function(c){twaver.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new twaver.Pool("div"),this._iconPool=new twaver.Pool("div"),this._textPool=new twaver.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=c,this._chart.addViewListener(this.handleViewChange,this),this._view=g.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=g.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var a=this;this._chart._internalVisibleFunction=function(h){return !a.isHidden(h)};var f;v.isTouchable?f=twaver.charts.LegendPaneTouchInteraction:f=twaver.charts.LegendPaneInteraction,f&&new f(this)},_twaver.ext("twaver.charts.LegendPane",twaver.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:d.LEGENDPANE_ICON_WIDTH,_iconHeight:d.LEGENDPANE_ICON_HEIGHT,_iconRadius:d.LEGENDPANE_ICON_RADIUS,_rowHeight:d.LEGENDPANE_ROW_HEIGHT,_orientation:d.LEGENDPANE_ORIENTATION,_hiddenColor:d.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:d.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:d.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(a){this.invalidate()},getChart:function(){return this._chart},isHidden:function(a){return this._hiddenMap[a.getId()]!=null},handleViewChange:function(a){a.kind==="validateEnd"&&(this._invalidate=!0,this.validate())},validate:function(){if(!this._invalidate){return}this._invalidate=!1,g.release(this._legendDiv),_twaver.keys(this._hiddenMap).forEach(function(r){this._chart.getDataBox().containsById(r)||delete this._hiddenMap[r]},this);var o=new k(this._chart.getUnfilteredDatas());for(var f=0;f<o.size();f++){var p=o.get(f);!this._chart.isVisible(p)&&!this.isHidden(p)&&(o.removeAt(f),f--)}var l=o.size(),c=this._view.style,h=this._orientation==="horizontal";h?(c.textAlign="center",c.height=this._rowHeight+"px"):(c.textAlign="",c.height=this._rowHeight*l+"px"),c.lineHeight=this._rowHeight-2+"px";for(f=0;f<l;f++){var p=o.get(f),a=this._divPool.get();a._data=p,a.style.cursor="pointer",a.style.height=this._rowHeight+"px",h?a.style.display="inline-block":a.style.display="block",this._legendDiv.appendChild(a),this.renderLegend(a,p),this.onLegendRendered(a,p)}this._pools.forEach(function(r){r.clear()})},renderLegend:function(l,c){var u=!this.isHidden(c),h=this._chart.isSelected(c),a=this._iconPool.get(),f=a.style;f.display="inline-block",f.verticalAlign="middle",f.marginLeft="4px",f.width=this.getIconWidth()+"px",f.height=this.getIconHeight()+"px",u?f.backgroundColor=this._chart.getColor(c):f.backgroundColor=this.getHiddenColor(),l.appendChild(a);var p=this._textPool.get();f=p.style,f.paddingLeft="2px",f.paddingRight="4px",f.display="inline-block",f.verticalAlign="middle",u?f.color=h?this._selectForegroundColor:"":f.color=this.getHiddenColor(),p.innerHTML=this._chart.getName(c),l.appendChild(p),u&&h?l.style.backgroundColor=this._selectBackgroundColor:l.style.backgroundColor=""},onLegendRendered:function(c,a){}}),twaver.charts.ChartPane=function(h,c,l,f){twaver.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=h,this._legendPane=new twaver.charts.LegendPane(h),this._titleDiv=g.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=g.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var a=this;this._legendPane.addPropertyChangeListener(function(o){(o.property==="rowHeight"||o.porperty==="orientation")&&a.invalidate()}),arguments.length>1&&this.setTitle(c),arguments.length>2&&this.setLegendOrientation(l),arguments.length>3&&this.setLegendWidth(f)},_twaver.ext("twaver.charts.ChartPane",twaver.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:d.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:d.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:d.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:d.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(c){if(this._legendOrientation===c){return}var a=this._legendOrientation;this._legendOrientation=c,this.firePropertyChange("orientation",a,c),this._adjustLegendOrientation()},_adjustLegendOrientation:function(){this._legendOrientation==="left"||this._legendOrientation==="right"?this._legendPane.setOrientation("vertical"):this._legendPane.setOrientation("horizontal")},onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var l=this._view.offsetWidth,c=this._view.offsetHeight,u=this._legendPane.getRowHeight(),h;this._title&&this._title!==""?(h=this._titleHeight,this._titleDiv.innerHTML=this._title):(h=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var a=this._titleDiv.style;a.left="0px",a.top="0px",a.width=l+"px",a.height=h+"px";var f,p;this._legendOrientation==="bottom"?(f={x:0,y:h,width:l,height:Math.max(c-h-u,0)},p={x:0,y:Math.max(c-u,0),width:l,height:u}):this._legendOrientation==="right"?(f={x:0,y:h,width:Math.max(l-this._legendWidth,0),height:Math.max(c-h,0)},p={x:Math.max(l-this._legendWidth,0),y:h,width:this._legendWidth,height:Math.max(c-h,0)}):this._legendOrientation==="top"?(f={x:0,y:h+u,width:l,height:Math.max(c-h-u,0)},p={x:0,y:h,width:l,height:u}):this._legendOrientation==="left"&&(f={x:this._legendWidth,y:h,width:Math.max(l-this._legendWidth,0),height:Math.max(c-h,0)},p={x:0,y:h,width:this._legendWidth,height:Math.max(c-h,0)}),f&&this._chart.adjustBounds(f),p&&this._legendPane.adjustBounds(p)}}),twaver.charts.ChartInteraction=function(c){this.chart=c,this.canvas=c._canvas;var a=this;this.canvas.addEventListener("mousedown",function(h){h.button===0&&a.handleMouseDown(h),h.preventDefault()},!1);var f=v.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(f,function(h){a.handleMouseWheel(h)},!1)},_twaver.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(c){this.chart.isFocusOnClick()&&twaver.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(c);var a=this.chart.tryGetDataAt(c);c.detail===2&&a==null?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=g.getClientPoint(c),g.handle_mousedown(this,c))},handleMouseMove:function(c){if(this.lastPoint){var a={x:this._startLogical.x+c.clientX-this._startClient.x,y:this._startLogical.y+c.clientY-this._startClient.y};!this.startPan&&x.getDistance(this.lastPoint,a)>3&&(this.startPan=!0,this.lastPoint=a),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+a.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+a.y-this.lastPoint.y),this.lastPoint=a)}},handleMouseUp:function(c){if(!this.startPan&&c.detail===1){var a=this.chart.tryGetDataAt(c),f=this.chart.getSelectionModel();a?_twaver.isCtrlDown(c)?f.contains(a)?f.removeSelection(a):f.appendSelection(a):f.contains(a)||f.setSelection(a):_twaver.isCtrlDown(c)||f.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(c){g.preventDefault(c);var a=v.isFirefox?-c.detail:c.wheelDelta;a>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()*1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()*1.1,!1)):a<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),twaver.charts.ChartTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,g.addEventListener("touchstart","handleTouchstart",this.canvas,this)},_twaver.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(a){g.preventDefault(a),this.chart.isFocusOnClick()&&twaver.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(a),j.isMultiTouch(a)&&(this.distance=j.getDistance(a),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),g.addEventListener("touchmove","handleTouchmove",this.canvas,this),g.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(h){if(!this.endPoint){return}var c=this.chart.getLogicalPoint(h);!this.moved&&x.getDistance(this.endPoint,c)>10&&(this.moved=!0,this.lastPoint=c);if(!this.moved){return}if(j.isSingleTouch(h)){this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+c.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+c.y-this.endPoint.y),this.endPoint=c)}else{if(this.distance){var l=j.getDistance(h)/this.distance,f=this.xZoom*l,a=this.yZoom*l;this.chart.isXZoomEnabled()&&this.chart.setXZoom(f,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(a,!1)}}},handleTouchend:function(f){if(!this.moved){this.endPoint=this.chart.getLogicalPoint(f);var a=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;a?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var h=this.chart.tryGetDataAt(f);if(a&&h==null){this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0))}else{var c=this.chart.getSelectionModel();h?c.contains(h)||c.setSelection(h):c.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,g.removeEventListener("touchmove",this.canvas,this),g.removeEventListener("touchend",this.canvas,this)}}),twaver.charts.LegendPaneInteraction=function(c){this.legendPane=c;var a=this;this.legendPane._legendDiv.addEventListener("mousedown",function(f){a.handleMouseDown(f)},!1)},_twaver.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(c){if(c.button!==0){return}var a=c.target._data;a||(a=c.target.parentNode._data),a&&(this.legendPane._hiddenMap[a.getId()]?delete this.legendPane._hiddenMap[a.getId()]:this.legendPane._hiddenMap[a.getId()]=a,this.legendPane._chart.invalidateModel())}}),twaver.charts.LegendPaneTouchInteraction=function(a){this.legendPane=a,g.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},_twaver.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(c){g.preventDefault(c);var a=c.target._data;a||(a=c.target.parentNode._data),a&&(this.legendPane._hiddenMap[a.getId()]?delete this.legendPane._hiddenMap[a.getId()]:this.legendPane._hiddenMap[a.getId()]=a,this.legendPane._chart.invalidateModel())}})})(window);(function(m,w){var g=_twaver.extend,b=_twaver.g,j=_twaver.html,x=_twaver.math,d=_twaver.popup,v=_twaver.render,q=_twaver.touch,k=_twaver.ua,h=twaver.List,p=twaver.Defaults;g.__tree=function(c,a){c._rootVisible=!0,c._initTree=function(f){this._rootData=null,this._expandMap={},this._levelMap={}},c.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},c._buildData=function(f){this._dataRowMap[f.getId()]=this._rowDatas.size(),this._rowDatas.add(f),this._levelMap[f.getId()]=this._currentLevel,this.isExpanded(f)&&(this._currentLevel++,this._buildChildren(f),this._currentLevel--)},c._buildChildren=function(l){var f=l?l.getChildren():this._box.getRoots(),o=this.getCurrentSortFunction();o&&this.isChildrenSortable(l)?f.toList(this.isVisible,this).sort(o).forEach(function(r){this._buildData(r)},this):f.forEach(function(r){this.isVisible(r)&&this._buildData(r)},this)},c.getLevel=function(f){return this._levelMap[f.getId()]},c.getToggleImage=function(f){return f.getChildrenSize()>0?this.isExpanded(f)?this._expandIcon:this._collapseIcon:null},c.isCheckable=function(f){return this.isCheckMode()},c.isCheckMode=function(){return g.__tree._checkMap[this._checkMode]===1},c.isChildrenSortable=function(f){return !0},c.handleDataBoxChange=function(f){f.kind==="remove"?delete this._expandMap[f.data.getId()]:f.kind==="clear"&&(this._expandMap={}),this.invalidateModel()},c.isExpanded=function(f){return this._expandMap[f.getId()]===1},c.expand=function(l){if(this.isExpanded(l)){return}var f=l.getParent();while(f!=null&&f!==this._rootData){this._expandMap[f.getId()]=1,f=f.getParent()}this._expandMap[l.getId()]=1,this.invalidateModel()},c.collapse=function(f){if(!this.isExpanded(f)){return}delete this._expandMap[f.getId()],this.invalidateModel()},c.expandAll=function(){this._box.forEach(function(f){this._expandMap[f.getId()]=1},this),this.invalidateModel()},c.collapseAll=function(){this._expandMap={},this.invalidateModel()},c._handleClick=function(l){this.isFocusOnClick()&&twaver.Util.setFocus(this._view);if(this._isValidating){return}var f;if(l.target._expandData){f=l.target._expandData,this.isExpanded(f)?(this.collapse(f),this.fireInteractionEvent({kind:"collapse",data:f})):(this.expand(f),this.fireInteractionEvent({kind:"expand",data:f}))}else{if(l.target._selectData||l.target.parentNode._selectData){this._handlePressSelection(l.target._selectData||l.target.parentNode._selectData,l);if(this.isCheckMode()){var o=this.getRowIndexAt(l);o>=0&&(this._focusedRow=o,this.invalidateDisplay())}}else{this._treeColumn?(f=this.getDataAt(l),f&&(this.isCheckMode()?l.target._checkData||(this._focusedRow=this.getRowIndexByData(f),this.invalidateDisplay()):this._handlePressSelection(f,l))):this.isCheckMode()&&!l.target._checkData&&(this._focusedRow=this.getRowIndexAt(l),this.invalidateDisplay())}}this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor)),this.updateCurrentEditor&&this.updateCurrentEditor(l)},c.handleChange=function(y){if(this._isCommitting||this._isCanceling||this._isValidating){return}var l=y.target._checkData;if(l){var z=this.isSelected(l),u=this.getSelectionModel(),f;if(this._checkMode==="default"){z?u.removeSelection(l):u.appendSelection(l)}else{if(this._checkMode==="children"){f=new h(l),f.addAll(l.getChildren())}else{if(this._checkMode==="descendant"){f=new h,_twaver.fillDescendant(l,f)}else{if(this._checkMode==="descendantAncestor"){f=new h,_twaver.fillDescendant(l,f);if(!z){var o=l.getParent();while(o){f.add(o),o=o.getParent()}}}}}}z?u.removeSelection(f):u.appendSelection(f)}y.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(y.target._editInfo,y.target))},c.onLabelRendered=function(y,l,z,u,f,o){},c._renderTree=function(G,K,B,y){var D=this._levelMap[K.getId()],L=this.getToggleImage(K),A=this.__spanPool.get();L?A.style.width=this._indent*D+"px":A.style.width=this._indent*(D+1)+"px",A.style.display="inline-block",G.appendChild(A);if(L){var J=this.__imagePool.get();J.setAttribute("src",_twaver.getImageSrc(L)),J.style.verticalAlign="middle",J._expandData=K,G.appendChild(J)}var I=this.isCheckable(K),F=this.getUncheckableStyle()==="disabled";if(I||F){var C=this._addCheckBox(G,K,y);C.disabled=!I}var H=this.getIcon(K);if(H){var E=this.isCheckMode()||this._treeColumn?null:K;this._addIcon(G,K,H,E)}var z=this.getLabel(K);z&&(A=this.__textPool.get(),A.style.whiteSpace="nowrap",A.style.verticalAlign="middle",A.style.padding="1px 2px 1px 2px",_twaver.setText(A,z,this._treeColumn?this._treeColumn.isInnerText():this._innerText),!this.isCheckMode()&&!this._treeColumn?(A._selectData=K,A.style.backgroundColor=y?this.getSelectColor(K):""):this._focusedRow===B&&(A.style.backgroundColor=this.getSelectColor(K)),this.onLabelRendered(A,K,z,B,D,y),G.appendChild(A))}},g.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1},twaver.Column=function(a){twaver.Column.superClass.constructor.call(this,a)},_twaver.ext("twaver.Column",twaver.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:p.COLUMN_INNER_TEXT,_width:p.COLUMN_WIDTH,_horizontalAlign:p.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:p.COLUMN_PROPERTY_TYPE,_valueType:p.COLUMN_VALUE_TYPE,_editable:p.COLUMN_EDITABLE,_sortable:p.COLUMN_SORTABLE,_visible:p.COLUMN_VISIBLE,_resizable:p.COLUMN_RESIZABLE,_movable:p.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:p.SORT_FUNCTION,_enumInfo:null,renderCell:p.COLUMN_RENDER_CELL,renderHeader:p.COLUMN_RENDER_HEADER,setParent:function(a){throw"parent not supported"}}),twaver.ColumnBox=function(a){twaver.ColumnBox.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.ColumnBox",twaver.DataBox,{_name:"ColumnBox",add:function(c,a){if(!c.IColumn){throw"Only IColumn can be added into ColumnBox"}twaver.ColumnBox.superClass.add.apply(this,arguments)}}),twaver.Property=function(a){twaver.Property.superClass.constructor.call(this,a)},_twaver.ext("twaver.Property",twaver.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:p.PROPERTY_INNER_TEXT,_horizontalAlign:p.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:p.PROPERTY_PROPERTY_TYPE,_valueType:p.PROPERTY_VALUE_TYPE,_editable:p.PROPERTY_EDITABLE,_categoryName:p.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:p.PROPERTY_RENDER_NAME,renderValue:p.PROPERTY_RENDER_VALUE,isVisible:null,setParent:function(a){throw"parent not supported"},setPropertyName:function(c){var a=this._propertyName;this._propertyName=c,this.firePropertyChange("propertyName",a,c)},setPropertyType:function(c){var a=this._propertyType;this._propertyType=c,this.firePropertyChange("propertyType",a,c)}}),twaver.PropertyBox=function(a){twaver.PropertyBox.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.PropertyBox",twaver.DataBox,{_name:"PropertyBox",add:function(c,a){if(!c.IProperty){throw"Only IProperty can be added into PropertyBox"}twaver.PropertyBox.superClass.add.apply(this,arguments)}}),twaver.Tab=function(a){twaver.Tab.superClass.constructor.call(this,a)},_twaver.ext("twaver.Tab",twaver.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:p.TAB_WIDTH,_closable:p.TAB_CLOSABLE,_resizable:p.TAB_RESIZABLE,_movable:p.TAB_MOVABLE,_disabled:p.TAB_DISABLED,_visible:p.TAB_VISIBLE,setParent:function(a){throw"parent not supported"}}),twaver.TabBox=function(a){twaver.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},_twaver.ext("twaver.TabBox",twaver.DataBox,{_name:"TabBox",add:function(c,a){if(!c.ITab){throw"Only ITab can be added into TabBox"}twaver.TabBox.superClass.add.apply(this,arguments)}}),twaver.controls.ListBase=function(c){twaver.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new h,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new twaver.Pool("div",20),this.__imagePool=new twaver.Pool("img",20),this.__canvasPool=new twaver.Pool("canvas",20),this.__spanPool=new twaver.Pool("span",20),this.__textPool=new twaver.Pool("span",20),this.__checkBoxPool=new twaver.Pool("input",20),this._pools.add(this.__divPool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=j.createView("auto"),this._rootDiv=j.createDiv(),this._dataDiv=j.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(c?c:new twaver.DataBox);var a=this;a.handleChange&&a._view.addEventListener("change",function(l){a.handleChange(l)},!1);var f;k.isTouchable?f=twaver.controls.ListBaseTouchInteraction:f=twaver.controls.ListBaseInteraction,f&&new f(this)},_twaver.ext("twaver.controls.ListBase",twaver.controls.View,{__bool:["innerText"],_innerText:p.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(a){return this._dataRowMap[a.getId()]},getRowIndexById:function(a){return this._dataRowMap[a]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(c){if(!c){throw"DataBox can not be null"}if(this._box===c){return}var a=this._box;a&&(a.removeDataBoxChangeListener(this.handleDataBoxChange,this),a.removeDataPropertyChangeListener(this.handlePropertyChange,this),a.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||a.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=c,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(c):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",a,this._box)},onPropertyChanged:function(a){a.property==="zoom"?this.invalidate():this.invalidateModel()},invalidateModel:function(){if(this._invalidateModel){return}this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay){return}this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateData:function(a){if(this._invalidateDisplay){return}this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[a.getId()]=a,this.invalidate()},validateImpl:function(){var F=this._view.scrollLeft,J=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},j.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var B;if(this._invalidateDatas){for(B in this._invalidateDatas){var y=this._renderMap[B];y&&(j.release(y),this._dataDiv.removeChild(y),delete this._renderMap[B])}this._invalidateDatas=null}var K=this._view.scrollTop/this._zoom,A=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(K/this._rowHeight)-2,this._endRowIndex=Math.ceil((K+A)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());var I=this._rowHeight-this._rowLineWidth-2+"px",H=this._rowLineWidth+"px";for(var E=this._startRowIndex;E<this._endRowIndex;E++){var C=this._rowDatas.get(E);B=C.getId();var G=this._renderMap[B];if(!G){G=this.__divPool.get();var D=G.style;D.position="absolute",D.whiteSpace="nowrap",D.lineHeight=I,D.top=E*this._rowHeight+"px",D.borderStyle="solid",D.borderWidth="0px",D.borderBottomWidth=H,D.borderBottomColor=this._rowLineColor,this._dataDiv.appendChild(G),this._renderMap[B]=G;var z=this.isSelected(C);this.renderData(G,C,E,z),this.onDataRendered(G,C,E,z)}}_twaver.keys(this._renderMap).forEach(function(c){var a=this.getRowIndexById(c);if(a<this._startRowIndex||a>=this._endRowIndex){var f=this._renderMap[c];j.release(f),this._dataDiv.removeChild(f),delete this._renderMap[c]}},this),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==F&&(this._view.scrollLeft=F),this._view.scrollTop!==J&&(this._view.scrollTop=J),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var f,a,l=this._rowHeight-this._rowLineWidth+"px",c=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(f in this._renderMap){a=this._renderMap[f],a.style.height=l,a.style.width=c}},onValidated:function(){},onDataRendered:function(f,a,l,c){},_addCheckBox:function(f,a,l){var c=this.__checkBoxPool.get();return c.keepDefault=!0,c.type="checkbox",c.style.margin="0px 2px",c.style.verticalAlign="middle",c._checkData=a,c.checked=l,c.disabled=!1,f.appendChild(c),c},_addIcon:function(D,H,y,A){var I=_twaver.getImageAsset(y),r=this.getInnerColor(H),G=this.getOuterColor(H),F=this.getAlarmFillColor(H),C;if((r||G||F)&&I&&I.getImage()){var z=I.getWidth(),E=I.getHeight();C=this.__canvasPool.get(),C.style.verticalAlign="middle",C.setAttribute("width",z),C.setAttribute("height",E);var B=C.getContext("2d");B.clearRect(0,0,z,E),B.drawImage(I.getImage(r),0,0,z,E),G&&(B.lineWidth=2,B.strokeStyle=G,B.beginPath(),B.rect(0,0,z,E),B.closePath(),B.stroke()),F&&(B.fillStyle=b.createRadialGradient(B,F,"white",1,E-9,8,8,0.75,0.25),B.beginPath(),B.arc(5,E-5,4,0,Math.PI*2,!0),B.closePath(),B.fill())}else{C=this.__imagePool.get(),C.style.verticalAlign="middle",C.setAttribute("src",_twaver.getImageSrc(y))}C.style.margin="0px 1px 0px 1px",C._selectData=A,D.appendChild(C)},isVisible:function(a){return this._box.contains(a)?this._visibleFunction?this._visibleFunction(a):!0:!1},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){a.property==="parent"?this.invalidateModel():this.invalidateData(a.source)},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){a.datas.forEach(function(c){this.invalidateData(c)},this),this.onSelectionChanged(a)},getRowIndexAt:function(c){var a=this.getLogicalPoint(c);if(!a){return -1}var f=parseInt(a.y/this._rowHeight);return f>=0&&f<this._rowDatas.size()?f:-1},getDataAt:function(c){var a=this.getRowIndexAt(c);return a>=0?this._rowDatas.get(a):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var c=this.getCurrentSortFunction();c&&this._rowDatas.sort(c);var a=this._rowDatas.size();for(var f=0;f<a;f++){this._dataRowMap[this._rowDatas.get(f).getId()]=f}},_buildChildren:function(a){a.forEach(function(c){this._rowDatas.add(c),this._buildChildren(c.getChildren())},this)},_handlePressSelection:function(u,c){var z=this.getSelectionModel();if(_twaver.isCtrlDown(c)){z.contains(u)?z.removeSelection(u):z.appendSelection(u)}else{if(c.shiftKey&&z.getLastData()){var l=z.getLastData(),a=this.getRowIndexByData(l),f=this.getRowIndexByData(u),y=new h;y.add(this.getRowDatas().get(a));while(a!==f){a+=f>a?1:-1,y.add(this.getRowDatas().get(a))}z.setSelection(y)}else{(z.size()!==1||!z.contains(u))&&z.setSelection(u)}}this.fireInteractionEvent({kind:c.detail===2?"doubleClick":"click",data:u})},_handleClick:function(c){this.isFocusOnClick()&&twaver.Util.setFocus(this._view);var a=this.getDataAt(c);a&&(this.isCheckMode()&&!c.target._checkData&&(this._focusedRow=this.getRowIndexByData(a),this.invalidateDisplay()),this.isCheckMode()||this._handlePressSelection(a,c)),this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor&&this.updateCurrentEditor(c)},handleChange:function(f){if(this._isCanceling||this._isValidating){return}var a=f.target._checkData;if(a){var l=this.isSelected(a),c=this.getSelectionModel();l?c.removeSelection(a):c.appendSelection(a)}f.target._editInfo&&this.commitEditValue&&this.commitEditValue(f.target._editInfo,f.target)},scrollToData:function(l){var c=this.getRowIndexById(l.getId());if(c<0){return}var o=c*this._rowHeight,f=o+this._rowHeight,a=this._view.scrollTop;this._view.scrollTop>o&&(a=o),this._view.scrollTop+this._view.clientHeight<f&&(a=f-this._view.clientHeight),this._view.scrollTop!=a&&(this._view.scrollTop=a,this.invalidate())},makeVisible:function(a){if(!this.isVisible(a)){return}this.expand&&this.expand(a),_twaver.callLater(this.scrollToData,this,[a],p.CALL_LATER_DELAY*2)},onSelectionChanged:function(a){this._makeVisibleOnSelected&&(a.kind==="append"||a.kind==="set"||a.kind==="all")&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(c){c.getParent()&&this.expand(c.getParent())},this),_twaver.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],p.CALL_LATER_DELAY*2))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),twaver.controls.TableBase=function(a){this._columnBox=new twaver.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),twaver.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new twaver.Pool("div",20),this._stringPool=new twaver.Pool("span",20),this._booleanPool=new twaver.Pool("input",20),this._colorPool=new twaver.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},_twaver.ext("twaver.controls.TableBase",twaver.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){a.source!==this._sortColumn||a.property!=="sortDirection"&&a.property!=="sortFunction"&&a.property!=="sortable"?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},renderData:function(G,L,B,y){var D=this._columnBox.getRoots(),M=D.size(),A=0,K=this._rowHeight-this._rowLineWidth+"px",J;for(var F=0;F<M;F++){var C=D.get(F),I=C.getWidth();I<0&&(I=0);var E=Math.min(this._columnLineWidth,I);if(C.isVisible()){var z=this._cellPool.get();J=z.style,J.position="absolute",J.whiteSpace="nowrap",J.verticalAlign="middle",J.textAlign=C.getHorizontalAlign(),J.overflow="hidden",J.textOverflow="ellipsis",J.left=A+"px",J.width=I-E+"px",J.height=K,J.borderStyle="solid",J.borderWidth="0px",J.borderRightWidth=E+"px",J.borderRightColor=this._columnLineColor,G.appendChild(z);var H={data:L,value:this.getValue(L,C),div:z,view:this,column:C,rowIndex:B,selected:y};this.renderCell(H),this.onCellRendered(H),A+=I}}J=G.style,J.width=A+"px",J.height=K,J.backgroundColor=this.isCheckMode()&&this._focusedRow===B||!this.isCheckMode()&&y?this.getSelectColor(L):""},adjustRowSize:function(){},onCellRendered:function(a){},getCurrentSortFunction:function(){var f=this._sortColumn;if(f){var a=f.getSortFunction();if(a){var l=this,c="asc"===f.getSortDirection()?1:-1;return function(r,t){var y=l.getValue(r,f),e=l.getValue(t,f);return a.call(l,y,e,r,t)*c}}}return this._sortFunction},renderCell:function(f){var a=f.column;if(a.renderCell){a.renderCell(f);return}var l=f.value,c=a.getEnumInfo();c&&c.values&&(l=c.map[l]),f.view.isCellEditable(f.data,a)&&(f.enumInfo=c,f.div._editInfo=f),v.render(a.getValueType(),l,f.div,f.view,a.isInnerText())},getValue:function(c,a){return a.getValue(c,this)},setValue:function(c,a,f){a.setValue(c,f,this)},getColumnAt:function(z){var f=this.getLogicalPoint(z);if(!f){return null}var B=this._columnBox.getRoots();for(var y=0,c=B.size(),l=0;y<c;y++){var A=B.get(y),a=A.getWidth();a<0&&(a=0);if(f.x>l&&f.x<l+a){return A}l+=a}return null},isCellEditable:function(c,a){return this.isEditable()&&a.isEditable()},commitEditValue:function(o,c){if(this._isCanceling){return}var u;c.type==="checkbox"?u=c.checked:u=c.value;var l=o.column,a=l.getValueType();a==="int"&&typeof u=="string"?u=parseInt(u):a==="number"&&typeof u=="string"&&(u=parseFloat(u)),this.setValue(o.data,l,u);if(this._currentEditor){var f=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(f),twaver.Util.setFocus(this._view)}},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var a=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(a),twaver.Util.setFocus(this._view),delete this._isCanceling}},updateCurrentEditor:function(f){var a=f.target;if(a===this._currentEditor||a.parentNode===this._currentEditor){return}var l;while(a&&a!==this._view&&!(l=a._editInfo)){a=a.parentNode}if(l&&a===l.div){l.enumInfo?this._currentEditor=j.createSelect(l.enumInfo,l.value):(this._currentEditor=document.createElement("input"),l.value!=null&&(this._currentEditor.value=l.value));if(this._currentEditor){this._currentEditor.addEventListener("keydown",function(r){var o=r.target._editInfo.view;r.keyCode===13?o.commitEditValue(r.target._editInfo,r.target):r.keyCode===27&&o.cancelEditing()},!1),self=this,this._currentEditor.addEventListener("blur",function(r){var o=r.target._editInfo.view;if(o._isCanceling){return}o.commitEditValue(r.target._editInfo,r.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=l;var c=this._currentEditor.style;c.position="absolute",c.margin="0px",c.border="0px",c.padding="0px",c.left=l.div.style.left,c.top=l.div.parentNode.style.top,c.width=l.div.style.width,c.height=l.div.style.height,this._rootDiv.appendChild(this._currentEditor),twaver.Util.setFocus(this._currentEditor)}}},onColumnSorted:function(a){},getCurrentEditor:function(){return this._currentEditor}}),twaver.controls.List=function(a){twaver.controls.List.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.controls.List",twaver.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:p.LIST_ROW_HEIGHT,_indent:p.LIST_INDENT,_rowLineWidth:p.LIST_ROW_LINE_WIDTH,_rowLineColor:p.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:p.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:p.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:p.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(c){delete this._focusedRow;var a=this._checkMode;this._checkMode=c,this.firePropertyChange("checkMode",a,c)},isCheckable:function(a){return this._checkMode===!0},renderData:function(z,C,l,c){var y;this._indent>0&&(y=this.__spanPool.get(),y.style.width=this._indent+"px",y.style.display="inline-block",z.appendChild(y));var D=this.isCheckable(C);D&&this._addCheckBox(z,C,c);var f=this.getIcon(C);f&&this._addIcon(z,C,f);var B=this.getLabel(C);if(B){y=this.__textPool.get();var A=y.style;A.whiteSpace="nowrap",A.verticalAlign="middle",A.padding="1px 2px 1px 2px",A.display="inline-block",_twaver.setText(y,B,this._innerText),this.onLabelRendered(y,C,B,l,c),z.appendChild(y)}this.isCheckMode()?z.style.backgroundColor=this._focusedRow===l?this.getSelectColor(C):"":z.style.backgroundColor=c?this.getSelectColor(C):""},onLabelRendered:function(l,c,o,f,a){}}),twaver.controls.ListBaseInteraction=function(c){this.listBase=c,this.view=c._view;var a=this;this.view.addEventListener("scroll",function(f){a.handleScroll(f)},!1),this.view.addEventListener("mousedown",function(f){a.handleMouseDown(f)},!1),this.view.addEventListener("keydown",function(f){a.handleKeyDown(f)},!1)},_twaver.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseDown:function(c){var a=this.listBase;if(c.target===a._currentEditor||c.target.parentNode===a._currentEditor){return}a._handleClick(c)},handleKeyDown:function(l){var a=this.listBase;if(a._currentEditor){return}if(_twaver.isCtrlDown(l)&&l.keyCode==65){a.isKeyboardSelectEnabled()&&a.selectAll().size()>0&&a.fireInteractionEvent({kind:"selectAll"}),j.preventDefault(l)}else{if(l.keyCode==46){a.isKeyboardRemoveEnabled()&&a.removeSelection()&&a.fireInteractionEvent({kind:"removeElement"}),j.preventDefault(l)}else{if(!!a.isCheckMode()||l.keyCode!==38&&l.keyCode!==40&&l.keyCode!==37&&l.keyCode!==39){_twaver.showVersion(l)}else{var o=a.getSelectionModel().getLastData();if(o){if(l.keyCode===38||l.keyCode===40){var f=a.getRowDatas(),c=a.getRowIndexByData(o);c>=0&&(l.keyCode===38?c!==0&&(o=f.get(c-1),a.getSelectionModel().setSelection(o)):c!==f.size()-1&&(o=f.get(c+1),a.getSelectionModel().setSelection(o)))}else{a.expand&&(l.keyCode===37||l.keyCode===39)&&o.hasChildren()&&(l.keyCode===37?a.collapse(o):a.expand(o))}}else{a.getRowDatas().size()>0&&(o=a.getRowDatas().get(0),a.getSelectionModel().setSelection(o))}}}}},handleScroll:function(a){this.listBase.invalidate()}}),twaver.controls.ListBaseTouchInteraction=function(a){this.listBase=a,this.view=a._view,j.addEventListener("touchstart","handleTouchstart",this.view,this)},_twaver.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(a){j.preventDefault(a),this.lastPoint=this.listBase.getLogicalPoint(a),j.addEventListener("touchmove","handleTouchmove",this.view,this),j.addEventListener("touchend","handleTouchend",this.view,this),q.isMultiTouch(a)&&(this.distance=q.getDistance(a),this.zoom=this.listBase._zoom)},handleTouchmove:function(o){this.moved||(this.moved=!0);if(q.isSingleTouch(o)){if(this.lastPoint){var c=this.listBase.getLogicalPoint(o),u=this.lastPoint.x-c.x,l=this.lastPoint.y-c.y,a=this.listBase.panByOffset(u,l);this.listBase.invalidate(),this.lastPoint.x-=u-a.x,this.lastPoint.y-=l-a.y}}else{if(this.distance){var f=q.getDistance(o)/this.distance;this.listBase.setZoom(this.zoom*f,!1)}}},handleTouchend:function(a){this.moved||this.listBase._handleClick(a),delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,j.removeEventListener("touchmove",this.view,this),j.removeEventListener("touchend",this.view,this)}}),twaver.controls.Tree=function(a){this._interactionDispatcher=new twaver.EventDispatcher,this._initTree(a),twaver.controls.Tree.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.controls.Tree",twaver.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:p.TREE_INDENT,_rowHeight:p.TREE_ROW_HEIGHT,_rowLineWidth:p.TREE_ROW_LINE_WIDTH,_rowLineColor:p.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:p.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:p.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:p.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:p.TREE_EXPAND_ICON,_collapseIcon:p.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",isCheckMode:function(){return this._checkMode},setCheckMode:function(c){delete this._focusedRow;var a=this._checkMode;this._checkMode=c,this.firePropertyChange("checkMode",a,c)},renderData:function(f,a,l,c){this._renderTree(f,a,l,c)}}),twaver.controls.Table=function(c){this._checkColumn=new twaver.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var a=this;this._checkColumn.getValue=function(f,l){return a.isSelected(f)},twaver.controls.Table.superClass.constructor.apply(this,arguments)},_twaver.ext("twaver.controls.Table",twaver.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:p.TABLE_EDITABLE,_rowHeight:p.TABLE_ROW_HEIGHT,_rowLineWidth:p.TABLE_ROW_LINE_WIDTH,_rowLineColor:p.TABLE_ROW_LINE_COLOR,_columnLineWidth:p.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:p.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:p.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:p.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:p.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(a){if(a===this.isCheckMode()){return}delete this._focusedRow,a?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!a,a)},renderCheckCell:function(c){var a=c.view._booleanPool.get();a.disabled=!1,a.type="checkbox",a.style.margin="0px 2px",a.style.verticalAlign="middle",a.checked=c.selected;var f=c.div;f.appendChild(a),f.style.textAlign===""&&(f.style.textAlign="center"),a._checkData=c.data}}),twaver.controls.TableHeader=function(c){twaver.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new twaver.Pool("div"),this._imagePool=new twaver.Pool("img"),this._textPool=new twaver.Pool("span"),this._resizePool=new twaver.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=c,this._tableView=c.getView(),this._columnBox=c.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var a=this;c.getView().addEventListener("scroll",function(l){a.invalidateScroll()},!1),c.addPropertyChangeListener(function(l){a.invalidateDisplay()},this),this._view=j.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=p.TABLEHEADER_BACKGROUND,this._rootDiv=j.createDiv(),this._view.appendChild(this._rootDiv),this.invalidateDisplay();var f;k.isTouchable?f=twaver.controls.TableHeaderTouchInteraction:f=twaver.controls.TableHeaderInteraction,f&&new f(this)},_twaver.ext("twaver.controls.TableHeader",twaver.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:p.TABLEHEADER_HEIGHT,_moveBackground:p.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:p.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:p.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:p.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:p.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:p.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:p.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){this.invalidateDisplay()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},onPropertyChanged:function(a){this.invalidateDisplay()},invalidateScroll:function(){if(this._invalidateScroll){return}this._invalidateScroll=!0,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay){return}this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate()},validate:function(){if(!this._invalidate){return}this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px")},validateDisplay:function(){j.release(this._rootDiv);var F=this._table.getZoom(),J=this.getHeight()+"px",B=this.getHeight()-2+"px",y=this._table.getColumnBox().getRoots(),K=y.size(),A=0,I=this._table._columnLineWidth*F;for(var H=0;H<K;H++){var E=y.get(H);if(E.isVisible()){var C=E.getWidth()*F;C<0&&(C=0);var G=Math.min(I,C),D=this._divPool.get();D._column=E;var z=D.style;z.position="absolute",z.whiteSpace="nowrap",z.lineHeight=B,z.overflow="hidden",z.textOverflow="ellipsis",z.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",z.backgroundRepeat="no-repeat",z.backgroundImage="",z.textAlign=E.getHorizontalAlign(),z.borderStyle="solid",z.borderWidth="0px",z.borderRightWidth=G+"px",z.borderRightColor=this._columnLineColor,z.left=A+"px",z.width=C-G+"px",z.height=J,D._x=A,D._width=C-G,this._rootDiv.insertBefore(D,this._rootDiv.firstChild),this.renderColumn(D,E),this.onColumnRendered(D,E),A+=C,E.isResizable()&&(D=this._resizePool.get(),D._resizeColumn=E,z=D.style,z.position="absolute",z.backgroundColor="white",z.opacity=0,z.left=A-G-this._resizeTolerance+"px",z.width=G+this._resizeTolerance*2+"px",z.height=J,this._rootDiv.appendChild(D))}}this._pools.forEach(function(a){a.clear()}),this._rootDiv.style.width=A+"px",this._rootDiv.style.height=J},renderColumn:function(u,c){if(c.renderHeader){c.renderHeader(u)}else{var z=this._textPool.get();z.style.whiteSpace="nowrap",z.style.verticalAlign="middle",z.style.padding="1px 2px 1px 2px",z.innerHTML=c.getName()?c.getName():c.getPropertyName(),z.setAttribute("title",z.innerHTML),u.appendChild(z);if(k.isOpera){var l=u.cloneNode(!1);l.style.left="0px",l.style.top="0px",l.style.opacity=0,u.appendChild(l)}}if(this._table.getSortColumn()===c&&c.isSortable()){var a=c.getSortDirection()==="asc"?this._sortAscIcon:this._sortDescIcon,f=_twaver.getImageSrc(a);if(!this._sortIconPosition||this._sortIconPosition===""){var y=this._imagePool.get();y.setAttribute("src",f),y.style.verticalAlign="middle",u.appendChild(y)}else{u.style.backgroundImage="url("+f+")"}}},onColumnRendered:function(c,a){}}),twaver.controls.TableHeaderInteraction=function(c){this.header=c,this.table=c._table,this.view=c._view;var a=this;this.view.addEventListener("mousedown",function(f){a.handleMouseDown(f)},!1),this.view.addEventListener("mousemove",function(f){a.handleMouseMove(f)},!1)},_twaver.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(a){if(a.button!==0){return}if(this.movableDiv){this.handleMouseUp(a);return}this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this._startClient=j.getClientPoint(a),this.lastX=this.getX(a),this._startLogicalX=this.lastX,j.handle_mousedown(this,a)},changeCursor:function(c){var a="";if(c.target._resizeColumn){a="ew-resize"}else{var f=this.getColumnAt(c);f&&(f.isMovable()||f.isSortable())&&(a="pointer")}this.view.style.cursor=a},handleMouseMove:function(l){if(this.lastX==null){this.changeCursor(l);return}if(j.target!==this){return}var a=this._startLogicalX+l.clientX-this._startClient.x;if(this.resizeColumn){if(this.stopX!=null){if(a<this.stopX){return}delete this.stopX}var o=this.resizeColumn.getWidth()+(a-this.lastX)/this.table.getZoom();o<10&&(o=10,this.stopX=a),this.resizeColumn.setWidth(o),this.lastX=a}else{if(this.movableDiv){var f=a-this.lastX;if(!this.cloneDiv){if(Math.abs(f)<3){return}this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=j.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var c=this.cloneDiv._x+f;this.cloneDiv.style.left=c+"px",this.cloneDiv._x=c,this.lastX=a,this.columnInfo=this.getColumnInfoAt(l),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleMouseUp:function(f){if(f.button!==0){return}var a;if(!this.resizeColumn){if(this.movableDiv&&this.columnInfo){a=this.movableDiv._column;var l=this.columnInfo.index;this.table.getColumnBox().moveTo(a,l)}else{a=this.getColumnAt(f);if(a&&a.isSortable()){var c=a.getSortDirection();this.table.getSortColumn()===a?(c==="desc"&&this.table.setSortColumn(null),a.setSortDirection(c==="asc"?"desc":"asc")):this.table.setSortColumn(a),this.table.onColumnSorted(this.table.getSortColumn())}}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._column)){c=c.parentNode}return a},getMovableDivAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._column)){c=c.parentNode}return a&&a.isMovable()?c:null},getX:function(c){var a=j.getLogicalPoint(this.view,c);return a?a.x:null},getColumnInfoAt:function(F){var J=this._startLogicalX+F.clientX-this._startClient.x+this.table.getView().scrollLeft,A=this.table.getColumnBox().getRoots(),y=A.size(),C=this.table.getZoom(),K=0,z=!1;for(var I=0;I<y;I++){var H=A.get(I);H===this.movableDiv._column&&(z=!0);if(H.isVisible()){var E=H.getWidth()*C;if(E<=0){continue}if(J>=K&&J<=K+E){var B=J<K+E/2;z&&(H!==this.movableDiv._column||!B)&&I--;var G=B?Math.max(0,I):Math.min(I+1,y),D=B?K:K+E;return D=Math.max(0,D-1),{index:G,column:H,position:D+"px"}}K+=E}}return this.columnInfo}}),twaver.controls.TableHeaderTouchInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view,j.addEventListener("touchstart","handleTouchstart",this.view,this)},_twaver.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(a){j.preventDefault(a);if(this.movableDiv){this.handleTouchend(a);return}this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),j.addEventListener("touchmove","handleTouchmove",this.view,this),j.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(l){if(this.lastX==null){return}var a;if(this.resizeColumn){a=this.getX(l);if(this.stopX!=null){if(a<this.stopX){return}delete this.stopX}var o=this.resizeColumn.getWidth()+(a-this.lastX)/this.table.getZoom();o<0&&(o=0,this.stopX=a),this.resizeColumn.setWidth(o),this.lastX=a}else{if(this.movableDiv){a=this.getX(l);var f=a-this.lastX;if(!this.cloneDiv){if(Math.abs(f)<3){return}this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=j.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var c=this.cloneDiv._x+f;this.cloneDiv.style.left=c+"px",this.cloneDiv._x=c,this.lastX=a,this.columnInfo=this.getColumnInfoAt(l),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleTouchend:function(f){var a;if(!this.resizeColumn){if(this.movableDiv&&this.columnInfo){a=this.movableDiv._column;var l=this.columnInfo.index;this.table.getColumnBox().moveTo(a,l)}else{a=this.getColumnAt(f);if(a&&a.isSortable()){var c=a.getSortDirection();this.table.getSortColumn()===a?(c==="desc"&&this.table.setSortColumn(null),a.setSortDirection(c==="asc"?"desc":"asc")):this.table.setSortColumn(a)}}}this.clear(),j.removeEventListener("touchmove",this.view,this),j.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._column)){c=c.parentNode}return a},getMovableDivAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._column)){c=c.parentNode}return a&&a.isMovable()?c:null},getX:function(c){var a=j.getLogicalPoint(this.view,c);return a?a.x:null},getColumnInfoAt:function(F){var J=this.getX(F)+this.table.getView().scrollLeft,A=this.table.getColumnBox().getRoots(),y=A.size(),C=this.table.getZoom(),K=0,z=!1;for(var I=0;I<y;I++){var H=A.get(I);H===this.movableDiv._column&&(z=!0);if(H.isVisible()){var E=H.getWidth()*C;if(E<=0){continue}if(J>=K&&J<=K+E){var B=J<K+E/2;z&&(H!==this.movableDiv._column||!B)&&I--;var G=B?Math.max(0,I):Math.min(I+1,y),D=B?K:K+E;return D=Math.max(0,D-1),{index:G,column:H,position:D+"px"}}K+=E}}return this.columnInfo}}),twaver.controls.TablePane=function(c,a){twaver.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=c,this._tableHeader=a?a:new twaver.controls.TableHeader(c),this._view=j.createView("hidden"),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var f=this;this._tableHeader.addPropertyChangeListener(function(l){l.property==="height"&&f.invalidate()})},_twaver.ext("twaver.controls.TablePane",twaver.controls.ControlBase,{onPropertyChanged:function(a){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var c=this._view.offsetWidth,a=this._view.offsetHeight,f=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:c,height:f}),this._table.adjustBounds({x:0,y:f,width:c,height:Math.max(0,a-f)})}}),twaver.controls.TreeTable=function(a){this._treeColumn=new twaver.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(a),twaver.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},_twaver.ext("twaver.controls.TreeTable",twaver.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:p.TREETABLE_EDITABLE,_indent:p.TREETABLE_INDENT,_rowHeight:p.TREETABLE_ROW_HEIGHT,_rowLineWidth:p.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:p.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:p.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:p.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:p.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:p.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:p.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:p.TREETABLE_EXPAND_ICON,_collapseIcon:p.TREETABLE_COLLAPSE_ICON,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(a){a.view._renderTree(a.div,a.data,a.rowIndex,a.selected)},getTreeValue:function(c,a){return a.getLabel(c)},setTreeValue:function(c,a,f){c.setName(a)}}),twaver.controls.PropertySheet=function(c){twaver.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=j.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new h,this._categoryMap={},this._rowList=new h,this._propertyBox=new twaver.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new twaver.Pool("div",2),this.__cellPool=new twaver.Pool("div",2),this.__imagePool=new twaver.Pool("img",2),this.__textPool=new twaver.Pool("span",2),this._stringPool=new twaver.Pool("span",2),this._booleanPool=new twaver.Pool("input",2),this._colorPool=new twaver.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=j.createView("auto"),this._rootDiv=j.createDiv(),this._dataDiv=j.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(c?c:new twaver.DataBox);var a=this;this._view.addEventListener("change",function(l){a.handleChange(l)},!1);var f;k.isTouchable?f=twaver.controls.PropertySheetTouchInteraction:f=twaver.controls.PropertySheetInteraction,f&&new f(this)},_twaver.ext("twaver.controls.PropertySheet",twaver.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:p.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:p.SELECT_COLOR,_categorizable:p.PROPERTYSHEET_CATEGORIZABLE,_editable:p.PROPERTYSHEET_EDITABLE,_propertyNameWidth:p.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:p.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:p.PROPERTYSHEET_SUM_WIDTH,_indent:p.PROPERTYSHEET_INDENT,_rowHeight:p.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:p.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:p.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:p.PROPERTYSHEET_BORDER_COLOR,_expandIcon:p.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:p.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:p.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(c){if(!c){throw"DataBox can not be null"}if(this._box===c){return}var a=this._box;a&&(a.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||a.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=c,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(c):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",a,this._box)},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(a){a.property!=="zoom"&&this.invalidate()},isVisible:function(a){return a.isVisible&&!a.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(a):!0},handlePropertyChange:function(a){this._currentData===a.source&&this.invalidate()},handleSelectionChange:function(a){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(c){if(!c){return !0}var a=this._categoryMap[c];return a?a.isExpanded:p.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(c){if(!c){return}var a=this._categoryMap[c];if(!a||a.isExpanded){return}a.isExpanded=!0,this.invalidate()},expandAll:function(){for(var c in this._categoryMap){var a=this._categoryMap[c];a&&(a.isExpanded=!0)}this.invalidate()},collapse:function(c){if(!c){return}var a=this._categoryMap[c];if(!a||!a.isExpanded){return}a.isExpanded=!1,this.invalidate()},collapseAll:function(){for(var c in this._categoryMap){var a=this._categoryMap[c];a&&(a.isExpanded=!1)}this.invalidate()},getCategoryName:function(c){if(!this.isCategorizable()){return"null"}var a=c.getCategoryName();return a?a:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var z={},C=new h,l=this._currentData?this._propertyBox.getRoots():new h,c,y,D,f,B;f=l.size();for(c=0;c<f;c++){B=l.get(c),this.isVisible(B)&&(C.add(B),D=this.getCategoryName(B),z[D]||(this._categoryList.add(D),z[D]={isExpanded:this.isExpanded(D),properties:new h}))}this._sortFunction&&C.sort(this._sortFunction),this._categoryMap=z,f=C.size();for(c=0;c<this._categoryList.size();c++){D=this._categoryList.get(c),D!=="null"&&this._rowList.add(D);var A=z[D];if(A.isExpanded){for(y=0;y<f;y++){B=C.get(y),this.getCategoryName(B)===D&&(A.properties.add(B),this._rowList.add({view:this,data:this._currentData,property:B,value:this._currentData?this.getValue(this._currentData,B):null}))}}}},adjustWidth:function(){var c=this._view.offsetWidth,a=this._view.offsetHeight;if(c<=this._indent||a<=0){return}c-=this._indent;if(this._rowList.size()*this._rowHeight>a){c-=p.SCROLL_BAR_WIDTH;if(c<=0){return}}this._sumWidth===0||this._propertyNameWidth>this._sumWidth?this._propertyNameWidth=c/2:this._propertyNameWidth=c*(this._propertyNameWidth/this._sumWidth),this._sumWidth=c,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"},validateDisplay:function(){var ab=this._rowList.size(),K=this._borderColor,R=this._indent,O=this._rowHeight,X=this._propertyNameWidth,L=Math.max(0,this._sumWidth-X),Q=this._rowLineWidth,I=this._columnLineWidth,af=O-Q+"px",aa=O-Q-2+"px",V=R+"px",ad=X-I+"px",Y=L-I+"px",P=X+L+"px",ac=Q+"px",H=I+"px",U=X+"px",Z=this._dataDiv,D=Z.style;D.height=ab*O+"px",D.width=R+X+L+"px";var ae=this.__divPool.get();D=ae.style,D.position="absolute",D.left="0px",D.top="0px",D.width=V,D.height=Z.style.height,D.borderWidth="0px",D.backgroundColor=K,Z.appendChild(ae);for(var G=0;G<ab;G++){var J=this._rowList.get(G),A=G*O+"px",F=this.__divPool.get();J.rowDiv=F,D=F.style,D.position="absolute",D.whiteSpace="nowrap",D.overflow="hidden",D.textOverflow="ellipsis",D.left=V,D.top=A,D.width=P,D.height=af,D.lineHeight=aa,D.borderStyle="solid",D.borderWidth="0px",D.borderBottomWidth=ac,D.borderBottomColor=K,Z.appendChild(F);if(typeof J=="string"){D.backgroundColor=K,ae=this.__divPool.get(),D=ae.style,D.position="absolute",D.left="0px",D.top=A,D.width=V,D.height=af,D.lineHeight=aa,D.borderWidth="0px",Z.appendChild(ae);var z=this.__imagePool.get(),B=this.isExpanded(J)?this._expandIcon:this._collapseIcon;z.setAttribute("src",_twaver.getImageSrc(B)),D=z.style,D.verticalAlign="middle",z._expandData=J,ae.appendChild(z),this.renderCategory(F,J),this.onCategoryRendered(F,J)}else{var M=J.property,W=this.__cellPool.get();J.nameRender=W,D=W.style,this._currentRowIndex===G&&(D.backgroundColor=this.getSelectColor()),D.position="absolute",D.verticalAlign="middle",D.textAlign=this._propertyNameHorizontalAlign,D.overflow="hidden",D.textOverflow="ellipsis",D.whiteSpace="nowrap",D.left="0px",D.top="0px",D.width=ad,D.height=af,D.borderStyle="solid",D.borderWidth="0px",D.borderRightWidth=H,D.borderRightColor=K,F.appendChild(W),this.renderName(J),this.onNameRendered(J),W=this.__cellPool.get(),J.valueRender=W,D=W.style,D.position="absolute",D.verticalAlign="middle",D.textAlign=M.getHorizontalAlign(),D.whiteSpace="nowrap",D.overflow="hidden",D.textOverflow="ellipsis",D.left=U,D.top="0px",D.width=Y,D.height=af,D.borderStyle="solid",D.borderWidth="0px",D.borderRightWidth=H,D.borderRightColor=K,F.appendChild(W),this.renderValue(J),this.onValueRendered(J)}}D=this._resizeDiv.style,D.left=R+X-I-this._resizeTolerance+"px",D.width=I+this._resizeTolerance*2+"px",D.height=Z.style.height,Z.appendChild(this._resizeDiv)},renderCategory:function(c,a){var f=this.__textPool.get();style=f.style,style.fontWeight="bold",style.whiteSpace="nowrap",style.overflow="hidden",style.textOverflow="ellipsis",style.verticalAlign="middle",style.padding="1px 2px 1px 2px",f.innerHTML=a,f.setAttribute("title",a),c.appendChild(f)},onCategoryRendered:function(c,a){},renderName:function(c){if(c.property.renderName){c.property.renderName(c);return}var a=this.__textPool.get();style=a.style,style.fontWeight="",style.whiteSpace="nowrap",style.verticalAlign="middle",style.padding="1px 2px 1px 2px";var f=c.property.getName();f||(f=c.property.getPropertyName()),a.innerHTML=f,a.setAttribute("title",f),c.nameRender.appendChild(a)},onNameRendered:function(a){},renderValue:function(f){var a=f.property;if(a.renderValue){a.renderValue(f);return}var l=f.value,c=a.getEnumInfo();c&&c.values&&(l=c.map[l]),f.view.isCellEditable(f.data,a)&&(f.enumInfo=c,f.valueRender._editInfo=f),v.render(a.getValueType(),l,f.valueRender,f.view,a.isInnerText())},onValueRendered:function(a){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var c=this._view.scrollLeft,a=this._view.scrollTop;j.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(f){f.clear()}),this._view.scrollLeft!==c&&(this._view.scrollLeft=c),this._view.scrollTop!==a&&(this._view.scrollTop=a)},getValue:function(c,a){return c?a.getValue(c,this):null},setValue:function(c,a,f){if(!c){return}a.setValue(c,f,this)},isCellEditable:function(c,a){return c?this.isEditable()&&a.isEditable():!1},getRowIndexAt:function(c){var a=this.getLogicalPoint(c);if(!a){return -1}var f=parseInt(a.y/this._rowHeight);return f>=0&&f<this._rowList.size()?f:-1},handleChange:function(a){if(this._isCommitting||this._isCanceling||this._isValidating){return}a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},commitEditValue:function(u,c){var z;c.type==="checkbox"?z=c.checked:z=c.value;var l=u.property,a=l.getValueType();if(a==="int"&&typeof z=="string"){z=parseInt(z)}else{if(a==="number"&&typeof z=="string"){z=parseFloat(z)}else{if(a==="array.string"){z=z.split(",")}else{if(a==="array.number"){z=z.split(",");for(var f=0,y=z.length;f<y;f++){z[f]=parseFloat(z[f])}}}}}this.setValue(u.data,l,z),twaver.Util.setFocus(this._view),this._currentEditor&&(this._rootDiv.removeChild(this._currentEditor),delete this._currentEditor),delete this._isCommitting},cancelEditing:function(){this._currentEditor&&(this._rootDiv.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling)},updateCurrentRowIndex:function(l){var a=this._rowList.size();if(l<0||l>=a){l=-1}var y=this._currentRowIndex,f;l!==y&&(y>=0&&y<a&&(f=this._rowList.get(y),f.nameRender&&(f.nameRender.style.backgroundColor="")),this._currentRowIndex=l);if(l>=0){f=this._rowList.get(l);if(f.nameRender){f.nameRender.style.backgroundColor=this.getSelectColor();if(!this._currentEditor&&f.valueRender&&f.valueRender._editInfo){var c=f.valueRender._editInfo;c.enumInfo?this._currentEditor=j.createSelect(c.enumInfo,c.value):(this._currentEditor=document.createElement("input"),c.value!=null&&(this._currentEditor.value=c.value));if(this._currentEditor){this._currentEditor.addEventListener("keydown",function(r){var o=r.target._editInfo.view;if(r.keyCode===13){if(o._isCommitting){return}o._isCommitting=!0,o.commitEditValue(r.target._editInfo,r.target)}else{r.keyCode===27&&(o._isCanceling=!0,o.cancelEditing())}},!1),this._currentEditor.addEventListener("blur",function(r){var o=r.target._editInfo.view;if(o._isCommitting||o._isCanceling){return}o._isCommitting=!0,o.commitEditValue(r.target._editInfo,r.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=c;var u=this._currentEditor.style;u.position="absolute",u.margin="0px",u.border="0px",u.padding="0px",u.left=this._indent+this._propertyNameWidth+"px",u.top=f.rowDiv.style.top,u.width=f.valueRender.style.width,u.height=f.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor),twaver.Util.setFocus(this._currentEditor)}}}}}}),twaver.controls.PropertySheetInteraction=function(c){this.sheet=c,this.view=c._view,this.resizeDiv=c._resizeDiv;var a=this;this.view.addEventListener("mousedown",function(f){f.button===0&&a.handleMouseDown(f)},!1),this.view.addEventListener("mousemove",function(f){a.handleMouseMove(f)},!1)},_twaver.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(c){if(c.target===this.sheet._currentEditor||c.target.parentNode===this.sheet._currentEditor){return}this.sheet.isFocusOnClick()&&twaver.Util.setFocus(this.view);if(this.sheet._isValidating){return}if(c.target._expandData){var a=c.target._expandData;this.sheet.isExpanded(a)?this.sheet.collapse(a):this.sheet.expand(a)}else{if(c.target===this.resizeDiv){this.lastX=this.getX(c),j.handle_mousedown(this,c)}else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var f=this.sheet.getRowIndexAt(c);this.sheet.updateCurrentRowIndex(f)}}},handleMouseMove:function(c){if(this.lastX==null&&!j.target){this.changeCursor(c);return}if(j.target!==this||this.lastX==null){return}var a=this.getX(c);if(this.stopLeft!=null){if(a<this.stopLeft){return}delete this.stopLeft}if(this.stopRight!=null){if(a>this.stopRight){return}delete this.stopRight}var f=this.sheet.getPropertyNameWidth()+(a-this.lastX);f<this.minGap?(f=this.minGap,this.stopLeft=a):f>this.sheet.getSumWidth()-this.minGap&&(f=this.sheet.getSumWidth()-this.minGap,this.stopRight=a),this.sheet.setPropertyNameWidth(f),this.lastX=a},handleMouseUp:function(a){if(a.button!==0){return}this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX},changeCursor:function(a){this.view.style.cursor=a.target===this.resizeDiv?"ew-resize":"default"},getX:function(a){return a.clientX/this.sheet.getZoom()}}),twaver.controls.PropertySheetTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,j.addEventListener("touchstart","handleTouchstart",this.view,this)},_twaver.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(a){j.preventDefault(a);if(a.target===this.sheet._currentEditor||a.target.parentNode===this.sheet._currentEditor){return}this.sheet.isFocusOnClick()&&twaver.Util.setFocus(this.view);if(this.sheet._isValidating){return}a.target===this.resizeDiv&&(this.lastX=this.getX(a)),this.lastPoint=this.sheet.getLogicalPoint(a),q.isMultiTouch(a)&&(this.distance=q.getDistance(a),this.zoom=this.sheet.getZoom()),j.addEventListener("touchmove","handleTouchmove",this.view,this),j.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(z){this.moved||(this.moved=!0);if(this.lastX==null){if(q.isSingleTouch(z)){if(this.lastPoint){var f=this.sheet.getLogicalPoint(z),B=this.lastPoint.x-f.x,y=this.lastPoint.y-f.y,c=this.sheet.panByOffset(B,y);this.lastPoint.x-=B-c.x,this.lastPoint.y-=y-c.y}}else{if(this.distance){var l=q.getDistance(z)/this.distance;this.sheet.setZoom(this.zoom*l,!1)}}return}var A=this.getX(z);if(this.stopLeft!=null){if(A<this.stopLeft){return}delete this.stopLeft}if(this.stopRight!=null){if(A>this.stopRight){return}delete this.stopRight}var a=this.sheet.getPropertyNameWidth()+(A-this.lastX);a<this.minGap?(a=this.minGap,this.stopLeft=A):a>this.sheet.getSumWidth()-this.minGap&&(a=this.sheet.getSumWidth()-this.minGap,this.stopRight=A),this.sheet.setPropertyNameWidth(a),this.lastX=A},handleTouchend:function(c){if(!this.moved){if(c.target._expandData){var a=c.target._expandData;this.sheet.isExpanded(a)?this.sheet.collapse(a):this.sheet.expand(a)}else{if(c.target!==this.resizeDiv){var f=this.sheet.getRowIndexAt(c);this.sheet.updateCurrentRowIndex(f)}}}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,j.removeEventListener("touchmove",this.view,this),j.removeEventListener("touchend",this.view,this)},getX:function(c){var a=c.changedTouches[0];return a.clientX}}),twaver.controls.SplitPane=function(l,a,o,f){twaver.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=j.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=j.createDiv(),this._dividerDiv.tabIndex=-1,this._view.appendChild(this._dividerDiv),l&&this.setFirstView(l),a&&this.setNextView(a),o&&this.setOrientation(o),f!=null&&this.setPosition(f),this.invalidate();var c;k.isTouchable?c=twaver.controls.SplitPaneTouchInteraction:c=twaver.controls.SplitPaneInteraction,c&&new c(this)},_twaver.ext("twaver.controls.SplitPane",twaver.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground"],_position:p.SPLITPANE_POSITION,_orientation:p.SPLITPANE_ORIENTATION,_dividerWidth:p.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:p.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:p.SPLITPANE_DIVIDER_OPACITY,_maskBackground:p.SPLITPANE_MASK_BACKGROUND,onPropertyChanged:function(a){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(c){c<0&&(c=0),c>1&&(c=1);if(c===this._position){return}var a=this._position;this._position=c,this.firePropertyChange("position",a,c)},setFirstView:function(c){if(this._firstView===c){return}var a=this._firstView;a&&(a.getView?this._view.removeChild(a.getView()):this._view.removeChild(a)),this._firstView=c,c&&(c.getView?this._view.insertBefore(c.getView(),this._dividerDiv):this._view.insertBefore(c,this._dividerDiv)),this.firePropertyChange("firstView",a,c)},getFirstView:function(){return this._firstView},setNextView:function(c){if(this._nextView===c){return}var a=this._nextView;a&&(a.getView?this._view.removeChild(a.getView()):this._view.removeChild(a)),this._nextView=c,c&&(c.getView?this._view.insertBefore(c.getView(),this._dividerDiv):this._view.insertBefore(c,this._dividerDiv)),this.firePropertyChange("nextView",a,c)},getNextView:function(){return this._nextView},validateImpl:function(){var A=this._position,D=this._view.offsetWidth,y=this._view.offsetHeight,c=this._dividerWidth;c>=8||c===0?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=j.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv));if(this._orientation==="horizontal"){c>D&&(c=D);var E=(D-c)*A,l=D-c-E+1;_twaver.setViewBounds(this._firstView,{x:0,y:0,width:E,height:y}),_twaver.setViewBounds(this._nextView,{x:E+c,y:0,width:l,height:y}),_twaver.setViewBounds(this._dividerDiv,{x:E,y:0,width:c,height:y}),this._dividerDiv.position=E,this._coverDiv&&_twaver.setViewBounds(this._coverDiv,{x:c/2-4,y:0,width:8,height:y})}else{c>y&&(c=y);var C=(y-c)*A,B=y-c-C;_twaver.setViewBounds(this._firstView,{x:0,y:0,width:D,height:C}),_twaver.setViewBounds(this._nextView,{x:0,y:C+c,width:D,height:B}),_twaver.setViewBounds(this._dividerDiv,{x:0,y:C,width:D,height:c}),this._dividerDiv.position=C,this._coverDiv&&_twaver.setViewBounds(this._coverDiv,{x:0,y:c/2-4,width:D,height:8})}var z=this._dividerDiv.style;z.background=this._dividerBackground}}),twaver.controls.SplitPaneInteraction=function(c){this.splitPane=c,this.view=c._view,this.dividerDiv=c._dividerDiv;var a=this;this.view.addEventListener("mousedown",function(f){f.button===0&&a.handleMouseDown(f)},!1),this.view.addEventListener("mousemove",function(f){a.handleMouseMove(f)},!1)},_twaver.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(c){if(this.resizeDiv){this.clear(c)}else{if(c.target===this.dividerDiv||c.target===this.splitPane._coverDiv){this.resizeDiv=j.createDiv();var a=this.resizeDiv.style;a.left=this.dividerDiv.style.left,a.top=this.dividerDiv.style.top,a.width=this.dividerDiv.style.width,a.height=this.dividerDiv.style.height,a.opacity=this.splitPane.getDividerOpacity(),a.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?c.clientX:c.clientY,this.resizeDiv.maskDiv=j.createDiv(),a=this.resizeDiv.maskDiv.style,a.left="0px",a.top="0px",a.width=this.view.clientWidth+"px",a.height=this.view.clientHeight+"px",a.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),j.handle_mousedown(this,c),c.preventDefault()}}},handleMouseMove:function(c){if(!this.resizeDiv&&!j.target){var a=this.splitPane._orientation==="horizontal"?"ew-resize":"ns-resize";this.view.style.cursor=c.target===this.dividerDiv||c.target===this.splitPane._coverDiv?a:"default"}else{this.resizeDiv&&j.target===this&&(this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+c.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+c.clientY-this.resizeDiv.lastPosition+"px")}},handleMouseUp:function(a){a.button===0&&this.clear(a)},clear:function(l){if(this.resizeDiv){var c=this.splitPane._dividerWidth,o;if(this.splitPane._orientation==="horizontal"){var f=this.view.clientWidth;c>f&&(c=f),o=this.dividerDiv.position+l.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(o/(f-c))}else{var a=this.view.clientHeight;c>a&&(c=a),o=this.dividerDiv.position+l.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(o/(a-c))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),twaver.controls.SplitPaneTouchInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,j.addEventListener("touchstart","handleTouchstart",this.view,this)},_twaver.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(c){j.preventDefault(c);if(this.resizeDiv){this.clear(c)}else{if(c.target===this.dividerDiv||c.target===this.splitPane._coverDiv){this.resizeDiv=j.createDiv();var a=this.resizeDiv.style;a.left=this.dividerDiv.style.left,a.top=this.dividerDiv.style.top,a.width=this.dividerDiv.style.width,a.height=this.dividerDiv.style.height,a.opacity=this.splitPane.getDividerOpacity(),a.background=this.splitPane.getDividerBackground();var f=c.changedTouches[0];this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?f.clientX:f.clientY,this.resizeDiv.maskDiv=j.createDiv();var a=this.resizeDiv.maskDiv.style;a.left="0px",a.top="0px",a.width=this.view.clientWidth+"px",a.height=this.view.clientHeight+"px",a.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}}j.addEventListener("touchmove","handleTouchmove",this.view,this),j.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(c){if(!!this.resizeDiv){var a=c.changedTouches[0];this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition+"px"}},handleTouchend:function(a){j.removeEventListener("touchmove",this.view,this),j.removeEventListener("touchend",this.view,this),this.clear(a)},clear:function(o){var c=o.changedTouches[0];if(this.resizeDiv){var u=this.splitPane._dividerWidth;if(this.splitPane._orientation==="horizontal"){var l=this.view.clientWidth;u>l&&(u=l);var a=this.dividerDiv.position+c.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(a/(l-u))}else{var f=this.view.clientHeight;u>f&&(u=f);var a=this.dividerDiv.position+c.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(a/(f-u))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),twaver.controls.TabPane=function(){twaver.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new twaver.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=j.createView("hidden",!0),this._tabDiv=j.createDiv(),this._tabDiv.onmousedown=j.preventDefault,this._tabDiv.onkeydown=j.preventDefault,this._contentDiv=j.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new twaver.Pool("div"),this._iconPool=new twaver.Pool("img"),this._closePool=new twaver.Pool("img"),this._textPool=new twaver.Pool("span"),this._resizePool=new twaver.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab();var a;k.isTouchable?a=twaver.controls.TabPaneTouchInteraction:a=twaver.controls.TabPaneInteraction,a&&new a(this)},_twaver.ext("twaver.controls.TabPane",twaver.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:p.TABPANE_TAB_GAP,_tabRadius:p.TABPANE_TAB_RADIUS,_tabHeight:p.TABPANE_TAB_HEIGHT,_resizeTolerance:p.TABPANE_RESIZE_TOLERANCE,_tabOrientation:p.TABPANE_TAB_ORIENTATION,_tabBackground:p.TABPANE_TAB_BACKGROUND,_disabledColor:p.TABPANE_DISABLED_COLOR,_selectBackground:p.TABPANE_SELECT_BACKGROUND,_moveBackground:p.TABPANE_MOVE_BACKGROUND,_insertBackground:p.TABPANE_INSERT_BACKGROUND,_horizontalAlign:p.TABPANE_HORIZONTAL_ALIGN,_closeIcon:p.TABPANE_CLOSE_ICON,_selectNextOnClose:p.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:p.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(a){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(z){if(this._selectNextOnInVisible&&z.property==="visible"&&!z.newValue&&this._tabBox.getSelectionModel().contains(z.source)){var f=z.source,B=this._tabBox.getRoots().indexOf(f),y=this._tabBox.getRoots(),c=y.size(),l=B,A,a;while(l<c-1){A=y.get(++l);if(A.isVisible()&&!A.isDisabled()){a=A;break}}if(!a){l=B;while(l>0){A=y.get(--l);if(A.isVisible()&&!A.isDisabled()){a=A;break}}}this._tabBox.getSelectionModel().setSelection(a)}this.invalidateTab()},invalidateTab:function(a){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(a))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var c=this._view.offsetWidth,a=this._view.offsetHeight,f;this._tabOrientation==="top"?(this._tabDiv.style.top="0px",f={x:0,y:this._tabHeight,width:c,height:Math.max(0,a-this._tabHeight)}):(this._tabDiv.style.top=a-this._tabHeight+"px",f={x:0,y:0,width:c,height:Math.max(0,a-this._tabHeight)}),this._currentView&&_twaver.setViewBounds(this._currentView,f)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(a){},onViewAdded:function(a){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var G=this._currentTab?this._currentTab.getView():null;if(G!==this._currentView){var M,B;this._currentView&&(M=this._currentView.getView?this._currentView.getView():this._currentView,M.style.visibility="hidden",this.onViewRemoved(this._currentView)),G&&(B=G.getView?G.getView():G,B.style.visibility="visible",B.parentNode||this._contentDiv.appendChild(B),this.onViewAdded(G)),this._currentView=G}j.release(this._tabDiv);var y=this._tabBox.getRoots(),N=this._tabHeight+"px",A=this._tabHeight-2+"px",L=this._tabRadius+"px",J=y.size(),F=0;for(var D=0;D<J;D++){var I=y.get(D);if(I.isVisible()){var E=this._currentTab===I,z=I.getWidth();z<0&&(z=0);var H=Math.min(this._tabGap,z),K=this._divPool.get();K._tab=I;var C=K.style;C.position="absolute",C.whiteSpace="nowrap",C.lineHeight=A,C.overflow="hidden",C.textOverflow="ellipsis",C.background=E?this._selectBackground:this._tabBackground,C.textAlign=this._horizontalAlign,this._tabOrientation==="top"?(C.borderTopLeftRadius=L,C.borderTopRightRadius=L,C.borderBottomLeftRadius="0px",C.borderBottomRightRadius="0px"):(C.borderTopLeftRadius="0px",C.borderTopRightRadius="0px",C.borderBottomLeftRadius=L,C.borderBottomRightRadius=L),C.left=F+"px",C.width=z-H+"px",C.height=N,K._x=F,K._width=z-H,this.renderTab(K,I),this.onTabRendered(K,I),this._tabDiv.insertBefore(K,this._tabDiv.firstChild),F+=z,I.isResizable()&&(K=this._resizePool.get(),K._resizeTab=I,C=K.style,C.position="absolute",C.backgroundColor="white",C.opacity=0,C.left=F-H-this._resizeTolerance+"px",C.width=H+this._resizeTolerance*2+"px",C.height=N,this._tabDiv.appendChild(K))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=F+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(a){a.clear()})},renderTab:function(z,f){if(f.renderTab){f.renderTab(z)}else{var B=f.getIcon();if(B){var y=this._iconPool.get();y.setAttribute("src",_twaver.getImageSrc(B)),y.style.paddingLeft="4px",y.style.verticalAlign="middle",z.appendChild(y)}var c=f.getName();if(c){var l=this._textPool.get();l.style.whiteSpace="nowrap",l.style.verticalAlign="middle",l.style.padding="2px 4px",l.innerHTML=c,z.appendChild(l)}if(k.isOpera){var A=z.cloneNode(!1);A.style.left="0px",A.style.top="0px",A.style.opacity=0,z.appendChild(A)}}if(f.isClosable()){var a=this._tabRadius/4+2,y=this._closePool.get();y._closeTab=f,y.setAttribute("src",_twaver.getImageSrc(this._closeIcon)),y.style.position="absolute",y.style.top=a+"px",y.style.right=a+"px",z.appendChild(y)}f.isDisabled()?z.style.color=this.getDisabledColor():z.style.color=""},onTabRendered:function(c,a){}}),twaver.controls.TabPaneInteraction=function(c){this.tabPane=c,this.view=c.getTabDiv();var a=this;this.view.addEventListener("mousedown",function(f){a.handleMouseDown(f)},!1),this.view.addEventListener("mousemove",function(f){a.handleMouseMove(f)},!1)},_twaver.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(a){if(a.button!==0){return}if(this.movableDiv){this.handleMouseUp(a);return}this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this.lastX=this.getX(a),this._startClient=j.getClientPoint(a),this._startLogicalX=this.lastX,j.handle_mousedown(this,a)},changeCursor:function(c){var a="";if(c.target._resizeTab){a="ew-resize"}else{var f=this.getTabAt(c);f&&(!f.isDisabled()||f.isMovable())&&(a="pointer")}this.view.style.cursor=a},handleMouseMove:function(l){if(this.lastX==null){this.changeCursor(l);return}if(j.target!==this){return}var a=this._startLogicalX+l.clientX-this._startClient.x;if(this.resizeTab){if(this.stopX!=null){if(a<this.stopX){return}delete this.stopX}var o=this.resizeTab.getWidth()+(a-this.lastX);o<10&&(o=10,this.stopX=a),this.resizeTab.setWidth(o),this.lastX=a}else{if(this.movableDiv){var f=a-this.lastX;if(!this.cloneDiv){if(Math.abs(f)<3){return}this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=j.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var c=this.cloneDiv._x+f;this.cloneDiv.style.left=c+"px",this.cloneDiv._x=c,this.lastX=a,this.tabInfo=this.getTabInfoAt(l),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}}},handleMouseUp:function(l){if(l.button!==0){return}if(!this.resizeTab){if(this.movableDiv&&this.tabInfo){var c=this.movableDiv._tab,o=this.tabInfo.index;this.tabPane.getTabBox().moveTo(c,o)}else{var f=this.tabPane.getTabBox(),c=l.target._closeTab;if(c){if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===c){var a=f.getRoots(),o=a.indexOf(c);f.remove(c),a.size()>0&&(o>=a.size()&&(o=a.size()-1),f.getSelectionModel().setSelection(a.get(o)))}else{f.remove(c)}}else{var c=this.getTabAt(l);c&&!c.isDisabled()&&f.getSelectionModel().setSelection(c)}}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._tab)){c=c.parentNode}return a},getMovableDivAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._tab)){c=c.parentNode}return a&&a.isMovable()?c:null},getX:function(c){var a=j.getLogicalPoint(this.view,c);return a?a.x:null},getTabInfoAt:function(E){var I=this._startLogicalX+E.clientX-this._startClient.x,A=this.tabPane.getTabBox().getRoots(),y=A.size(),C=0,J=!1;for(var z=0;z<y;z++){var H=A.get(z);H===this.movableDiv._tab&&(J=!0);if(H.isVisible()){var G=H.getWidth();if(G<=0){continue}if(I>=C&&I<=C+G){var D=I<C+G/2;J&&(H!==this.movableDiv._tab||!D)&&z--;var B=D?Math.max(0,z):Math.min(z+1,y),F=D?C:C+G;return F=Math.max(0,F-1),{index:B,tab:H,position:F+"px"}}C+=G}}return this.tabInfo}}),twaver.controls.TabPaneTouchInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv(),j.addEventListener("touchstart","handleTouchstart",this.view,this)},_twaver.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(a){j.preventDefault(a);if(this.movableDiv){this.handleTouchend(a);return}this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),j.addEventListener("touchmove","handleTouchmove",this.view,this),j.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(l){if(this.lastX==null){return}if(this.resizeTab){var a=this.getX(l);if(this.stopX!=null){if(a<this.stopX){return}delete this.stopX}var o=this.resizeTab.getWidth()+(a-this.lastX);o<0&&(o=0,this.stopX=a),this.resizeTab.setWidth(o),this.lastX=a}else{if(this.movableDiv){var a=this.getX(l),f=a-this.lastX;if(!this.cloneDiv){if(Math.abs(f)<3){return}this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=j.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var c=this.cloneDiv._x+f;this.cloneDiv.style.left=c+"px",this.cloneDiv._x=c,this.lastX=a,this.tabInfo=this.getTabInfoAt(l),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}}},handleTouchend:function(l){if(!this.resizeTab){if(this.movableDiv&&this.tabInfo){var a=this.movableDiv._tab,o=this.tabInfo.index;this.tabPane.getTabBox().moveTo(a,o)}else{var f=this.tabPane.getTabBox(),a=l.target._closeTab;if(a){if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===a){var c=f.getRoots(),o=c.indexOf(a);f.remove(a),c.size()>0&&(o>=c.size()&&(o=c.size()-1),f.getSelectionModel().setSelection(c.get(o)))}else{f.remove(a)}}else{var a=this.getTabAt(l);a&&!a.isDisabled()&&f.getSelectionModel().setSelection(a)}}}this.clear(),j.removeEventListener("touchmove",this.view,this),j.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._tab)){c=c.parentNode}return a},getMovableDivAt:function(c){c=c.target;var a;while(c&&c!==this.view&&!(a=c._tab)){c=c.parentNode}return a&&a.isMovable()?c:null},getX:function(c){var a=j.getLogicalPoint(this.view,c);return a?a.x:null},getTabInfoAt:function(E){var I=this.getX(E),A=this.tabPane.getTabBox().getRoots(),y=A.size(),C=0,J=!1;for(var z=0;z<y;z++){var H=A.get(z);H===this.movableDiv._tab&&(J=!0);if(H.isVisible()){var G=H.getWidth();if(G<=0){continue}if(I>=C&&I<=C+G){var D=I<C+G/2;J&&(H!==this.movableDiv._tab||!D)&&z--;var B=D?Math.max(0,z):Math.min(z+1,y),F=D?C:C+G;return F=Math.max(0,F-1),{index:B,tab:H,position:F+"px"}}C+=G}}return this.tabInfo}}),twaver.controls.TitlePane=function(c,a,f){twaver.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=j.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=j.preventDefault,this._span=document.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=document.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=j.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),a&&this.setTitle(a),c&&this.setContent(c),f&&this.setIcon(f)},_twaver.ext("twaver.controls.TitlePane",twaver.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:p.TITLEPANE_TITLE_HEIGHT,_titleBackground:p.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:p.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(c){if(this._content===c){return}var a=this._content;a&&(a.getView?this._view.removeChild(a.getView()):this._view.removeChild(a)),this._content=c,c&&(c.getView?this._view.appendChild(c.getView()):this._view.appendChild(c)),this.firePropertyChange("content",a,c)},validateImpl:function(){var c=this._view.offsetWidth,a=this._view.offsetHeight,f=this._titleDiv.style;f.textAlign=this._titleHorizontalAlign,f.lineHeight=this._titleHeight-2+"px",f.background=this._titleBackground,j.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",_twaver.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var f=this._titleDiv.style;f.left="0px",f.top="0px",f.width=c+"px",f.height=this._titleHeight+"px",_twaver.setViewBounds(this._content,{x:0,y:this._titleHeight,width:c,height:Math.max(a-this._titleHeight,0)})}}),twaver.controls.Accordion=function(){twaver.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new h,this._currentTitle=null,this._currentView=null,this._view=j.createView("hidden",!0),this.invalidate();var a=this;this._view.addEventListener("mousedown",function(c){a.handleMouseDown(c)},!1)},_twaver.ext("twaver.controls.Accordion",twaver.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor"],_expandIcon:p.ACCORDION_EXPAND_ICON,_collapseIcon:p.ACCORDION_COLLAPSE_ICON,_titleHeight:p.ACCORDION_TITLE_HEIGHT,_titleBackground:p.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:p.ACCORDION_BORDER_BOTTOM_COLOR,onPropertyChanged:function(a){this.invalidate()},handleMouseDown:function(c){if(c.button!==0){return}var a=c.target._title;a||(a=c.target.parentNode._title),a&&(this._currentTitle===a?this.collapse():this.expand(a))},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(l,a){if(this._titleMap[l]){throw"Title ' + title + ' already exists"}var o=j.createDiv();o._title=l,o.onmousedown=j.preventDefault,o.style.cursor="pointer",o.style.textAlign="left",o.style.textOverflow="ellipsis",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.borderBottomWidth="1px",o.style.borderBottomStyle="solid";var f=document.createElement("img");f.style.verticalAlign="middle",f.style.paddingLeft="4px";var c=document.createElement("span");c.style.verticalAlign="middle",c.style.paddingLeft="4px",c.innerHTML=l,c.setAttribute("title",l),this._view.appendChild(o),o.appendChild(f),o.appendChild(c),this._titleMap[l]={content:a,titleDiv:o,span:c,img:f},this._titleList.add(l),this.invalidate()},remove:function(a){delete this._titleMap[a],this._titleList.remove(a),this.invalidate()},clear:function(){this._titleMap={},this._titleList.clear(),this.invalidate()},expand:function(a){this._titleMap[a]&&this._currentTitle!==a&&(this._currentTitle=a,this.onExpanded(a),this.invalidate())},onExpanded:function(a){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(a){},validateImpl:function(){var E=this._currentView;this._currentView=null;var I=this._view.offsetWidth,A=this._view.offsetHeight,y=this._titleList.size(),C=0;for(var J=0;J<y;J++){var z=this._titleList.get(J),H=this._titleMap[z],G=H.titleDiv.style;G.lineHeight=this._titleHeight-3+"px",G.background=this._titleBackground,G.borderBottomColor=this._borderBottomColor,G.left="0px",G.top=C+"px",G.width=I+"px",G.height=this._titleHeight-1+"px";var D=this._currentTitle===z,B=D?this._expandIcon:this._collapseIcon;H.img.setAttribute("src",_twaver.getImageSrc(B));if(D){var F=Math.max(0,A-y*this._titleHeight);H.content&&(this._currentView=H.content.getView?H.content.getView():H.content,_twaver.setViewBounds(H.content,{x:0,y:C+this._titleHeight,width:I,height:F})),C+=this._titleHeight+F}else{C+=this._titleHeight}}this._currentView&&this._currentView!==E&&this._view.appendChild(this._currentView),E&&E!==this._currentView&&this._view.removeChild(E)}}),twaver.controls.BorderPane=function(l,a,o,f,c){twaver.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=j.createView("hidden",!0),this._view.tabIndex=-1,l&&this.setCenter(l),a&&this.setTop(a),o&&this.setRight(o),f&&this.setBottom(f),c&&this.setLeft(c)},_twaver.ext("twaver.controls.BorderPane",twaver.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:p.BORDERPANE_HGAP,_vGap:p.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(a){this.invalidate()},getCenter:function(){return this._center},setCenter:function(a){this._setContent("center",a)},getTop:function(){return this._top},setTop:function(a){this._setContent("top",a)},getRight:function(){return this._right},setRight:function(a){this._setContent("right",a)},getBottom:function(){return this._bottom},setBottom:function(a){this._setContent("bottom",a)},getLeft:function(){return this._left},setLeft:function(a){this._setContent("left",a)},_setContent:function(c,a){var f=this["_"+c];if(f===a){return}f&&(f.getView?this._view.removeChild(f.getView()):this._view.removeChild(f)),this["_"+c]=a,a&&(a.getView?this._view.appendChild(a.getView()):this._view.appendChild(a)),this.firePropertyChange(c,f,a)},validateImpl:function(){var E=this._view.offsetWidth,I=this._view.offsetHeight,A=0,y=0,C=E,J=I,z=0,H=0,G=0,D=0;this._top&&(z=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),y=z+this._vGap),this._bottom&&(H=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),J=I-H-this._vGap),this._left&&(G=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),A=G+this._hGap),this._right&&(D=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),C=E-D-this._hGap);var B=Math.max(0,C-A),F=Math.max(0,J-y);this._top&&_twaver.setViewBounds(this._top,{x:0,y:0,width:E,height:z}),this._bottom&&_twaver.setViewBounds(this._bottom,{x:0,y:J,width:E,height:H}),this._left&&_twaver.setViewBounds(this._left,{x:0,y:y,width:G,height:F}),this._right&&_twaver.setViewBounds(this._right,{x:C,y:y,width:D,height:F}),this._center&&_twaver.setViewBounds(this._center,{x:A,y:y,width:B,height:F})}}),twaver.controls.PopupMenu=function(c){this._view=j.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(c);var a=this._view,f=this;a.addEventListener("mouseover",function(l){f._mouseOver=!0},!1),a.addEventListener("mouseout",function(l){f._mouseOver=!1},!1),a.oncontextmenu=function(l){l.preventDefault()},j.addEventListener("mousedown","_handleClick",a,this)},_twaver.ext("twaver.controls.PopupMenu",Object,{_width:200,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"#C2CFF1",getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(c){this._removeContextmenuListener(),this._contextView=c;if(c){var a=c.getView?c.getView():c;k.isTouchable?(a.addEventListener("touchstart",this._getTouchStartListener(),!1),a.addEventListener("touchmove",this._getTouchMoveListener(),!1),a.addEventListener("touchend",this._getTouchEndListener(),!1)):j.addEventListener("contextmenu","_handleContextmenu",a,this)}},getMenuItems:function(){return this._items},setMenuItems:function(c){this._items=[],this._itemsMap={};if(c){for(var a=0,f=c.length;a<f;a++){this.addMenuItem(c[a])}}},addMenuItem:function(a){a.separator!==!0&&(this._itemsMap[a.id||a.label]=a),this._items.push(a)},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(a){return this._itemsMap[a]},isVisible:function(a){return a.visible!==!1},isEnabled:function(a){return a.enabled!==!1},show:function(y){this.hide();var c=this._view,A=this._view.style,l,f;k.isTouchable?(l=y.changedTouches[0].clientX,f=y.changedTouches[0].clientY):(l=y.clientX,f=y.clientY),j.clear(c),this.renderMenu(c,this._items);if(this._height===0){return}j.addEventListener(k.isTouchable?"touchstart":"mousedown","_handleBodyClicked",document.body,this);var z=j.windowWidth()-this._width-10,a=height=j.windowHeight()-this._height-10;l=l>z?z:l,f=f>a?a:f,l=l<0?0:l,f=f<0?0:f,A.left=l+q.scrollLeft()+"px",A.top=f+q.scrollTop()+"px",document.body.appendChild(c)},hide:function(){document.body.contains(this._view)&&document.body.removeChild(this._view),delete this._mouseOver,j.removeEventListener(k.isTouchable?"touchstart":"mousedown",document.body,this)},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(a){return !0},onAction:function(a){},renderMenu:function(u,c){var z=u.style;z.background=this._background,z.border=this._border,z.width=this._width+"px",this._height=0,delete this._separator;for(var l=0,a=c.length,f;l<a;l++){f=c[l];if(this.isVisible(f)){if(f.separator===!0){this._separator=!0}else{var y=document.createElement("div");this.isEnabled(f)&&this._addMouseoverListener(y),y.menuItem=f,this._view.appendChild(y),this.renderMenuItem(y,f),this.onMenuItemRendered(y,f),this._separator=!1,this._height+=this._menuItemHeight}}}},renderMenuItem:function(o,c){var u=o.style;u.height=this._menuItemHeight+"px",this._separator&&(u.borderTop="1px solid gray"),this.isEnabled(c)||(u.color=this._disabledColor);var l=document.createElement("span");u=l.style,u.position="absolute",u.width="25px",u.height=this._menuItemHeight+"px",u.lineHeight=this._menuItemHeight+"px",u.textAlign="center",o.appendChild(l);if(c.icon){var a=new Image;a.src=c.icon,l.appendChild(a)}var f=document.createElement("label");_twaver.setText(f,c.label,!0),u=f.style,u.position="absolute",u.height=this._menuItemHeight+"px",u.lineHeight=this._menuItemHeight+"px",u.left="25px",o.appendChild(f)},onMenuItemRendered:function(c,a){},_addMouseoverListener:function(c){var a=this;c.addEventListener("mouseover",function(e){c.style.background=a._focusColor,c.style.color="#FFFFFF"},!1),c.addEventListener("mouseout",function(e){c.style.background=a._background,c.style.color="#000000"},!1)},_removeContextmenuListener:function(){var a=this._contextView;a&&(a=a.getView?a.getView():a,k.isTouchable?(a.removeEventListener("touchstart",this._getTouchStartListener(),!1),a.removeEventListener("touchmove",this._getTouchMoveListener(),!1),a.removeEventListener("touchend",this._getTouchEndListener(),!1)):j.removeEventListener("contextmenu",a,this))},_handleContextmenu:function(a){this.onMenuShowing(a)===!0&&this.show(a),a.preventDefault()},_handleBodyClicked:function(c){if(k.isTouchable){var a=c.target;while(a&&a!==this._view){a=a.parentElement}a!==this._view&&this.hide()}else{this._mouseOver||this.hide()}},_handleClick:function(c){if(c.button!==0){return}var a=c.target;while(!a.menuItem&&a.parentElement){a=a.parentElement}var f=a?a.menuItem:null;f&&this.isEnabled(f)&&(f.action&&f.action(),this.onAction(f),this.hide())},_getTouchStartListener:function(){if(!this._touchStartListener){var a=this;this._touchStartListener=function(c){a._touchMoved=!1,a._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var a=this;this._touchMoveListener=function(c){a._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var a=this;this._touchEndListener=function(c){!a._touchMoved&&(new Date).getTime()-a._lastTouch.getTime()>1000&&a._handleContextmenu(c)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(a){this._width=a},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(a){this._menuItemHeight=a},getBackground:function(){return this._background},setBackground:function(a){this._background=a},getBorder:function(){return this._border},setBorder:function(a){this._border=a},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(a){this._disabledColor=a},getFocusColor:function(){return this._focusColor},setFocusColor:function(a){this._focusColor=a}})})(window);(function(d,b){var f=twaver.List,c=twaver.Node,a=twaver.Group;twaver.JsonSerializer=function(h,g,j){this.dataBox=h,this.settings=g?g:new twaver.SerializationSettings,this.filterFunction=j,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},_twaver.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:twaver.Util.getVersion(),platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this);if(this.settings.isDataBoxSerializable){var g={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=g,this.dataBox.serializeJson(this,this.dataBox.newInstance(),g),_twaver.isEmptyObject(g.p)&&delete g.p,_twaver.isEmptyObject(g.s)&&delete g.s,_twaver.isEmptyObject(g.c)&&delete g.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(g){this.refMap[g.getId()]=this.ref++,g.getChildren().forEach(this.initRefs,this)},isSerializable:function(g){return this.dataBox.contains(g)?this.filterFunction&&!this.filterFunction(g)?!1:!0:!1},serializeData:function(j){if(this.isSerializable(j)){var g=j.newInstance(),k=this.refMap[j.getId()],h={"class":j.getClassName(),ref:k,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=j.getId()),this.jsonObject.datas.push(h),j.serializeJson(this,g,h),_twaver.isEmptyObject(h.p)&&delete h.p,_twaver.isEmptyObject(h.s)&&delete h.s,_twaver.isEmptyObject(h.c)&&delete h.c}j.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(l,h,p,k){var g=this.settings.getPropertyType(h);if(g){var j=_twaver.getValue(l,h,g),m=_twaver.getValue(p,h,g);j!==m&&this.serializeValue(h,j,m,g,k.p)}},serializeStyleJson:function(l,h,p,k){var g=this.settings.getStyleType(h);if(g){var j=l.getStyle(h),m=p.getStyle(h);j!=m&&this.serializeValue(h,j,m,g,k.s)}},serializeClientJson:function(l,h,p,k){var g=this.settings.getClientType(h);if(g!=null){var j=l.getClient(h),m=p.getClient(h);j!=m&&this.serializeValue(h,j,m,g,k.c)}},serializeValue:function(l,h,k,g,j){if(h==null){j[l]=null}else{if(h instanceof f){j[l]=h._as}else{if(g==="data"){var m=this.refMap[h.getId()];m!=null&&(j[l]=m)}else{j[l]=h}}}},deserialize:function(p,w){_twaver.isDeserializing=!0,this.jsonObject=JSON.parse(p),this.refMap={},this.idMap={};var g=new f,k=new f,x,h=this.jsonObject.datas.length;for(var v=0;v<h;v++){var q=this.jsonObject.datas[v],m=q["class"],j=this.settings.getPropertyType("id");if(j&&q.id!=null){if(q.action==="remove"){this.dataBox.removeById(q.id);continue}x=this.dataBox.getDataById(q.id),x||(x=_twaver.newInstance(m,q.id))}else{x=_twaver.newInstance(m)}q.ref!=null&&(this.refMap[q.ref]=x),g.add(x),k.add(q),this.idMap[x.getId()]=x}this.dataBox.forEach(function(l){this.idMap[l.getId()]=l},this),h=g.size();for(v=0;v<h;v++){x=g.get(v),x.deserializeJson(this,k.get(v))}for(v=0;v<h;v++){x=g.get(v);if(this.dataBox.containsById(x.getId())){continue}w&&!x.getParent()&&x.setParent(w),this.dataBox.add(x)}this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),_twaver.isDeserializing=!1},deserializePropertyJson:function(j,g,k){var h=this.settings.getPropertyType(k);h&&_twaver.setValue(j,k,this.deserializeValue(g,h))},deserializeStyleJson:function(j,g,k){var h=this.settings.getStyleType(k);h&&j.setStyle(k,this.deserializeValue(g,h))},deserializeClientJson:function(j,g,k){var h=this.settings.getClientType(k);h&&j.setClient(k,this.deserializeValue(g,h))},deserializeValue:function(j,g){if(g==="data"){var h=this.refMap[j];return h?h:this.idMap[j]}return j instanceof Array?new f(j):j}}),_twaver.addMethod(twaver.Data,{serializeJson:function(j,g,k){if(j.settings.isClientSerializable&&this._clientMap){for(var h in this._clientMap){this.serializeClientJson(j,h,g,k)}}this.serializePropertyJson(j,"name",g,k),this.serializePropertyJson(j,"icon",g,k),this.serializePropertyJson(j,"toolTip",g,k),this.serializePropertyJson(j,"parent",g,k)},serializePropertyJson:function(j,g,k,h){j.serializePropertyJson(this,g,k,h)},serializeClientJson:function(j,g,k,h){j.serializeClientJson(this,g,k,h)},deserializeJson:function(h,g){var j;for(j in g.p){this.deserializePropertyJson(h,g.p[j],j)}if(h.settings.isClientSerializable){for(j in g.c){this.deserializeClientJson(h,g.c[j],j)}}},deserializePropertyJson:function(h,g,j){h.deserializePropertyJson(this,g,j)},deserializeClientJson:function(h,g,j){h.deserializeClientJson(this,g,j)}}),_twaver.addMethod(twaver.Element,{serializeJson:function(k,h,l){if(k.settings.isStyleSerializable&&this._styleMap){for(var j in this._styleMap){this.serializeStyleJson(k,j,h,l)}}twaver.Element.superClass.serializeJson.call(this,k,h,l),this.serializePropertyJson(k,"layerId",h,l);if(this._alarmState.getHighestNativeAlarmSeverity()&&k.settings.getPropertyType("alarmState")==="alarmstate"){var g={n:{},a:{}};l.p.alarmState=g,twaver.AlarmSeverity.forEach(function(o){var m=this.getNewAlarmCount(o);m>0&&(g.n[o.name]=m)},this._alarmState),twaver.AlarmSeverity.forEach(function(o){var m=this.getAcknowledgedAlarmCount(o);m>0&&(g.a[o.name]=m)},this._alarmState),_twaver.isEmptyObject(g.n)&&delete g.n,_twaver.isEmptyObject(g.a)&&delete g.a,_twaver.isEmptyObject(g)&&delete l.p.alarmState}},serializeStyleJson:function(j,g,k,h){j.serializeStyleJson(this,g,k,h)},deserializeJson:function(h,g){twaver.Element.superClass.deserializeJson.call(this,h,g);if(h.settings.isStyleSerializable){for(var j in g.s){this.deserializeStyleJson(h,g.s[j],j)}}},deserializeStyleJson:function(h,g,j){h.deserializeStyleJson(this,g,j)},deserializePropertyJson:function(j,g,k){if(k==="alarmState"){if(j.settings.getPropertyType("alarmState")==="alarmstate"){var h;for(h in g.n){this._alarmState.setNewAlarmCount(twaver.AlarmSeverity.getByName(h),g.n[h])}for(h in g.a){this._alarmState.setAcknowledgedAlarmCount(twaver.AlarmSeverity.getByName(h),g.a[h])}}}else{twaver.Element.superClass.deserializePropertyJson.call(this,j,g,k)}}}),_twaver.addMethod(c,{serializeJson:function(h,g,j){c.superClass.serializeJson.call(this,h,g,j),this.serializePropertyJson(h,"image",g,j),this.serializePropertyJson(h,"location",g,j),_twaver.num(this._width)&&this._width>=0&&this.serializePropertyJson(h,"width",g,j),_twaver.num(this._height)&&this._height>=0&&this.serializePropertyJson(h,"height",g,j)}}),_twaver.addMethod(twaver.Link,{serializeJson:function(h,g,j){twaver.Link.superClass.serializeJson.call(this,h,g,j),this.serializePropertyJson(h,"fromNode",g,j),this.serializePropertyJson(h,"toNode",g,j)}}),_twaver.addMethod(twaver.Follower,{serializeJson:function(h,g,j){twaver.Follower.superClass.serializeJson.call(this,h,g,j),this.serializePropertyJson(h,"host",g,j)}}),_twaver.addMethod(a,{serializeJson:function(h,g,j){a.superClass.serializeJson.call(this,h,g,j),this.serializePropertyJson(h,"expanded",g,j)}}),_twaver.addMethod(twaver.ShapeNode,{serializeJson:function(h,g,j){twaver.ShapeNode.superClass.serializeJson.call(this,h,g,j),this.serializePropertyJson(h,"points",g,j),this.serializePropertyJson(h,"segments",g,j)}}),_twaver.addMethod(twaver.ShapeLink,{serializeJson:function(h,g,j){twaver.ShapeLink.superClass.serializeJson.call(this,h,g,j),this.serializePropertyJson(h,"points",g,j)}}),_twaver.addMethod(twaver.RotatableNode,{serializeJson:function(h,g,j){twaver.RotatableNode.superClass.serializeJson.call(this,h,g,j),this.serializePropertyJson(h,"angle",g,j)}}),_twaver.addMethod(twaver.DataBox,{serializeJson:function(j,g,k){if(j.settings.isClientSerializable&&this._clientMap){for(var h in this._clientMap){this.serializeClientJson(j,h,g,k)}}this.serializePropertyJson(j,"name",g,k),this.serializePropertyJson(j,"icon",g,k),this.serializePropertyJson(j,"toolTip",g,k)},serializePropertyJson:function(j,g,k,h){j.serializePropertyJson(this,g,k,h)},serializeClientJson:function(j,g,k,h){j.serializeClientJson(this,g,k,h)},deserializeJson:function(h,g){var j;for(j in g.p){this.deserializePropertyJson(h,g.p[j],j)}if(h.settings.isClientSerializable){for(j in g.c){this.deserializeClientJson(h,g.c[j],j)}}},deserializePropertyJson:function(h,g,j){h.deserializePropertyJson(this,g,j)},deserializeClientJson:function(h,g,j){h.deserializeClientJson(this,g,j)}}),_twaver.addMethod(twaver.ElementBox,{serializeJson:function(j,g,k){j.settings.isLayerBoxSerializable&&(k.layers=[],this._layerBox.forEachByDepthFirst(function(m){var l={};k.layers.push(l),this._layerBox.getDefaultLayer()!==m&&(l.id=m.getId()),m.getName()&&(l.name=m.getName()),l.visible=m.isVisible(),l.editable=m.isEditable(),l.movable=m.isMovable()},null,this));if(j.settings.isStyleSerializable&&this._styleMap){for(var h in this._styleMap){this.serializeStyleJson(j,h,g,k)}}twaver.ElementBox.superClass.serializeJson.call(this,j,g,k)},serializeStyleJson:function(j,g,k,h){j.serializeStyleJson(this,g,k,h)},deserializeStyleJson:function(h,g,j){h.deserializeStyleJson(this,g,j)},deserializeJson:function(l,h){twaver.ElementBox.superClass.deserializeJson.call(this,l,h);if(l.settings.isLayerBoxSerializable&&h.layers){this._layerBox.clear();if(h.layers){var p=h.layers.length;for(var k=0;k<p;k++){var g,j=h.layers[k];j.id!=null?(g=new twaver.Layer(j.id),this._layerBox.add(g)):(g=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(g)),j.name&&g.setName(j.name),j.visible!=null&&g.setVisible(j.visible),j.editable!=null&&g.setEditable(j.editable),j.movable!=null&&g.setMovable(j.movable)}}}if(l.settings.isStyleSerializable){for(var m in h.s){this.deserializeStyleJson(l,h.s[m],m)}}}})})(window);(function(aT,aC){var aK=_twaver.math,aE=_twaver.html,aD=twaver.List,aJ=twaver.Node,aB=twaver.Group;twaver.layout.SpringLayouter=function(a){this._network=a,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new aD,this._slinks=new aD,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},_twaver.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:0.6,_linkRepulsionFactor:0.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:0.01,start:function(){if(this._timer){return}var a=this,b=function(){a.relax.call(a)};this._timer=aT.setInterval(b,this._interval),this._damper=1},stop:function(){this._timer&&(aT.clearInterval(this._timer),this._timer=null)},relax:function(){if(this._damper<0.1&&this._maxMotion<this._motionLimit){return}this._rebuild();var f=this._snodes.size();for(var b=0;b<this._stepCount;b++){this._slinks.forEach(this._relaxLink,this);for(var h=0;h<f;h++){for(var d=0;d<f;d++){var a=this._snodes.get(h),c=this._snodes.get(d);a!=c&&this._relaxNodePair(a,c)}}this._moveNodes()}this._isAdjusting=!0;for(var b=0;b<f;b++){var g=this._snodes.get(b);g.fix||g.element.setLocation(g.x,g.y)}this._isAdjusting=!1},isRunning:function(){return !!this._timer},getNetwork:function(){return this._network},isVisible:function(a){return this._network.isVisible(a)},isMovable:function(a){return this._network.isMovable(a)?this._network.getSelectionModel().contains(a)?!1:a instanceof aB?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(a){a<0.02&&(a=0.02),this._nodeRepulsionFactor=a,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(a){a<0.02&&(a=0.02),this._linkRepulsionFactor=a,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(a){this._stepCount=a,this._damper=1},getInterval:function(){return this._interval},setInterval:function(a){if(this._interval===a){return}this._interval=a;if(this._timer){aT.clearInterval(this._timer);var c=this,b=function(){c.relax.call(c)};this._timer=aT.setInterval(b,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},_handleDataPropertyChange:function(a){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(a){this._network.getElementBox().size()===0?this._damper=0:this._damper=1},_handleNetworkPropertyChange:function(b){if(b.property==="elementBox"){var a=b.oldValue;a!=null&&(a.removeDataBoxChangeListener(this._handleDataBoxChange,this),a.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(g){var k=g.toNode.x-g.fromNode.x,d=g.toNode.y-g.fromNode.y,b=Math.sqrt(k*k+d*d),f=k*0.25,l=d*0.25;f/=g.length*100;var c=g.length,j=c*100,h=l;l/=j,h/=g.length*100,g.toNode.dx=g.toNode.dx-f*b,g.toNode.dy=g.toNode.dy-l*b,g.fromNode.dx=g.fromNode.dx+f*b,g.fromNode.dy=g.fromNode.dy+l*b},_relaxNodePair:function(g,k){var d=0,b=0,f=g.x-k.x,l=g.y-k.y,c=f*f+l*l;c===0?(d=Math.random(),b=Math.random()):c<360000&&(d=f/c,b=l/c);var j=g.repulsion*k.repulsion/100,h=j*0.25;g.dx+=d*h,g.dy+=b*h,k.dx-=d*h,k.dy-=b*h},_moveNodes:function(){var j=this._maxMotion,m=0;for(var d=0,b=this._snodes.size();d<b;d++){var g=this._snodes.get(d),p=g.dx,c=g.dy;p*=this._damper,c*=this._damper,g.dx=p/2,g.dy=c/2;var l=Math.sqrt(p*p+c*c);if(!g.fix){g.x=g.x+Math.max(-30,Math.min(30,p)),g.y=g.y+Math.max(-30,Math.min(30,c));if(!this._limitBounds){g.x<1&&this._adjustLocation(1,0),g.y<1&&this._adjustLocation(0,1)}else{g.x<this._limitBounds.x&&(g.x=this._limitBounds.x,this._adjustLocation(1,0)),g.y<this._limitBounds.y&&(g.y=this._limitBounds.y,this._adjustLocation(0,1));var k,h=this._network.getElementUI(g.element);h?k=h._viewRect:k=g.element.getRect(),k&&(g.x+k.width>this._limitBounds.x+this._limitBounds.width&&(g.x=this._limitBounds.x+this._limitBounds.width-k.width,this._adjustLocation(-1,0)),g.y+k.height>this._limitBounds.y+this._limitBounds.height&&(g.y=this._limitBounds.y+this._limitBounds.height-k.height,this._adjustLocation(0,-1)))}}m=Math.max(l,m)}this._maxMotion=m,this._maxMotion>0?this._motionRatio=j/this._maxMotion-1:this._motionRatio=0,this._damp()},_damp:function(){this._motionRatio<=0.001&&((this._maxMotion<0.2||this._maxMotion>1&&this._damper<0.9)&&this._damper>0.01?this._damper-=0.01:this._maxMotion<0.4&&this._damper>0.003?this._damper-=0.003:this._damper>0.0001&&(this._damper-=0.0001)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(a){this.isVisible(a)&&(a instanceof twaver.Link?this._addLink(a):a instanceof aJ&&this._addNode(a))},this)},_addNode:function(b){var a=this._snodeMap[b.getId()];return a?a:(a={},a.element=b,a.repulsion=this._getRepulsion(b),a.x=b.getX(),a.y=b.getY(),a.dx=0,a.dy=0,a.fix=!this.isMovable(b),this._snodeMap[b.getId()]=a,this._snodes.add(a),a)},_addLink:function(f){var b={};b.fromNode=this._addNode(f.getFromNode()),b.toNode=this._addNode(f.getToNode()),b.element=f;var g=this._network.getElementUI(f.getToNode()),d=this._network.getElementUI(f.getFromNode()),a,c;g&&g._viewRect&&d&&d._viewRect?(a=g._viewRect.width+d._viewRect.width,c=g._viewRect.height+d._viewRect.height):(a=f.getToNode().getWidth()+f.getFromNode().getWidth(),c=f.getToNode().getHeight()+f.getFromNode().getHeight()),b.length=Math.floor(Math.sqrt(a*a+c*c)*this._linkRepulsionFactor),b.length<=0&&(b.length=100),this._slinks.add(b)},_getRepulsion:function(c){var a=this._network.getElementUI(c),d;if(a&&a._viewRect){var b=a._viewRect;d=Math.floor(Math.sqrt(b.width*b.width+b.height*b.height)*this._nodeRepulsionFactor)}else{d=100}return d<=0&&(d=100),d},_adjustLocation:function(f,b){for(var h=0,d=this._snodes.size();h<d;h++){var a=this._snodes.get(h),c,g=this._network.getElementUI(a.element);g?c=g._viewRect:c=a.element.getRect();if(!c){return}if(f>0){if(!this._limitBounds||a.x+c.width+f<this._limitBounds.x+this._limitBounds.width){a.x+=f}}else{if(!this._limitBounds||a.x+f>this._limitBounds.x){a.x+=f}}if(b>0){if(!this._limitBounds||a.y+c.height+b<this._limitBounds.y+this._limitBounds.height){a.y+=b}}else{if(!this._limitBounds||a.y+b>this._limitBounds.y){a.y+=b}}}}}),twaver.layout.CloudLayouter=function(a){twaver.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=a,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1000,this._lastHeight=-1000,this._nodes=new aD,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.getClassName()==="twaver.network.Network"?this._network.setInteractions([new twaver.network.interaction.SelectInteraction(this._network)]):this._network.setInteractions([new twaver.canvas.interaction.SelectInteraction(this._network)])},_twaver.ext("twaver.layout.CloudLayouter",twaver.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:0.9,_ceaseLimit:0.01,_percentPadding:0.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(a){return this._network.isVisible(a)&&this._network.isMovable(a)},start:function(a){arguments.length===0&&(a=!0);if(this._timer){return}this._installListeners(),a&&this.updateLayoutRect(!0);var c=this,b=function(){c._update.call(c)};this._timer=aT.setInterval(b,this._interval),this._update()},stop:function(){this._timer&&(aT.clearInterval(this._timer),this._timer=null)},isRunning:function(){return !!this._timer},getInterval:function(){return this._interval},setInterval:function(b){if(this._interval===b){return}var d=this._interval;this._interval=b;if(this._timer){aT.clearInterval(this._timer);var c=this,a=function(){c._update.call(c)};this._timer=aT.setInterval(a,this._interval)}this.firePropertyChange("interval",d,b)},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(b){var a=this._moveSpeed;this._moveSpeed=b,this.firePropertyChange("moveSpeed",a,b)},getLayoutRect:function(){var c=this._network.getView().offsetWidth/this._network.getZoom(),a=this._network.getView().offsetHeight/this._network.getZoom(),d=c*this._percentPadding,b=a*this._percentPadding;return{x:d,y:b,width:c-2*d,height:a-2*b}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(d){var b=this._radius;this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2;if(d){this.reload()}else{this._lasta=1,this._lastb=1;var f=this._nodes.size();for(var c=0;c<f;c++){var a=this._nodes.get(c);a.cx*=this._radius/b,a.cy*=this._radius/b,a.cz*=this._radius/b}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new aD,this._box.forEach(function(g){if(g&&this.isLayoutable(g)){var f={};f.node=g,this._nodes.add(f)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;var c=0,a=0,d=this._nodes.size();for(i=0;i<d;i++){c=Math.acos(-1+(2*(i+1)-1)/d),a=Math.sqrt(d*Math.PI)*c;var b=this._nodes.get(i);b.cx=this._radius*Math.cos(a)*Math.sin(c),b.cy=this._radius*Math.sin(a)*Math.sin(c),b.cz=this._radius*Math.cos(c)}},_sineCosine:function(c,a,d){var b=Math.PI/180;this._sa=Math.sin(c*b),this._ca=Math.cos(c*b),this._sb=Math.sin(a*b),this._cb=Math.cos(a*b),this._sc=Math.sin(d*b),this._cc=Math.cos(d*b)},handleSelectionChange:function(a){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(a){(this._reloadOnDataBoxChanged||a.kind==="clear")&&this.reload()},handleMouseMove:function(a){this._centering||this._updateLogicalPoint(a),this._mouseMoveFunction?this._active=this._mouseMoveFunction(a):this._active=!0},handleMouseOver:function(a){this._centering||this._updateLogicalPoint(a),this._mouseOverFunction?this._active=this._mouseOverFunction(a):this._active=!0},_updateLogicalPoint:function(a){this._localPoint=this._network.getLogicalPoint(a)},handleRollOut:function(a){this._active=!1},handleResize:function(a){if(a.kind==="validateEnd"){if(!this._updateLayoutRectOnResized){return}if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2){return}this.updateLayoutRect()}},handleNetworkPropertyChange:function(a){a.property==="elementBox"&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),a.property==="zoom"&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);var c=this._nodes.size();for(var a=0;a<c;a++){var d=this._nodes.get(a).node,b=this._box.getDatas().indexOf(d);this._box.getDatas().removeAt(b),this._box.getDatas().add(d,a),this._box.fireIndexChange(d,b,a),this.updateNode(d,a,c,this._nodes.get(a).alpha)}},_sortFunction:function(b,a){return a.cz>b.cz?1:a.cz<b.cz?-1:0},updateNode:function(c,a,d,b){this._updateNodeFunction&&this._updateNodeFunction(c,a,d,b)},_update:function(){if(this._freeze){return}var I,q;if(this._centering&&this._centeringNode){var B=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(B){this._freeze=!0,this._centering=!1,this._centeringNode=null;return}}!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(I=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,q=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(I=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,q=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(I=this._lasta*this._ceaseRate,q=this._lastb*this._ceaseRate),this._lasta=I,this._lastb=q;if(Math.abs(I)>this._ceaseLimit||Math.abs(q)>this._ceaseLimit){var x=0;this._sineCosine(I,q,x);for(var E=0,w=this._nodes.size();E<w;E++){var A=this._nodes.get(E),k=A.cx,L=A.cy*this._ca+A.cz*-this._sa,H=A.cy*this._sa+A.cz*this._ca,D=k*this._cb+H*this._sb,K=L,F=k*-this._sb+H*this._cb,z=D*this._cc+K*-this._sc,J=D*this._sc+K*this._cc,j=F;A.cx=z,A.cy=J,A.cz=j;var C=this._radius*2;C/=C+j,A.perspective=C,A.alpha=(this._radius-j)/(this._radius*2);var G=this._horizontalElliptical*z*C-this._horizontalElliptical*2+this._centerX,b=J*C*this._verticalElliptical+this._centerY;A.node.setCenterLocation(G,b)}this._adjustIndex()}},centerNode:function(c){if(c&&this.isLayoutable(c)){if(this._centeringNode&&c===this._centeringNode.node&&this._freeze){return}for(var a=0,d=this._nodes.size();a<d;a++){var b=this._nodes.get(a);if(b&&c===b.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=b,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else{this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null}},createControlPoint:function(f){var b=f.getCenterLocation(),h=this.getLayoutRect(),d=h.x+h.width/2,a=h.y+h.height/2,c=Math.atan2(b.y-a,b.x-d),g=h.width+h.height;return{x:d+g*Math.cos(c),y:a+g*Math.sin(c)}},isAtCenter:function(f,b,g,d,a){if(this._moveSpeed<=0){return !0}var c=16/this._moveSpeed;return c>20?c=20:c<2&&(c=2),-a/Math.sqrt(g*g+d*d)>c},_updateNodes:function(G,k,z){this._sineCosine(G,k,z);for(var w=0,C=this._nodes.size();w<C;w++){var q=this._nodes.get(w),y=q.cx,j=q.cy*this._ca+q.cz*-this._sa,J=q.cy*this._sa+q.cz*this._ca,F=y*this._cb+J*this._sb,B=j,I=y*-this._sb+J*this._cb,D=F*this._cc+B*-this._sc,x=F*this._sc+B*this._cc,H=I;q.cx=D,q.cy=x,q.cz=H;var b=this._radius*2;b/=b+H,q.perspective=b;var A=this._horizontalElliptical*D*b-this._horizontalElliptical*2+this._centerX,E=x*b*this._verticalElliptical+this._centerY;q.node.setCenterLocation(A,E)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),aE.addEventListener("mouseout","handleRollOut",this._network.getView(),this),aE.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),aE.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),aE.removeEventListener("mouseout",this._network.getView(),this),aE.removeEventListener("mousemove",this._network.getView(),this),aE.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),twaver.layout.AutoLayouter=function(a){this._box=a},_twaver.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(a){this._expandGroup=a},getRepulsion:function(){return this._repulsion},setRepulsion:function(a){this._repulsion=a},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(a){this._animate=a},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(a){this._explicitXOffset=a},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(a){this._explicitYOffset=a},getDimension:function(f){if(f instanceof aB&&f.getChildrenSize()>0){var b=null;for(var d=0,a=f.getChildrenSize();d<a;d++){var c=f.getChildAt(d);c instanceof aJ&&(b?b=aK.unionRect(b,c.getRect()):b=c.getRect())}return b?{width:b.width,height:b.height}:null}return{width:f.getWidth(),height:f.getHeight()}},isVisible:function(a){return !0},isMovable:function(a){return !0},getGroupLayoutType:function(a){return this._type},getElements:function(){var h,f=this._box,j=f.getSelectionModel().size()>1;j?h=f.getSelectionModel().getSelection():(h=new aD,f.forEachByBreadthFirst(h.add,null,h)),this._xOffset=-1,this._yOffset=-1;var g=new aD;for(var d=0,c=h.size();d<c;d++){var b=h.get(d);if(this.isVisible(b)){if(b instanceof twaver.Link){g.add(b)}else{if(this.isMovable(b)&&b instanceof aJ){g.add(b);if(j){if(this._xOffset<0||b.getX()<this._xOffset){this._xOffset=b.getX()}if(this._yOffset<0||b.getY()<this._yOffset){this._yOffset=b.getY()}}}}}}return j||(isNaN(this._explicitXOffset)?this._xOffset=50/this._repulsion:this._xOffset=this._explicitXOffset,isNaN(this._explicitYOffset)?this._yOffset=50/this._repulsion:this._yOffset=this._explicitYOffset),g},getLayoutResult:function(b){var a={};return this.doLayoutImpl(b,null,a),a},doLayout:function(b,a){return this.doLayoutImpl(b,a)},doLayoutImpl:function(J,x,C){this._type=J;var z=null;if("round"===J){z=new aj}else{if("symmetry"===J){z=new bE}else{if("hierarchic"===J){z=new ag}else{if(J==="topbottom"||J==="bottomtop"||J==="rightleft"||J==="leftright"){z=new aF}}}}if(z==null){return !1}var F={},B=this.getElements(),s=new bC(this,B,!0,null);B=s.process();var N=new be(this,B,J,!0,null);try{z.i2(N)}catch(I){return s.resetGroup(),x!=null&&x(),!1}var E,L;for(E in N._a){L=N._a[E];var G=N.g4(L);F[E]={x:G.x+this._xOffset,y:G.y+this._yOffset}}var A;if(J==="rightleft"||J==="leftright"||J==="bottomtop"){var K=bC.createMatrix(J),q=Number.MAX_VALUE,D=Number.MAX_VALUE;for(E in F){L=N._a[E],A=F[E];var H=K.transform(A);A.x=H.x,A.y=H.y;var j;J==="rightleft"||J==="leftright"?(j=H.x-N.g9(L)/2/this._repulsion,j<q&&(q=j),j=H.y-N.gj(L)/2/this._repulsion,j<D&&(D=j)):(j=H.x-N.gj(L)/2/this._repulsion,j<q&&(q=j),j=H.y-N.g9(L)/2/this._repulsion,j<D&&(D=j))}for(E in F){L=N._a[E],A=F[E],A.x=A.x-q+this._xOffset,A.y=A.y-D+this._yOffset}}if(C==null&&this._animate){var M=new aD,k=new aD;for(E in F){M.add(N._a[E].node),k.add(F[E])}twaver.animate.AnimateManager.endAnimate(),twaver.animate.AnimateManager.start(new twaver.animate.AnimateCenterLocation(M,k,function(){s.resetGroup(),x!=null&&_twaver.callLater(x)}))}else{for(E in F){L=N._a[E],A=F[E],C==null?L.node.setCenterLocation(A.x,A.y):C[L.node.getId()]=A}s.resetGroup(),x!=null&&_twaver.callLater(x)}return !0}});var aY=function(b,a){this.x=b,this.y=a};_twaver.ext(aY,Object,{equals:function(a){return this===a?!0:a instanceof aY?a.x==this.x&&a.y==this.y:!1}});var aS=function(b,a){this.width=b,this.height=a};_twaver.ext(aS,Object,{});var aN=function(b,a){this.x=b,this.y=a};_twaver.ext(aN,Object,{});var aV=function(){arguments.length===2?(aV.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(aV.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};_twaver.ext(aV,aS,{});var aQ=function(c,a){if(aQ.a2(c.x,a.x)){this._a=1,this._b=0,this._c=-c.x}else{this._b=-1;var d=(a.y-c.y)/(a.x-c.x),b=c.y-c.x*d;this._a=d,this._c=b}};_twaver.ext(aQ,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),aQ.a6=function(j,m){if(aQ.a1(j.a3())&&aQ.a1(m.a3())){return null}if(aQ.a1(j.a4())&&aQ.a1(m.a4())){return null}if(aQ.a1(m.a4())){var c=j;j=m,m=c}var a=j.a3(),g=j.a4(),p=-j.a5(),b,k;aQ.a1(j.a3())?(b=m.a4(),k=-m.a5()):(b=m.a4()-m.a3()/j.a3()*j.a4(),k=-m.a5()-m.a3()/j.a3()*-j.a5());var h=k/b,d=(p-h*g)/a;return new aY(d,h)},aQ.a1=function(a){return aQ.a2(a,0)},aQ.a2=function(b,a){return Math.abs(b-a)<0.00001};var aI=function(b){this._a=new bh;if(b){for(var a=0;a<b.size();a++){this._a.aa(b.get(a))}}};_twaver.ext(aI,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){var b=new aD;for(var a=this.c();a.i1();a.i2()){b.add(a.i6(),0)}return new aI(b)},b:function(){return this._a.ay()}});var aU=function(b,a){this.x=b,this.y=a};_twaver.ext(aU,Object,{a:function(b,a){this.x=b,this.y=a}});var aA=function(b,a){this.x=b||0,this.y=a||0};_twaver.ext(aA,Object,{b:function(){return new aA(this.x,this.y)},a:function(a){this.z=a},c:function(){return this.x},d:function(){return this.y},f:function(b,a){this.x=b,this.y=a}});var aL=function(a){this._c=new bh,a?(this.ac(a.a8().b()),this.ad(a.a9().b())):(this.ac(new aA),this.ad(new aA))};_twaver.ext(aL,Object,{a6:function(){return this.a5(this)},ac:function(a){a.a(this),this._a=a},ad:function(a){a.a(this),this._b=a},a8:function(){return this._a},a9:function(){return this._b},a1:function(b,a){return this.a4(b,a,this.aa())},a2:function(){return this._c.ay()},a7:function(a){return this._c.ak(a)},aa:function(){return this._c.ay()===0?null:this._c.as()},a3:function(){this._c.af()},i2:function(b){var a=this.a7(b);return a!=null?new aY(a.x,a.y):null},i1:function(){return this.a2()},i6:function(){var a=this.a8();return new aY(a.c(),a.d())},i7:function(){var a=this.a9();return new aY(a.c(),a.d())},i8:function(a){this.a8().f(a.x,a.y)},i9:function(a){this.a9().f(a.x,a.y)},i3:function(c,a,d){var b=this.a7(c);b!=null&&b.a(a,d)},i4:function(b,a){this.a1(b,a)},i5:function(){this.a3()}});var aR=function(a){aR.superClass.constructor.call(this,a)};_twaver.ext(aR,aL,{a5:function(a){return new aR(a)},a4:function(c,a,d){var b=new aU(c,a);return this.ab(b,d),b},ab:function(b,a){this._c.an(b,this._c.al(a))}});var av=function(){if(arguments.length===2){var b=arguments[0],a=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=b-this._w/2,this._y=a-this._h/2}else{var c=arguments[0];this._s=c._s,this._w=c._w,this._h=c._h,this._x=c._x,this._y=c._y}};_twaver.ext(av,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(b,a){this._x=b-this._w/2,this._y=a-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(b,a){this._x=b,this._y=a},i3:function(){return this._w},i4:function(){return this._h},i6:function(c,a){var d=(this._w-c)/2,b=(this._h-a)/2;this._x+=d,this._y+=b,this._w=c,this._h=a},m1:function(d){var b,f,c,a;d.width<=0?(b=this._x,f=this._x+this._w,c=this._y,a=this._y+this._h):(b=Math.min(this._x,d.x),f=Math.max(this._x+this._w,d.x+d.width),c=Math.min(this._y,d.y),a=Math.max(this._y+this._h,d.y+d.height)),d.x=b,d.y=c,d.width=f-b,d.height=a-c}});var aX=function(a){a?aX.superClass.constructor.call(this,a):aX.superClass.constructor.call(this,0,0)};_twaver.ext(aX,av,{m2:function(a){return new aX(a)}});var ax={};ax.a2=function(b){var a=bN.a2(an.a(b.xa()));return ax.a4(b,a,ax.a3(b,a))},ax.a3=function(f,b){for(var h=f.x9();h.i1();h.i2()){b.i7(h.i9(),-1)}var d=0,a=new aH(f.xa());for(var c=f.x9();c.i1();c.i2()){var g=c.i9();b.i2(g)===-1&&ax.a(g,a,b,d++)}return d},ax.a6=function(d){var b=new br,f=ax.a2(d);for(var c=0;c<f.length-1;c++){var a=d.xo(f[c].x2(),f[c+1].x3());b.aa(a)}return b},ax.a4=function(f,b,g){var d=[];for(var a=0;a<g;a++){d[a]=new a2}for(var c=f.x9();c.i1();c.i2()){d[b.i2(c.i9())].ae(c.i9())}return d},ax.a=function(g,c,j,f){c.c(g),j.i7(g,f);while(!c.a()){g=c.b();for(var b=g.ag();b!=null;b=b.a8()){var d=b.a3();j.i2(d)===-1&&(j.i7(d,f),c.c(d))}for(var h=g.ae();h!=null;h=h.a7()){var a=h.a2();j.i2(a)===-1&&(j.i7(a,f),c.c(a))}}},ax.a1=function(c,a,d){var b=new bA(a,d);return b.a8(c),b._i},ax.a5=function(f,b,g){var d=[];for(var a=0;a<g;a++){d[a]=new br}for(var c=f.xf();c.i1();c.i2()){d[b.i2(c.i8())].aa(c.i8())}return d},ax.a7=function(y){var E=new br,k=bN.a3(an.b(y.xa())),b=bN.a4(an.a(y.xh())),q=ax.a1(y,b,k),F=ax.a5(y,b,q);if(F.length>1){var j=new a2;for(var D=0;D<F.length;D++){var B=F[D],x=null;if(B.ay()===1){var m=B.c2();m.a2().ad()===1?x=m.a2():m.a3().ad()===1&&(x=m.a3())}else{for(var A=B.c1();A.i1();A.i2()){var w=A.i8();if(k.i4(w.a2())){if(x==null){x=w.a2()}else{if(x!==w.a2()){x=null;break}}}if(!k.i4(w.a3())){continue}if(x==null){x=w.a3();continue}if(x===w.a3()){continue}x=null;break}if(x!=null){var g=B.c2();g.a2()!==x?x=g.a2():x=g.a3()}}x!=null&&j.aa(x)}var z;for(var C=j.x4();!j.ar();C=z){z=j.x4(),E.ac(y.xo(C,z))}}return E};var bv=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};_twaver.ext(bv,Object,{a6:function(a){this._f=a},a7:function(a){this._b=a},a8:function(a){a.x0()!==0&&this.a9(a,a.x9().i9())},a9:function(c,a){this._xx=c.xk(),this._c=c.xl(),this._d=0,this._e=0,this.a0(a);if(this._b){for(var d=c.x9();d.i1();d.i2()){var b=d.i9();this._xx.i1(b)==null&&(this.a1(b),this.a0(b))}}c.xi(this._xx),c.xj(this._c)},a0:function(d){var b=++this._d;this._xx.z1(d,bv._B),this.a5(d,b);for(var f=this._f?d.ap():d.af();f.i1();f.i2()){var c=f.i8();if(!this._c.i4(c)){this._c.i7(c,!0);var a=c.a1(d);this._xx.i1(a)==null?(this.a3(c,a,!0),this.a0(a),this.a2(c,a)):this.a3(c,a,!1)}}this.a4(d,b,++this._e),this._xx.z1(d,bv._C)},a5:function(b,a){},a4:function(b,a,c){},a3:function(b,a,c){},a2:function(b,a){},a1:function(a){}}),bv._B={},bv._C={};var bd=function(a){this._a=a};_twaver.ext(bd,bv,{a5:function(b,a){var c=this._a._ah.i2(b);this._a._ad[c].ae(b)}});var aw=function(a){this._a=a};_twaver.ext(aw,bv,{a2:function(d,b){var f=d.a1(b),c=this._a[f.al()],a=this._a[b.al()];a._a+1>c._a?(c._c=c._a,c._b=c._d,c._a=a._a+1,c._d=d):a._a+1>c._c&&(c._c=a._a+1,c._b=d)}});var bb=function(a){this._a=a};_twaver.ext(bb,bv,{a3:function(b,a,c){c&&b.a2()===a&&this._a.ac(b)}});var bk=function(){this._a=0,this._c=0};_twaver.ext(bk,Object,{});var bx=function(){this._a=0};_twaver.ext(bx,Object,{a1:function(g,c){this._a=0;for(var j=c.length-1;j>=0;j--){c[j]=-1}for(var f=g.x9();f.i1();f.i2()){var b=f.i9();if(b.ak()!==0){continue}this.a2(b,b.al(),c);break}for(var d=g.x9();d.i1();d.i2()){var h=d.i9(),a=h.al();c[a]===-1&&this.a2(h,a,c)}},a2:function(f,b,g){g[b]=-2;for(var d=f.ag();d!=null;){var a=d.a3(),c=a.al();switch(g[c]){case -1:this.a2(a,c,g);case -2:default:d=d.a8()}}g[b]=this._a++}});var aO={};aO.a1=function(b){var a=new bn;return a.a8(b),a._n},aO.a2=function(c){var a=c.x9(),d=null,b=0;a.i4();for(;a.i1();a.i2()){a.i9().ak()===0&&(d=a.i9(),b++)}if(b===1){return d}b=0,a.i4();for(;a.i1();a.i2()){a.i9().ao()===0&&(d=a.i9(),b++)}return b===1?d:aO.a8(c)},aO.a8=function(b){var a=an.a(b.x0()),c=bN.a2(a);return aO.a6(b,c)},aO.a6=function(f,b){var h=f.xd(),d=an.d(1),a=an.a(f.x0(),-1),c=aO.a4(f,h);aO.a7(h,b,d,a,-1);for(var g=c.c1();g.i1();g.i2()){f.x3(g.i8())}return d[0]},aO.a7=function(w,A,j,b,m){var B=0;for(var g=w.ag();g!=null;g=g.a8()){var z=g.a3(),y=aO.a7(z,A,j,b,m);y>m&&(m=y),B+=b[z.al()]}var v=B*(w._g.xa()-1-B);for(var k=w.ag();k!=null;k=k.a8()){var x=k.a3();for(var q=k.a8();q!=null;q=q.a8()){var d=q.a3();v+=b[x.al()]*b[d.al()]}}return A.i7(w,v),b[w.al()]=B+1,v>m&&(m=v,j[0]=w),m},aO.a4=function(d,b){var f=new br,c=new bb(f);c.a6(!1),c.a9(d,b);for(var a=f.c1();a.i1();a.i2()){d.x3(a.i8())}return f},aO.a3=function(a){return aO.a4(a,aO.a2(a))};var bn=function(){this._n=!0,this.a6(!1)};_twaver.ext(bn,bv,{a3:function(b,a,c){c||(this._n=!1)},a1:function(a){this._n=!1}});var bA=function(b,a){this._i=0,this._m=a,this._j=b,this._l=!1};_twaver.ext(bA,bv,{a8:function(a){this._h=an.a(a.x0()),this._k=an.a(a.x0()),this._g=new aH(a.xh()),bA.superClass.a8.call(this,a)},a5:function(b,a){this._k[b.al()]=this._h[b.al()]=a},a3:function(c,a,d){this._g.c(c);if(!d){var b=c.a1(a);this._h[b.al()]=Math.min(this._h[b.al()],this._k[a.al()])}},a1:function(a){this._l=!1},a2:function(b,a){var c=b.a1(a);if(this._h[a.al()]>=this._k[c.al()]){for(;this._g.d()!==b;this._j.i5(this._g.b(),this._i)){}this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(c,!0):this._l=!0:this._m.i5(c,!0)}this._h[c.al()]=Math.min(this._h[c.al()],this._h[a.al()])}});var bi=function(b,a){this._h=!1,this._i=b,this._g=a};_twaver.ext(bi,Object,{z1:function(b,a){b._c[this._i]=a},i1:function(a){return a._c[this._i]},i5:function(b,a){b._c[this._i]=a},i4:function(a){return a._c[this._i]},i7:function(b,a){b._c[this._i]=a},i2:function(b){var a=b._c[this._i];return a==null?0:a},i6:function(b,a){b._c[this._i]=a},i3:function(b){var a=b._c[this._i];return a==null?0:a},c:function(){return this._h},d:function(){this._h=!0}});var bm=function(b,a){this._c=!1,this._d=b,this._b=a};_twaver.ext(bm,Object,{i8:function(b,a){b._c[this._d]=a},i1:function(a){return a._c[this._d]},i7:function(b,a){b._c[this._d]=a},i4:function(b){var a=b._c[this._d];return a==null?!1:a},i5:function(b,a){b._c[this._d]=an.a(a)},i2:function(b){var a=b._c[this._d];return a==null?0:a},i6:function(b,a){b._c[this._d]=an.a(a)},i3:function(b){var a=b._c[this._d];return a==null?0:a},a:function(){return this._c},b:function(){this._c=!0}});var aZ=function(a){this._bb=a,this.i4()};_twaver.ext(aZ,Object,{i1:function(){return this._aa!=null},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var bw=function(a){bw.superClass.constructor.call(this,a)};_twaver.ext(bw,aZ,{i8:function(){return this.i6()}});var bh=function(a){this._id=_twaver.id(),this._a=0;if(a){a.i4();for(;a.i1();a.i2()){this.ae(a.i6())}}};_twaver.ext(bh,Object,{ac:function(b){var a=this.ag(b);return this._b==null?this._b=this._c=a:(this._b._b=a,a._a=this._b,this._b=a),this._a++,a},ae:function(b){var a=this.ag(b);return this._c==null?this._b=this._c=a:(this._c._a=a,a._b=this._c,this._c=a),this._a++,a},z1:function(a){a._b=null,a._a=null,this._c==null?this._b=this._c=a:(this._c._a=a,a._b=this._c,this._c=a),this._a++},ad:function(a){a._b=null,a._a=null,this._b==null?this._b=this._c=a:(this._b._b=a,a._a=this._b,this._b=a),this._a++},aa:function(a){return this.ae(a),!0},ab:function(a){for(;a.i1();a.i2()){this.ae(a.i6())}},ao:function(b,a){if(a===this._b){return this.ac(b)}if(a==null){return this.ae(b)}var c=this.ag(b);return this.aq(c,a),c},aq:function(b,a){if(a==null){this.ad(b)}else{if(a===this._b){this.ad(b)}else{if(this._c==null){b._b=null,b._a=null,this._b=this._c=b}else{var c=a._b;a._b=b,b._a=a,c._a=b,b._b=c}this._a++}}},ap:function(b,a){if(a==null){this.z1(b)}else{if(a===this._c){this.z1(b)}else{if(this._b==null){b._b=null,b._a=null,this._b=this._c=b}else{var c=a._a;a._a=b,b._a=c,c._b=b,b._b=a}this._a++}}},an:function(b,a){if(a===this._c){return this.ae(b)}if(a==null){return this.ac(b)}var c=this.ag(b);return this.ap(c,a),c},ay:function(){return this._a},ar:function(){return this._a===0},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var a=this.am();return this.aw(this._b),a},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(b){var a=0;for(var c=this._b;c!=null;){if(b===a){return c._c}c=c._a,a++}return null},aj:function(a){return a._a==null?this._b:a._a},ai:function(a){return a._b==null?this._c:a._b},aw:function(a){return a!==this._b?a._b._a=a._a:this._b=a._a,a!==this._c?a._a._b=a._b:this._c=a._b,this._a--,a._c},av:function(a){return this.aw(a._aa)},ah:function(){return new aZ(this)},al:function(b){var a=this._b;while(a!=null){if(a._c==null&&b==null){return a}if(a._c===b){return a}a=a._a}return null},a0:function(){var b=an.d(this._a),a=0;for(var c=this._b;c!=null;){b[a]=c._c,c=c._a,a++}return b},ax:function(){for(var b=this._b;b!=null;b=b._b){var a=b._a;b._a=b._b,b._b=a}var c=this._b;this._b=this._c,this._c=c},a1:function(c){var a=this.a0();a.sort(c);var d=0;for(var b=this._b;b!=null;){b._c=a[d],b=b._a,d++}},a2:function(){var b=this.a0();b.sort(an.c);var a=0;for(var c=this._b;c!=null;){c._c=b[a],c=c._a,a++}},az:function(a){this._b==null?(this._b=a._b,this._c=a._c):a._b!=null&&(this._c._a=a._b,a._b._b=this._c,this._c=a._c),this._a+=a._a,a._b=a._c=null,a._a=0},ag:function(a){return new bu(a)}});var br=function(a){br.superClass.constructor.call(this,a)};_twaver.ext(br,bh,{c1:function(){return new bw(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var bz=function(){this._c=0};_twaver.ext(bz,Object,{a:function(a){this._c++,a._b=this._b,a._a=null,this._b!=null?(this._b._a=a,this._b=a):this._b=this._a=a},b:function(b,a){if(a==null){this.a(b);return}var c=a._b;c!=null?c._a=b:this._a=b,b._b=c,b._a=a,a._b=b,this._c++},c:function(b){var a=b._a,c=b._b;this._c--,a!=null?a._b=c:this._b=c,c!=null?c._a=a:this._a=a}});var aP=function(b,a){this._p=b,this._j=a,this._o=b._o[a]};_twaver.ext(aP,Object,{i1:function(){return this._o!=null},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var bu=function(a){this._c=a};_twaver.ext(bu,Object,{a:function(){return this._a},b:function(){return this._b},c:function(a){this._c=a},d:function(){return this._c}});var bq=function(c,a,d,b){this._r=c,this._s=a,this._q=d,this._p=b};_twaver.ext(bq,Object,{i1:function(a){return this._p[a.a5()]},i3:function(a){return this._r[a.a5()]},i2:function(a){return this._s[a.a5()]},i4:function(a){return this._q[a.a5()]},i8:function(b,a){this._p[b.a5()]=a},i6:function(b,a){this._r[b.a5()]=a},i5:function(b,a){this._s[b.a5()]=a},i7:function(b,a){this._q[b.a5()]=a}});var aH=function(a){this._a=an.d(a),this._b=-1};_twaver.ext(aH,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(a){this._a[++this._b]=a},a:function(){return this._b<0}});var bf=function(){};_twaver.ext(bf,Object,{a0:function(a){this._c=an.d(a)}});var ba=function(f,b,h,d,a,c,g){this._g=0,f.xt(this,b,h,d,a,c,g)};_twaver.ext(ba,bf,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(a){return this._d!==a?this._d:this._e},a4:function(){for(var a=0;a<=1;a++){this._k[a]=null,this._f[a]=null}},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(c,a,d,b){this.a0(b),this._h=c,this._k=an.d(2),this._f=an.d(2),this._d=a,this._e=d}});var au=function(a){this._j=0,this._h=a,this.i4()};_twaver.ext(au,Object,{i2:function(){this._k=this._k._k[this._j],this._k==null&&this._j===0&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],this._k==null&&this._j===1&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],this._k==null?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],this._k==null?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return this._k!=null},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var a7=function(){this._a=bP._A,this._b=bP._A,this._c=new aD};_twaver.ext(a7,Object,{i1:function(){return this._c.size()},i2:function(a){return this._c.get(a)},i3:function(b,a,c){this._c.set(b,new aY(a,c))},i4:function(b,a){this._c.add(new aY(b,a))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(a){this._a=a},i9:function(a){this._b=a}});var a5=function(){this._x=0,this._y=0,this._w=0,this._h=0};_twaver.ext(a5,Object,{i5:function(b,a){this._x=b,this._y=a},i6:function(b,a){this._w=b,this._h=a},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var a9=function(c,a,d,b){this._m=c,this._n=a,this._l=d,this._k=b};_twaver.ext(a9,Object,{i1:function(a){return this._k[a.al()]},i3:function(a){return this._m[a.al()]},i2:function(a){return this._n[a.al()]},i4:function(a){return this._l[a.al()]},z1:function(b,a){this._k[b.al()]=a},i6:function(b,a){this._m[b.al()]=a},i7:function(b,a){this._n[b.al()]=a},i5:function(b,a){this._l[b.al()]=a}});var bJ=function(b,a){this._b=b,this._r=a,this._a=[];for(var c=this._b-1;c>=0;c--){this._a.push(c)}this._c=new aD};_twaver.ext(bJ,Object,{a1:function(b){var a;if(this._a.length===0){this.a2(b,this._b,this._b+this._r);for(var c=this._b+this._r-1;c>this._b;c--){this._a.push(c)}a=this._b,this._b+=this._r}else{a=this._a.pop()}return a},b:function(b){var a=this.a1(b),c=new bi(a,this);return this._c.add(c),this.a4(b,a),c},c:function(b){var a=this.a1(b),c=new bm(a,this);return this._c.add(c),this.a4(b,a),c},a2:function(d,b,f){for(var c=d._a;c!=null;c=c._a){var a=an.d(f);an.f(c._c,a,b),c._c=a}},a3:function(c,a,d){var b=an.d(d);an.f(c._c,b,a),c._c=b},a4:function(b,a){for(var c=b._a;c!=null;c=c._a){c._c[a]=null}},a5:function(c,a){if(c instanceof bi){var d=c;if(d.c()){throw"Error"}d.d();var b=c._i;this._a.indexOf(b)<0&&(this.a4(a,b),this._a.push(b),this._c.remove(c))}},a6:function(c,a){if(c instanceof bm){var d=c;if(d.a()){throw"Error"}d.b();var b=d._d;this._a.indexOf(b)<0&&(this.a4(a,b),this._a.push(b),this._c.remove(c))}}});var bp=function(a){this._id=_twaver.id(),this._p=0,a.xs(this)};_twaver.ext(bp,bf,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new au(this)},am:function(){return new aP(this,1)},ap:function(){return new aP(this,0)},an:function(){return new bg(this)},aq:function(){return new bo(this,1)},aw:function(){return new bo(this,0)},ah:function(b){for(var a=this._o[0];a!=null;a=a._k[0]){if(a.a3()===b){return a}}return null},ai:function(b){for(var a=this._o[1];a!=null;a=a._k[1]){if(a.a2()===b){return a}}return null},aj:function(b){var a=this.ah(b);return a==null&&(a=this.ai(b)),a},au:function(a){this.at(a,1,an.d(this.ak()))},av:function(a){this.at(a,0,an.d(this.ao()))},as:function(b,a){this.a0(a),this._g=b,this._o=an.d(2),this._q=an.d(2),this._n=an.a(2)},ab:function(g,c,j,f,b){if(c==null){this.aa(g,j,f);return}var d;c._d===c._e?d=f:d=this!==c._d?1:0;if(b===0){var h=c._k[d];g._f[f]=c,g._k[f]=h,c._k[d]=g,h==null?this._q[j]=g:h._d===h._e?h._f[f]=g:h._f[this!==h._d?1:0]=g}else{var a=c._f[d];g._k[f]=c,g._f[f]=a,c._f[d]=g,a==null?this._o[j]=g:a._d===a._e?a._k[f]=g:a._k[this!==a._d?1:0]=g}this._n[j]++},aa:function(c,a,d){var b=this._q[a];c._k[d]=null,b==null?(this._o[a]=c,c._f[d]=null):(c._f[d]=b,b._d===b._e?b._k[d]=c:b._k[this!==b._d?1:0]=c),this._q[a]=c,this._n[a]++},ar:function(d,b,f){var c,a;c=d._k[f],a=d._f[f],c==null?this._q[b]=a:c._f[c._d!==this?1:0]=a,a==null?this._o[b]=c:a._k[a._d!==this?1:0]=c,this._n[b]--},ac:function(){for(var a=0;a<=1;a++){this._o[a]=null,this._q[a]=null,this._n[a]=0}},at:function(g,c,j){if(this._n[c]<2){return}var f=this._n[c],b=0,d;for(d=this._o[c];d!=null;d=d._k[c]){j[b]=d,b++}an.s(j,f,g);var h=this._o[c]=j[0];h._f[c]=null;for(var a=1;a<f;){d=j[a],d._f[c]=h,h._k[c]=d,a++,h=d}this._q[c]=d,d._k[c]=null}});var bo=function(b,a){bo.superClass.constructor.call(this,b,a),this._h=a!==1?1:0};_twaver.ext(bo,aP,{i6:function(){return this.i9()},i9:function(){return this._h!==0?this._o._e:this._o._d}});var bg=function(a){bg.superClass.constructor.call(this,a)};_twaver.ext(bg,au,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var bs=function(a){bs.superClass.constructor.call(this,a)};_twaver.ext(bs,aZ,{i9:function(){return this.i6()}});var a3=function(a){this._o=a,this._c=a._a};_twaver.ext(a3,Object,{i1:function(){return this._c!=null},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var a2=function(b){if(b&&b.length){a2.superClass.constructor.call(this);for(var a=0;a<b.length;a++){this.ae(b[a])}}else{a2.superClass.constructor.call(this,b)}};_twaver.ext(a2,bh,{x1:function(){return new bs(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var bS=function(a){this._d=a,bS.superClass.constructor.call(this)};_twaver.ext(bS,a2,{});var bc=function(a){this._a=a,this._b=new br,this._c=new a2};_twaver.ext(bc,Object,{a:function(){for(var a=this._a.x9();a.i1();a.i2()){this.e(a.i9())}},b:function(){this.c(),this.d()},c:function(){while(!this._c.ar()){var a=this._c.x4();this._a.xq(a)||this.g(a)}},d:function(){while(!this._b.ar()){var a=this._b.c3();this._a.xp(a)||this.f(a)}},e:function(b){for(var a=b.af();a.i1();a.i2()){this._b.ac(a.i8()),this._a.h1(a.i8())}this._c.ac(b),this._a.h2(b)},f:function(a){this._a.u1(a)},g:function(a){this._a.h3(a)}}),bc.h=function(b,a){a.i4();for(;a.i1();a.i2()){var c=a.i8();b.xq(c.a2())||b.h3(c.a2()),b.xq(c.a3())||b.h3(c.a3()),b.xp(c)||b.u1(c)}},bc.i=function(b,a){a.i4();for(;a.i1();a.i2()){var c=a.i8();b.xp(c)&&b.h1(c),c.a2().ad()===0&&b.h2(c.a2()),c.a3().ad()===0&&b.h2(c.a3())}};var a4=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new bh,this._e=0,arguments.length!==1&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};_twaver.ext(a4,Object,{a:function(m,w,g,b){var j=an.d(g-w+1);for(var x=w;x<=g;x++){j[x]=new bS(x)}for(var d=this._g.x9();d.i1();d.i2()){var v=d.i9();if(b==null||b.i4(v)){this._f.z1(v,j[m.i2(v)-w].ac(v)),this._e++}}for(var q=0;q<j.length;q++){var k=j[q],h=this._d.ae(k);for(var p=k.x1();p.i1();p.i2()){this._h.z1(p.i9(),h)}}},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return this._e===0},g:function(){for(;this._d.am().ar();this._d.at()){}this._e--;var a=this._d.am().x4();return this._h.z1(a,null),this._f.z1(a,null),a},f:function(){for(;this._d.as().ar();this._d.au()){}this._e--;var a=this._d.as().x4();return this._h.z1(a,null),this._f.z1(a,null),a},d:function(f){var b=this._f.i1(f),g=this._h.i1(f),d=g.d(),a=null,c=g.a();c!=null?(a=c.d(),this._h.z1(f,c)):(a=new bS(d._d+1),this._h.z1(f,this._d.ae(a))),d.aw(b),this._f.z1(f,a.ac(f))},b:function(f){var b=this._f.i1(f),g=this._h.i1(f),d=g.d(),a=null,c=g.b();c!=null?(a=c.d(),this._h.z1(f,c)):(a=new bS(d._d-1),this._h.z1(f,this._d.ac(a))),d.aw(b),this._f.z1(f,a.ac(f))}});var bN={};bN.a1=function(a){return new a9(a,null,null,null)},bN.a2=function(a){return new a9(null,a,null,null)},bN.a3=function(a){return new a9(null,null,a,null)},bN.a4=function(a){return new bq(null,a,null,null)},bN.a5=function(a){return new bq(null,null,a,null)},bN.a6=function(a){return new bq(null,null,null,a)};var aq=function(){if(arguments.length===2){this._a=new bh,this._b=new bh,this._c=0;var b=arguments[0],a=arguments[1],c=new bF(b._j2.gj(a)/2,0);this._a.ac(c),c=new bF(b._j2.gj(a)/2,0),this._b.ac(c)}else{this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]}};_twaver.ext(aq,Object,{});var bF=function(b,a){this._b=b,this._a=a};_twaver.ext(bF,Object,{});var ay=function(){this._cx=!0,this._cs=new bH,this._ct=new bD,this._cw=new bB};_twaver.ext(ay,Object,{i5:function(a){this._cx=a},k:function(){var a=new aW(this);return this._cx&&(this._cs.w1(a),a=this._cs),this._cw.w1(a),a=this._cw,this._ct.w1(a),a=this._ct,a},i2:function(a){this.k().i2(a)},i1:function(a){return this.k().i1(a)}});var aF=function(){aF.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(d,b){var f=d.a3(),c=b.a3(),a=f._g;return Math.floor(100*(a.g5(f)-a.g5(c)))}};_twaver.ext(aF,ay,{i4:function(a){return aO.a1(a)},i3:function(c){if(!this.i4(c)){throw"Error"}var a=aO.a3(c);this._j2=c,this._j3=new by(c),bO.c(c),this._jy=c.xk();if(!c.xb()){this.bu();var d=this._j3.c1();this.f(d),this.b(this._j3),this.c(this._j3)}var b;for(;!a.ar();c.x3(b)){b=a.c3(),bO.b(c.g2(b))}},bu:function(){if(this._jx!=null){for(var a=this._j2.x9();a.i1();a.i2()){a.i9().av(this._jx)}}},c:function(q){var y=this.a2(q),g=an.a(y.length);for(var b=0;b<y.length;b++){var k=y[b],z=0;for(var d=k.ah();d.i1();d.i2()){var x=d.i6();z=Math.max(z,this._j2.g9(x))}g[b]=z}var w=-this._jw;for(var p=0;p<y.length;p++){w+=this._jw+g[p];var j=y[p];for(var v=j.ah();v.i1();v.i2()){var m=v.i6();this._j2.s2(m,this._j2.g5(m),w-g[p]/2)}}},a2:function(c){var a=an.d(c.b());for(var d=0,b=c.b();d<b;d++){a[d]=new bh}return c.c1(),this.a1(c.c1(),0,a),a},a1:function(c,a,d){d[a].ae(c);for(var b=c.aw();b.i1();b.i2()){this.a1(b.i9(),a+1,d)}},b:function(b){var a=b.c1();this._j2.s2(a,0,this._j2.g6(a)),this.g(a)},g:function(c){for(var a=c.aw();a.i1();a.i2()){var d=a.i9(),b=this._jy.i1(d);this._j2.s2(d,this._j2.g5(c)+b._c,this._j2.g6(d)),this.g(d)}},f:function(N){if(this._j3.c2(N)){this._jy.z1(N,new aq(this,N));return}var A=N.aw(),G=A.i9();A.i2(),this.f(G);var C=this._jy.i1(G),J=new aq(this,C._a,C._b,0);if(!A.i1()){J._a.ac(new bF(this._j2.gj(N)/2,0)),J._b.ac(new bF(this._j2.gj(N)/2,0)),this._jy.z1(N,J);return}while(A.i1()){G=A.i9(),A.i2(),this.f(G),C=this._jy.i1(G);var B=J._b.ah(),F=C._a.ah(),x=2147483647,R=0,M=0;while(B.i1()&&F.i1()){var I=B.i6();B.i2();var P=F.i6();F.i2(),M+=I._a,R+=P._a,x=Math.min(x,R-M-I._b-P._b)}C._c=this._jv-x,R+=C._c;var K=C._b.am();K._a=C._c;if(B.i1()&&!F.i1()){for(var D=M-this.a3(C._b);B.i1();D=0){var O=B.i6();B.i2(),C._b.ae(new bF(O._b,O._a+D))}}else{if(!B.i1()&&F.i1()){var q=this.a3(J._a);for(q=R-q;F.i1();q=0){var H=F.i6();F.i2(),J._a.ae(new bF(H._b,H._a+q))}}}J._b=C._b}this._jy.z1(N,J);var L=-C._c/2;for(var j=N.aw();j.i1();){var Q=j.i9();j.i2();var k=this._jy.i1(Q);k._c+=L;var z=k._b.am();z._a+=L,z=k._a.am(),z._a+=L}J._a.ac(new bF(this._j2.gj(N)/2,0)),J._b.ac(new bF(this._j2.gj(N)/2,0))},a3:function(c){var a=0;for(var d=c.ah();d.i1();d.i2()){var b=d.i6();a+=b._a}return a}});var by=function(a){this._b=a,this.a()};_twaver.ext(by,Object,{c1:function(){return this._a==null&&this.a(),this._a},b:function(){return this._a==null?-1:this.d(this._a)},d:function(b){var a=0;for(var c=b.aw();c.i1();c.i2()){a=Math.max(a,this.d(c.i9()))}return a+1},c2:function(a){return a.ao()===0},a:function(){for(var a=this._b.x9();a.i1();a.i2()){if(a.i9().ak()===0){this._a=a.i9();return}}}});var bK=function(a){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=a,this._c=new bh};_twaver.ext(bK,Object,{a:function(){return this._d+this._e+this._f}});var bM=function(){bM.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=0.5};_twaver.ext(bM,ay,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(f){if(!aO.a1(f)){throw"Error"}this._a=f;var b=this.i8(),g=aO.a4(f,b);bO.c(f),this._kn=an.d(f.x0());for(var d=f.x9();d.i1();d.i2()){var a=d.i9();a!==b?this.aa(a,new bK(this._kk+this.q(a.aq().i9()))):this.aa(a,new bK(this._kk))}this.s(b),f.s2(b,0,0),this.t(b);var c;for(;!g.ar();f.x3(c)){c=g.c3()}},i4:function(a){return aO.a1(a)},i0:function(a){return this._kn[a.al()]},i8:function(){return aO.a2(this._a)},i7:function(g){var c=this.ib(g),j;do{j=this.i6(g);if(j<=c){break}for(var f=g.aw();f.i1();f.i2()){var b=f.i9();this.i0(b)._g*=1+this._ko}}while(!0);var d=(c-j)/(2*g.ao());j=0;for(var h=g.aw();h.i1();h.i2()){var a=this.i0(h.i9());a._d+=d,a._e+=d,j+=a._d+a._e}this.id(g)},id:function(f){var b=an.d(f.ao()),h=0;for(var d=f.ap();d.i1();){b[h]=d.i8(),d.i2(),h++}var a=this;b.sort(function(m,j){var o=m.a3(),l=j.a3(),k=a.i0(o).a()-a.i0(l).a();return k>0?1:k>=0?0:-1});for(var c=0;c<b.length;c++){this._a.h1(b[c])}for(var g=0;g<b.length;g+=2){this._a.u1(b[g])}h=b.length-1,h%2===0&&h--;for(;h>0;h-=2){this._a.u1(b[h])}},ib:function(a){return a.ak()===0?this._km:a.ao()===2?Math.min(180,this._kl):this._kl},i6:function(x){var C=0;for(var k=x.ap();k.i1();k.i2()){var b=k.i8(),q=b.a3(),D=this.i0(q),j=-D._g,B=D._b,A=D._c,w=0,m=w+1,z=A._b,v=z.d(),g;for(;m>w;m=(g.y-B)/(g.x-j)){g=v,z=A.ai(z),v=z.d(),w=(v.y-g.y)/(v.x-g.x)}D._d=-Math.atan(m)*180/Math.PI,w=0,m=w-1,z=A._b;for(v=z.d();z.a().d().x===v.x;v=z.d()){z=z.a()}var y;for(;m<w;m=(y.y-B)/(y.x-j)){y=v,z=A.aj(z),v=z.d(),w=(v.y-y.y)/(v.x-y.x)}D._e=Math.atan(m)*180/Math.PI,C+=D._d+D._e}return C},aa:function(b,a){this._kn[b.al()]=a},p:function(c){var a=this.i0(c),d=new bh,b=2*this.q(c);d.aa(new aY(0,0)),d.aa(new aY(0,b)),d.aa(new aY(b,b)),d.aa(new aY(b,0)),a._c=d,a._a=b/2,a._b=b/2},r:function(z){if(z.ao()===0){this.p(z)}else{var E=this.i0(z),j=this.q(z),a=new bh;a.aa(new aY(-j,-j)),a.aa(new aY(-j,j)),a.aa(new aY(j,-j)),a.aa(new aY(j,j));for(var w=z.aw();w.i1();w.i2()){var F=this.i0(w.i9());a.az(F._c)}var g=bP.h(a),D=Number.MAX_VALUE,y=Number.MAX_VALUE,q=Number.MIN_VALUE,B=Number.MIN_VALUE;for(var x=g.ah();x.i1();x.i2()){var b=x.i6();b.x<D&&(D=b.x),b.x>q&&(q=b.x),b.y<y&&(y=b.y),b.y>B&&(B=b.y)}var A=new bh;for(var C=g.ah();C.i1();C.i2()){var k=C.i6();A.aa(new aY(k.x-D,k.y-y))}E._c=A,E._a=-D,E._b=-y}},s:function(x){if(x.ao()===0){this.r(x)}else{for(var C=x.aw();C.i1();C.i2()){this.s(C.i9())}this.i7(x);var j=0;for(var a=x.aw();a.i1();a.i2()){var m=a.i9(),D=this.i0(m),g=180-(360-this.ib(x))/2-j-(D._e+D._f);j+=D.a(),g=g/180*Math.PI;var B=Math.sin(g),w=Math.cos(g);for(var k=D._c._b;k!=null;k=k.a()){var z=k.d(),q=z.x+D._g,b=z.y-D._b,y=new aY(q*w-B*b,q*B+w*b);k.c(y)}var A=D._a+D._g;D._a=A*w,D._b=A*B}this.r(x)}},t:function(m){var w=this._a.g4(m),g=0;if(m.ak()>0){var b=m.aq().i9(),j=this._a.g4(b);g=Math.PI+Math.atan2(j.y-w.y,j.x-w.x)}for(var x=m.aw();x.i1();x.i2()){var d=x.i9(),v=this.i0(d);if(g!==0){var q=Math.cos(g),k=Math.sin(g),h=v._a*q-k*v._b,p=v._a*k+q*v._b;v._a=h,v._b=p}this._a.s2(d,w.x+v._a,w.y+v._b),this.t(d)}},q:function(a){return 1.41*(Math.max(this._a.gj(a),this._a.g9(a))/2)}});var ap=function(){};_twaver.ext(ap,Object,{i2:function(a){return a.ad()},i1:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var a0=function(a){this._a=a};_twaver.ext(a0,Object,{i2:function(b){var a=0;for(var c=b.an();c.i1();c.i2()){this._a.i1(c.i9())!=null&&a++}return a},i4:function(a){return this._a.i1(a)==null},i1:function(a){throw"Error"},i3:function(a){throw"Error"}});var ak=function(){ak.superClass.constructor.call(this),this._kq=!1,this._kp=90};_twaver.ext(ak,bM,{a:function(b,a){this._kr=a,this._ks=b,this._kq=!0},i7:function(Q){if(!this.u(Q)){ak.superClass.i7.call(this,Q);return}var D=this.i9(),J=this.ib(Q),G=(360-J)/2+J,M=new br(Q.ap());do{var F=this.i6(Q);F=(360-J)/2;var I=null,B=null;for(var V=M._b;V!=null;V=V.a()){var P=V.d(),L=P.a3(),T=this.i0(L),N=this._ks.i3(P),H=N-(F+T._e);H>=0&&N+T._d>=G&&(F+T.a()<=G?H=G-F-T.a():H=2*(G-(N+T._d))),T._f=0;if(H>=0){T._f=H,I=V,B=T}else{-H>T._d+T._e?H=(T._d+T._e)/2:H/=-2,F-=H,F<=G&&F+T.a()>G&&(F+=H,H=F+T.a()-G,F-=H);for(;I!=null&&H>B._f;B=this.i0(I.d().a3())){H-=B._f,B._f=0,I=I.b();if(I!=null){continue}B=null;break}I!=null?B._f-=H:F+=H}F+=T.a()}if(F<=G){var R=0,A=(360-J)/2;for(var K=Q.ap();K.i1();K.i2()){var O=K.i8(),k=O.a3(),U=this._ks.i3(O),z=this.i0(k),C=A+z._f+z._e;R<Math.abs(C-U)&&(R=Math.abs(C-U)),A+=z.a()}if(R<=this._kp){break}}for(var j=Q.aw();j.i1();j.i2()){var q=j.i9();this.i0(q)._g*=1+D}}while(!0)},ib:function(a){return this.u(a)?a.ak()===0?this.ic():this.ia():ak.superClass.ib.call(this,a)},u:function(a){return !this._kq||a.ao()===0?!1:this._ks.i1(a.ag())!=null}});var ah=function(a){this._a=a};_twaver.ext(ah,Object,{i1:function(a){return this._a.i1(a)},i2:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var am=function(){};_twaver.ext(am,Object,{w1:function(a){this._bb=a},w2:function(){return this._bb},w4:function(a){this._bb!=null&&this._bb.i2(a)},w3:function(a){return this._bb!=null?this._bb.i1(a):!0}});var bD=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};_twaver.ext(bD,am,{i1:function(J){if(this.w2()!=null){var w=!0,C=J.xk(),z=ax.a3(J,C),F=an.d(z),x=an.d(z);for(var B=0;B<z;B++){F[B]=new a2,x[B]=new br}for(var q=J.xf();q.i1();q.i2()){var N=q.i8();x[C.i2(N.a2())].aa(N),J.h1(N)}for(var I=J.x9();I.i1();I.i2()){var E=I.i9();F[C.i2(E)].aa(E),J.h2(I.i9())}for(var L=0;L<z;L++){for(var G=F[L].x1();G.i1();G.i2()){J.h3(G.i9())}for(var A=x[L].c1();A.i1();A.i2()){J.u1(A.i8())}w=this.w3(J);for(var K=x[L].c1();K.i1();K.i2()){J.h1(K.i8())}for(var k=F[L].x1();k.i1();k.i2()){J.h2(k.i9())}if(!w){break}}for(var D=0;D<z;D++){for(var H=F[D].x1();H.i1();H.i2()){J.h3(H.i9())}}for(var j=0;j<z;j++){for(var M=x[j].c1();M.i1();M.i2()){J.u1(M.i8())}}return J.xi(C),w}return !0},i2:function(bW){if(bW.xb()){return}var J=bW.xk(),X=ax.a3(bW,J),R=an.d(X),bt=an.d(X),P=an.d(X),W=an.d(X);for(var H=0;H<X;H++){R[H]=new a2,bt[H]=new br}for(var bV=bW.xf();bV.i1();bV.i2()){var Z=bV.i8();bt[J.i2(Z.a2())].aa(Z),bW.h1(Z)}for(var bT=bW.x9();bT.i1();bT.i2()){var V=bT.i9();R[J.i2(V)].aa(V),bW.h2(bT.i9())}for(var bX=0;bX<X;bX++){for(var G=R[bX].x1();G.i1();G.i2()){bW.h3(G.i9())}for(var Y=bt[bX].c1();Y.i1();Y.i2()){bW.u1(Y.i8())}this.w4(bW);var bU=bW.g3();P[bX]=new aV(bU.x,bU.y,bU.width,bU.height);var B={};W[bX]=B;if(this._cf>0){var bY=this._cg+Math.ceil((bU.width+1)/this._cf)*this._cf,I=this._cg+Math.ceil((bU.height+1)/this._cf)*this._cf;B.x=bU.x,B.y=bU.y,B.width=bY,B.height=I}else{B.x=bU.x,B.y=bU.y,B.width=bU.width+this._cg,B.height=bU.height+this._cg}for(var c=bt[bX].c1();c.i1();c.i2()){bW.h1(c.i8())}for(var F=R[bX].x1();F.i1();F.i2()){bW.h2(F.i9())}}for(var a=0;a<X;a++){for(var q=R[a].x1();q.i1();q.i2()){bW.h3(q.i9())}}for(var Q=0;Q<X;Q++){for(var at=bt[Q].c1();at.i1();at.i2()){bW.u1(at.i8())}}bO.a(W,null,this._ce/this._ch);if(this._cf<=0){for(var z=0;z<W.length;z++){this.w5(bW,R[z],bt[z],new aY(W[z].x,W[z].y),P[z])}}else{for(var U=0;U<W.length;U++){var j=Math.floor((W[U].x-P[U].x)/this._cf)*this._cf,w=Math.floor((W[U].y-P[U].y)/this._cf)*this._cf,bZ=P[U].x+j,K=P[U].y+w;this.w5(bW,R[U],bt[U],new aY(bZ,K),P[U])}}bW.xi(J)},w5:function(w,B,g,a,p){var b=-p.x+a.x,A=-p.y+a.y;for(var s=B.x1();s.i1();s.i2()){var k=w.ga(s.i9());w.s4(s.i9(),new aY(k.x+b,k.y+A))}for(var y=g.c1();y.i1();y.i2()){var q=y.i8(),x=new aD;for(var z=w.gp(q).c();z.i1();z.i2()){var j=z.i6();x.add(new aY(j.x+b,j.y+A))}w.s5(q,new aI(x))}}});var bB=function(){};_twaver.ext(bB,am,{i1:function(a){return this.w3(a)},i2:function(a){this.w7(a),this.w2()!=null&&this.w4(a),this.w6(a)},w7:function(a){this.e(a),this.k(a),this.i(a)},e:function(b){for(var a=b.x9();a.i1();a.i2()){var c=b.g4(a.i9());b.s1(a.i9(),c)}},w6:function(a){this.l(a),this.j(a),this.f(a)},l:function(b){for(var a=b.x9();a.i1();a.i2()){var c=b.g4(a.i9());b.s1(a.i9(),c)}},j:function(f){for(var b=f.xf();b.i1();b.i2()){var g=f.g7(b.i8()),d=g.i6();g.i8(d),d=g.i7(),g.i9(d);for(var a=0;a<g.i1();a++){var c=g.i2(a);g.i3(a,c.x,c.y)}}},k:function(f){for(var b=f.xf();b.i1();b.i2()){var g=f.g7(b.i8()),d=g.i6();g.i8(d),d=g.i7(),g.i9(d);for(var a=0;a<g.i1();a++){var c=g.i2(a);g.i3(a,c.x,c.y)}}},f:function(a){this._ca!=null&&(a.x1("A",this._ca),this._ca=null,this._b6=null),this._b8!=null&&(a.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(a){this._ca=a.xc("A"),this._ca!=null&&(this._b6=new ah(this._ca),a.x1("A",this._b6)),this._b8=a.xc("B"),this._b8!=null&&(this._b9=new ah(this._b8),a.x1("B",this._b9))}});var bH=function(){this._a=new br,this._c=10};_twaver.ext(bH,am,{i2:function(a){this._b=a.xl(),this.w9(a),this.w4(a),this.c(a),this.w8(a,this._b),a.xj(this._b)},i1:function(b){if(this.w2()==null){return !0}this._b=b.xl(),this.w9(b);var a=this.w3(b);return this.c(b),b.xj(this._b),a},w8:function(d,b){for(var f=d.xf();f.i1();f.i2()){var c=f.i8();if(b.i1(c)!=null){var a=b.i1(c);bO.g(d,c,a,this._c)}}},w9:function(m){var w=m.xk();for(var g=m.x9();g.i1();g.i2()){var b=g.i9();for(var j=b.af();j.i1();j.i2()){var x=j.i8(),d=x.a1(b),v=w.i1(d);if(v!==x){if(v==null){w.z1(d,x)}else{this._b.i1(v)==null&&this._b.i8(v,new br);var q=this._b.i1(v);q.aa(x),this._a.ac(x),m.h1(x)}}}for(var k=b.af();k.i1();k.i2()){var h=k.i8(),p=h.a1(b);w.z1(p,null)}}m.xi(w)},c:function(a){for(;!this._a.ar();a.u1(this._a.c3())){}}});var aW=function(a){this._a=a};_twaver.ext(aW,Object,{i2:function(a){this._a.i3(a)},i1:function(a){return this._a.i4(a)}});var ae=function(){ae.superClass.constructor.call(this),this._jo=30,this._jp=new bI,this._jt=5};_twaver.ext(ae,ay,{i4:function(a){return !0},i3:function(c){this._ju=c,bO.c(c);var a=this._jp.i1(c),d=0;for(var b=c.x9();b.i1();b.i2()){d=Math.max(d,this.e(b.i9()))}d<this._jt&&(d=this._jt),this.a(a,d)},a:function(w,A){var j=w.i7(),b=2*Math.PI/j,m=0,B=an.a(j);w.i4();for(var g=0;g<j;){B[g]=this.e(w.i9())+this._jo,m+=B[g],g++,w.i2()}var z=m/j,y=m/(Math.PI*2);y<A&&(y=A),w.i4();var v=0;for(var k=0;k<j;){var x=b/z*B[k];v+=x/2;var q=Math.cos(v)*y,d=Math.sin(v)*y;v+=x/2,this._ju.s2(w.i9(),q,d),k++,w.i2()}return y},e:function(b){var a=this._ju.gj(b),c=this._ju.g9(b);return a<=c?c:a}});var aj=function(){aj.superClass.constructor.call(this),this._jm=new ae,this._jk=new ak};_twaver.ext(aj,ay,{i4:function(a){return !0},i3:function(A){if(A.x0()<2){return}this._jn=A,bO.c(this._jn),bO.e(this._jn);var G=new bL(this._jn);G.a1(),G.h();var k=new bc(this._jn);k.a();for(var b=G.x9();b.i1();b.i2()){var x=b.i9(),H=G.c2(x);if(H.ay()>1){var j=G.d1(x);bc.h(this._jn,j.c1()),this._jm.i3(this._jn);var F=this._jn.g3();G.s7(x,F.width,F.height)}else{if(H.ay()===1){var D=H.x2();G.s8(x,this._jn.gm(D)),this._jn.s2(D,0,0)}else{G.s7(x,1,1)}}bc.i(this._jn,this._jn.xf())}k.b();var z=this.a7(G);aO.a4(G,z);var w=G.xk(),C=G.xl();this.a2(G,C,w),this.a1(G,C),this.a3(G,z,C),this._jk.a(C,w),this._jk.i3(G),this.a5(G,z,w);for(var y=G.x9();y.i1();y.i2()){var g=y.i9(),B=G.g4(g);for(var E=G.c2(g).x1();E.i1();E.i2()){var q=E.i9();this._jn.s2(q,B.x+this._jn.g5(q),B.y+this._jn.g6(q))}}},a7:function(d){var b=-1,f=null;for(var c=d.x9();c.i1();c.i2()){var a=c.i9();d.c2(a).ay()>b&&(f=a,b=d.c2(a).ay())}return f},a1:function(c,a){var d=function(g,h){var f=a.i3(g)-a.i3(h);return f>0?1:f>=0?0:-1};for(var b=c.x9();b.i1();b.i2()){b.i9().av(d)}},a2:function(j,m,d){var b=an.a(this._jn.x0());for(var g=j.x9();g.i1();g.i2()){var p=g.i9(),c=j.c2(p);for(var l=c.x1();l.i1();l.i2()){var k=l.i9();b[k.al()]=p.al()}}var h=aO.a2(j);this.a4(j,h,b,m,d)},a3:function(m,w,g){if(m.c2(w).ay()>1){var b=0,j=0,x=0;for(var d=w.ap();d.i1();d.i2()){var v=d.i8(),q=g.i3(v);q-b>j&&(j=q-b,x=(b+q)/2),b=q}360-b>j&&(x=(360+b)/2),this.a6(m,w,x);for(var k=w.ap();k.i1();k.i2()){var h=k.i8(),p=g.i3(h);for(p-=x;p<0;p+=360){}g.i6(h,p)}w.av(function(f,a){var c=g.i3(f)-g.i3(a);return c>0?1:c>=0?0:-1})}},a4:function(J,w,C,z,F){var x=w.al(),B=F.i3(w);for(var q=w.ap();q.i1();q.i2()){var N=q.i8(),I=J.b(N),E=0,L=0,G=0,A=0;for(var K=I.c1();K.i1();K.i2()){var k=K.i8(),D=null,H=null;C[k.a2().al()]===x?(D=k.a2(),H=k.a3()):(D=k.a3(),H=k.a2()),G-=this._jn.g5(D),A+=this._jn.g6(D),E-=this._jn.g5(H),L+=this._jn.g6(H)}if(G!==0||A!==0){var j;for(j=Math.atan2(A,G)*180/Math.PI-B;j<0;j+=360){}z.i6(N,j)}if(E!==0&&L!==0){var M=Math.atan2(L,E)*180/Math.PI;M<0&&(M+=360),F.i6(N.a3(),M)}this.a4(J,N.a3(),C,z,F)}},a5:function(m,w,g){var b=m.g4(w);for(var j=w.ap();j.i1();j.i2()){var x=j.i8(),d=x.a3(),v=m.g4(d),q=v.x-b.x,k=v.y-b.y,h=Math.atan2(k,q)*180/Math.PI;if(g.i1(d)!=null){var p=g.i3(d);h+=p}this.a6(m,d,h),this.a5(m,d,g)}},a6:function(m,w,g){g=g/180*Math.PI;var b=m.c2(w);if(b.ay()<=1){return}for(var j=b.x1();j.i1();j.i2()){var x=j.i9(),d=this._jn.g5(x),v=this._jn.g6(x),q=Math.cos(g),k=Math.sin(g),h=d*q-k*v,p=d*k+q*v;this._jn.s2(x,h,p)}}});var bQ=function(){this._a=(new Date).getTime()};_twaver.ext(bQ,Object,{b:function(){return(new Date).getTime()-this._a}});var bP={};bP._A=new aY(0,0),bP.b=function(b,a,c){return bP.c(b.x,b.y,a.x,a.y,c.x,c.y)},bP.c=function(f,b,h,d,a,c){h-=f,d-=b,a-=f,c-=b;var g=a*d-c*h;return g>=0?g<=0?0:-1:1},bP.d=function(b,a,c){return bP.b(b,a,c)>0},bP.f=function(b,a,c){return bP.b(b,a,c)<0},bP.g=function(b,a,c){return bP.b(b,a,c)===0},bP.h=function(a){return bP.i(a)},bP.i=function(g){var k=new bh(g.ah()),d=new bh;k.a2();if(k.ar()){return d}var b=k.at();d.ae(b);for(;!k.ar()&&b.equals(k.am());k.at()){}if(k.ar()){return d}b=k.at();var f=d.ae(b);for(var l=k.ah();l.i1();l.i2()){var c=l.i6();if(!c.equals(b)){b=c;if(d.ay()===2&&bP.g(d.am(),d.as(),c)){f.c(c)}else{var j;for(j=f;!bP.f(d.ai(j).d(),j.d(),c);j=d.ai(j)){}var h;for(h=f;!bP.d(d.aj(h).d(),h.d(),c);h=d.aj(h)){}for(;h!==d.aj(j);d.aw(d.aj(j))){}f=d.an(c,j)}}}return d},bP.j=function(){return bP.k(Number.MAX_VALUE)},bP.k=function(a){return Math.floor(Math.random()*a)},bP.l=function(b,a){return Math.random()*(a-b)+b};var bI=function(){};_twaver.ext(bI,Object,{i1:function(b){this._b=b;var a=new br;a=ax.a6(b),a.az(ax.a7(b));var c=this.a1();for(;!a.ar();b.x5(a.c3())){}return c.x1()},a1:function(){if(this._b.x0()<3){return new a2(this._b.x9())}var cg=this._b.xk(),b1=this._b.xk(),b7=this._b.xl(),b3=new a4(this._b,new ap,0,this.a3(this._b)),cc=this._b.x0(),b2=new br,b6=new br,b0=new bc(this._b);for(;cc>3;cc--){var ck=b3.g();for(var cf=ck.an();cf.i1();cf.i2()){cg.z1(cf.i9(),cc),b1.i5(cf.i9(),!1)}for(var b9=ck.an();b9.i1();b9.i2()){var ci=b9.i9();for(var cd=ci.ap();cd.i1();cd.i2()){var b5=cd.i8();cg.i2(b5.a3())===cc&&(b6.aa(b5),b1.i5(b5.a2(),!0),b1.i5(b5.a3(),!0))}}if(b6.ay()<ck.ad()-1){var ch=null;for(var bZ=ck.an();bZ.i1();bZ.i2()){var b8=bZ.i9();if(cg.i2(b8)===cc&&!b1.i4(b8)){if(ch==null){ch=b8}else{var ce=this._b.xo(ch,b8);b7.i7(ce,!0),b6.aa(ce),ch=null}}}if(ch!=null){for(var bW=ck.an();bW.i1();bW.i2()){var cj=bW.i9();if(cj===ch||cj.aj(ch)!=null){continue}var bY=this._b.xo(ch,cj);b7.i7(bY,!0),b6.aa(bY);break}}if(b6.ay()<ck.ad()-1){var at=2147483647,H=null;for(var bX=ck.an();bX.i1();bX.i2()){var G=bX.i9();G.ad()<at&&(H=G,at=G.ad())}for(var V=ck.an();V.i1();V.i2()){var bT=V.i9();if(H.aj(bT)!=null||H===bT){continue}var ca=this._b.xo(H,bT);b7.i7(ca,!0),b6.aa(ca);if(b6.ay()>=ck.ad()-1){break}}}}for(var X=ck.an();X.i1();X.i2()){b3.b(X.i9())}for(var bV=b6.c1();bV.i1();bV.i2()){var Q=bV.i8();b7.i4(Q)&&(b3.d(Q.a2()),b3.d(Q.a3()))}b2.az(b6),b0.e(ck)}b0.b(),b3.c();for(var W=b2.c1();W.i1();W.i2()){var cl=W.i8();cl._h!=null&&(b7.i4(cl)?this._b.x5(cl):this._b.h1(cl))}var bt=this.a4(this._b),K=new a2,bU=bt.ak(0),cb=bt.ak(1),Z=null;bU.a2()===cb.a2()||bU.a2()===cb.a3()?Z=bU.a3():Z=bU.a2(),K.aa(Z);for(var Y=bt.c1();Y.i1();Y.i2()){var b4=Y.i8();Z=b4.a1(Z),K.aa(Z)}for(var J=b2.c1();J.i1();J.i2()){var z=J.i8();!b7.i4(z)&&z._h==null&&this._b.u1(z)}return this._b.xi(b1),this._b.xj(b7),this._b.xi(cg),this.a2(K),K},a2:function(q){if(q.ay()<this._b.x0()){var y=this._b.xk();for(var g=q._b;g!=null;g=g.a()){var b=g.d();y.z1(b,g)}var k;for(k=new a4(this._b,new a0(y),0,q.ay(),new a0(y));!k.e();){var z=k.f();for(var d=z.an();d.i1();d.i2()){var x=d.i9();if(y.i1(x)==null){continue}var w=y.i1(x),p=q.ai(w).d(),j=null;z.aj(p)!=null?j=q.ao(z,w):j=q.an(z,w),y.z1(z,j);break}for(var v=z.an();v.i1();v.i2()){var m=v.i9();y.i1(m)==null&&k.d(m)}}this._b.xi(y),k.c()}},a3:function(b){var a=0;for(var c=b.x9();c.i1();c.i2()){a=Math.max(a,c.i9().ad())}return a},a4:function(w){var A=[];for(var j=0,b=w.x0();j<b;j++){A[j]=new bk}var m=new aw(A);m.a6(!1),m.a8(w);var B=-1,g=null;for(var z=w.x9();z.i1();z.i2()){var y=z.i9(),v=A[y.al()];v._a+v._c>B&&(B=v._a+v._c,g=y)}var k=new br,x=g;for(var q=A[x.al()]._d;q!=null;q=A[x.al()]._d){k.ac(q),x=q.a1(x)}x=g;for(var d=A[x.al()]._b;d!=null;d=A[x.al()]._d){k.ae(d),x=d.a1(x)}return k}});var bG=function(){this._v=new bz,this._x=new bz,this._z=new bJ(3,5),this._w=new bJ(3,5),this._y=!1,this._u=!1,this._t={}};_twaver.ext(bG,Object,{xm:function(){var a=new bp(this);return a},xo:function(b,a){return this.xn(b,null,a,null,0,0)},xn:function(f,b,g,d,a,c){return new ba(this,f,b,g,d,a,c)},x4:function(a){this.b3(a)},b3:function(b){var a;while((a=b._o[0])!=null){this.x5(a)}while((a=b._o[1])!=null){this.x5(a)}this._v.c(b),b._g=null,this._y=!0},x5:function(a){this.a11(a)},a11:function(b){if(b._h!==this){throw"Error"}var a=b.a2(),c=b.a3();this.a12(b,a,c),this._x.c(b),b._h=null,this._u=!0},x7:function(a){a._p=this._v._c,a._g=this,a.ac(),a._c.length<this._z._b&&this._z.a3(a,a._c.length,this._z._b),this._v.a(a),this._y=!0},x8:function(a){if(a._h!=null){throw"Error"}a._c.length<this._w._b&&this._w.a3(a,a._c.length,this._w._b),a._a==null||a._a._h!==this?this._x.a(a):this._x.b(a,a._a),a._h=this,a.a4(),this.b2(a,a.a2(),null,a.a3(),null,0,0),this._u=!0},xr:function(d,b,f){var c=d.a2(),a=d.a3();d._h==null?(d._d=b,d._e=f):(c!==b&&(c.ar(d,0,0),d._d=b,b.ab(d,null,0,0,0)),a!==f&&(a.ar(d,1,1),d._e=f,f.ab(d,null,1,1,0)))},x3:function(a){this.xr(a,a.a3(),a.a2())},h1:function(a){this.a11(a)},u1:function(a){this.x8(a)},h2:function(a){this.x4(a)},h3:function(a){this.x7(a)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return this._v._c===0},xq:function(a){return a._g===this},xp:function(a){return a._h===this},xd:function(){return this._v._a},x9:function(){return new a3(this._v)},xf:function(){return new a3(this._x)},x2:function(f,b){var g=an.d(this.xh());if(f!=null&&b!=null){for(var d=this.x9();d.i1();d.i2()){d.i9().at(f,1,g),d.i9().at(b,0,g)}}else{if(b==null&&f!=null){for(var a=this.x9();a.i1();a.i2()){a.i9().at(f,1,g)}}else{if(b!=null&&f==null){for(var c=this.x9();c.i1();c.i2()){c.i9().at(b,0,g)}}}}},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(a){this._z.a5(a,this._v)},xj:function(a){this._w.a6(a,this._x)},xc:function(a){return this._t[a]},x1:function(b,a){this._t[b]=a},x6:function(a){delete this._t[a]},b2:function(f,b,h,d,a,c,g){b.ab(f,h,0,0,c),d.ab(f,a,1,1,g)},a12:function(b,a,c){a.ar(b,0,0),c.ar(b,1,1)},c:function(){var b=0;for(var a=this.x9();a.i1();a.i2()){a.i9()._p=b++}this._y=!1},b1:function(){var b=0;for(var a=this.xf();a.i1();a.i2()){a.i8()._g=b++}this._u=!1},xs:function(a){a.as(this,this._z._b),a._p=this._v._c,this._v.a(a)},xt:function(f,b,h,d,a,c,g){f.a6(this,b,d,this._w._b),f._g=this._x._c,this._x.a(f),this.b2(f,f.a2(),h,f.a3(),a,c,g)}});var a1=function(){a1.superClass.constructor.call(this)};_twaver.ext(a1,bG,{gb:function(a){return this.g1(a)},g7:function(a){return this.g2(a)},g5:function(b){var a=this.g1(b);return a.i1()+a.i3()/2},g6:function(b){var a=this.g1(b);return a.i2()+a.i4()/2},g4:function(a){return new aY(this.g5(a),this.g6(a))},gi:function(a){return this.g1(a).i1()},gh:function(a){return this.g1(a).i2()},ga:function(b){var a=this.g1(b);return new aY(a.i1(),a.i2())},gj:function(a){return this.g1(a).i3()},g9:function(a){return this.g1(a).i4()},gm:function(a){return new aS(this.gj(a),this.g9(a))},s1:function(b,a){this.s2(b,a.x,a.y)},s2:function(c,a,d){var b=this.g1(c);b.i5(a-b.i3()/2,d-b.i4()/2)},s7:function(b,a,c){this.g1(b).i6(a,c)},s8:function(b,a){this.s7(b,a.width,a.height)},s3:function(b,a,c){this.g1(b).i5(a,c)},s4:function(b,a){this.s3(b,a.x,a.y)},gp:function(c){var a=this.g2(c),d=new aD;for(var b=0;b<a.i1();b++){d.add(a.i2(b))}return new aI(d)},gf:function(c){var a=this.g2(c),d=new bh;for(var b=0;b<a.i1();b++){d.aa(a.i2(b))}return d},gc:function(b){var a=new aD;a.add(this.gs(b));for(var c=this.gp(b).d();c.i1();c.i2()){a.add(c.i6())}return a.add(this.gl(b)),new aI(a)},gd:function(b){var a=new bh;a.aa(this.gs(b));for(var c=this.gp(b).d();c.i1();c.i2()){a.aa(c.i6())}return a.aa(this.gl(b)),a},m1:function(f,b){var h=this.g2(f);h.i5();var d=b.ah(),a=d.i6();this.gx(f,a);var c=b.as();d.i2();for(;d.i6()!==c;d.i2()){var g=d.i6();h.i4(g.x,g.y)}this.gy(f,c)},s5:function(d,b){var f=this.g2(d);f.i5();for(var c=b.d();c.i1();c.i2()){var a=c.i6();f.i4(a.x,a.y)}},s6:function(d,b){var f=this.g2(d);f.i5();for(var c=b.ah();c.i1();c.i2()){var a=c.i6();f.i4(a.x,a.y)}},m2:function(b,a,c){this.gx(b,a),this.gy(b,c)},gn:function(a){return this.g2(a).i6()},gk:function(a){return this.g2(a).i7()},gt:function(b,a){this.g2(b).i8(a)},gz:function(b,a){this.g2(b).i9(a)},gs:function(b){var a=this.g2(b).i6();if(a==null){return this.g4(b.a2())}var c=new aY(this.g5(b.a2())+a.x,this.g6(b.a2())+a.y);return c},gl:function(b){var a=this.g2(b).i7();if(a==null){return this.g4(b.a3())}var c=new aY(this.g5(b.a3())+a.x,this.g6(b.a3())+a.y);return c},gx:function(b,a){var c=new aY(a.x-this.g5(b.a2()),a.y-this.g6(b.a2()));this.g2(b).i8(c)},gy:function(b,a){var c=new aY(a.x-this.g5(b.a3()),a.y-this.g6(b.a3()));this.g2(b).i9(c)},g8:function(){var b=new br;for(var a=this.xf();a.i1();a.i2()){b.aa(a.i8())}return b},g3:function(){var j,m=j=Number.MAX_VALUE,d,b=d=Number.MIN_VALUE;for(var g=this.x9();g.i1();g.i2()){var p=this.ga(g.i9()),c=this.gm(g.i9());m=Math.min(p.x,m),j=Math.min(p.y,j),b=Math.max(p.x+c.width,b),d=Math.max(p.y+c.height,d)}for(var l=this.xf();l.i1();l.i2()){for(var k=this.gp(l.i8()).c();k.i1();k.i2()){var h=k.i6();m=Math.min(h.x,m),j=Math.min(h.y,j),b=Math.max(h.x,b),d=Math.max(h.y,d)}}return{x:Math.floor(m),y:Math.floor(j),width:Math.floor(b-m),height:Math.floor(d-j)}}});var aa=function(){aa.superClass.constructor.call(this),this.a(new aX,new aR)};_twaver.ext(aa,a1,{a:function(b,a){this._a3=b,this._a4=a},xo:function(b,a){return this.l2(b,a,this._a4.a6())},l2:function(b,a,c){return this.l1(b,null,a,null,0,0,c)},xn:function(f,b,g,d,a,c){return this.l1(f,b,g,d,a,c,this._a4.a6())},l1:function(g,c,j,f,b,d,h){var a=new ba(this,g,c,j,f,b,d);return a._l=h,a},xm:function(){var a=new bp(this);return a._r=this._a3.m3(),a},g3:function(){var b={x:0,y:0,width:-1,height:-1};for(var a=this.x9();a.i1();a.i2()){a.i9()._r.m1(b)}return b},g1:function(a){return a._r},g2:function(a){return a._l},g5:function(a){return a._r.m4()},g6:function(a){return a._r.m5()},gi:function(a){return a._r.i1()},gh:function(a){return a._r.i2()},gj:function(a){return a._r.i3()},g9:function(a){return a._r.i4()},s2:function(b,a,c){b._r.m6(a,c)},s7:function(b,a,c){b._r.i6(a,c)},s3:function(b,a,c){b._r.i5(a,c)}});var ad=function(){ad.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};_twaver.ext(ad,a1,{g1:function(b){var a=this._ap.i1(b);return a==null&&(a=new a5,this._ap.z1(b,a)),a},g2:function(b){var a=this._as.i1(b);return a==null&&(a=new a7,this._as.i8(b,a)),a}});var bL=function(a){bL.superClass.constructor.call(this),this._ay=a,this._a0=this.xk(),this._au=this.xl()};_twaver.ext(bL,ad,{c2:function(b){var a=this._a0.i1(b);return a},a2:function(b,a){this._a0.z1(b,a)},h:function(){this._az==null&&(this._az=this.xk());var w=an.a(this._ay.x0()+1),A=1;for(var j=this.x9();j.i1();){var b=this.c2(j.i9());for(var m=b.x1();m.i1();m.i2()){var B=m.i9();w[B.al()]=A}var g=new br;for(var z=b.x1();z.i1();z.i2()){var y=z.i9(),v=w[y.al()];for(var k=y.ap();k.i1();k.i2()){var x=k.i8(),q=x.a3(),d=w[q.al()];d===v&&g.ac(x)}}this._az.z1(j.i9(),g),j.i2(),A++}},d1:function(a){return this._az.i1(a)},b:function(a){return this._au.i1(a)},a3:function(b,a){this._au.i8(b,a)},a1:function(){var c=this._ay.xk(),a=bN.a4(an.a(this._ay.xh())),d=ax.a1(this._ay,a,c),b=ax.a5(this._ay,a,d);this.d2(c,b),this._ay.xi(c)},c1:function(f){var b=null,g=-1;for(var d=0,a=f.length;d<a;d++){var c=f[d];c.ay()>g&&(b=c,g=c.ay())}return b},d2:function(cE,cn){var ct=this._ay.xl(),co=this._ay.xk(),cz=cn.length;for(var cs=0;cs<cz;cs++){var cm=cn[cs];for(var cI=cm.c1();cI.i1();cI.i2()){ct.i8(cI.i8(),cm)}}var cD=this.c1(cn);this.a4(cD,cE,ct,new aD,co);var cv={};cz=cn.length;for(var cG=0;cG<cz;cG++){var cA=cn[cG];if(cA.ay()>1){var cr=this.xm();cv[cA._id]=cr}}for(var cF=this._ay.x9();cF.i1();cF.i2()){var cl=cF.i9();if(cE.i4(cl)&&co.i1(cl)==null){var cu=this.xm();cv[cl._id]=cu;var cB=new a2;cB.aa(cl),this.a2(cu,cB)}}var ci=an.d(2);cz=cn.length;for(var cH=0;cH<cz;cH++){var ck=cn[cH];if(ck.ay()===1){var b8=ck.c2();ci[0]=b8.a2(),ci[1]=b8.a3();for(var bU=0;bU<2;bU++){var cj=ci[bU];if(cj.ad()===1){var bT=this.xm();cv[cj._id]=bT;var bZ=new a2;bZ.aa(cj),this.a2(bT,bZ)}}}}for(var ca=this._ay.x9();ca.i1();ca.i2()){var cw=ca.i9();if(co.i1(cw)!=null){var b1=co.i1(cw),cc=cv[b1._id];for(var bY=cw.af();bY.i1();bY.i2()){var b0=bY.i8();if(ct.i1(b0)!==b1){var cJ=cv[ct.i1(b0)._id];if(cJ==null){var b9=b0.a1(cw),bX=co.i1(b9);bX!=null?cJ=cv[bX._id]:cJ=cv[b9._id]}var cb=cc.aj(cJ),cy=null;cb==null?(cb=this.xo(cc,cJ),cy=new br):cy=this.b(cb),cy.aa(b0),this.a3(cb,cy)}}}else{if(cE.i4(cw)){var b7=cv[cw._id];for(var b4=cw.af();b4.i1();b4.i2()){var cp=b4.i8(),bV=cp.a1(cw),bt=cv[bV._id];if(bt!=null){var ch=b7.aj(bt);if(ch==null){var Z=this.xo(b7,bt),H=new br;H.aa(cp),this.a3(Z,H)}}}}}}if(this._ay.x0()===2&&this._ay.xg()===1){var at=this._ay.xf().i8(),cg=cv[at.a2()._id],b3=cv[at.a3()._id];if(b3!=null&&cg!=null&&b3.aj(cg)==null){var b2=this.xo(cg,b3),bW=new br;bW.aa(at),this.a3(b2,bW)}}var b6=an.a(this._ay.x0()),s=1;cz=cn.length;for(var cq=0;cq<cz;cq++){var cC=cn[cq],cx=cv[cC._id];if(cx!=null){var cf=this.c2(cx);cf==null&&(cf=new a2,this.a2(cx,cf));for(var cd=cC.c1();cd.i1();cd.i2()){var b5=cd.i8(),ce=b5.a2();b6[ce.al()]!==s&&(!cE.i4(ce)||co.i1(ce)===cC)&&(b6[ce.al()]=s,cf.aa(ce)),ce=b5.a3(),b6[ce.al()]!==s&&(!cE.i4(ce)||co.i1(ce)===cC)&&(b6[ce.al()]=s,cf.aa(ce))}}}this._ay.xj(ct),this._ay.xi(co)},a4:function(m,w,g,b,j){if(b.contains(m)){return}b.add(m);var x=[];for(var d=m.c1();d.i1();d.i2()){var v=d.i8();x[0]=v.a2(),x[1]=v.a3();for(var q=0;q<2;q++){var k=x[q];if(w.i4(k)&&j.i1(k)==null){m.ay()>1&&j.z1(k,m);for(var h=k.af();h.i1();h.i2()){var p=g.i1(h.i8());this.a4(p,w,g,b,j)}}}}}});var be=function(F,q,x,s,B){this._a={},be.superClass.constructor.call(this);var w=new aD,J,E;for(J=0,E=q.size();J<E;J++){var A=q.get(J);if(A instanceof twaver.Link){w.add(A)}else{var H=s&&B==null&&A instanceof aB;H&&A.setExpanded(!0);var C=F.getDimension(A);H&&A.setExpanded(!1);if(C==null){continue}var u=this.xm(),G=F._repulsion;x==="rightleft"||x==="leftright"?this.s7(u,C.height*G,C.width*G):this.s7(u,C.width*G,C.height*G),u.node=A,this._a[A.getId()]=u}}for(J=0,E=w.size();J<E;J++){var k=w.get(J),z=k.getFromAgent(),D=k.getToAgent(),j=this._a[z.getId()],I=this._a[D.getId()];if(j==null||I==null||j===I){continue}this.xo(j,I)}};_twaver.ext(be,aa,{});var bO={};bO._D=new aI,bO._E=new aY(0,0),bO.b=function(f){if(f.i1()>0){var c=new aD;for(var h=f.i1()-1;h>=0;h--){c.add(f.i2(h))}f.i5();for(var d=0,b=c.size();d<b;d++){var g=c.get(d);f.i4(g.x,g.y)}}var a=f.i6();f.i8(f.i7()),f.i9(a)},bO.c=function(a){bO.d(a,!0)},bO.d=function(d,b){if(b){for(var f=d.xf();f.i1();f.i2()){var c=f.i8();d.gt(c,bO._E),d.gz(c,bO._E),d.s5(c,bO._D)}}else{for(var a=d.xf();a.i1();a.i2()){d.s5(a.i8(),bO._D)}}},bO.e=function(c){var a=new aY(0,0);for(var d=c.xf();d.i1();d.i2()){var b=d.i8();c.gt(b,a),c.gz(b,a)}},bO.f=function(Q,D,I,G){var M=Q.gc(D).b(),H=an.d(M),A=0;for(var P=Q.gc(D).c();P.i1();P.i2()){var U=P.i6();if(A<=0||!U.equals(H[A-1])){H[A]=new aY(U.x,U.y),A++}}M=A;if(M<2){return}var R=new aD,z=new aN(H[1].x-H[0].x,H[1].y-H[0].y),J=bO.i(z);J.x*=G,J.y*=G;var O=bO.h(H[0],J),p=bO.h(H[1],J),V=new aQ(O,p);for(var s=1;s<M-1;s++){var B=V,h=bO.i(new aN(H[s+1].x-H[s].x,H[s+1].y-H[s].y));h.x*=G,h.y*=G;var q=bO.h(H[s],h),a=bO.h(H[s+1],h);V=new aQ(q,a);var j=aQ.a6(B,V);j!=null&&R.add(new aY(j.x,j.y))}var F=new aN(H[M-1].x-H[M-2].x,H[M-1].y-H[M-2].y);F=bO.i(F),F.x*=G,F.y*=G;var K=bO.h(H[M-1],F),l=new aI(R);D.a2()===I.a2()?(Q.s5(I,l),Q.m2(I,O,K)):(Q.s5(I,l.a()),Q.m2(I,K,O))},bO.g=function(f,b,h,d){var a=d;for(var c=h.c1();c.i1();c.i2()){var g=c.i8();bO.f(f,b,g,a),a<0&&(a-=d),a=-a}},bO.a=function(b,a,c){return bO.j(b,a,c,1)},bO.l=function(O,B,H){if(O==null||O.length<1){return B!=null&&(B.x=0,B.y=0,B.width=0,B.height=0),{width:0,height:0}}var D=0,K=0;for(var C=0;C<O.length;C++){var G=O[C];D=Math.max(D,G.width),K=Math.max(K,G.height)}var z=D*K*O.length,T=Math.sqrt(z/H),N=z/T,J=Math.floor(N/D),Q=Math.ceil(N/D),L=Math.ceil(O.length/J),F=Math.ceil(O.length/Q),P,x;J*L<Q*F?(P=J,x=L):(P=Q,x=F);var I=0,M=0,k=0,R=0,q;if(D>K){for(var A=0;A<O.length;A++){q=O[A],q.x=M*D,q.y=I*K,k=Math.max(k,q.x+q.width),R=Math.max(R,q.y+q.height),++M>=P&&(I++,M=0)}}else{for(var j=0;j<O.length;j++){q=O[j],q.x=M*D,q.y=I*K,k=Math.max(k,q.x+q.width),R=Math.max(R,q.y+q.height),++I>=x&&(M++,I=0)}}return B!=null&&(B.x=0,B.y=0,B.width=k,B.height=R),{width:x,height:P}},bO.j=function(b0,R,bt,X){if(b0==null||b0.length<1){return R!=null&&(R.x=0,R.y=0,R.width=0,R.height=0),0}var bW,V=bW=b0[0].width,at,P=at=b0[0].height,b4=b0.length;for(var bZ=1;bZ<b4;bZ++){var bU=b0[bZ].width;V=Math.min(V,bU),bW=Math.max(bW,bU);var b2=b0[bZ].height;P=Math.min(P,b2),at=Math.max(at,b2)}if(P/at>0.95&&V/bW>0.95){return bO.l(b0,R,bt).width}var bX=new bh,Z=0;for(var b1=0;b1<b4;b1++){var K=b0[b1];bX.aa(b0[b1]),Z=Math.floor(Z+K.width*K.height)}bX.a1(function(b,a){var c=Math.floor(a.height)-Math.floor(b.height);return c===0?Math.floor(a.width)-Math.floor(b.width):c});var bT=0,bY=0,H=Math.floor(bt*Math.sqrt(Z/bt)),b3=H,J=0,Q=new bh;do{var q=new bh;Q.aa(q);var I,j,B=I=j=0;for(var W=bX.ah();W.i1();W.i2()){var bV=W.i6();B+bV.width>b3&&q.ay()>0?(j=Math.max(j,B),q=new bh,q.aa(bV),Q.aa(q),B=Math.floor(bV.width)):(q.aa(bV),B=Math.floor(B+bV.width)),q.ay()===1&&(I=Math.floor(I+q.am().height))}j=Math.max(j,B),bt*I>j&&J!==j&&(Q.af(),b3=Math.floor(b3*1.1),J=j)}while(Q.ar());var G=0;for(var Y=Q.ah();Y.i1();Y.i2()){var z=0,F=Y.i6();for(var b5=F.ah();b5.i1();b5.i2()){var U=b5.i6();U.x=z,U.y=G,z+=U.width}bT=Math.max(bT,z),G+=bO.k(F),bY=Math.max(bY,G)}return R!=null&&(R.x=0,R.y=0,R.width=bT,R.height=bY),Q.ay()},bO.k=function(b){var a=0;for(var c=b.ah();c.i1();c.i2()){a=Math.max(c.i6().height,a)}return a},bO.h=function(b,a){return new aY(b.x+a.x,b.y+a.y)},bO.i=function(b){var a=Math.sqrt(b.x*b.x+b.y*b.y);return new aN(-b.y/a,b.x/a)};var bR=function(a){this._a=a,this._b=!1};_twaver.ext(bR,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return this._a===1},d:function(){return this._a===2},e:function(){return this._a===4},f:function(){return this._a===8},g:function(){return this._a===0}}),bR.h=function(b,a){var c=b.xc("A");return c==null?null:c.i1(a)},bR.i=function(b,a){var c=b.xc("B");return c==null?null:c.i1(a)},bR.j=function(a){switch(a){case 1:return bR.k;case 2:return bR.l}return null},bR.k=new bR(1),bR.l=new bR(2);var ar=function(f,b,g,d,a){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=f,this._a=0.0001,this._r=b,this._p=1,this._e=(a.gj(f)+a.g9(f))/4;var c=0.45*g*Math.sqrt(d);this._k=bP.l(-c,c),this._h=bP.l(-c,c),this._g=bP.l(-c,c)};_twaver.ext(ar,Object,{});var aG=function(){this._a=0,this._c=0,this._b=0};_twaver.ext(aG,Object,{});var bE=function(){bE.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=0.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=300000,this._ee=2,this._di=2,this._df=1000};_twaver.ext(bE,ay,{i4:function(a){return !0},i3:function(g){if(g==null){return}this._d5=g;if(!this.s(g)){return}var k=new aG,d=0,b=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);b=Math.max(b,10000);var f=this._ea*this._ea*this._dz.length,l=this._df;try{for(;this._dj>f&&d<b;d++){var c=this.b(d&2147483647);l--===0&&(this._dy.b()>this._eb&&(d=b),l=this._df),this.h(c,k),this.d(c,k),this.i(c,k),this._d8?(this.g(c,k),this.j(c,k)):(this.f(c,k),this.c(c,k));var j=Math.sqrt(k._a*k._a+k._c*k._c+k._b*k._b);this.ac(c,k,j),this.aa(c,k,j)}}catch(h){}finally{this.r()}},s:function(f){if(f==null||f.xa()<1){return !1}this._d5=f,this._dp=1,this._dy=new bQ,this._dt=f.x0(),this._d2=an.d(this._dt),this._df=1+100000/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(this._dl*0.05),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new aG,this._dq=Math.max(20*this._dl,10);var b=Math.max(0.1,Math.min(this._dw*this._dl,this._dq)),g=this._dt;bO.c(f),this._dz=an.d(g);for(var d=f.x9();d.i1();d.i2()){var a=d.i9(),c=new ar(a,b,this._dl,this._dt,f);this._dz[--g]=c,this._dj+=c._r,this._dh+=c._r*c._r,this._du._a+=c._k,this._du._c+=c._h,this._du._b+=c._g,this._d2[a.al()]=c}return this._d8=!1,this._dz.length>0},b:function(d){var b=this._dz.length,f=b-d%b-1,c=bP.k(f+1),a=this._dz[c];return this._dz[c]=this._dz[f],this._dz[f]=a,a},f:function(O,B){var H,D,K=H=D=0;for(var C=O._b.ae();C!=null;C=C.a7()){var G=this._d2[C.a2().al()],z=G._k-O._k,T=G._h-O._h,N=G._g-O._g,J=z*z+T*T+N*N,Q,L=Math.sqrt(J),F=L-(G._e+O._e);if(F<=0){continue}Q=F*F*this._d3/L,K+=z*Q,H+=T*Q,D+=N*Q}for(var P=O._b.ag();P!=null;P=P.a8()){var x=this._d2[P.a3().al()],I=x._k-O._k,M=x._h-O._h,k=x._g-O._g,R=I*I+M*M+k*k,q,A=Math.sqrt(R),j=A-(x._e+O._e);if(j<=0){continue}q=j*j*this._d3/A,K+=I*q,H+=M*q,D+=k*q}B._a+=K,B._c+=H,B._b+=D},g:function(O,B){var H,D,K=H=D=0;this._dp++,O._f=this._dp;for(var C=O._b.ae();C!=null;C=C.a7()){var G=this._d2[C.a2().al()];G._f=this._dp;var z=G._k-O._k,T=G._h-O._h,N=G._g-O._g,J=z*z+T*T+N*N,Q=Math.sqrt(J);if(Q!==0){var L=Math.max(0.000001,Q-(O._e+G._e)),F=-this._ef[C.a5()]/(L*L);F+=L*L*this._d1[C.a5()],F/=Q,K+=z*F,H+=T*F,D+=N*F}}for(var P=O._b.ag();P!=null;P=P.a8()){var x=this._d2[P.a3().al()];x._f=this._dp;var I=x._k-O._k,M=x._h-O._h,k=x._g-O._g,R=I*I+M*M+k*k,q=Math.sqrt(R);if(q!==0){var A=Math.max(0.000001,q-(O._e+x._e)),j=-this._ef[P.a5()]/(A*A);j+=A*A*this._d1[P.a5()],j/=q,K+=I*j,H+=M*j,D+=k*j}}B._a+=K,B._c+=H,B._b+=D},j:function(w,A){var j,b,m=j=b=0;for(var B=this._dt-1;B>=0;B--){var g=this._d2[B];if(g._f!==w._f){var z=w._k-g._k,y=w._h-g._h,v=w._g-g._g,k=z*z+y*y+v*v;if(k!==0){var x=Math.sqrt(k),q=Math.max(0.000001,x-(w._e+g._e)),d=this._dr/(q*q*x);m+=z*d,j+=y*d,b+=v*d}}}A._a+=m,A._c+=j,A._b+=b},c:function(w,A){var j,b,m=j=b=0;for(var B=this._dt-1;B>=0;B--){var g=this._d2[B],z=w._k-g._k,y=w._h-g._h,v=w._g-g._g,k=z*z+y*y+v*v;if(k!==0){var x=Math.sqrt(k),q,d=x-(w._e+g._e);d<=0?q=this._dr/(1e-8*x):q=this._dr/(d*d*x),m+=z*q,j+=y*q,b+=v*q}}A._a+=m,A._c+=j,A._b+=b},i:function(b,a){var c=this._du._b/this._dt-b._g;a._b+=c*this._dl*this._dt/this._dh},d:function(d,b){if(this._de!==0){var f=this._du._a/this._dt-d._k,c=this._du._c/this._dt-d._h,a=this._du._b/this._dt-d._g;b._a+=f*this._de,b._c+=c*this._de,b._b+=a*this._de}},h:function(b,a){var c=0.05*(b._r+2);c>0&&(a._a=bP.l(-c,c),a._c=bP.l(-c,c),a._b=bP.l(-c,c))},ac:function(d,b,f){if(f!==0&&d._a!==0){var c=b._a*d._o+b._c*d._l+b._b*d._i,a=c/(f*d._a);this._dh-=d._r*d._r,this._dj-=d._r,d._p*a>0?d._r+=a*0.45:d._r+=a*0.15,d._r>this._dq?d._r=this._dq:d._r<0.1&&(d._r=0.1),this._dj+=d._r,this._dh+=d._r*d._r,d._p=a}},aa:function(f,b,h){if(h>0){var d=f._r/h,a=b._a*d,c=b._c*d,g=b._b*d;f._k+=a,f._h+=c,f._g+=g,this._du._a+=a,this._du._c+=c,this._du._b+=g,f._a=h,f._o=b._a,f._l=b._c,f._i=b._b}},r:function(){for(var b=this._d2.length-1;b>=0;b--){var a=this._d2[b];this._d5.s2(a._b,a._k,a._h)}}});var bC=function(c,a,d,b){this._e=c,this._f=a,this._a=d,this._b=b,this._c={}};_twaver.ext(bC,Object,{resetGroup:function(){if(!this._a||this._b!=null){return}for(var b in this._c){var a=this._c[b];this._e.isExpandGroup()?a.group.setExpanded(!0):a.group.setExpanded(a.b)}},process:function(){var c=new aD;for(var a=0,d=this._f.size();a<d;a++){var b=this._f.get(a);if(b instanceof twaver.Link){b.isLooped()||c.add(b)}else{if(this._b==null&&b.getParent() instanceof aB){continue}(this._b==null||this._b!=null&&this._b!==b)&&c.add(b),this._b==null&&b instanceof aB&&this.layoutGroup(b)}}return c},layoutGroup:function(L){if(!this._a||this._c[L.getId()]!=null||this._b!=null){return}this._c[L.getId()]={group:L,b:L.isExpanded()};var A=this._e.getGroupLayoutType(L);if(!A){return}L.setExpanded(!0);var D=new aD,B=L.getChildren(),H;for(var P=0,K=B.size();P<K;P++){H=B.get(P),H instanceof aB&&(this.layoutGroup(H),H.setExpanded(!1)),!(H instanceof twaver.Link)&&!D.contains(H)&&D.add(H);if(H instanceof aJ){var G=H.getLinks();if(G!=null){for(var N=0,I=G.size();N<I;N++){var C=G.get(N);D.contains(C)||D.add(C)}}}}var M=new be(this._e,D,A,this._a,this._b);try{var u=null;if("round"===A){u=new aj}else{if("symmetry"===A){u=new bE}else{if("hierarchic"===A){u=new ag}else{if(A==="topbottom"||A==="bottomtop"||A==="rightleft"||A==="leftright"){u=new aF}}}}if(u!=null){u.i2(M);var F=bC.createMatrix(A),J={},o={};for(var O in M._a){var s=M._a[O],z=s.node,k=M.g4(s);J[O]=z.getCenterLocation();if(F!=null){var q=F.transform(k);z.setCenterLocation(q.x,q.y)}else{z.setCenterLocation(k.x,k.y)}o[O]=z.getCenterLocation()}}}catch(j){}B=L.getChildren();for(P=0,K=B.size();P<K;P++){H=B.get(P),H instanceof aB&&H.setExpanded(!0)}}}),bC.createMatrix=function(a){return a==="rightleft"?aK.createMatrix(Math.PI/2,0,0):a==="leftright"?aK.createMatrix(-Math.PI/2,0,0):a==="bottomtop"?aK.createMatrix(Math.PI,0,0):null};var ai=function(){};_twaver.ext(ai,Object,{i1:function(c,a,d){var b=this.a1(c,a);return this.a2(c,a,d),b},a1:function(g,k){var d=ai.i4(g);d.ax();var b=0;for(var f=d.x1();f.i1();f.i2()){k.i7(f.i9(),-1)}for(var l=d.x1();l.i1();l.i2()){var c=l.i9(),j=-1;for(var h=c.aq();h.i1();h.i2()){j=Math.max(j,k.i2(h.i9()))}k.i7(c,j+1),b=Math.max(b,j+1)}return b+1},a2:function(b,a,c){c.az(ai.i3(b,a))}}),ai.i3=function(d,b){var f=new br;for(var c=d.xf();c.i1();c.i2()){var a=c.i8();b.i2(a.a2())>b.i2(a.a3())&&(d.x3(a),f.ac(a))}return f},ai.i4=function(b){var a=an.a(b.xa());return(new bx).a1(b,a),ai.i2(b,a)},ai.i2=function(f,b){var g=an.d(f.x0());for(var d=f.x9();d.i1();d.i2()){var a=d.i9(),c=a.al();g[b[c]]=a}return new a2(g)};var ab=function(){ab.superClass.constructor.call(this),this.c0()};_twaver.ext(ab,br,{c0:function(){this._bc=1,this._bd=0}});var a6=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};_twaver.ext(a6,Object,{i4:function(a){this._m3=a},i5:function(a){this._m4=a},i3:function(a){this._m1=a},i6:function(a){this._m2=a},i2:function(a){this._m5=a},t1:function(){return this._m2},a1:function(c,a){var d=an.d(a.length);for(var b=0;b<a.length;b++){d[b]=a[b].x1()}this.a2(c,d)},a2:function(h,k){var c=an.a(k.length),a=0;for(var d=0;d<k.length;d++){var l=0,b=k[d];b.i4();for(;b.i1();b.i2()){l=Math.max(l,h.g9(b.i9()))}c[d]=l,b.i4();for(;b.i1();b.i2()){var j=(c[d]-h.g9(b.i9()))/2;h.s4(b.i9(),new aY(h.gi(b.i9()),a+j))}var g=this.t1();a+=c[d]+g,b.i4()}},i1:function(b,a,c){this._m6=b,this.t2(a,c)}});var ac=function(b,a){ac.superClass.constructor.call(this)};_twaver.ext(ac,a6,{t2:function(b,a){var c=this._m6;this._a=c.xc("D"),this._h=c.xc("C"),this.a1(c,b),this.tg(c,b),this.tf(b,bN.a5(this._e),this._m5,this._l),this.tb(c,this._f[0]),this.ta(b),this.th(c,this._f[0],b),this.b(b),this.tb(c,this._f[1]),this.ta(b),this.th(c,this._f[1],b),this.b(b),this.a11(this._f[1]),this.a12(b),this.tb(c,this._f[2]),this.ta(b),this.th(c,this._f[2],b),this.b(b),this.tb(c,this._f[3]),this.ta(b),this.th(c,this._f[3],b),this.b(b),this.a11(this._f[3]),this.a12(b),this.tc(c),this.tj()},a11:function(b){for(var a=0;a<b.length;a++){b[a]=-b[a]}},b:function(B){for(var G=0;G<B.length;G++){var k=B[G];k.ax()}for(var a=0;a<B.length;a++){var x=0,H=null;for(var j=B[a].x1();j.i1();j.i2()){var F=j.i9(),A=F.al();this._l[A]=x++,this._b[A]=H,this._k[A]=null,H!=null&&(this._k[H.al()]=F),H=F}}var w=this._a;this._a=this._h,this._h=w;for(var D=this._m6.xf();D.i1();D.i2()){var y=D.i8(),b=this._m6.gn(y);this._m6.gt(y,new aY(-b.x,b.y));var C=this._m6.gk(y);this._m6.gz(y,new aY(-C.x,C.y))}var E=this._l,q=function(d,c){return d==null&&c!=null?1:d!=null&&c==null?-1:d==null&&c==null?0:E[d.a2().al()]-E[c.a2().al()]},z=function(d,c){return d==null&&c!=null?1:d!=null&&c==null?-1:d==null&&c==null?0:E[d.a3().al()]};this._m6.x2(q,z)},a12:function(k){for(var q=this._m6.xf();q.i1();q.i2()){var d=q.i8();this._m6.x3(d);var b=this._m6.gn(d),h=this._m6.gk(d);this._m6.gz(d,b),this._m6.gt(d,h)}var v=new bh;for(var c=0;c<k.length;c++){v.ae(k[c])}for(var p=0;p<k.length;p++){k[p]=v.au()}var m=this._l,j=function(f,a){return f==null&&a!=null?1:f!=null&&a==null?-1:f==null&&a==null?0:m[f.a2().al()]-m[a.a2().al()]},g=function(f,a){return f==null&&a!=null?1:f!=null&&a==null?-1:f==null&&a==null?0:m[f.a3().al()]};this._m6.x2(j,g)},tg:function(q,y){var g=q.x0(),b=q.xg();this._l=an.a(g),this._b=an.d(g),this._k=an.d(g),this._m=an.d(g),this._i=an.d(g),this._o=an.d(g),this._f=an.e(4,g),this._c=an.a(g),this._g=an.a(g),this._j=an.a(g),this._d=an.b(g),this._e=an.b(b);for(var k=0;k<y.length;k++){var z=0,d=null;for(var x=y[k].x1();x.i1();x.i2()){var w=x.i9(),p=w.al();this._l[p]=z++,this._b[p]=d,this._k[p]=null,d!=null&&(this._k[d.al()]=w),d=w}}var j=this._l,v=function(c,a){return c==null&&a!=null?1:c!=null&&a==null?-1:c==null&&a==null?0:j[c.a2().al()]-j[a.a2().al()]},m=function(c,a){return c==null&&a!=null?1:c!=null&&a==null?-1:c==null&&a==null?0:j[c.a3().al()]};q.x2(v,m)},tb:function(d,b){for(var f=d.x9();f.i1();f.i2()){var c=f.i9(),a=c.al();this._m[a]=c,this._i[a]=c,b[a]=Number.MAX_VALUE,this._o[a]=c,this._c[a]=Number.MAX_VALUE,this._d[a]=!1,this._j[a]=this._g[a]=0}},ta:function(x){for(var C=1;C<x.length;C++){var k=-1;for(var b=x[C]._b;b!=null;b=b.a()){var q=b.d(),D=q.al(),j=q.ak();if(j!==0){var B=Math.floor((j+1)/2),A=Math.ceil((j+1)/2),w=1,m;for(m=q.ae();w<B;m=m.a7()){w++}for(var z=!1;w<=A&&!z;w++){var v=this._m6.g2(m),g=m.a2(),y=g.al();this._i[D]===q&&!this._e[m.a5()]&&k<this._l[y]&&(k=this._l[y],this._i[y]=q,this._m[D]=this._m[y],this._i[D]=this._m[D],z=!0,this._j[y]=v.i6().x,this._g[D]=v.i7().x),m=m.a7()}}}}},th:function(w,A,j){for(var b=w.x9();b.i1();b.i2()){var m=b.i9(),B=m.al();this._m[B]===m&&this.td(w,m,A)}for(var g=0;g<j.length;g++){var z=j[g].x1();if(z.i1()){var y=j[g].x1().i9(),v=y.al();this._o[this._m[v].al()]===y&&this.tk(w,y,A)}}for(var k=w.x9();k.i1();k.i2()){var x=k.i9(),q=x.al(),d=this._c[this._o[this._m[q].al()].al()];d<Number.MAX_VALUE&&(A[q]+=d)}},td:function(k,q,d){var b=q.al();if(d[b]===Number.MAX_VALUE){d[b]=0;var h=q,v=0;do{var c=h.al();c!==b&&(v-=this._g[c]);if(this._l[c]>0){var p=this._b[c],m=this._m[this._b[c].al()],j=m.al();this.td(k,m,d),this._o[b]===q&&(this._o[b]=this._o[j]),this._o[b]===this._o[j]&&(d[b]=Math.max(d[b],d[p.al()]+this.ti(k,p,h)-v))}v+=this._j[c],h=this._i[c]}while(h!==q);v=0,h=q;do{var g=h.al();g!==b&&(v-=this._g[g]),d[g]=d[b]+v,v+=this._j[g],h=this._i[g]}while(h!==q)}},tk:function(j,m,d){var b=m.al();if(this._d[b]){return}this._d[b]=!0;var g=m;do{var p=g.al(),c=this._k[p];if(c!=null){var l=c.al(),k=this._o[this._m[l].al()];if(k!==this._o[b]){var h=d[l]-d[b]-this.ti(j,g,c);this._c[k.al()]!==Number.MAX_VALUE&&(h+=this._c[k.al()]),this._c[this._o[b].al()]=Math.min(this._c[this._o[b].al()],h)}else{this.tk(j,this._m[l],d)}}g=this._i[p]}while(g!==m)},tc:function(k){var q=an.a(4),d=an.a(4);for(var a=k.x9();a.i1();a.i2()){var h=a.i9(),v=h.al();d[0]+=this._f[0][v],d[1]+=this._f[1][v],d[2]+=this._f[2][v],d[3]+=this._f[3][v]}d[0]/=k.xa(),d[1]/=k.xa(),d[2]/=k.xa(),d[3]/=k.xa();for(var b=k.x9();b.i1();b.i2()){var p=b.i9(),j=p.al(),g=k.g4(p);q[0]=this._f[0][j]-d[0],q[1]=this._f[1][j]-d[1],q[2]=this._f[2][j]-d[2],q[3]=this._f[3][j]-d[3],q.sort(an.n);var m=(q[1]+q[2])/2;k.s1(p,new aY(m,g.y))}},ti:function(f,b,g){var d=f.gj(b),a=f.gj(g),c;return d>1&&a>1?c=this._m1+(d+a)/2:c=this._m3+(d+a)/2,this._l[b.al()]<this._l[g.al()]?(this._a!=null&&(c+=this._a.i3(g)),this._h!=null&&(c+=this._h.i3(b))):(this._a!=null&&(c+=this._a.i3(b)),this._h!=null&&(c+=this._h.i3(g))),c},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(I,q,B,x){var E=I.length;for(var w=2;w<E-1;w++){var A=-1,k=0,L=0,H=I[w].x1();for(var D=I[w].x1();D.i1();D.i2()){var K=D.i9(),F=null,z=!1;K.ak()===1&&(F=K.ae().a2(),B.i1(F)!=null&&B.i1(K)!=null&&(z=!0));if(L===I[w].ay()-1||z){var J=z?x[F.al()]:I[w-1].ay();for(;k<=L;k++){var j=H.i9();for(var C=j.am();C.i1();C.i2()){var G=C.i8(),b=x[G.a2().al()];(b<A||b>J)&&q.i7(C.i8(),!0)}H.i2()}A=J}L++}}}});var af=function(b,a){this._b=20,this._a=a,this._d=b,this._f={}};_twaver.ext(af,Object,{a3:function(a){this._b=a},a4:function(f,b,g,d,a){if(this.a2(f)){var c=this.b2(f);c._o=b,c._m=a,c._n=d,c._f=g}},b2:function(b){var a=this._f[b._id];return a==null&&(a=new bl,this._f[b._id]=a),a},a2:function(a){return this._f[a._id]!=null},c:function(){var d=bN.a1(an.a(this._d.xa())),b=bN.a1(an.a(this._d.xa()));for(var f=this._d.x9();f.i1();f.i2()){var c=f.i9();if(this.a2(c)){var a=this.b2(c);d.i6(c,this._b*(a.c()-1)),b.i6(c,this._b*(a.b()-1))}}this._d.x1("D",d),this._d.x1("C",b)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var K=this._d.x9();K.i1();K.i2()){var x=K.i9();if(this.a2(x)){var D=this._d.gi(x),A=this._d.gh(x),G=this._d.gj(x),z=this._d.g9(x),C=this.b2(x),q=C._q.ay()+C._b.ay()+C._f,J=C._d.ay()+C._g.ay()+C._o,F=C._i.ay()+C._l.ay()+C._n,M=C._h.ay()+C._k.ay()+C._m,H=this._a.a7(G,q),B=this._a.a7(G,J),L=this._a.a7(z,M),k=this._a.a7(z,F);C.a2(this._a.a8(G,q,H),this._a.a8(G,J,B),this._a.a8(z,M,L),this._a.a8(z,F,k));for(var E=C._j.c1();E.i1();E.i2()){var I=E.i8(),a=this.a1(I),N=this.b1(I),j=new bh;if(a.b()===N.b()){a.c()?(j.aa(new aY(D+C._g._bd*B+C._c,A)),j.aa(new aY(D+C._g._bd*B+C._c,A-this._b)),C._g._bd++,j.aa(new aY(D+C._g._bd*B+C._c,A-this._b)),j.aa(new aY(D+C._g._bd*B+C._c,A)),C._g._bd++,C._g._bc=Math.max(C._g._bc,2)):a.d()?(j.aa(new aY(D+C._b._bd*H+C._p,A+z)),j.aa(new aY(D+C._b._bd*H+C._p,A+z+this._b)),C._b._bd++,j.aa(new aY(D+C._b._bd*H+C._p,A+z+this._b)),j.aa(new aY(D+C._b._bd*H+C._p,A+z)),C._b._bd++,C._b._bc=Math.max(C._b._bc,2)):a.f()?(j.aa(new aY(D,A+C._i._bd*k+C._a)),j.aa(new aY(D-this._b,A+C._i._bd*k+C._a)),C._i._bd++,j.aa(new aY(D-this._b,A+C._i._bd*k+C._a)),j.aa(new aY(D,A+C._i._bd*k+C._a)),C._i._bd++,C._i._bc=Math.max(C._i._bc,2)):a.e()&&(j.aa(new aY(D+G,A+C._h._bd*L+C._e)),j.aa(new aY(D+G+this._b,A+C._h._bd*L+C._e)),C._h._bd++,j.aa(new aY(D+G+this._b,A+C._h._bd*L+C._e)),j.aa(new aY(D+G,A+C._h._bd*L+C._e)),C._h._bd++,C._h._bc=Math.max(C._h._bc,2)),this._d.m1(I,j)}else{if(a.c()||N.c()){if(a.e()||N.e()){j.aa(new aY(D+G-C._d._bd*B-C._c,A)),j.aa(new aY(D+G-C._d._bd*B-C._c,A-this._b*C._d._bc)),j.aa(new aY(D+G+this._b*C._h._bc,A-this._b*C._d._bc)),j.aa(new aY(D+G+this._b*C._h._bc,A+C._h._bd*L+C._e)),j.aa(new aY(D+G,A+C._h._bd*L+C._e)),C._d._bd++,C._d._bc++,C._h._bd++,C._h._bc++,N.c()&&j.ax(),this._d.m1(I,j)}else{if(a.f()||N.f()){j.aa(new aY(D+C._g._bd*B+C._c,A)),j.aa(new aY(D+C._g._bd*B+C._c,A-this._b*C._g._bc)),j.aa(new aY(D-this._b*C._i._bc,A-this._b*C._g._bc)),j.aa(new aY(D-this._b*C._i._bc,A+C._i._bd*k+C._a)),j.aa(new aY(D,A+C._i._bd*k+C._a)),C._g._bd++,C._g._bc++,C._i._bd++,C._i._bc++,N.c()&&j.ax(),this._d.m1(I,j)}else{if(a.d()||N.d()){j.aa(new aY(D+G-C._d._bd*B-C._c,A)),j.aa(new aY(D+G-C._d._bd*B-C._c,A-this._b*C._d._bc)),j.aa(new aY(D+G+this._b*C.b(),A-this._b*C._d._bc)),j.aa(new aY(D+G+this._b*C.b(),A+z+this._b*C._q._bc)),j.aa(new aY(D+G-C._q._bd*H-C._p,A+z+this._b*C._q._bc)),j.aa(new aY(D+G-C._q._bd*H-C._p,A+z)),C._d._bd++,C._d._bc++,C._k._bc++,C._h._bc++,C._q._bc++,C._q._bd++,N.c()&&j.ax(),this._d.m1(I,j)}}}}else{if(a.d()||N.d()){if(a.e()||N.e()){j.aa(new aY(D+G-C._q._bd*H-C._p,A+z)),j.aa(new aY(D+G-C._q._bd*H-C._p,A+z+this._b*C._q._bc)),j.aa(new aY(D+G+this._b*C._k._bc,A+z+this._b*C._q._bc)),j.aa(new aY(D+G+this._b*C._k._bc,A+z-C._k._bd*L-C._e)),j.aa(new aY(D+G,A+z-C._k._bd*L-C._e)),C._q._bd++,C._q._bc++,C._k._bd++,C._k._bc++,N.d()&&j.ax(),this._d.m1(I,j)}else{if(a.f()||N.f()){j.aa(new aY(D+C._b._bd*H+C._p,A+z)),j.aa(new aY(D+C._b._bd*H+C._p,A+z+this._b*C._b._bc)),j.aa(new aY(D-this._b*C._l._bc,A+z+this._b*C._b._bc)),j.aa(new aY(D-this._b*C._l._bc,A+z-C._l._bd*k-C._a)),j.aa(new aY(D,A+z-C._l._bd*k-C._a)),C._b._bd++,C._b._bc++,C._l._bd++,C._l._bc++,N.d()&&j.ax(),this._d.m1(I,j)}}}else{j.aa(new aY(D,A+z-C._l._bd*k-C._a)),j.aa(new aY(D-this._b*C._l._bc,A+z-C._l._bd*k-C._a)),j.aa(new aY(D-this._b*C._l._bc,A+z+this._b*C.a1())),j.aa(new aY(D+G+this._b*C._k._bc,A+z+this._b*C.a1())),j.aa(new aY(D+G+this._b*C._k._bc,A+z-C._k._bd*L-C._e)),j.aa(new aY(D+G,A+z-C._k._bd*L-C._e)),C._l._bd++,C._l._bc++,C._b._bc++,C._q._bc++,C._k._bc++,C._k._bd++,N.f()&&j.ax(),this._d.m1(I,j)}}}}}}},a5:function(g,c){for(var j=0;j<g.length;j++){var f=g[j],b=c[j];for(var d=f.x1();d.i1();d.i2()){var h=d.i9();if(this.a2(h)){var a=this.b2(h);b._g=Math.max(b._g,this._b*(a.d()-1)),b._j=Math.max(b._j,this._b*(a.a1()-1))}}}},a1:function(d){var b=this._d.xc("A"),f=null;b!=null&&(f=b.i1(d));if(f==null||f.g()){var c=this._d.xc("B");if(c==null){return bR.j(1)}var a=c.i1(d);if(a==null||a.g()){return bR.j(1)}if(a.c()){return bR.j(8)}if(a.f()){return bR.j(1)}if(a.d()){return bR.j(4)}if(a.e()){return bR.j(2)}}return f},b1:function(d){var b=this._d.xc("B"),f=null;b!=null&&(f=b.i1(d));if(f==null||f.g()){var c=this._d.xc("A");if(c==null){return bR.j(8)}var a=c.i1(d);if(a==null||a.g()){return bR.j(8)}if(a.c()){return bR.j(8)}if(a.f()){return bR.j(1)}if(a.d()){return bR.j(4)}if(a.e()){return bR.j(2)}}return f}});var bl=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new br,this._g=new ab,this._d=new ab,this._b=new ab,this._q=new ab,this._h=new ab,this._k=new ab,this._i=new ab,this._l=new ab};_twaver.ext(bl,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(c,a,d,b){this._c=a,this._a=b,this._p=c,this._e=d,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var bj=function(c,a,d,b){this._k=20,this._r=0.5,this._d=c,this._c=a,this._j=d,this._m=b,this._i=c.xc("A")!=null||c.xc("B")!=null,this._t=new aM(c,a,d,b),this._b=new af(c,this)};_twaver.ext(bj,Object,{a6:function(a){this._k=a,this._t.a1(a),this._b.a3(a)},g1:function(){return this._k},a9:function(a){return this.c1(),a},a5:function(a){return this.a1(),a},b3:function(a){return this.c1(),a=this.c4(a),this._b.c(),a},g2:function(a){return this._b.g(),a},e2:function(a){a=this.f(a),this._b.f()},e1:function(){this._t.d(),this._n!=null&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){if(!this._i){return}this._q!=null&&(this._d.x1("A",this._q),this._q=null),this._p!=null&&(this._d.x1("B",this._p),this._p=null),this._h!=null&&(this._d.xj(this._h),this._h=null),this._l!=null&&(this._d.xj(this._l),this._l=null)},c1:function(){if(!this._i){return}this._h==null&&(this._h=this._d.xl()),this._l==null&&(this._l=this._d.xl());for(var f=this._d.xf();f.i1();f.i2()){var b=f.i8(),g=this._j.i1(b.a2())!=null,d=this._j.i1(b.a3())!=null;if(g&&!d){var a=this._j.i1(b.a2());this._m.i4(a)?this._l.i8(b,bR.h(this._d,a)):this._l.i8(b,bR.i(this._d,a))}else{if(!g&&d){var c=this._j.i1(b.a3());this._m.i4(c)?this._h.i8(b,bR.i(this._d,c)):this._h.i8(b,bR.h(this._d,c))}else{!g&&!d&&(this._m.i4(b)?(this._h.i8(b,bR.i(this._d,b)),this._l.i8(b,bR.h(this._d,b))):(this._h.i8(b,bR.h(this._d,b)),this._l.i8(b,bR.i(this._d,b))))}}}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)},c4:function(cM){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();var cu=new br,cB=new br,cw=new br,cH=new br,cv=new br,cA=new br,ct=new br,cL=new br,cD=new br,cO=this._d.xk();for(var cI=0;cI<cM.length;cI++){var cz=0;for(var cN=cM[cI].x1();cN.i1();){cO.i6(cN.i9(),cz),cN.i2(),cz++}}var cs=function(c,b){var d=cO.i3(c.a3())-cO.i3(b.a3());return d<=0?d>=0?0:-1:1},cC=function(c,b){var d=cO.i3(c.a2())-cO.i3(b.a2());return d<=0?d>=0?0:-1:1};for(var cJ=0;cJ<cM.length;cJ++){var cp=cM[cJ];for(var cP=cp._b;cP!=null;cP=cP.a()){var cr=cP.d();cr.av(cs),cr.au(cC);var cc=0;cu.af(),cB.af(),cw.af(),cH.af(),cv.af(),cA.af(),ct.af(),cL.af(),cD.af();for(var bY=cr.ap();bY.i1();){var cq=bY.i8(),bW=this.b1(cq);bW==null||bW.d()||bW.g()?cw.aa(cq):bW.e()?cu.aa(cq):bW.f()?(cB.aa(cq),cD.aa(cq)):bW.c()&&(cL.aa(cq),cD.aa(cq)),bY.i2(),cc++}cc=0;for(var b3=cr.am();b3.i1();){var ce=b3.i8(),cE=this.a2(ce);cE==null||cE.c()||cE.g()?cH.aa(ce):cE.e()?cu.aa(ce):cE.f()?(cB.aa(ce),cD.aa(ce)):cE.d()&&(cA.aa(ce),cD.aa(ce)),b3.i2(),cc++}var b5=cO.i3(cr);if(!cD.ar()){var cg=0.1/cD.ay();for(var b2=b5-0.4;!cD.ar();b2+=cg){var b4=cD.c3();if(b4.a2()===cr){var cQ=this._d.xm();this._n.z1(cQ,b4.a2()),this._d.s7(cQ,1,1),this._c.z1(cQ,this._c.i1(cr)),cO.i6(cQ,b2),this._a.i8(b4,this._d.gn(b4)),this._d.gt(b4,bP._A),this._d.xr(b4,cQ,b4.a3()),cp.ao(cQ,cP)}else{var cd=this._d.xm();this._n.z1(cd,b4.a3()),this._d.s7(cd,1,1),this._c.z1(cd,this._c.i1(cr)),cO.i6(cd,b2),this._g.i8(b4,this._d.gk(b4)),this._d.gz(b4,bP._A),this._d.xr(b4,b4.a2(),cd),cp.ao(cd,cP)}}}if(!cu.ar()){var b1=0.1/cu.ay();for(var cf=b5+0.1;!cu.ar();cf+=b1){var cG=cu.c3();if(cG.a2()===cr){var cb=this._d.xm();this._n.z1(cb,cG.a2()),this._d.s7(cb,1,1),this._c.z1(cb,this._c.i1(cr)),cO.i6(cb,cf),this._a.i8(cG,this._d.gn(cG)),this._d.gt(cG,bP._A),this._d.xr(cG,cb,cG.a3()),cP=cp.an(cb,cP)}else{var b8=this._d.xm();this._n.z1(b8,cG.a3()),this._d.s7(b8,1,1),this._c.z1(b8,this._c.i1(cr)),cO.i6(b8,cf),this._g.i8(cG,this._d.gk(cG)),this._d.gz(cG,bP._A),this._d.xr(cG,cG.a2(),b8),cP=cp.an(b8,cP)}}}var cx=bj._z;this._b.a2(cr)&&(cx=this._b.b2(cr));var bZ=cx._b.ay()+cA.ay()+cr.ao()+cv.ay()+cx._q.ay();if(bZ>0){var bV=this._d.g9(cr)/2,co=this._d.gj(cr),bT=this.a7(co,bZ),bt=-0.5*co+this.a8(this._d.gj(cr),bZ,bT)+bT*(cx._b.ay()+cA.ay());for(var bU=cr.ap();bU.i1();bU.i2()){var cn=bU.i8();!this.c2(cn)&&this._j.i1(cn.a2())==null&&(this._d.g2(cn).i8(new aY(bt,bV)),bt+=bT)}}var b7=this._t.a3(cr),b6=0,b0=0,ca=0,H=0;b7!=null&&(b6=b7._e.ay(),b0=b7._c.ay(),ca=b7._b.ay(),H=b7._d.ay()),bZ=cx._g.ay()+b6+cL.ay()+cr.ak()+ct.ay()+b0+cx._d.ay();if(bZ>0){var a=this._d.gj(cr),cy=this.a7(a,bZ),cK=this.a8(a,bZ,cy),cF=-0.5*a+cK+cy*(cx._g.ay()+b6+cL.ay()),cl=-this._d.g9(cr)/2;for(var ci=cr.am();ci.i1();ci.i2()){var b9=ci.i8();!this.d1(b9)&&this._j.i1(b9.a3())==null&&(this._d.g2(b9).i9(new aY(cF,cl)),cF+=cy)}if(b7!=null){var ck=-0.5*a+cK+cy*(cx._g.ay()+cL.ay()+b7._e.ay()-1);for(var cm=b7._e.c1();cm.i1();cm.i2()){var bX=cm.i8();this._d.u1(bX),bX.a2()===cr&&!this.c2(bX)?(this._d.g2(cm.i8()).i8(new aY(ck,cl)),ck-=cy):this.d1(bX)||(this._d.g2(cm.i8()).i9(new aY(ck,cl)),ck-=cy),this._d.h1(bX)}ck=0.5*a-cK-cy*(cx._d.ay()+ct.ay());for(var ch=b7._c.c1();ch.i1();ch.i2()){var cj=ch.i8();this._d.u1(cj),cj.a2()===cr&&!this.c2(cj)?(this._d.g2(ch.i8()).i8(new aY(ck,cl)),ck-=cy):this.d1(cj)||(this._d.g2(ch.i8()).i9(new aY(ck,cl)),ck-=cy),this._d.h1(cj)}}}this._b.a2(cr)&&this._b.a4(cr,b6+cL.ay()+cr.ak()+ct.ay()+b0,cA.ay()+cr.ao()+cv.ay(),ca+cB.ay(),H+cu.ay())}}return this._d.xi(cO),cM},a7:function(b,a){return a<=1?0:b/(a-1+2*this._r)},a8:function(b,a,c){return a<=1?b*0.5:(b-c*(a-1))*0.5},f:function(dq){var c4=this.g1();this._f=this._d.xk();for(var dc=0;dc<dq.length;dc++){var c7=dq[dc];for(var dj=c7._b;dj!=null;){var c5=dj.d(),db=this._n.i1(c5);if(db!=null||this._t.b2(c5)){dj=dj.a()}else{var c3=new a2,dp=new a2,df=new a2,du=new a2,dk=new a2,c9=new a2,ds=new br,c2=new br,de=new al(c3,dp,df,du,dk,c9,ds,c2);this._f.z1(c5,de),ds.ab(c5.am()),c2.ab(c5.ap());for(var dm=dj.b();dm!=null&&this._n.i1(dm.d())===c5;dm=dm.b()){var cY=dm.d(),dv=this.c3(cY);dv.f()?dp.ac(cY):dv.c()?du.ac(cY):dv.d()&&c9.ac(cY)}var c1;for(c1=dj.a();c1!=null&&this._n.i1(c1.d())===c5;c1=c1.a()){var d0=c1.d(),dG=this.c3(d0);dG.e()?c3.aa(d0):dG.c()?df.aa(d0):dG.d()&&dk.aa(d0)}dj=c1}}}var c0=this.d2(dq),dE=0;for(var dO=0;dO<dq.length;dO++){var d2=c0[dO];dO>0&&(dE+=c0[dO-1]._j+c0[dO-1]._h+c0[dO-1]._b),dE+=d2._g+d2._f+d2._a+d2._d;for(var dg=dq[dO].x1();dg.i1();dg.i2()){var dR=dg.i9();this._d.s3(dR,this._d.gi(dR),this._d.gh(dR)+dE)}d2._c+=dE,d2._i+=dE}for(var d4=0;d4<dq.length;d4++){var dM=dq[d4];for(var dQ=dM.x1();dQ.i1();dQ.i2()){var dx=dQ.i9();this._n.i1(dx)!=null&&dM.av(dQ)}}var d1=this,dL=function(c,b){return d1.a3(c)?d1.a3(b)?d1._d.gi(c)>=d1._d.gi(b)?-1:1:1:d1.a3(b)?-1:d1._d.gi(c)>=d1._d.gi(b)?1:-1},d3=function(c,b){return d1.a3(c)?d1.a3(b)?d1._d.gi(c)>=d1._d.gi(b)?1:-1:1:d1.a3(b)?-1:d1._d.gi(c)>=d1._d.gi(b)?-1:1};for(var di=0;di<dq.length;di++){var dY=c0[di];for(var dV=dq[di].x1();dV.i1();dV.i2()){var c8=dV.i9();if(!this._t.b2(c8)){var dI=this._f.i1(c8),dD=dI._d,cX=dI._a,dB=dI._b,dA=dI._h,dC=dI._f,ef=dI._c,dU=dI._g,dS=dI._e,dJ=0,dX=0,dz=0,cI=0,ck=c8.ao(),dN=c8.ak(),cD=this._d.gi(c8),b9=this._d.gh(c8),cu=this._d.gj(c8),dd=this._d.g9(c8),cc=this._t.a3(c8),d7=bj._z;this._b.a2(c8)&&(d7=this._b.b2(c8));if(cc!=null){dJ=cc._d.ay(),dX=cc._b.ay(),dz=cc._e.ay(),cI=cc._c.ay();if(dJ>0){var cz=d7._h.ay()+dD.ay()+dJ+d7._k.ay(),ej=this.a7(dd,cz),cZ=this.a8(dd,cz,ej),cg=b9+cZ+ej*(d7._h.ay()+this.a4(dD));for(var cS=cc._d.c1();cS.i1();cS.i2()){var cQ=cS.i8();this._d.u1(cQ),cQ.a2()===c8?this.c2(cQ)||this._d.gx(cQ,new aY(cD+cu,cg)):(this.d1(cQ),this._d.gy(cQ,new aY(cD+cu,cg))),cg+=ej,this._d.h1(cQ)}}if(dX>0){var b5=d7._i.ay()+cX.ay()+dX+d7._l.ay(),ea=this.a7(dd,b5),cp=this.a8(dd,b5,ea),ee=b9+cp+ea*(d7._i.ay()+this.a4(cX));for(var dy=cc._b.c1();dy.i1();dy.i2()){var bX=dy.i8();this._d.u1(bX),bX.a2()===c8?this.c2(bX)||this._d.gx(bX,new aY(cD,ee)):this.d1(bX)||this._d.gy(bX,new aY(cD,ee)),ee+=ea,this._d.h1(bX)}}}if(dD.ay()>0){dD.a1(dL);var b0=d7._h.ay()+dD.ay()+dJ+d7._k.ay(),em=this.a7(dd,b0),eo=this.a8(dd,b0,em),ed=b9+eo+em*d7._h.ay(),cs=!0;while(!dD.ar()){var cf=dD.x4();if(this.a3(cf)){cs&&(cs=!1,ed+=em*dJ);var bT=cf.ag(),cK=this._d.gd(bT),cy=cK.at();cK.ac(new aY(cy.x,dY.b()));if(this.c2(bT)){var cj=this._a.i1(bT);cK.ac(new aY(cy.x,cj.y+this._d.g6(c8))),cK.ac(new aY(cj.x+this._d.g5(c8),cj.y+this._d.g6(c8)))}else{cK.ac(new aY(cy.x,ed)),cK.ac(new aY(cD+cu,ed))}this._d.xr(bT,c8,bT.a3()),this._d.m1(bT,cK)}else{var cC=cf.ae(),a=this._d.gd(cC),b8=a.au();a.ae(new aY(b8.x,dY.a()));if(this.d1(cC)){var cb=this._g.i1(cC);a.ae(new aY(b8.x,cb.y+this._d.g6(c8))),a.ae(new aY(cb.x+this._d.g5(c8),cb.y+this._d.g6(c8)))}else{a.ae(new aY(b8.x,ed)),a.ae(new aY(cD+cu,ed))}this._d.xr(cC,cC.a2(),c8),this._d.m1(cC,a)}this._d.x4(cf),ed+=em}}if(cX.ay()>0){cX.a1(d3);var d9=d7._i.ay()+cX.ay()+dX+d7._l.ay(),co=this.a7(dd,d9),b1=this.a8(dd,d9,co),Z=b9+b1+co*d7._i.ay(),dK=!0;while(!cX.ar()){var cL=cX.x4();if(this.a3(cL)){dK&&(dK=!1,Z+=co*dX);var bW=cL.ag(),dZ=this._d.gd(bW),cV=dZ.at();dZ.ac(new aY(cV.x,dY.b()));if(this.c2(bW)){var cO=this._a.i1(bW);dZ.ac(new aY(cV.x,cO.y+this._d.g6(c8))),dZ.ac(new aY(cO.x+this._d.g5(c8),cO.y+this._d.g6(c8)))}else{dZ.ac(new aY(cV.x,Z)),dZ.ac(new aY(cD,Z))}this._d.xr(bW,c8,bW.a3()),this._d.m1(bW,dZ)}else{var dr=cL.ae(),dH=this._d.gd(dr),da=dH.au();dH.ae(new aY(da.x,dY.a()));if(this.d1(dr)){var b4=this._g.i1(dr);dH.ae(new aY(da.x,b4.y+this._d.g6(c8))),dH.ae(new aY(b4.x+this._d.g5(c8),b4.y+this._d.g6(c8)))}else{dH.ae(new aY(da.x,Z)),dH.ae(new aY(cD,Z))}this._d.xr(dr,dr.a2(),c8),this._d.m1(dr,dH)}this._d.x4(cL),Z+=co}}var ei=d7._g.ay()+d7._d.ay()+dN+dA.ay()+dB.ay()+dz+cI;cu=this._d.gj(c8);var cG=this.a7(cu,ei),cx=this.a8(cu,ei,cG);ei=d7._b.ay()+d7._q.ay()+ck+ef.ay()+dC.ay();var cJ=this.a7(cu,ei),cm=this.a8(cu,ei,cJ);if(dA.ay()>0){var dW=cG,cF=c4,cw=this._d.gi(c8)+cx+dW*(d7._g.ay()+dA.ay()-1),dl=this._d.gh(c8),ce=dY._c-dY._g-dA.ay()*cF,d8;for(;!dA.ar();this._d.x4(d8)){d8=dA.x4();var cB=d8.ag(),el=this._d.gd(cB),c6=el.at();el.ac(new aY(c6.x,dY.b())),el.ac(new aY(c6.x,ce));if(this.c2(cB)){var ci=this._a.i1(cB);el.ac(new aY(ci.x+this._d.g5(c8),ce)),el.ac(new aY(ci.x+this._d.g5(c8),ci.y+this._d.g6(c8)))}else{el.ac(new aY(cw,ce)),el.ac(new aY(cw,dl)),cw-=dW}ce+=cF,this._d.xr(cB,c8,cB.a3()),this._d.m1(cB,el)}}if(dB.ay()>0){var cU=cG,cR=c4,b7=this._d.gi(c8)+this._d.gj(c8)-cx-cU*d7._d.ay(),ec=this._d.gh(c8),cr=dY._c-dY._g-cR,eh;for(;!dB.ar();this._d.x4(eh)){eh=dB.x4();var dF=eh.ag(),bZ=this._d.gd(dF),b2=bZ.at();bZ.ac(new aY(b2.x,dY.b())),bZ.ac(new aY(b2.x,cr));if(this.c2(dF)){var ep=this._a.i1(dF);bZ.ac(new aY(ep.x+this._d.g5(c8),cr)),bZ.ac(new aY(ep.x+this._d.g5(c8),ep.y+this._d.g6(c8)))}else{bZ.ac(new aY(b7,cr)),bZ.ac(new aY(b7,ec)),b7-=cU}cr-=cR,this._d.xr(dF,c8,dF.a3()),this._d.m1(dF,bZ)}}if(ef.ay()>0){var eq=cJ,eg=c4,cv=this._d.gi(c8)+cm+eq*(d7._b.ay()+ef.ay()-1),ch=this._d.gh(c8)+this._d.g9(c8),bV=ch+ef.ay()*eg,cM;for(;!ef.ar();this._d.x4(cM)){cM=ef.x4();var cA=cM.ae(),cl=this._d.gd(cA),cE=cl.au();cl.ae(new aY(cE.x,dY.a())),cl.ae(new aY(cE.x,bV));if(this.d1(cA)){var H=this._g.i1(cA);cl.ae(new aY(H.x+this._d.g5(c8),bV)),cl.ae(new aY(H.x+this._d.g5(c8),H.y+this._d.g6(c8)))}else{cl.ae(new aY(cv,bV)),cl.ae(new aY(cv,ch)),cv-=eq}bV-=eg,this._d.xr(cA,cA.a2(),c8),this._d.m1(cA,cl)}}if(dC.ay()>0){var ca=cJ,cd=c4,eb=this._d.gi(c8)+this._d.gj(c8)-cm-cJ*d7._q.ay(),cq=this._d.gh(c8)+this._d.g9(c8),b3=cq+cd,bU;for(;!dC.ar();this._d.x4(bU)){bU=dC.x4();var dT=bU.ae(),cN=this._d.gd(dT),bY=cN.au();cN.ae(new aY(bY.x,dY.a())),cN.ae(new aY(bY.x,b3));if(this.d1(dT)){var d5=this._g.i1(dT);cN.ae(new aY(d5.x+this._d.g5(c8),b3)),cN.ae(new aY(d5.x+this._d.g5(c8),d5.y+this._d.g6(c8)))}else{cN.ae(new aY(eb,b3)),cN.ae(new aY(eb,cq)),eb-=ca}b3+=cd,this._d.xr(dT,dT.a2(),c8),this._d.m1(dT,cN)}}while(!dS.ar()){var d6=dS.c3(),cW=this._d.gl(d6);dY.a()+12<cW.y&&this._d.g7(d6).i4(cW.x,dY.a())}while(!dU.ar()){var cP=dU.c3(),dw=this._d.gs(cP);if(dY.b()-12>dw.y){var dP=this._d.gf(cP);dP.ac(new aY(dw.x,dY.b())),this._d.s6(cP,dP)}}}}}for(var dh=0;dh<dq.length;dh++){var cT=dq[dh];for(var b6=cT._b;b6!=null;b6=b6.a()){var ek=b6.d(),cH=this._t.a3(ek);cH!=null&&cH._a!=null&&(this._d.x4(cH._a),cT.aw(b6.b()))}}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),dq},c3:function(a){return this.a3(a)?this.b1(a.ag()):this.a2(a.ae())},b1:function(a){return this._h==null?bj.s:this._h.i1(a)},a2:function(a){return this._l==null?bj.u:this._l.i1(a)},c2:function(b){if(b==null){return !1}var a=this.b1(b);return a!=null&&a.a()},d1:function(b){if(b==null){return !1}var a=this.a2(b);return a!=null&&a.a()},a3:function(a){return a.ao()===1},b2:function(a){return a.ak()===1},a4:function(b){var a=0;for(var c=b._b;c!=null;c=c.a()){this.b2(c.d())&&a++}return a},d2:function(w){var A=this._k,j=an.d(w.length+1);for(var b=0;b<w.length;b++){var m=w[b],B=new a8;j[b]=B,B._c=Number.MAX_VALUE,B._i=Number.MIN_VALUE;for(var g=m.x1();g.i1();g.i2()){var z=g.i9(),y=this._d.gb(z);B._c=Math.min(B._c,y.i2()),B._i=Math.max(B._i,y.i2()+y.i4())}}this._b.a5(w,j);for(var v=0;v<w.length;v++){var k=j[v];for(var x=w[v].x1();x.i1();x.i2()){var q=x.i9(),d=this._f.i1(q);d!=null&&(k._h=Math.max(k._h,Math.max(d._f.ay()*A,d._c.ay()*A)),k._f=Math.max(k._f,Math.max(d._b.ay()*A,d._h.ay()*A)))}}return j}}),bj.s=bR.j(2),bj.u=bR.j(1),bj._z=new bl;var ao=function(){this._af=0,this._b=0};_twaver.ext(ao,Object,{ib:function(a){this._af=a},ia:function(f,b,h){this.a6(f,b,h),this.b2(!1);var d=this.g();if(this.o()&&d>0){var a=this.r();for(var c=0;c<20&&d>0&&this.o();c++){this.b2(!0);var g=this.g();g<d&&(this.a7(a),d=g)}this.b3(a),this.b1()}return this.c()},a6:function(f,b,g){this._b=(new Date).getTime(),this._ac=f,this._ah=b;var d=this;this._p=function(j,h){var k=d._n[j.al()]-d._n[h.al()];return k>0?1:k>=0?0:-1},this._ad=an.d(g);for(var a=0;a<this._ad.length;a++){this._ad[a]=new a2}this._ab=an.a(this._ac.x0()),this._f=an.d(this._ac.x0()),this._n=an.a(this._ac.x0()+1);var c=this._ab;this._o=function(y,D){if(y==null&&D!=null){return 1}if(y!=null&&D==null){return -1}if(y==null&&D==null){return 0}var q=y,j=D,v=q._h,m=q.a2(),C=j.a2(),B=c[m.al()]-c[C.al()];if(B===0){var x=ao.b(bR.h(v,q),v.gn(q)),s=ao.b(bR.h(v,j),v.gn(j)),A=x-s;if(A===0){var w=c[q.a3().al()]-c[j.a3().al()];if(w===0){var k=ao.a(bR.i(v,q),v.gk(q)),z=ao.a(bR.i(v,j),v.gk(j));return k-z}return w}return A}return B},this._l=function(y,D){if(y==null&&D!=null){return 1}if(y!=null&&D==null){return -1}if(y==null&&D==null){return 0}var q=y,j=D,v=q._h,m=q.a3(),C=j.a3(),B=c[m.al()]-c[C.al()];if(B===0){var x=ao.a(bR.i(v,q),v.gk(q)),s=ao.a(bR.i(v,j),v.gk(j)),A=x-s;if(A===0){var w=c[q.a2().al()]-c[j.a2().al()];if(w===0){var k=ao.b(bR.h(v,q),v.gn(q)),z=ao.b(bR.h(v,j),v.gn(j));return k-z}return w}return A}return B},this._z=function(m,j){if(m==null&&j!=null){return 1}if(m!=null&&j==null){return -1}if(m==null&&j==null){return 0}var q=m,l=j,h=q._h,k=ao.b(bR.h(h,q),h.gn(q)),p=ao.b(bR.h(h,l),h.gn(l));return k-p},this._e=function(m,j){if(m==null&&j!=null){return 1}if(m!=null&&j==null){return -1}if(m==null&&j==null){return 0}var q=m,l=j,h=q._h,k=ao.a(bR.i(h,q),h.gk(q)),p=ao.a(bR.i(h,l),h.gk(l));return k-p},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var a=this._ad;return this._ad=null,a},o:function(){var a=(new Date).getTime()-this._b;return a<=this._af},m:function(){var c=this,a=function(e,f){return Math.ceil(c._n[e.a3().al()])-Math.ceil(c._n[f.a3().al()])};for(var d=this._ac.x9();d.i1();d.i2()){for(var b=d.i9().aw();b.i1();b.i2()){this._n[b.i9().al()]=bP.j()}d.i9().av(a)}},b2:function(f){for(var b=0;b<this._ad.length;b++){this._ad[b].af()}if(f){this.m();for(var h=0,d=this._ab.length;h<d;h++){this._ab[h]=0}this._ac.x2(null,this._z)}var a=this._ac.xm();this._ah.i7(a,0);for(var c=this._ac.x9();c.i1();c.i2()){c.i9().ak()===0&&c.i9()!==a&&this._ac.xo(a,c.i9())}var g=new bd(this);g.a6(!0),g.a9(this._ac,a),this._ad[0].at(),this._ac.x4(a),this.d()},a1:function(){this._ac.x2(this._o,this._l);var c=0;for(var a=1;a<this._ad.length;a++){var d=this.a2(this._ad[a-1],this._ad[a]);c+=d}var b=0;return c+=b,c},a2:function(f,b){var h=f.ah(),d=b.ah(),a=new bh,c=new bh;this._aa=an.d(this._ac.x0());var g=0;for(;h.i1()&&d.i1();d.i2()){g+=this.a8(h.i6(),a,c,!0),g+=this.a8(d.i6(),c,a,!1),h.i2()}for(;h.i1();h.i2()){g+=this.a8(h.i6(),a,c,!0)}for(;d.i1();d.i2()){g+=this.a8(d.i6(),c,a,!1)}return g},a8:function(x,C,k,b){var q=0,D=0,j=0;if(this._aa[x.al()]!=null){var B=this._aa[x.al()].a();for(var A=C._b;A!==B;A=A.a()){var w=A._c;w===x?(q++,j+=D,C.aw(A)):D++}}var m=q*k.ay()+j;if(b){for(var z=x.ag();z!=null;z=z.a8()){var v=z.a3();this._ab[v.al()]>=this._ab[x.al()]&&(this._aa[v.al()]=k.ae(v))}}else{for(var g=x.ae();g!=null;g=g.a7()){var y=g.a2();this._ab[y.al()]>this._ab[x.al()]&&(this._aa[y.al()]=k.ae(y))}}return m},g:function(){var g=this.r(),c=this.a1(),j=!0;for(var f=0;f<3&&this.o()&&c>0;){var b=this.k();b<c?(this.a7(g),c=b):f++,j=!j}this.b3(g),this.b1();if(c>0){var d=1;for(var h=0;d===1&&c>0;h++){this.e(),this.i();var a=this.a1();a<c?(d=1,this.a7(g)):d=-1,c=a}this.b3(g),this.b1()}return c},e:function(){var bY=this.l(),Q=this.r(),Z=an.d(this._ac.x0());for(var V=this._ad.length-1;V>=0;V--){for(var bU=this._ad[V].ah();bU.i1();bU.i2()){var R=bU.i6();if(R.ak()===1&&R.ao()===1){var Y=bY.i1(R.ag());if(Y!=null&&Z[Y.al()]==null){var K=this.a4(R,Y),b2=Y.al(),bX=Z[b2]=an.d(K+1);for(var bt=bX.length-1;bt>=0;bt--){bX[bt]=new bh}}}}}for(var b0=0;b0<this._ad.length;b0++){for(var bV=this._ad[b0].ah();bV.i1();bV.i2()){var X=bV.i6();if(X.ak()===1&&X.ao()===1){var bZ=bY.i1(X.ag());if(bZ!=null){var J=bZ.al(),at=this.a4(X,bZ)-1;Z[J][at].ae(X.ae())}}else{for(var bW=X.ae();bW!=null;bW=bW.a7()){var G=bY.i1(bW);if(G!=null){var b1=G.al(),I=this.a4(X,G)-1;Z[b1][I].ae(bW)}}}}}for(var P=this._ac.x9();P.i1();P.i2()){var q=P.i9();if(Z[q.al()]!=null){for(var H=q.ag();H!=null;H=H.a8()){var j=bY.i1(H);if(j!=null){for(var B=Z[j.al()];B[0].ay()>0;){var U=0,bT;do{bT=B[U].am();var F=bT.a3();if(F.ak()!==1||F.ao()!==1){break}U++}while(!0);var W=B[U].at().a3();U--,W=bT.a2(),bT=B[U].at();var z=bT.a3();while(U>=0){Q[W.al()]!==Q[z.al()]&&(this._ab[W.al()]=Q[z.al()]),W=W.ae().a2();if(--U>=0){var D=B[U].at();z=D.a3()}}}}}}}this.b1(),this._ac.xj(bY)},i:function(){var bY=this.f(),Q=this.r(),Z=an.d(this._ac.x0());for(var V=0;V<this._ad.length;V++){for(var bU=this._ad[V].ah();bU.i1();bU.i2()){var R=bU.i6();if(R.ak()===1&&R.ao()===1){var Y=bY.i1(R.ae());if(Y!=null&&Z[Y.al()]==null){var K=this.a4(Y,R),b2=Y.al(),bX=Z[b2]=an.d(K+1);for(var bt=bX.length-1;bt>=0;bt--){bX[bt]=new bh}}}}}for(var b0=this._ad.length-1;b0>=0;b0--){for(var bV=this._ad[b0].ah();bV.i1();bV.i2()){var X=bV.i6();if(X.ak()===1&&X.ao()===1){var bZ=bY.i1(X.ae());if(bZ!=null){var J=bZ.al(),at=this.a4(bZ,X)-1;Z[J][at].ae(X.ag())}}else{for(var bW=X.ag();bW!=null;bW=bW.a8()){var G=bY.i1(bW);if(G!=null){var b1=G.al(),I=this.a4(G,X)-1;Z[b1][I].ae(bW)}}}}}for(var P=this._ac.x9();P.i1();P.i2()){var q=P.i9();if(Z[q.al()]!=null){for(var H=q.ae();H!=null;H=H.a7()){var j=bY.i1(H);if(j!=null){for(var B=Z[j.al()];B[0].ay()>0;){var U=0,bT;do{bT=B[U].am();var F=bT.a2();if(F.ak()!==1||F.ao()!==1){break}U++}while(!0);var W=B[U].at().a2();U--,W=bT.a3(),bT=B[U].at();var z=bT.a2();while(U>=0){Q[W.al()]!==Q[z.al()]&&(this._ab[W.al()]=Q[z.al()]),W=W.ag().a3();if(--U>=0){var D=B[U].at();z=D.a2()}}}}}}}this.b1(),this._ac.xj(bY)},a4:function(b,a){return this._ah.i2(b)-this._ah.i2(a)},l:function(){var g=bN.a6(an.d(this._ac.xg()));for(var k=this._ac.x9();k.i1();k.i2()){var d=k.i9();if(d.ao()>1){var b=0;for(var f=d.ag();f!=null;f=f.a8()){var l=f.a3();l.ak()===1&&l.ao()===1&&b++}if(b>1){for(var c=d.ag();c!=null;c=c.a8()){var j=c,h=j.a3();if(h.ak()===1&&h.ao()===1){for(;h.ak()===1&&h.ao()===1;h=j.a3()){g.i8(j,d),j=h.ag()}g.i8(j,d)}}}}}return g},f:function(){var g=bN.a6(an.d(this._ac.xg()));for(var k=this._ac.x9();k.i1();k.i2()){var d=k.i9();if(d.ak()>1){var b=0;for(var f=d.ae();f!=null;f=f.a7()){var l=f.a2();l.ak()===1&&l.ao()===1&&b++}if(b>1){for(var c=d.ae();c!=null;c=c.a7()){var j=c,h=j.a2();if(h.ak()===1&&h.ao()===1){for(;h.ak()===1&&h.ao()===1;h=j.a2()){g.i8(j,d),j=h.ae()}g.i8(j,d)}}}}}return g},k:function(){for(var c=1;c<this._ad.length;c++){var a=this._ad[c];for(var d=a.ah();d.i1();d.i2()){var b=d.i6();this._n[b.al()]=this.a5(b,a.ay(),b.am(),this._ad[c-1].ay()),this._n[b.al()]+=this._ab[b.al()]/(this._ad[c-1].ay()*3)}this.a3(a,this._p)}return this.a1()},a5:function(f,b,g,d){var a=0;if(g.i7()===0){a=d*this._ab[f.al()]/b}else{for(;g.i1();g.i2()){var c=g.i8();c.a2()===f?a+=this._ab[c.a3().al()]:a+=this._ab[c.a2().al()]}a/=g.i7()}return a},a7:function(a){an.f(this._ab,a,a.length)},b3:function(a){an.f(a,this._ab,a.length)},r:function(){var a=an.a(this._ab.length);return this.a7(a),a},d:function(){for(var b=0;b<this._ad.length;b++){var a=0;for(var c=this._ad[b].ah();c.i1();){this._ab[c.i6().al()]=a,c.i2(),a++}}},b1:function(){for(var f=0;f<this._ad.length;f++){var b=this._ad[f];for(var g=b._b;g!=null;g=g.a()){var d=g.d();this._f[this._ab[d.al()]]=d}var a=0;for(var c=b._b;c!=null;){c.c(this._f[a]),c=c.a(),a++}}},a3:function(f,b){var g=f.ah();for(var d=0;d<f.ay();g.i2()){this._f[d]=g.i6(),d++}an.s(this._f,f.ay(),b);var a=0;for(var c=f._b;c!=null;){c.c(this._f[a]),this._ab[this._f[a].al()]=a,c=c.a(),a++}}}),ao.b=function(c,a){if(c==null){return 0}var d=c.a()?Math.floor(a.x):0,b=c.a()?Math.floor(a.y):0;return c.e()?10000-b:c.f()?-10000+b:c.c()?-20000-d:d},ao.a=function(c,a){if(c==null){return 0}var d=c.a()?Math.floor(a.x):0,b=c.a()?Math.floor(a.y):0;return c.e()?10000+b:c.f()?-10000-b:c.d()?-20000-d:d};var ag=function(){ag.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new ai,this._i1=new ao,this._i8=new ac};_twaver.ext(ag,ay,{j2:function(){return this._i2},i4:function(a){return !0},i3:function(k){this._i6=(new Date).getTime(),bO.d(k,!1);var q=k.xk(),d=k.xk(),b=k.xl(),h=new br,v=new bj(k,q,d,b);v.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(d);var c=this._i7.i1(k,q,h);for(var p=h.c1();p.i1();p.i2()){var m=p.i8();b.i7(m,!0);var j=k.gn(m);k.gt(m,k.gk(m)),k.gz(m,j)}this.a2(k,q,d),c=v.a9(c);var g=this.j1(k,q,c);g=v.a5(g),g=v.b3(g),this._i8.i1(k,g,q),g=v.g2(g),v.e2(g),this.b(k,d),this.w(k),this.a1(k,h),v.e1(),k.xj(b),k.xi(d),k.xi(q)},j1:function(f,b,g){if(this._i1 instanceof ao){var d=this._i1,a=(new Date).getTime()-this._i6;d.ib(this._i3-a)}var c=this._i1.ia(f,b,g);return c},a1:function(f,b){for(var h=b.c1();h.i1();h.i2()){var d=h.i8(),a=f.gs(d),c=f.gl(d);f.x3(d);var g=f.gp(d);f.s5(d,g.a()),f.gy(d,a),f.gx(d,c)}},b:function(q,y){for(var g=q.x9();g.i1();g.i2()){var b=g.i9(),k=y.i1(b);if(k!=null&&!q.xp(k)){for(var z=b.am().i8().a2();y.i1(z)!=null;z=b.am().i8().a2()){b=z}q.u1(k);var d=b.ae(),x=new bh;for(;y.i1(d.a3())!=null;d=d.a3().ag()){var w=q.gs(d);x.aa(w),x.az(q.gf(d));var p=q.gl(d);p.equals(w)||x.aa(p)}var j=q.gs(d);x.aa(j),x.az(q.gf(d));var v=q.gl(d);v.equals(j)||x.aa(v),q.m1(k,x)}}for(var m=q.x9();m.i1();m.i2()){y.i1(m.i9())!=null&&q.x4(m.i9())}},w:function(A){for(var H=A.xf();H.i1();H.i2()){var k=H.i8(),b=A.g2(k);if(b.i1()>0){var s=new aD,j=A.gc(k),G=j.c(),E=G.i6();G.i2();var z=E.x,q=E.y;if(G.i1()){var C=G.i6(),w=C.x,B=C.y;G.i2();for(;G.i1();G.i2()){var F=G.i6(),p=F.x,x=F.y,D=(z-p)*(B-x)/(q-x)+p;Math.abs(D-w)>=1&&(s.add(C),z=w,q=B),C=F,w=p,B=x}}s.size()<b.i1()&&A.s5(k,new aI(s))}}},a2:function(j,m,d){var b=j.g8().c1();b.i5();for(;b.i1();b.i3()){var g=b.i8().a2(),p=b.i8().a3(),c=m.i2(p)-m.i2(g);if(c>1){var l=null,k=null,h=g;for(;c>1;c--){l=j.xm(),j.s7(l,1,1),j.s4(l,bP._A),k=j.xo(h,l),h===g&&j.gt(k,j.gn(b.i8())),m.i7(l,m.i2(h)+1),d.z1(l,b.i8()),h=l}k=j.xo(l,p),j.gz(k,j.gk(b.i8())),j.h1(b.i8())}}}});var aM=function(c,a,d,b){this._i=20,this._j=c,this._g=a,this._a=d,this._h=b};_twaver.ext(aM,Object,{a1:function(a){this._i=a},b2:function(a){return this._e==null?!1:this._e.i4(a)},a3:function(a){return this._f==null?null:this._f.i1(a)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var a8=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};_twaver.ext(a8,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var az=function(){this._d=new br,this._b=new br,this._c=new br,this._e=new br};_twaver.ext(az,Object,{});var al=function(g,c,j,f,b,d,h,a){this._d=g,this._a=c,this._b=j,this._h=f,this._f=b,this._c=d,this._e=h,this._g=a};_twaver.ext(al,Object,{});var an={};an.a=function(c,a){var d=[];for(var b=0;b<c;b++){d[b]=a||0}return d},an.b=function(b){var a=[];for(var c=0;c<b;c++){a[c]=!1}return a},an.c=function(b,a){if(b instanceof aY){return b.x<a.x?-1:b.x>a.x?1:b.y<a.y?-1:b.y<=a.y?0:1}if(b instanceof aS){return a.width>b.width?-1:a.width<b.width?1:a.height>b.height?-1:a.height>=b.height?0:1}if(b instanceof aV){return b.x<a.x?-1:b.x>a.x?1:b.y<a.y?-1:b.y>a.y?1:a.width>b.width?-1:a.width<b.width?1:a.height>b.height?-1:a.height>=b.height?0:1}throw"Unkown Type: "+b},an.d=function(b){var a=[];for(var c=0;c<b;c++){a[c]=null}return a},an.e=function(c,a){var d=[];for(var b=0;b<c;b++){d[b]=an.a(a)}return d},an.f=function(c,a,d){for(var b=0;b<d;b++){a[b]=c[b]}},an.s=function(c,a,d){var b=[];an.f(c,b,a),b.sort(d),an.f(b,c,a)},an.n=function(b,a){return b-a}})(window);(function(O,B){var H=_twaver.arrow,D=_twaver.box,K=_twaver.bus,C=_twaver.Dashline,G=_twaver.element,z=_twaver.g,T=_twaver.group,N=_twaver.html,J=_twaver.link,Q=_twaver.math,L=_twaver.Matrix,F=_twaver.interaction,P=_twaver.popup,x=_twaver.position,I=_twaver.render,M=_twaver.touch,k=_twaver.ua,R=twaver.Defaults,q=twaver.List,A=twaver.Node,j=twaver.Group;twaver.network.Network=function(b){function c(){var h=(new Date).getTime();if(a.hoverElement!=null&&!a.mousedown&&h-a.hoverTime>1000&&!P.getToolTipDiv().parentNode){var m=a.getToolTip(a.hoverElement);P.showToolTip(a.hoverPoint,m);var g=a._view.offsetLeft,d=a._view.offsetTop,f=a._view.parentElement;while(f){g+=f.offsetLeft,d+=f.offsetTop,f=f.parentElement}var l=P.getToolTipDiv();l.clientWidth+l.offsetLeft>a._view.clientWidth+g&&(l.style.left=g+a._view.clientWidth-l.clientWidth-10+"px"),l.clientHeight+l.offsetTop>a._view.clientHeight+d&&(l.style.top=d+a._view.clientHeight-l.clientHeight+"px")}}twaver.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new q,this._view=N.createView("auto"),this._rootDiv=N.createDiv(),this._topDiv=N.createDiv(),this._attachmentDiv=N.createDiv(),this._layersDiv=N.createDiv(),this._bottomDiv=N.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(b?b:new twaver.ElementBox),k.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(R.NETWORK_TOOLTIP_ENABLED),this.hoverElement=null,this.hoverTime=0,this.hoverPoint={x:0,y:0},this.mousedown=!1;var a=this;this._view.addEventListener("mousedown",function(){a.hoverElement=null,a.hoverTime=0,a.hoverPoint.x=0,a.hoverPoint.y=0,a.mousedown=!0}),this._view.addEventListener("mouseup",function(){a.mousedown=!1}),setInterval(c,50)},_twaver.ext("twaver.network.Network",twaver.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:R.NETWORK_SELECT_MODE,_noAgentLinkVisible:R.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:R.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:R.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:R.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:R.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:R.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:R.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:R.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:R.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:R.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:R.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:R.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:R.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:R.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:R.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:R.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:R.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:R.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:R.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:R.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:R.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:R.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:R.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:R.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:R.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:R.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:R.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:R.NETWORK_EDIT_LINE_COLOR,_editLineWidth:R.NETWORK_EDIT_LINE_WIDTH,_resizePointFillColor:R.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:R.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:R.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:R.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:R.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:R.NETWORK_RESIZE_ANIMATE,_limitElementInPositiveLocation:R.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,getLabel:function(a){return a.getStyle("network.label")||a.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(b){this._toolTipEnabled=b;if(b){if(!this._toolTipListener){var a=this;this._toolTipListener=function(c){var d=a.getElementAt(c);if(d){if(a.hoverElement==null||a.hoverElement!=d){P.hideToolTip(),a.hoverElement=d,a.hoverTime=(new Date).getTime()}a.hoverPoint.x=c.clientX,a.hoverPoint.y=c.clientY;return}a.hoverElement=null,a.hoverTime=0,a.hoverPoint.x=0,a.hoverPoint.y=0,P.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else{this._toolTipListener&&(P.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))}},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){var p=0,y=null,d=null,b=null,g=this._invalidateElementVisibility;this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(a){a.validate();var e=a.getElement();a.setVisible(this.isVisible(e));if(this._removeElementUIOnInvisible){y=this.getLayerDivByElement(e);if(a.isVisible()){if(a.getView().parentNode!==y){y.appendChild(a.getView()),d=a.getAttachments();for(p=0;p<d.size();p++){b=d.get(p),b.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(b.getView())}}}else{if(a.getView().parentNode===y){y.removeChild(a.getView()),d=a.getAttachments();for(p=0;p<d.size();p++){b=d.get(p),b.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(b.getView())}}}}else{if(!a.getView().parentNode){y=this.getLayerDivByElement(e),y.appendChild(a.getView()),d=a.getAttachments();for(p=0;p<d.size();p++){b=d.get(p),b.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(b.getView())}}}},null,this));if(this._invalidateElementIndex){this._invalidateElementIndex=!1;var E,c=this;this._box.getLayerBox().forEachByDepthFirst(function(h){var a=c._layerMap[h.getId()],l;c._box.forEachByLayer(function(U){var S=c._elementUIMap[U.getId()];if(S&&S.getView().parentNode===a){l=N.insertAfter(S.getView(),l);var t=S.getAttachments();for(var s=0;s<t.size();s++){var o=t.get(s);o.getView().parentNode===c._attachmentDiv&&(E=N.insertAfter(o.getView(),E))}}},h)})}if(g&&!this._invalidateElementVisibility){var w;for(var v in this._elementUIMap){var f=this._elementUIMap[v];f.isVisible()&&(w=Q.unionRect(w,f.getViewRect()))}w?w={x:0,y:0,width:w.x+w.width,height:w.y+w.height}:w={x:0,y:0,width:0,height:0};if(w.x!==this._viewRect.x||w.y!==this._viewRect.y||w.width!==this._viewRect.width||w.height!==this._viewRect.height){var m=this._viewRect;this._viewRect=w,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=w.width+"px",this._rootDiv.style.height=w.height+"px",this.firePropertyChange("viewRect",m,w)}}},setInteractions:function(b){var a=this._interactions;a&&a.forEach(function(c){c.tearDown()}),this._interactions=b,b&&b.forEach(function(c){c.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",a,b)},getInteractions:function(){return this._interactions},upSubNetwork:function(b,a){this._currentSubNetwork&&this.setCurrentSubNetwork(G.getSubNetwork(this._currentSubNetwork),b,a)},sendToTop:function(b){if(!this.isVisible(b)){return}var a=b;while(this.isVisible(a.getParent())){a=a.getParent();if(!a){break}}a!==b&&this._box.adjustElementIndex(a),this._box.adjustElementIndex(b)},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){N.clear(this._layersDiv),N.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var a=this;this._box.getLayerBox().forEachByDepthFirst(function(b){var c=N.createDiv();N.setVisible(c,b.isVisible()),a._layerMap[b.getId()]=c,a._layersDiv.appendChild(c),a._layerList.add(b)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(c,a,d){var b=twaver.animate.AnimateManager;b.endAnimate();if(a){if(this._currentSubNetwork===c){return}if(c&&!this._box.contains(c)){throw c+" is not contained in this network's elementBox"}b.start(new twaver.animate.AnimateSubNetwork(this,c,d))}else{this._setCurrentSubNetwork(c),d&&d()}},_setCurrentSubNetwork:function(b){if(this._currentSubNetwork===b){return}if(b&&!this._box.contains(b)){throw b+" is not contained in this network's elementBox"}var a=this._currentSubNetwork;this._currentSubNetwork=b,this.firePropertyChange("currentSubNetwork",a,b),this.invalidateElementVisibility()},isVisible:function(b){if(!this._box.contains(b)){return !1}if(this._visibleFunction&&!this._visibleFunction(b)){return !1}if(!this._box.getLayerBox().getLayerByElement(b).isVisible()){return !1}if(G.getSubNetwork(b)!==this._currentSubNetwork){return !1}if(b instanceof twaver.Link){if(!this.isNoAgentLinkVisible()){if(!b.getFromAgent()||!b.getToAgent()){return !1}if(!this.isVisible(b.getFromAgent())||!this.isVisible(b.getToAgent())){return !1}}if(b.getBundleIndex()>0&&b.getBundleCount()>1&&!b.getStyle("link.bundle.expanded")){return !1}}else{var a=b.getParent();while(a&&!a.ISubNetwork){if(a instanceof j){if(!a.isExpanded()||!this.isVisible(a)){return !1}}a=a.getParent()}}return b.IDummy?!1:!0},isMovable:function(a){return this._box.contains(a)?a instanceof twaver.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isMovable():!1},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isEditable():!1},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(b){var a=this._visibleFunction;this._visibleFunction=b,this.firePropertyChange("visibleFunction",a,b),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(b){var a=this._editableFunction;this._editableFunction=b,this.firePropertyChange("editableFunction",a,b),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(b){if(!b){throw"ElementBox can not be null"}if(this._box===b){return}var a=this._box;a&&(a.removeDataBoxChangeListener(this.handleElementBoxChange,this),a.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),a.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),a.removeIndexChangeListener(this.handleIndexChange,this),a.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),a.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),a.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||a.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=b,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(b):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",a,this._box)},invalidateElementUI:function(b,a){var c=this.getElementUI(b);c&&c.invalidate(a)},invalidateElementUIs:function(b){for(var a in this._elementUIMap){var c=this._elementUIMap[a];c.invalidate(b)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},getElementUI:function(a){return a?this._elementUIMap[a.getId()]:null},getLayerDivByElement:function(b){var a=this._box.getLayerBox().getLayerByElement(b);return a?this._layerMap[a.getId()]:null},createElementUI:function(b){var a=this._elementUIMap[b.getId()];a||(a=this._elementUIFunction(this,b),a&&(this._elementUIMap[b.getId()]=a));if(a){var c=this.getLayerDivByElement(b);a.getView().parentNode!==c&&(c.appendChild(a.getView()),a.getAttachments().forEach(function(d){d.isShowInAttachmentDiv()&&d.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(d.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(a){a instanceof twaver.Link&&a.getBundleLinks()&&a.getBundleLinks().forEachSiblingLink(function(b){if(b!==a){var c=this.getElementUI(b);c&&c.invalidate(!1)}},this)},handleLayerBoxChange:function(a){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(b){var a=b.source;if(b.property==="visible"){var c=this._layerMap[a.getId()];N.setVisible(c,a.isVisible())}else{b.property==="editable"&&this.invalidateSelectedElementUIs(!0)}this.invalidateElementVisibility()},handleLayerHierarchyChange:function(b){var a=0,c;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(f){var d=this._layerMap[f.getId()];c=N.insertAfter(d,c),this._layerList.add(f)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(b){b.datas.forEach(function(c){var d=this.getElementUI(c);d&&d.handleSelectionChange(b)},this),this.invalidateElementVisibility();var a=this.getSelectionModel().getLastData();a&&(b.kind==="append"||b.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(a),this.isSendToTopOnSelected()&&this.sendToTop(a))},makeVisible:function(g){var c=this.getElementUI(g);if(!c){return}var h=G.getSubNetwork(g);if(h!==this._currentSubNetwork){var f=this;this.setCurrentSubNetwork(h,this.isSubNetworkAnimate(),function(){_twaver.callLater(f.makeVisible,f,[g])});return}var b=g;while((b=b.getParent())&&b!==h){b instanceof j&&b.setExpanded(!0)}var d=c.getUnionBodyBounds();if(!d){return}var a={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};Q.intersects(a,d)||this.isVisible(g)&&_twaver.callLater(this.centerByLogicalPoint,this,[d.x+d.width/2,d.y+d.height/2])},handleElementBoxChange:function(d){var b=d.data;if(d.kind==="add"){this.createElementUI(b),this.invalidateBundleLink(b)}else{if(d.kind==="remove"){var f=this.getElementUI(b);if(f){var c=this._box.getLayerBox().getLayerByElement(b),a=this._layerMap[c.getId()];f.getView().parentNode===a&&a.removeChild(f.getView()),f.dispose(),delete this._elementUIMap[b.getId()]}b===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else{d.kind==="clear"&&(this.forEachElementUI(function(g){g.dispose()}),this._elementUIMap={},this.updateLayers(),this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null))}}this.invalidateElementVisibility()},handleElementPropertyChange:function(d){var b=d.source,f=this.getElementUI(b);if(f){f.handlePropertyChange(d);if(d.property==="layerId"){var c=this._box.getLayerBox().getLayerByElement(b),a=this._layerMap[c.getId()];f.getView().parentNode!==a&&(a.appendChild(f.getView()),this.invalidateElementIndex())}}this.invalidateBundleLink(b),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(a){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(b){if(!b){throw"ElementUIFunction can not be null"}if(this._elementUIFunction===b){return}var a=this._elementUIFunction;this._elementUIFunction=b,this.firePropertyChange("elementUIFunction",a,b),this._box.isEmpty()||this.updateLayers()},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},getSelectColor:function(a){return a.getStyle("select.color")},getShadowColor:function(b){var a=b.getStyle("shadow.color");return !a&&this.isSelected(b)&&b.getStyle("select.style")==="shadow"?b.getStyle("select.color"):a},getAlarmLabel:function(b){var a=b.getAlarmState().getHighestNewAlarmSeverity();if(a){var c=b.getAlarmState().getNewAlarmCount(a)+a.nickName;return b.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(b){var a=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=b,this.firePropertyChange("removeElementUIOnInvisible",a,b),this.invalidateElementVisibility()},setDefaultInteractions:function(a){this.setInteractions([new twaver.network.interaction.SelectInteraction(this),new twaver.network.interaction.MoveInteraction(this,a),new twaver.network.interaction.DefaultInteraction(this)])},setPanInteractions:function(){this.setInteractions([new twaver.network.interaction.PanInteraction(this),new twaver.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new twaver.network.interaction.SelectInteraction(this),new twaver.network.interaction.EditInteraction(this,a),new twaver.network.interaction.MoveInteraction(this,a),new twaver.network.interaction.DefaultInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new twaver.network.interaction.CreateElementInteraction(this,a),new twaver.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new twaver.network.interaction.CreateLinkInteraction(this,a),new twaver.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new twaver.network.interaction.CreateShapeLinkInteraction(this,a),new twaver.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new twaver.network.interaction.CreateShapeNodeInteraction(this,a),new twaver.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new twaver.network.interaction.TouchInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(b){var a=this._hasEditInteraction;this._hasEditInteraction=b,this.firePropertyChange("hasEditInteraction",a,b)},moveSelectedElements:function(d,b,f,c){if(d===0&&b===0){return}var a=this.getMovableSelectedElementsRect();if(a==null){return}this._limitElementInPositiveLocation&&(a.x+d<0&&(d=-a.x),a.y+b<0&&(b=-a.y)),twaver.Util.moveElements(this.getMovableSelectedElements(),d,b,f,c,this)},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},hasMovableSelectedElements:function(){var b=this.getSelectionModel().getSelection();for(var a=0;a<b.size();a++){var c=b.get(a);if(this.isMovable(c)){return !0}}return !1},getMovableSelectedElementsRect:function(){var f=this.getMovableSelectedElements();if(f.size()===0){return null}var b=null;for(var g=0,d=f.size();g<d;g++){var a=f.get(g);if(a instanceof A){var c=this.getElementUI(a);c&&(b=Q.unionRect(b,c.getViewRect()))}}return b},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getPosition:function(f,b,h,d,a){var c,g=b instanceof twaver.network.ElementUI?b:this.getElementUI(b);if(g){if(f==="from"||f==="to"){if(g.getFromPosition){c=f==="from"?g.getFromPosition(d,a):g.getToPosition(d,a);if(c){return{x:c.x-h.width/2,y:c.y-h.height/2}}}}else{f==="hotspot"?c=g.getHotSpot():c=x.get(f,g.getBodyRect(),h)}}!c&&b.getRect&&(c=x.get(f,b.getRect(),h));if(c){return{x:c.x+d,y:c.y+a}}throw"position '"+f+"' object '"+b+"'"},getViewRect:function(){return this._viewRect?_twaver.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(b,a,c){a?this._box.forEachReverse(function(e){if(this.getLayerByElement(e)===a){var d=this.getElementUI(e);d&&(c?b.call(c,d):b(d))}},this):this._layerList.forEachReverse(function(d){this.forEachElementUI(b,d,c)},this)},findFirstElement:function(g,c){var l=this._layerList.size()-1,f=this._box.size()-1;for(var b=l;b>=0;b--){var d=this._layerList.get(b);for(var h=f;h>=0;h--){var a=this._box.getDataAt(h);if(this.getLayerByElement(a)===d){if(c){if(g.call(c,a)===!0){return a}}else{if(g(a)===!0){return a}}}}}return null},getElementAt:function(c,a){arguments.length===1&&(a=!0);if(!this.isValidEvent(c)){return null}c=this._getPoint(c),c||console.log("null");var d=c.x,b=c.y;return this.findFirstElement(function(g){if(a&&!this.isSelectable(g)){return !1}var f=this.getElementUI(g);return f&&f.hitTest(d,b)?!0:!1},this)},_getPoint:function(a){return a?a.target?this.getLogicalPoint(a):a:null},getElementsAtRect:function(c,a,d){var b=new q;return this.forEachElementUI(function(e){e.isVisible()&&(!d||d(e._element))&&(a?e.intersectsTest(c)&&b.add(e._element):Q.contains(c,e.getViewRect())&&b.add(e._element))},null,this),b},hitTest:function(b){var a=this.getElementAt(b);if(!a){return null}var c=this.getElementUI(a);return c?(b=this._getPoint(b),c.hitTest(b.x,b.y)):null},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},toCanvas:function(f,b,g){g||(g=N.createCanvas()),g.setAttribute("width",f),g.setAttribute("height",b),g._viewRect?(g._viewRect.width=f,g._viewRect.height=b):g._viewRect={x:0,y:0,width:f,height:b};var d=g.getContext("2d");d.clearRect(0,0,f,b);if(this._view.clientWidth===0||this._view.clientHeight===0){return g}var a=f/this._view.scrollWidth*this._zoom,c=b/this._view.scrollHeight*this._zoom;return d.scale(a,c),N.forEach(this._view,function(l){if((l.tagName==="CANVAS"||l.tagName==="IMG")&&!l._isIgnored){var h=l._viewRect;if(h){try{d.drawImage(l,h.x,h.y,h.width,h.height)}catch(l){}}}}),g},toCanvasByRegion:function(f,b,g){g||(g=N.createCanvas());var d=f.width*b,a=f.height*b;g.setAttribute("width",d),g.setAttribute("height",a),g._viewRect?(g._viewRect.width=d,g._viewRect.height=a):g._viewRect={x:0,y:0,width:d,height:a};var c=g.getContext("2d");return c.clearRect(0,0,d,a),this._view.clientWidth===0||this._view.clientHeight===0?g:(c.scale(b,b),c.fillStyle=this._view.style.backgroundColor||"#FFFFFF",c.fill(),N.forEach(this._view,function(e){if((e.tagName==="CANVAS"||e.tagName==="IMG")&&!e._isIgnored){var h=e._viewRect;if(h&&Q.intersects(h,f)){try{c.drawImage(e,h.x-f.x,h.y-f.y,h.width,h.height)}catch(e){}}}}),g)},getGroupChildrenRects:function(b){var a=new q;return b.getChildren().forEach(function(d){if(d instanceof A){var f=this.getElementUI(d);if(f){var c=f.getViewRect();c&&a.add(c)}}},this),a}}),twaver.network.Overview=function(b){twaver.network.Overview.superClass.constructor.apply(this,arguments),this._view=N.createView(),this._rootDiv=N.createDiv(),this._imageCanvas=N.createCanvas(),this._imageDiv=N.createDiv(),this._maskCanvas=N.createCanvas(),this._selectDiv=N.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,N.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(b);var a;k.isTouchable?a=twaver.network.OverviewTouchInteraction:a=twaver.network.OverviewInteraction,a&&new a(this)},_twaver.ext("twaver.network.Overview",twaver.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:R.OVERVIEW_FILL_COLOR,_outlineColor:R.OVERVIEW_OUTLINE_COLOR,_outlineWidth:R.OVERVIEW_OUTLINE_WIDTH,_selectColor:R.OVERVIEW_SELECT_COLOR,_selectWidth:R.OVERVIEW_SELECT_WIDTH,_padding:R.OVERVIEW_PADDING,_animate:R.OVERVIEW_ANIMATE,_maxPackingWidth:R.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:R.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){if(a===this._network){return}this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),N.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),N.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(a){(a.property==="zoom"||a.property==="currentSubNetwork"||a.property==="elementBox"||a.property==="dataBox")&&this.invalidate()},_handleNetworkViewChange:function(a){a.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){if(!this._isNetworkDirty||!this._isMaskDirty){this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),_twaver.callLater(this.validate,this,null,a)}},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,_twaver.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network._view.clientWidth!==0&&this._network._view.clientHeight!==0){var p=this._maxPackingWidth>0&&this._maxPackingHeight>0,v;p?v={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:v={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Q.grow(v,-this._padding,-this._padding);var d=Math.min(v.width/this._network._view.scrollWidth,v.height/this._network._view.scrollHeight);p&&(N.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),v.width=this._imageDiv._viewRect.width,v.height=this._imageDiv._viewRect.height);var b=this._network._view.scrollWidth*d,g=this._network._view.scrollHeight*d,w=v.x+(v.width-b)/2,c=v.y+(v.height-g)/2;if(this._isNetworkDirty){var u={x:w,y:c,width:b,height:g};this._network.toCanvas(u.width,u.height,this._imageCanvas),N.setDiv(this._imageDiv,u,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var f={x:this._network._view.scrollLeft*d,y:this._network._view.scrollTop*d,width:b*this._network._view.clientWidth/this._network._view.scrollWidth,height:g*this._network._view.clientHeight/this._network._view.scrollHeight},m=N.setCanvas(this._maskCanvas,w,c,b,g);m.lineWidth=0,m.fillStyle=this._fillColor,z.drawVector(m,"rectangle",null,w,c,b,g),m.closePath(),m.fill(),m.stroke(),m.clearRect(w+f.x,c+f.y,f.width,f.height),m.lineWidth=this._outlineWidth,m.strokeStyle=this._outlineColor,z.drawVector(m,"rectangle",null,w+f.x+this._outlineWidth,c+f.y+this._outlineWidth,f.width-this._outlineWidth*2,f.height-this._outlineWidth*2),m.closePath(),m.stroke(),this._isMaskDirty=!1}}else{this._isNetworkDirty=!1,this._isMaskDirty=!1}},getLogicalPoint:function(a){return N.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(b,a){var c=this._imageDiv._viewRect;Q.containsPoint(c,b)&&(this._network.centerByLogicalPoint((b.x-c.x)/c.width*this._network._view.scrollWidth/this._network.getZoom(),(b.y-c.y)/c.height*this._network._view.scrollHeight/this._network.getZoom(),a),this._invalidateMask())}}),twaver.network.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,N.addEventListener("touchstart","handleTouchstart",this.view,this)},_twaver.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(a){N.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),M.isMultiTouch(a)&&(this.distance=M.getDistance(a),this.zoom=this.network.getZoom()),N.addEventListener("touchmove","handleTouchmove",this.view,this),N.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(b){this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(b);if(M.isSingleTouch(b)){this.overview.centerNetwork(this.endPoint,!1)}else{if(this.distance){var a=M.getDistance(b)/this.distance;this.network.setZoom(this.zoom*a,!1)}}},handleTouchend:function(b){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(b);var a=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;a?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),a?_twaver.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,N.removeEventListener("touchmove",this.view,this),N.removeEventListener("touchend",this.view,this))}}),twaver.network.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,N.addEventListener("mousedown","handleMousedown",this.view,this)},_twaver.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(a){this.clear(),this.endPoint=this.overview.getLogicalPoint(a),_twaver.isCtrlDown(a)&&(this.startPoint=this.endPoint,N.setVisible(this.overview._selectDiv,!0)),N.addEventListener("mousemove","handleMousemove",this.view,this),N.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(g){this.endPoint=this.overview.getLogicalPoint(g);if("detail" in g&&g.detail===2){_twaver.callLater(this.network.zoomReset,this.network,[this.overview._animate])}else{if(N.isVisible(this.overview._selectDiv)&&this.startPoint){var m=this.overview._imageDiv._viewRect,d=this.overview._selectDiv._viewRect.x,b=this.overview._selectDiv._viewRect.y,f=m.width/this.overview._selectDiv._viewRect.width,p=m.height/this.overview._selectDiv._viewRect.height,c=Math.min(f,p),l=this.network._view.scrollWidth/this.network.getZoom()*((d-m.x+this.overview._selectDiv._viewRect.width/2)/m.width),h=this.network._view.scrollHeight/this.network.getZoom()*((b-m.y+this.overview._selectDiv._viewRect.height/2)/m.height);this.network.setZoom(c*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),_twaver.callLater(this.network.centerByLogicalPoint,this.network,[l,h,this.overview._animate]),N.setVisible(this.overview._selectDiv,!1),N.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else{this.overview.centerNetwork(this.endPoint,this.overview._animate)}}this.clear()},handleMousemove:function(f){var b=this.overview.getLogicalPoint(f);this.endPoint=b;if(N.isVisible(this.overview._selectDiv)&&this.startPoint){var h=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var a=this.overview._imageDiv._viewRect;h<a.x&&(h=a.x),h>a.x+a.width&&(h=a.x+a.width),d<a.y&&(d=a.y),d>a.y+a.height&&(d=a.y+a.height);var c=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);h+c>a.x+a.width&&(c=a.x+a.width-h),d+g>a.y+a.height&&(g=a.y+a.height-d),N.setDiv(this.overview._selectDiv,{x:h,y:d,width:c,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else{this.overview.centerNetwork(b,!1)}},clear:function(){this.endPoint&&(this.endPoint=null,N.removeEventListener("mousemove",this.view,this),N.removeEventListener("mouseup",this.view,this))}}),twaver.network.ElementUI=function(b,a){this._view=N.createDiv(),this._bodyView=N.createDiv(),this._view.appendChild(this._bodyView),this._network=b,this._element=a,this._attachments=new q,this._bodyBounds=new q,this.invalidate(!0)},_twaver.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(a){return this._element.getStyle(a)},getFont:function(b){var a=this._element.getStyle(b);return a?a:R.FONT},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?_twaver.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},getUnionBodyBounds:function(){return _twaver.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),_twaver.clone(this._bodyRect)},invalidate:function(a){a===B&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag){return}this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateMeasure:function(){},validate:function(){if(!this._invalidateFlag){return}this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),N.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var b=this._element.getStyle("whole.alpha");this._view.style.opacity=b,this._attachments.forEach(function(c){c.updateMeasure();var d=c.getAlpha();c.isShowInAttachmentDiv()?c._view.style.opacity=d*b:c._view.style.opacity=d});var a;this._bodyBounds.forEach(function(c){a=Q.unionRect(a,c)}),this._unionBodyBounds=_twaver.clone(a),this._attachments.forEach(function(c){a=Q.unionRect(a,c.getViewRect())}),this._viewRect=a},cleanUp:function(d){var b=d.length;for(var f=0;f<b;f++){var c=d[f],a=this[c];a&&!a.parentNode&&(this[c]=null)}},setVisible:function(a){if(this.isVisible()===a){return}N.setVisible(this._view,a),this._attachments.forEach(function(b){b.isShowInAttachmentDiv()&&N.setVisible(b._view,a)}),this.invalidate(!0)},isVisible:function(){return N.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);a!=null&&a!==""?this._labelAttachment||(this._labelAttachment=new twaver.network.LabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);a!=null&&a!==""?this._alarmAttachment||(this._alarmAttachment=new twaver.network.AlarmAttachment(this,R.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new twaver.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new twaver.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return !0},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(a){a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose()}),this._attachments.clear()},addAttachment:function(a){this._attachments.add(a),a.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(a.getView()):this._view.appendChild(a.getView()),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose(),this.invalidate(!1)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},addComponent:function(a){this._bodyView.appendChild(a)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return _twaver.clone(this._viewRect)},setShadow:function(d,b,f){var c=d.isShadowable()&&this._shadowColor&&!this._editAttachment;c&&(this._shadowXOffset>0?f.width+=this._shadowXOffset:(f.x+=this._shadowXOffset,f.width+=-this._shadowXOffset),this._shadowYOffset>0?f.height+=this._shadowYOffset:(f.y+=this._shadowYOffset,f.height+=-this._shadowYOffset),Q.grow(f,this._shadowBlur,this._shadowBlur));var a=N.setCanvas(b,f);return c&&(a.shadowOffsetX=this._shadowXOffset,a.shadowOffsetY=this._shadowYOffset,a.shadowBlur=this._shadowBlur,a.shadowColor=this._shadowColor),a},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},hit:function(b,a){return !1},hitCanvas:function(f,b,h){var d=h.length;for(var a=0;a<d;a++){var c=h[a],g=this[c];if(z.hit(g,f,b)){return !0}}return !1},hitComponent:function(f,b,h){var d=h.length;for(var a=0;a<d;a++){var c=h[a],g=this[c];if(g&&Q.containsPoint(g._viewRect,f,b)){return !0}}return !1},hitTest:function(d,b){if(!this.isVisible()||!Q.containsPoint(this._viewRect,d,b)){return null}var f,c=this._attachments.size(),a;for(f=c-1;f>=0;f--){a=this._attachments.get(f);if(a.isShowInAttachmentDiv()&&a.hit(d,b)){return a}}for(f=c-1;f>=0;f--){a=this._attachments.get(f);if(!a.isShowInAttachmentDiv()&&a.hit(d,b)){return a}}return Q.containsPoint(this._unionBodyBounds,d,b)&&this.hit(d,b)?this:null},intersects:function(a){return !1},intersectsComponent:function(f,b){var g=b.length;for(var d=0;d<g;d++){var a=b[d],c=this[a];if(c&&Q.intersects(c._viewRect,f)){return !0}}return !1},intersectsCanvas:function(f,b){var g=b.length;for(var d=0;d<g;d++){var a=b[d],c=this[a];if(z.intersects(c,f)){return !0}}return !1},intersectsTest:function(c){if(!this.isVisible()||!Q.intersects(this._viewRect,c)){return null}var a=this._attachments.size(),d,b;for(d=a-1;d>=0;d--){b=this._attachments.get(d);if(b.isShowInAttachmentDiv()&&b.intersects(c)){return b}}for(d=a-1;d>=0;d--){b=this._attachments.get(d);if(!b.isShowInAttachmentDiv()&&b.intersects(c)){return b}}return Q.intersects(this._unionBodyBounds,c)&&this.intersects(c)?this:null}}),twaver.network.Attachment=function(b,a){this._view=N.createDiv(),this._ui=b,this._element=this._ui.getElement(),this._network=b.getNetwork(),this._isShowInAttachmentDiv=a===!0,this._isShowInAttachmentDiv&&N.setVisible(this._view,b.isVisible())},_twaver.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return _twaver.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(b,a){return Q.containsPoint(this._viewRect,b,a)},intersects:function(a){return Q.intersects(this._viewRect,a)}}),twaver.network.BasicAttachment=function(b,a){twaver.network.BasicAttachment.superClass.constructor.call(this,b,a),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=N.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},_twaver.ext("twaver.network.BasicAttachment",twaver.network.Attachment,{calculateMeasure:function(){var E=this.getContentWidth(),V=this.getContentHeight(),g=this.getCornerRadius(),b=this.getPointerLength(),v=this.getPointerWidth(),W=this.getPosition(),d=this.getXOffset(),U=this.getYOffset(),S=this._roundRect;S.width=E+g*2,S.height=V;var y;if(b>0){var m=this.getDirection();y=this._network.getPosition(W,this._ui,null,d,U);var w;if(m==="aboveleft"){S.y=y.y-b-S.height,S.x=y.x-(S.width-g),w=Math.max(y.x-v,S.x+g/2),this._pointers=[y,{x:y.x,y:y.y-b},{x:w,y:y.y-b}]}else{if(m==="aboveright"){S.y=y.y-b-S.height,S.x=y.x-g,w=Math.min(y.x+v,S.x+S.width-g/2),this._pointers=[y,{x:y.x,y:y.y-b},{x:w,y:y.y-b}]}else{if(m==="belowleft"){S.y=y.y+b,S.x=y.x-(S.width-g),w=Math.max(y.x-v,S.x+g/2),this._pointers=[y,{x:y.x,y:y.y+b},{x:w,y:y.y+b}]}else{if(m==="belowright"){S.y=y.y+b,S.x=y.x-g,w=Math.min(y.x+v,S.x+S.width-g/2),this._pointers=[y,{x:y.x,y:y.y+b},{x:w,y:y.y+b}]}else{if(m==="leftabove"){S.y=y.y+g-S.height,S.x=y.x-b-S.width,w=Math.max(y.y-v,S.y+g/2),this._pointers=[y,{x:y.x-b,y:y.y},{x:y.x-b,y:w}]}else{if(m==="leftbelow"){S.y=y.y-g,S.x=y.x-b-S.width,w=Math.min(y.y+v,S.y+S.height-g/2),this._pointers=[y,{x:y.x-b,y:y.y},{x:y.x-b,y:w}]}else{if(m==="rightabove"){S.y=y.y+g-S.height,S.x=y.x+b,w=Math.max(y.y-v,S.y+g/2),this._pointers=[y,{x:y.x+b,y:y.y},{x:y.x+b,y:w}]}else{if(m==="rightbelow"){S.y=y.y-g,S.x=y.x+b,w=Math.min(y.y+v,S.y+S.height-g/2),this._pointers=[y,{x:y.x+b,y:y.y},{x:y.x+b,y:w}]}else{if(m==="above"){S.y=y.y-b-S.height,S.x=y.x-S.width/2,w=Math.min(E/2,v/2),this._pointers=[y,{x:y.x-w,y:y.y-b},{x:y.x+w,y:y.y-b}]}else{if(m==="below"){S.y=y.y+b,S.x=y.x-S.width/2,w=Math.min(E/2,v/2),this._pointers=[y,{x:y.x-w,y:y.y+b},{x:y.x+w,y:y.y+b}]}else{if(m==="left"){S.y=y.y-S.height/2,S.x=y.x-b-S.width,w=Math.min(V/2,v/2),this._pointers=[y,{x:y.x-b,y:y.y+w},{x:y.x-b,y:y.y-w}]}else{if(m!=="right"){throw"Can not resolve '"+m+"' attachment direction"}S.y=y.y-S.height/2,S.x=y.x+b,w=Math.min(V/2,v/2),this._pointers=[y,{x:y.x+b,y:y.y+w},{x:y.x+b,y:y.y-w}]}}}}}}}}}}}}else{y=this._network.getPosition(W,this._ui,{width:S.width,height:S.height},d,U),S.x=y.x,S.y=y.y,this._pointers=null}this._contentRect.x=S.x+(S.width-E)/2,this._contentRect.y=S.y+(S.height-V)/2,this._contentRect.width=E,this._contentRect.height=V;var c=this.getPadding();c!=0&&Q.grow(S,c,c),c=this.getPaddingLeft(),c!=0&&(S.x-=c,S.width+=c),c=this.getPaddingRight(),c!=0&&(S.width+=c),c=this.getPaddingTop(),c!=0&&(S.y-=c,S.height+=c),c=this.getPaddingBottom(),c!=0&&(S.height+=c),S.width<0&&(S.width=S.width,S.x-=S.width),S.height<0&&(S.height=-S.height,S.y-=S.height)},updateMeasure:function(){twaver.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var d=this.isFill(),b=this.getOutlineWidth();this._viewRect=Q.getRect(this._pointers),this._viewRect=Q.unionRect(this._viewRect,this._roundRect),b>0&&Q.grow(this._viewRect,b/2,b/2);var f=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if(b>0||d){f.beginPath(),z.drawRoundRect(f,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(f.moveTo(this._pointers[0].x,this._pointers[0].y),f.lineTo(this._pointers[1].x,this._pointers[1].y),f.lineTo(this._pointers[2].x,this._pointers[2].y)),f.closePath(),b>0&&(f.lineWidth=b,f.strokeStyle=this.getOutlineColor(),f.lineCap=this.getCap(),f.lineJoin=this.getJoin(),f.stroke());if(d){var c=this.getFillColor(),a=this.getGradient();a?z.fill(f,c,a,this.getGradientColor(),this._viewRect):f.fillStyle=c,f.fill()}}return f},getRoundRect:function(){return _twaver.clone(this._roundRect)},getContentRect:function(){return _twaver.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(a){if(this._content===a){return}this._content&&this._view.removeChild(this._content),this._content=a,a&&this._view.appendChild(a)},getContentWidth:function(){return R.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return R.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return R.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return R.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return R.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return R.ATTACHMENT_POSITION},getXOffset:function(){return R.ATTACHMENT_XOFFSET},getYOffset:function(){return R.ATTACHMENT_YOFFSET},getPadding:function(){return R.ATTACHMENT_PADDING},getPaddingLeft:function(){return R.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return R.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return R.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return R.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return R.ATTACHMENT_DIRECTION},isFill:function(){return R.ATTACHMENT_FILL},getFillColor:function(){return R.ATTACHMENT_FILL_COLOR},getGradient:function(){return R.ATTACHMENT_GRADIENT},getGradientColor:function(){return R.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return R.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return R.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return R.ATTACHMENT_CAP},getJoin:function(){return R.ATTACHMENT_JOIN},isShadowable:function(){return R.ATTACHMENT_SHADOWABLE},hit:function(b,a){return Q.containsPoint(this._viewRect,b,a)?Q.containsPoint(this._contentRect,b,a)?!0:z.hit(this._attachmentCanvas,b,a):!1},intersects:function(a){return Q.intersects(this._viewRect,a)?Q.intersects(this._contentRect,a)?!0:z.intersects(this._attachmentCanvas,a):!1}}),twaver.network.LabelAttachment=function(b,a){twaver.network.LabelAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.LabelAttachment",twaver.network.BasicAttachment,{updateMeasure:function(){var b=this.getFont("label.font"),a=this.getLabel();this._textSize=z.getTextSize(b,a);var c=twaver.network.LabelAttachment.superClass.updateMeasure.call(this);z.drawText(c,a,this._contentRect,b,this.getStyle("label.color"))},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),twaver.network.AlarmAttachment=function(b,a){twaver.network.AlarmAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.AlarmAttachment",twaver.network.BasicAttachment,{updateMeasure:function(){var b=this.getFont("alarm.font"),a=this._network.getAlarmLabel(this._element);this._textSize=z.getTextSize(b,a),this._fillColor=this._network.getAlarmFillColor(this._element);var c=twaver.network.AlarmAttachment.superClass.updateMeasure.call(this);z.drawText(c,a,this._contentRect,b,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),twaver.network.LinkHandlerAttachment=function(b,a){twaver.network.LinkHandlerAttachment.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.LinkHandlerAttachment",twaver.network.BasicAttachment,{updateMeasure:function(){var b=this.getFont("link.handler.font"),a=this._network.getLinkHandlerLabel(this._element);this._textSize=z.getTextSize(b,a);var c=twaver.network.LabelAttachment.superClass.updateMeasure.call(this);z.drawText(c,a,this._contentRect,b,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),twaver.network.EditAttachment=function(b,a){twaver.network.EditAttachment.superClass.constructor.call(this,b,a),this._attachmentDiv=N.createDiv(),this._view.appendChild(this._attachmentDiv)},_twaver.ext("twaver.network.EditAttachment",twaver.network.Attachment,{updateMeasure:function(){twaver.network.EditAttachment.superClass.updateMeasure.call(this),this._element instanceof A&&this._addResizingPoint(this._element),this._element instanceof twaver.ShapeNode&&this._addShapeNodePoint(this._element),this._ui instanceof twaver.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof twaver.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(g){var c=g.getRect();if(!c){return}if(!this._resizeDivs){this._resizeDivs=new Array;for(var l=0;l<8;l++){var f=N.createDiv();this._attachmentDiv.appendChild(f),this._resizeDivs[l]=f}}var b=new q([{x:c.x,y:c.y},{x:c.x+c.width/2,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x,y:c.y+c.height/2},{x:c.x+c.width,y:c.y+c.height/2},{x:c.x,y:c.y+c.height},{x:c.x+c.width/2,y:c.y+c.height},{x:c.x+c.width,y:c.y+c.height}]),d=this._network.getResizePointOutlineWidth(),h=this._network.getResizePointOutlineColor(),a=this._network.getResizePointFillColor();this._addPoints(c,b,d,h,a,!0)},_addPoints:function(W,ab,w,b,S,ac){var f=this._network.getEditPointSize(),aa=f+w;Q.grow(W,aa,aa),this._viewRect=W;var Y=f*2,E=new q,U,c,X,Z;for(U=0,c=ab.size();U<c;U++){X=ab.get(U),Z={x:X.x-f,y:X.y-f,width:Y,height:Y},E.add(Z)}var y;if(ac){y=this._resizeDivs}else{this._controlDivs||(this._controlDivs=new Array);if(this._controlDivs.length<c){for(U=this._controlDivs.length;U<c;U++){var V=N.createDiv();this._attachmentDiv.appendChild(V),this._controlDivs[U]=V}}else{if(this._controlDivs.length>c){for(U=c;U<this._controlDivs.length;U++){this._attachmentDiv.removeChild(this._controlDivs[U])}this._controlDivs.splice(c)}}y=this._controlDivs}for(U=0,c=E.size();U<c;U++){Z=E.get(U),N.setDiv(y[U],Z,S,w,b),N.setBorderRaidus(y[U],(ac?"0":Y)+"px")}},_addShapeLinkPoints:function(a){this._addEditPoints(a._element.getPoints())},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(b){if(J.isOrthogonalLink(b._element)){var a=b.getControlPoint();if(a){var c=new q;c.add(a),this._addEditPoints(c)}}},_addEditPoints:function(d){var b=Q.getRect(d);if(!b){return}var f=this._network.getEditPointOutlineWidth(),c=this._network.getEditPointOutlineColor(),a=this._network.getEditPointFillColor();this._addPoints(b,d,f,c,a,!1)},hit:function(b,a){if(!Q.containsPoint(this._viewRect,b,a)){return !1}var c;if(this._resizeDivs){for(c=this._resizeDivs.length-1;c>=0;c--){if(Q.containsPoint(this._resizeDivs[c]._viewRect,b,a)){return !0}}}if(this._controlDivs){for(c=this._controlDivs.length-1;c>=0;c--){if(Q.containsPoint(this._controlDivs[c]._viewRect,b,a)){return !0}}}return !1},intersects:function(b){if(!Q.intersects(this._viewRect,b)){return !1}var a;if(this._resizeDivs){for(a=this._resizeDivs.length-1;a>=0;a--){if(Q.intersects(this._resizeDivs[a]._viewRect,b)){return !0}}}if(this._controlDivs){for(a=this._controlDivs.length-1;a>=0;a--){if(Q.intersects(this._controlDivs[a]._viewRect,b)){return !0}}}return Q.intersects(this._viewRect,b)?!1:!1}}),twaver.network.IconsAttachment=function(b,a){twaver.network.IconsAttachment.superClass.constructor.call(this,b,a),this._iconsCanvas=null},_twaver.ext("twaver.network.IconsAttachment",twaver.network.Attachment,{isShadowable:function(){return R.ATTACHMENT_SHADOWABLE},updateMeasure:function(){twaver.network.IconsAttachment.superClass.updateMeasure.call(this);var ad=this._network.getIconsNames(this._element);if(!ad||ad.length==0){return}var E=this._network.getIconsColors(this._element),X=this._element.getStyle("icons.orientation"),U=this._element.getStyle("icons.position"),aa=this._element.getStyle("icons.xoffset"),S=this._element.getStyle("icons.yoffset"),W=this._element.getStyle("icons.xgap"),w=this._element.getStyle("icons.ygap"),ag=this._getIconsSize(ad,X,W,w);if(!ag){return}var Z=this._network.getPosition(U,this._ui,ag,aa,S);this._viewRect={x:Z.x,y:Z.y,width:ag.width,height:ag.height},X==="top"?Z.y+=ag.height:X==="left"&&(Z.x+=ag.width),this._iconsCanvas||(this._iconsCanvas=N.createCanvas(),this._view.appendChild(this._iconsCanvas));var af=this._ui.setShadow(this,this._iconsCanvas,_twaver.clone(this._viewRect)),ab=Z.x,V=Z.y,ae=0;for(var f in ad){var Y=null,ac=null;E&&E.length>ae&&(ac=E[ae++]);var b=_twaver.getImageAsset(ad[f]);if(b==null){continue}if(X==="right"){Y={x:ab,y:V,width:b.getWidth(),height:b.getHeight()},ab+=Y.width+W}else{if(X==="left"){Y={x:ab-b.getWidth(),y:V,width:b.getWidth(),height:b.getHeight()},ab-=Y.width+W}else{if(X==="top"){Y={x:ab,y:V-b.getHeight(),width:b.getWidth(),height:b.getHeight()},V-=Y.height+w}else{if(X!=="bottom"){throw"Can not resolve '"+X+"' orientation"}Y={x:ab,y:V,width:b.getWidth(),height:b.getHeight()},V+=Y.height+w}}}af.drawImage(b.getImage(ac),Y.x,Y.y,Y.width,Y.height)}},_getIconsSize:function(l,v,d,b){var g=0,w=0,c=null,p=null,m=null;for(var h in l){p=_twaver.getImageAsset(l[h]);if(!p){continue}if(v==="right"){c={x:g,y:w,width:p.getWidth(),height:p.getHeight()},g+=c.width+d}else{if(v==="left"){c={x:g-p.getWidth(),y:w,width:p.getWidth(),height:p.getHeight()},g-=c.width+d}else{if(v==="top"){c={x:g,y:w-p.getHeight(),width:p.getWidth(),height:p.getHeight()},w-=c.height+b}else{if(v!=="bottom"){throw"Can not resolve '"+v+"' orientation"}c={x:g,y:w,width:p.getWidth(),height:p.getHeight()},w+=c.height+b}}}m==null?m=_twaver.clone(c):m=Q.unionRect(m,c)}return m?{width:Math.abs(m.width),height:Math.abs(m.height)}:null}}),twaver.network.NodeUI=function(b,a){twaver.network.NodeUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.NodeUI",twaver.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(b){twaver.network.NodeUI.superClass.invalidate.call(this,b);var a=this._element.getAgentLinks();a&&a.forEach(function(c){this._network.invalidateElementUI(c,!1)},this)},updateMeasure:function(){twaver.network.NodeUI.superClass.updateMeasure.call(this);var b=this.getStyle("vector.shape"),a=this.getBodyRect();this._hotSpot=Q.getHotSpot(a.x,a.y,a.width,a.height,b),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var c=this._element.getParent();c instanceof j&&this._network.invalidateElementUI(c,!1)},drawBody:function(){var a=this.getStyle("body.type");a==="default"?this.drawDefaultBody():a==="vector"?this.drawVectorBody():a==="default.vector"?(this.drawVectorBody(),this.drawDefaultBody()):a==="vector.default"&&(this.drawDefaultBody(),this.drawVectorBody())},drawOuterBorder:function(){var d=this._element,b=d.getStyle("outer.width");if(b>0){var f=this.getBodyRect();Q.addPadding(f,d,"outer.padding",1),this._outerCanvas||(this._outerCanvas=N.createCanvas());var c=_twaver.clone(f);Q.grow(c,b/2,b/2);var a=N.setCanvas(this._outerCanvas,c);a.lineWidth=b,a.lineCap=d.getStyle("outer.cap"),a.lineJoin=d.getStyle("outer.join"),a.strokeStyle=this._outerColor,z.drawVector(a,d.getStyle("outer.shape"),null,f),a.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(c)}},drawSelectBorder:function(){var d=this._element,b=d.getStyle("select.width");if(b>0){var f=this.getBodyRect();Q.addPadding(f,d,"select.padding",1),this._selectCanvas||(this._selectCanvas=N.createCanvas());var c=_twaver.clone(f);Q.grow(c,b/2,b/2);var a=N.setCanvas(this._selectCanvas,c);a.lineWidth=b,a.lineCap=d.getStyle("select.cap"),a.lineJoin=d.getStyle("select.join"),a.strokeStyle=d.getStyle("select.color"),z.drawVector(a,d.getStyle("select.shape"),null,f),a.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(c)}},drawDefaultBody:function(){var d=this._element,b=_twaver.getImageAsset(d.getImage()),f=this.getBodyRect();if(!b){this.addBodyBounds(f),this._currentImageAsset=null;return}Q.addPadding(f,this._element,"image.padding",1);if(b.getImage()){this._nodeCanvas||(this._nodeCanvas=N.createCanvas());var c=_twaver.clone(f),a=this.setShadow(this,this._nodeCanvas,c);a.drawImage(b.getImage(this._innerColor),f.x,f.y,f.width,f.height),f=c,this.addComponent(this._nodeCanvas)}else{if(b.getSrc()){this._nodeImage||(this._nodeImage=N.createImg()),N.setImg(this._nodeImage,b.getSrc(),f),this.addComponent(this._nodeImage)}else{if(!b.getFunction()){throw"ImageAsset '"+d.getImage()+" ' is empty"}this._currentImageAsset!==b?this._nodeComponent=b.getFunction()(this,f):this._nodeComponent=b.getFunction()(this,f,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=_twaver.clone(f)}}this.addBodyBounds(f),this._currentImageAsset=b},hit:function(b,a){return this.hitCanvas(b,a,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(b,a,["_nodeImage","_nodeComponent"])},intersects:function(a){return this.intersectsCanvas(a,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(a,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=N.createCanvas());var b=z.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),a=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color");a!==0&&c&&this.getStyle("vector.shape")==="rectangle"&&z.draw3DRect(this._vectorCanvas.getContext("2d"),c,a,this._bodyRect),this.addBodyBounds(b),this.addComponent(this._vectorCanvas)}}),twaver.network.LinkUI=function(b,a){twaver.network.LinkUI.superClass.constructor.call(this,b,a),this._linkCanvas=N.createCanvas()},_twaver.ext("twaver.network.LinkUI",twaver.network.ElementUI,{isEditable:function(){return J.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},hit:function(b,a){return this.hitCanvas(b,a,["_linkCanvas"])},intersects:function(a){return this.intersectsCanvas(a,["_linkCanvas"])},checkAttachments:function(){twaver.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);a!=null&&a!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new twaver.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Q.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,twaver.network.LinkUI.superClass.invalidate.call(this,a)},getFromPosition:function(b,a){var c=this.getFromPoint();return c?{x:c.x+b,y:c.y+a}:null},getToPosition:function(b,a){var c=this.getToPoint();return c?{x:c.x+b,y:c.y+a}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=J.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=J.createToPoint(this)),this._toPoint},updateMeasure:function(){twaver.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var d=this.getFromPoint(),b=this.getToPoint(),f=this.getStyle("link.type");if(J.isOrthogonalOrFlexionalLink(this._element)){return J.orthogonalAndFlexional(this,f)}var c=new q;if(this._element.isLooped()){var a=this._network.getElementUI(this._element.getFromAgent());if(a==null){return null}this._hotSpot=J.fillLoopedPoints(this,a.getBodyRect(),c)}else{if(f!=="arc"&&f!=="triangle"&&f!=="parallel"){throw"Can not resolve link type '"+f+"'"}this._hotSpot=J.fillBundlePoints(this,f,d,b,c)}return c},drawLinePoints:function(d,b,f,c,a){d.lineWidth=f,d.strokeStyle=c,d.beginPath(),z.drawLinePoints(d,b,a),d.stroke()},drawBody:function(){var m=this.getLinkPoints();if(!m||m.size()<2){return}var w=this._element,b=Q.getLineRect(m),g=w.getStyle("link.width"),y=g;if(this._outerColor){var c=w.getStyle("outer.width");y+=c*2}var v=!this._editAttachment&&w.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(v){var p=w.getStyle("select.width");y+=p*2}Q.grow(b,y/2,y/2),w.getStyle("arrow.from")&&(b=Q.unionRect(b,H.getArrowRect(m,!0,w.getStyle("arrow.from.shape"),w.getStyle("arrow.from.width"),w.getStyle("arrow.from.height"),w.getStyle("arrow.from.xoffset"),w.getStyle("arrow.from.yoffset")))),w.getStyle("arrow.to")&&(b=Q.unionRect(b,H.getArrowRect(m,!1,w.getStyle("arrow.to.shape"),w.getStyle("arrow.to.width"),w.getStyle("arrow.to.height"),w.getStyle("arrow.to.xoffset"),w.getStyle("arrow.to.yoffset"))));var h=this.setShadow(this,this._linkCanvas,b);h.lineCap=w.getStyle("link.cap"),h.lineJoin=w.getStyle("link.join");var d=w.getStyle("link.pattern");v&&this.drawLinePoints(h,m,y,w.getStyle("select.color"),d),this._outerColor&&this.drawLinePoints(h,m,g+c*2,this._outerColor,d),this.drawLinePoints(h,m,g,this._innerColor||w.getStyle("link.color"),d),this.addBodyBounds(b),this.addComponent(this._linkCanvas),H.drawLinkArrow(this,h,m)},getControlPoint:function(){return J.getControlPoint(this._element,this)},setControlPoint:function(c){if(!c){return}var a=this.getStyle("link.type");if(!J.hasControlPoint(a)){return}var d=J.getLinkSourceBounds(this),b=J.getLinkTargetBounds(this);J.setParamsByControlPoint(c,d,b,a,this._element)},getLineLength:function(){return this._lineLength}}),twaver.network.GroupUI=function(b,a){twaver.network.GroupUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.GroupUI",twaver.network.NodeUI,{isEditable:function(){return !this._element.isExpanded()},drawBody:function(){var a=this.getBodyRect();this._shapeRect?this.drawExpandedGroup():twaver.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=N.createCanvas());var b=z.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),a=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");a!==0&&c&&this.getStyle("group.shape")==="rectangle"&&z.draw3DRect(this._nodeCanvas.getContext("2d"),c,a,this._bodyRect),this.addBodyBounds(b),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var c=this._element;if(c.isExpanded()){var a=this.getChildrenRects();if(!a.isEmpty()){var d=c.getStyle("group.shape"),b=T[d];if(!b){throw"Can not resolve group shape '"+d+"'"}this._shapeRect=b(a)}}return this._shapeRect?(Q.addPadding(this._shapeRect,c,"group.padding",1),this._shapeRect):twaver.network.GroupUI.superClass.createBodyRect.call(this)}}),twaver.network.GridUI=function(b,a){twaver.network.GridUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.GridUI",twaver.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?twaver.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var w=this.getStyle("grid.fill"),S=this.getStyle("grid.deep"),g=this.getStyle("grid.cell.deep");if(!w&&S===0&&g===0){return}var b=this.getBodyRect(),u=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=N.createCanvas());var U=_twaver.clone(b),f=this.setShadow(this,this._nodeCanvas,U);w&&(f.fillStyle=u,f.rect(b.x,b.y,b.width,b.height),f.fill(),this.addComponent(this._nodeCanvas)),S!=0&&z.draw3DRect(f,u,S,b.x,b.y,b.width,b.height);if(g!=0){var E=this.getStyle("grid.row.count"),m=this.getStyle("grid.column.count");for(var y=0;y<E;y++){for(var v=0;v<m;v++){var d=this._element.getCellRect(y,v);d!=null&&z.draw3DRect(f,u,g,d.x,d.y,d.width,d.height)}}}this.addBodyBounds(U)}}),twaver.network.ShapeNodeUI=function(b,a){twaver.network.ShapeNodeUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.ShapeNodeUI",twaver.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2){return}this._nodeCanvas||(this._nodeCanvas=N.createCanvas());var a=z.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(a),this.addComponent(this._nodeCanvas),H.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),Q.getPointObject(this._element._points,this._element._segments))}}),twaver.network.ShapeLinkUI=function(b,a){twaver.network.ShapeLinkUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.ShapeLinkUI",twaver.network.LinkUI,{isEditable:function(){return !0},createLinkPoints:function(){var V=this.getFromPoint(),ab=this.getToPoint(),w=new q,b=this.getStyle("shapelink.type");w.add(V),this._element._points!=null&&w.addAll(this._element._points),w.add(ab);var E=w.size(),ac=Math.ceil(E/2);if(E%2===0){var m=w.get(ac),aa=w.get(ac-1);this._hotSpot={x:(m.x+aa.x)/2,y:(m.y+aa.y)/2}}else{this._hotSpot=_twaver.clone(w.get(ac))}var Y,U,y;if(b!=="lineto"){if(b==="quadto"){Y=new q(w.get(0));for(U=1,E=w.size();U<E;U++){U<E-1?Y.add(new q([w.get(U++),w.get(U)])):Y.add(w.get(U))}w=Y}else{if(b==="cubicto"){Y=new q(w.get(0));for(U=1,E=w.size();U<E;U++){U<E-2?Y.add(new q([w.get(U++),w.get(U++),w.get(U)])):U<E-1?Y.add(new q([w.get(U++),w.get(U)])):Y.add(w.get(U))}w=Y}else{if(b!=="orthogonalto"){throw"Can not resolve shapelink type '"+b+"'"}y=w.get(0),Y=new q(y);for(U=1,E=w.size();U<E;U++){if(U<E-1){var X=_twaver.clone(w.get(U)),S=X.x,g=X.y,W=S-y.x,Z=g-y.y;Math.abs(W)>Math.abs(Z)?(X.x=S,X.y=y.y):(X.x=y.x,X.y=g),y=X,Y.add(y)}else{Y.add(w.get(U))}}w=Y}}}return w}}),twaver.network.RotatableNodeUI=function(b,a){twaver.network.RotatableNodeUI.superClass.constructor.call(this,b,a)},_twaver.ext("twaver.network.RotatableNodeUI",twaver.network.NodeUI,{isEditable:function(){return !1},drawDefaultBody:function(){var g=this._element,c=_twaver.getImageAsset(g.getImage()),l=this.getBodyRect();if(!c){this.addBodyBounds(l),this._currentImageAsset=null;return}Q.addPadding(l,this._element,"image.padding",1);if(c.getImage()){this._nodeCanvas||(this._nodeCanvas=N.createCanvas());var f=_twaver.clone(l),b=this.setShadow(this,this._nodeCanvas,f),d=this._element._getOrignalWidth(),h=this._element._getOrignalHeight(),a=this._element._getRotateRect();b.save(),b.translate(l.x-a.x+d/2,l.y-a.y+h/2),b.rotate(this._element._angle*Math.PI/180),b.drawImage(c.getImage(this._innerColor),-d/2,-h/2,d,h),b.restore(),this.addComponent(this._nodeCanvas)}else{if(!c.getSrc()&&!c.getFunction()){throw"ImageAsset '"+g.getImage()+" ' is empty"}}this.addBodyBounds(l),this._currentImageAsset=c}}),twaver.network.interaction.BaseInteraction=function(a){this.network=a},_twaver.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var b=0;b<arguments.length;b++){var a=arguments[b];N.addEventListener(a,"handle_"+a,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++){N.removeEventListener(arguments[a],this.network.getView(),this)}},_handle_mousedown:function(a){if(a.button!==0){return}this._startLogical=this.network.getLogicalPoint(a),this._startClient=N.getClientPoint(a),this._startLogical&&N.handle_mousedown(this,a)},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),twaver.network.interaction.DefaultInteraction=function(a){twaver.network.interaction.DefaultInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.network.interaction.DefaultInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown")},tearDown:function(){this.removeListener("mousedown","keydown")},handle_mousedown:function(b){if(!this.network.isValidEvent(b)){return}this.network.isFocusOnClick()&&twaver.Util.setFocus(this.network.getView());var a=this.network.getElementAt(b);b.detail===2?this.handleDoubleClicked(b,a):this.handleClicked(b,a)},handleClicked:function(b,a){F.handleClicked(this.network,b,a)},handleDoubleClicked:function(b,a){F.handleDoubleClicked(this.network,b,a)},handle_keydown:function(a){F.handleKeyDown(this.network,a)}}),twaver.network.interaction.SelectInteraction=function(a){twaver.network.interaction.SelectInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.network.interaction.SelectInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(b){this._button=b.button;if(!this.network.isValidEvent(b)||this.network.isMovingElement()||this.network.isEditingElement()){return}if(b.shiftKey){return}var a=this.network.getElementAt(b),c=this.network.getSelectionModel();a?_twaver.isCtrlDown(b)?c.contains(a)?c.removeSelection(a):c.appendSelection(a):c.contains(a)||c.setSelection(a):(_twaver.isCtrlDown(b)||c.clearSelection(),this.end(b),this.network.getLogicalPoint(b)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(b))},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(b){if(this._button!==0||this.network.isMovingElement()||this.network.isEditingElement()){this.end(b);return}this._handle_mousemove(b),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:b}):(this.mark=N.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:b}));var a=Q.getRect([this._startLogical,this._endLogical]);N.setDiv(this.mark,a,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(d){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var f=this.network.getSelectionModel(),c=f.toSelection();b.forEach(function(g){f.contains(g)?c.remove(g):c.add(g)},this),f.setSelection(c)}this.network.fireInteractionEvent({kind:"selectEnd",event:d})}var a=this;setTimeout(function(){a.mark&&(a.network.getTopDiv().removeChild(a.mark),a.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(d)}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),twaver.network.interaction.MoveInteraction=function(b,a){this.lazyMode=a,this.xoffset=0,this.yoffset=0,twaver.network.interaction.MoveInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.network.interaction.MoveInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(b){if(b.button!==0){return}if(this.network.isSelectingElement()||this.network.isEditingElement()){return}var a=this.network.getElementAt(b);if(!this.network.isMovable(a)){return}this.end(b),this._handle_mousedown(b)},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(b){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()){this.end(b);return}this._handle_mousemove(b),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y;if(this.lazyMode){if(this.mark){this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:b})}else{this.mark=N.createDiv();var a;this.network.getMovableSelectedElements().forEach(function(c){var d=this.getElementUI(c);d&&(a=Q.unionRect(a,d.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),N.setDiv(this.mark,a,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:b})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{this.network.moveSelectedElements(this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=N.getClientPoint(b),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:b}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:b}))}},end:function(b){if(this._startLogical){if(this.lazyMode){if(this.mark){var a=this,c=function(){a.network.fireInteractionEvent({kind:"lazyMoveEnd",event:b}),a.mark&&(a.network.getTopDiv().removeChild(a.mark),a.mark=null,a.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else{this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:b}))}this._handle_mouseup(b)}}}),twaver.network.interaction.PanInteraction=function(a){twaver.network.interaction.PanInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.network.interaction.PanInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){this._startLogical=this.network.getLogicalPoint(a),this._startLogical&&(this._handle_mousedown(a),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(c){if(!this._startLogical){return}this._handle_mousemove(c);var a=this._startLogical.x-this._endLogical.x,d=this._startLogical.y-this._endLogical.y,b=this.network.panByOffset(a,d);this._startLogical=this._endLogical,this._startClient=N.getClientPoint(c)},_clear:function(a){this._startLogical&&(this._handle_mouseup(a),this.network.getView().style.cursor=this._oldCursor)}}),twaver.network.interaction.EditInteraction=function(b,a){this.lazyMode=a,this.pointIndex=-1,twaver.network.interaction.EditInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.network.interaction.EditInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.isStart=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(!this.network.isEditingElement()){return}this.isStart||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})))},handle_mouseup:function(c){if(this.isStart){var a=_twaver.clone(this._endLogical);if(this.resizingRect){if(this.lazyMode){if(this.network.ResizeAnimate){var d=this,b=new twaver.animaate.AnimateBounds(this.node,this.resizingRect,function(){d.network.fireInteractionEvent({kind:"lazyResizeEnd",event:c,element:d.node,resizeDirection:d.resizeDirection})});twaver.animate.AnimateManager.start(b)}else{this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:c,element:this.node,resizeDirection:this.resizeDirection})}}else{this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:c,element:this.node,resizeDirection:this.resizeDirection})}}else{this.shapeNode&&this.pointIndex>=0&&a?(this.shapeNode.setPoint(this.pointIndex,a),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:c,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&a?(this.shapeLink.setPoint(this.pointIndex,a),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:c,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&a&&(this.linkUI.setControlPoint(a),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:c,element:this.linkUI._element}))}}this._handle_mouseup(c),this.clear()},handle_mousemove:function(d){if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(d);return}if(this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(d);return}if(this.node&&this.resizeDirection){this._handleResizing(d);return}if(this.linkUI){this._handleMovingLinkControlPoint(d);return}return}if(!this.network.isValidEvent(d)){return}if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var b=this.network.getElementAt(d),f=this.network.getElementUI(b);if(!f||!f.getEditAttachment()){this.clear();return}var c=this.network.getLogicalPoint(d);if(b instanceof A){this.node=b;if(this._isEditingShapeNode(c)||this._isResizingNode(c)){this.network.setEditingElement(!0);return}}else{if(b instanceof twaver.ShapeLink){this.shapeLink=b;if(this._isEditingShapeLink(c)){this.network.setEditingElement(!0);return}}else{if(f instanceof twaver.network.LinkUI&&J.isOrthogonalLink(f._element)){this.linkUI=f;var a=this.linkUI.getControlPoint();a&&this._contains(c,a)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}}}this.clear()},_handleMovingShapeNodePoint:function(a){this._handle_mousemove(a),this.shapeNode.setPoint(this.pointIndex,_twaver.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){this._handle_mousemove(a),this.shapeLink.setPoint(this.pointIndex,_twaver.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this._handle_mousemove(a),this.linkUI.setControlPoint(_twaver.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(b){this._handle_mousemove(b);var a=_twaver.clone(this._endLogical),c=this.node.getRect();this.resizeDirection==="northwest"&&(this.resizingRect=this._getRect(a.x,a.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="north"&&(this.resizingRect=this._getRect(c.x,a.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="northeast"&&(this.resizingRect=this._getRect(c.x,a.y,a.x,c.y+c.height)),this.resizeDirection==="west"&&(this.resizingRect=this._getRect(a.x,c.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="east"&&(this.resizingRect=this._getRect(c.x,c.y,a.x,c.y+c.height)),this.resizeDirection==="southwest"&&(this.resizingRect=this._getRect(a.x,c.y,c.x+c.width,a.y)),this.resizeDirection==="south"&&(this.resizingRect=this._getRect(c.x,c.y,c.x+c.width,a.y)),this.resizeDirection==="southeast"&&(this.resizingRect=this._getRect(c.x,c.y,a.x,a.y)),this.lazyMode?(this.mark||(this.mark=N.createDiv(),this.network.getTopDiv().appendChild(this.mark)),N.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:b,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:b,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(d){if(this.node instanceof twaver.ShapeNode){this.shapeNode=this.node;var b=this.shapeNode.getPoints();for(var f=0,c=b.size();f<c;f++){var a=b.get(f);if(this._contains(d,a)){return this._setCrossCursor(),this.pointIndex=f,!0}}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(d){var b=this.shapeLink.getPoints();for(var f=0,c=b.size();f<c;f++){var a=b.get(f);if(this._contains(d,a)){return this._setCrossCursor(),this.pointIndex=f,!0}}return this.pointIndex=-1,!1},_isResizingNode:function(b){var a=this.network.getEditPointSize(),c=this.node.getRect();return this._isResizing(b,c.x,c.y,"northwest","nwse-resize")?!0:this._isResizing(b,c.x+c.width/2,c.y,"north","ns-resize")?!0:this._isResizing(b,c.x+c.width,c.y,"northeast","nesw-resize")?!0:this._isResizing(b,c.x,c.y+c.height/2,"west","ew-resize")?!0:this._isResizing(b,c.x+c.width,c.y+c.height/2,"east","ew-resize")?!0:this._isResizing(b,c.x,c.y+c.height,"southwest","nesw-resize")?!0:this._isResizing(b,c.x+c.width/2,c.y+c.height,"south","ns-resize")?!0:this._isResizing(b,c.x+c.width,c.y+c.height,"southeast","nwse-resize")?!0:!1},_isResizing:function(d,b,f,c,a){return this._contains(d,{x:b,y:f})?(this.resizeDirection!==c&&(this._removeCursor(),this._setCursor(a),this.resizeDirection=c),!0):!1},_getRect:function(g,c,l,f){var b=g<l?g:l,d=c<f?c:f,h=Math.abs(g-l),a=Math.abs(c-f);return{x:b,y:d,width:h,height:a}},_contains:function(c,a){var d=this.network.getEditPointSize(),b={x:a.x-d,y:a.y-d,width:d*2,height:d*2};return Q.containsPoint(b,c)}}),twaver.network.interaction.CreateElementInteraction=function(b,a){a||(a=A),twaver.Util.isTypeOf(a,A)?this.elementFunction=function(c){var d=new a;return d instanceof A&&d.setCenterLocation(c),d}:this.elementFunction=a,twaver.network.interaction.CreateElementInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.network.interaction.CreateElementInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(b){var a=this.network.getLogicalPoint(b);if(a){var c=this.elementFunction(a);c&&this.network.addElementByInteraction(c)}}}),twaver.network.interaction.CreateLinkInteraction=function(b,a){a||(a=twaver.Link),twaver.Util.isTypeOf(a,twaver.Link)?this.linkFunction=function(d,f){var c=new a;return c instanceof twaver.Link&&(c.setFromNode(d),c.setToNode(f)),c}:this.linkFunction=a,twaver.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.network.interaction.CreateLinkInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var a=this;setTimeout(function(){a._fromRectangle&&(a.network.getTopDiv().removeChild(a._fromRectangle),a._fromRectangle=null),a._currentRectangle&&(a.network.getTopDiv().removeChild(a._currentRectangle),a._currentRectangle=null),a._line&&(a.network.getTopDiv().removeChild(a._line),a._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(b){if(!this.network.isValidEvent(b)){return}if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var a=this.createLink();a&&this.network.addElementByInteraction(a)}this.clear()}else{this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()}},handle_mousemove:function(b){var a=this.network.getLogicalPoint(b);if(!a){return}if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var c=null;this.fromNode?(this.currentNode=this.getToNode(b),this.currentPoint=a,this.updateMark()):(c=this.getFromNode(b),this.currentNode!==c&&(this.currentNode=c,this.updateMark()))},getFromNode:function(b){var a=this.network.getElementAt(b);return a instanceof A?a:null},getToNode:function(b){var a=this.network.getElementAt(b);return a instanceof A?a:null},updateMark:function(){var a;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(a=this.network.getElementUI(this.currentNode),this._currentRectangle=N.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),N.setDiv(this._currentRectangle,a._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var f=this.fromNode.getCenterLocation(),b=f.x,g=f.y,d=this.currentPoint.x,a=this.currentPoint.y;this._line||(this._line=N.createCanvas(),this.network.getTopDiv().appendChild(this._line));var c=N.setCanvas(this._line,Math.min(b,d),Math.min(g,a),Math.abs(b-d),Math.abs(g-a));c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),c.moveTo(b,g),c.lineTo(d,a),c.stroke()}else{this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}}),twaver.network.interaction.CreateShapeNodeInteraction=function(b,a){a||(a=twaver.ShapeNode),twaver.Util.isTypeOf(a,twaver.ShapeNode)?this.shapeNodeFunction=function(c){var d=new a;return d instanceof twaver.ShapeNode&&c&&d.setPoints(c),d}:this.shapeNodeFunction=a,twaver.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,b)},_twaver.ext("twaver.network.interaction.CreateShapeNodeInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(d){var b=this.network.getLogicalPoint(d);if(!b){return}if(d.detail===2){if(this.points){var f=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(f),this.clear();var c=this;setTimeout(function(){c.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new q);if(this.points.size()>0){var a=this.points.get(this.points.size()-1);if(a.x===b.x&&a.y===b.y){return}}this.points.add(b),this.updateMark()}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.updateMark())},updateMark:function(c){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=N.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var a=new q(this.points);a.add(this.currentPoint);var d=Q.getRect(a),b=N.setCanvas(this.mark,d);b.lineWidth=this.network.getEditLineWidth(),b.strokeStyle=this.network.getEditLineColor(),b.beginPath(),z.drawLinePoints(b,a),b.stroke()}}}),twaver.network.interaction.CreateShapeLinkInteraction=function(b,a){twaver.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,b),a||(a=twaver.ShapeLink),twaver.Util.isTypeOf(a,twaver.ShapeLink)?this.linkFunction=function(f,g,d){var c=new a;return c instanceof twaver.ShapeLink&&(c.setFromNode(f),c.setToNode(g),d&&c.setPoints(d)),c}:this.linkFunction=a},_twaver.ext("twaver.network.interaction.CreateShapeLinkInteraction",twaver.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),twaver.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(c){var a=this.network.getLogicalPoint(c);if(!a){return}if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var d=this.createLink();d&&this.network.addElementByInteraction(d),this.clear()}else{this.points||(this.points=new q);if(this.points.size()>0){var b=this.points.get(this.points.size()-1);if(b.x===a.x&&b.y===a.y){return}}this.points.add(a),this.updateMark()}}else{this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=N.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()}},updateLine:function(){if(this.currentPoint&&this.polyline){var b=new q(this.points);b.add(this.fromNode.getCenterLocation(),0),b.add(this.currentPoint);var a=Q.getRect(b),c=N.setCanvas(this.polyline,a);c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),z.drawLinePoints(c,b),c.stroke()}}}),twaver.network.interaction.CreateOrthogonalLinkInteraction=function(f,b,g,d,a,c){twaver.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,f,b),this.linkType=g||"orthogonal",this.isByControlPoint=d,this.splitPercent=a,this.isSplitByPercent=c,this.link=new twaver.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),J.isFlexionalTypeLink(this.linkType)||J.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=twaver.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):J.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=twaver.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},_twaver.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",twaver.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),twaver.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var b=twaver.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);b.setStyle("link.type",this.linkType),b.setStyle("link.split.by.percent",this.isSplitByPercent);if(this.isByControlPoint){var a=J.getControlPoint(b);if(a){return b.SetStyle("link.control.point",a),b}}else{J.isFlexionalTypeLink(this.linkType)||J.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=twaver.Styles.getStyle("link.extend")),b.setStyle("link.extend",this.splitPercent)):J.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=twaver.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?b.setStyle("link.split.percent",this.splitPercent):b.setStyle("link.split.value",this.splitPercent))}return b},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode){return}var f,b=this.network.getElementUI(this.fromNode);if(!b){return}f=b.getBodyRect();if(f==null){return}var g;if(this.currentNode&&this.currentNode!==this.fromNode){var d=this.network.getElementUI(this.currentNode);if(!d){return}g=d.getBodyRect()}else{g={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1}}if(!g){return}var a=J.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,f,g,this.link);J.drawCorner(a,this.link);if(a.size()<2){return}this.line||(this.line=N.createCanvas(),this.network.getTopDiv().appendChild(this.line));var c=N.setCanvas(this.line,Q.getLineRect(a));c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),z.drawLinePoints(c,a),c.stroke()}else{this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}}),twaver.network.interaction.MagnifyInteraction=function(c,a,d,b){twaver.network.interaction.MagnifyInteraction.superClass.constructor.call(this,c),this.scale=a||2,this.xRadius=d||100,this.yRadius=b||100,this.markCanvas=N.createCanvas(),this.markCanvas._isIgnored=!0},_twaver.ext("twaver.network.interaction.MagnifyInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(b){var a=this.network.getLogicalPoint(b);if(!a){return}this.lastPoint||this.network.getTopDiv().appendChild(this.markCanvas),this.lastPoint=a,this.updateMark()},updateMark:function(){var b=this.xRadius/this.scale/this.network._zoom,a=this.yRadius/this.scale/this.network._zoom,c={x:this.lastPoint.x-b,y:this.lastPoint.y-a,width:b*2,height:a*2};N.setCanvas(this.markCanvas,this.lastPoint.x-this.xRadius/this.network._zoom,this.lastPoint.y-this.yRadius/this.network._zoom,this.xRadius/this.network._zoom*2,this.yRadius/this.network._zoom*2),this.network.toCanvasByRegion(c,this.scale,this.markCanvas)},_clear:function(a){this.lastPoint&&(this.network.getTopDiv().removeChild(this.markCanvas),this.lastPoint=null)}}),twaver.network.interaction.TouchInteraction=function(a){twaver.network.interaction.TouchInteraction.superClass.constructor.call(this,a)},_twaver.ext("twaver.network.interaction.TouchInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){N.addEventListener("touchstart","handleTouchstart",this.network.getView(),this)},tearDown:function(){N.removeEventListener("touchstart",this.network.getView(),this)},handleTouchstart:function(d){N.preventDefault(d);var b=this.network;if(M.isSingleTouch(d)){this._lastPoint=b.getLogicalPoint(d);var f=b.getElementAt(this._lastPoint);this._isClickBackground=!f,this._isClickBackground||b.getSelectionModel().contains(f)||b.getSelectionModel().setSelection(f);var c=new Date;this._lastTouchStartTime&&c.getTime()-this._lastTouchStartTime.getTime()<=500&&Q.getDistance(this._lastTouchStartPoint,this._lastPoint)<=20?(F.handleDoubleClicked(b,d,f),delete this._lastTouchStartTime,delete this._lastTouchStartPoint):(this._lastTouchStartTime=c,this._lastTouchStartPoint={x:this._lastPoint.x,y:this._lastPoint.y},F.handleClicked(b,d,f))}M.isMultiTouch(d)&&(this._distance=M.getDistance(d),this._zoom=b.getZoom());var a=b.getView();N.addEventListener("touchmove","handleTouchmove",a,this),N.addEventListener("touchend","handleTouchend",a,this)},handleTouchmove:function(f){this._moved||(this._moved=!0);var b=this.network;if(M.isSingleTouch(f)){var h=b.getLogicalPoint(f),d,a;if(this._isClickBackground){d=this._lastPoint.x-h.x,a=this._lastPoint.y-h.y;var c=b.panByOffset(d,a);this._lastPoint.x-=d-c.x,this._lastPoint.y-=a-c.y}else{if(!b.hasMovableSelectedElements()){this.touchEnd(f);return}h=b.getLogicalPoint(f),d=h.x-this._lastPoint.x,a=h.y-this._lastPoint.y,this._lastPoint=h,b.moveSelectedElements(d,a),b.isMovingElement()?b.fireInteractionEvent({kind:"liveMoveBetween",event:f}):(b.setMovingElement(!0),b.fireInteractionEvent({kind:"liveMoveStart",event:f}))}}else{if(this._distance){var g=M.getDistance(f)/this._distance;b.setZoom(this._zoom*g,!1)}}},handleTouchend:function(a){!this._moved&&this._isClickBackground&&this.network.getSelectionModel().clearSelection(),this.touchEnd(a)},touchEnd:function(b){var a=this.network;a.isMovingElement()&&(a.setMovingElement(!1),a.fireInteractionEvent({kind:"liveMoveEnd",event:b})),delete this._lastPoint,delete this._isClickBackground,delete this._zoom,delete this._distance,delete this._moved;var c=a.getView();N.removeEventListener("touchmove",c,this),N.removeEventListener("touchend",c,this)}})})(window);(function(d,b){var f=twaver.List,c=twaver.Node,a=twaver.Group;twaver.XmlSerializer=function(h,g,j){this.dataBox=h,this.settings=g?g:new twaver.SerializationSettings,this.filterFunction=j,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},_twaver.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+twaver.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(g){this.refMap[g.getId()]=this.ref++,g.getChildren().forEach(this.initRefs,this)},isSerializable:function(g){return this.dataBox.contains(g)?this.filterFunction&&!this.filterFunction(g)?!1:!0:!1},serializeData:function(h){if(this.isSerializable(h)){var g=h.newInstance(),j=this.refMap[h.getId()];this.xmlString+="<data class='"+h.getClassName()+"' ref='"+j+"'",this.settings.getPropertyType("id")!=null&&(this.xmlString+=" id='"+h.getId()+"'"),this.xmlString+=">\n",h.serializeXml(this,g),this.xmlString+="</data>\n"}h.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(l,h,m){var k=this.settings.getPropertyType(h);if(k){var g=_twaver.getValue(l,h,k),j=_twaver.getValue(m,h,k);g!==j&&this.serializeValue("p",h,g,j,k)}},serializeStyleXml:function(l,h,m){var k=this.settings.getStyleType(h);if(k){var g=l.getStyle(h),j=m.getStyle(h);g!=j&&this.serializeValue("s",h,g,j,k)}},serializeClientXml:function(l,h,m){var k=this.settings.getClientType(h);if(k!=null){var g=l.getClient(h),j=m.getClient(h);g!=j&&this.serializeValue("c",h,g,j,k)}},serializeValue:function(l,h,m,k,g){if(m==null){this.xmlString+="	<"+l+" n='"+h+"' none=''/>\n"}else{if(g==="cdata"){this.xmlString+="	<"+l+" n='"+h+"'><![CDATA["+m+"]]></"+l+">\n"}else{if(g==="data"){var j=this.refMap[m.getId()];j!=null&&(this.xmlString+="	<"+l+" n='"+h+"' ref='"+j+"'/>\n")}else{if(g==="point"){if(!k||m.x!==k.x||m.y!==k.y){this.xmlString+="	<"+l+" n='"+h+"' x='"+m.x+"' y='"+m.y+"'/>\n"}}else{g==="list.point"?(this.xmlString+="	<"+l+" n='"+h+"'>\n",m.forEach(function(o){this.xmlString+="		<p x='"+o.x+"' y='"+o.y+"'/>\n"},this),this.xmlString+="	</"+l+">\n"):g==="list.string"||g==="list.number"?(this.xmlString+="	<"+l+" n='"+h+"'>\n",m.forEach(function(o){this.xmlString+="		<s>"+o+"</s>\n"},this),this.xmlString+="	</"+l+">\n"):g==="rectangle"?this.xmlString+="	<"+l+" n='"+h+"' x='"+m.x+"' y='"+m.y+"' w='"+m.width+"' h='"+m.height+"'/>\n":this.xmlString+="	<"+l+" n='"+h+"'>"+m+"</"+l+">\n"}}}}},deserialize:function(x,C){_twaver.isDeserializing=!0,this.xmlString=x;var g=_twaver.xml(x).documentElement;this.refMap={},this.idMap={};var q=new f,D=new f,k,B,A,w=g.getElementsByTagName("data"),m=w.length;for(A=0;A<m;A++){B=w[A];var z=B.getAttribute("class"),v=this.settings.getPropertyType("id");if(v&&B.hasAttribute("id")){var j=null;if(v==="string"){j=B.getAttribute("id")}else{if(v==="int"){j=parseInt(B.getAttribute("id"))}else{if(v!=="number"){throw"Unsupported id type '"+v+"'"}j=parseFloat(B.getAttribute("id"))}}if(B.getAttribute("action")==="remove"){this.dataBox.removeById(j);continue}k=this.dataBox.getDataById(j),k||(k=_twaver.newInstance(z,j))}else{k=_twaver.newInstance(z)}if(B.hasAttribute("ref")){var y=B.getAttribute("ref");this.refMap[y]=k}q.add(k),D.add(B),this.idMap[k.getId()]=k}this.dataBox.forEach(function(h){this.idMap[h.getId()]=h},this),m=q.size();for(A=0;A<m;A++){k=q.get(A),B=D.get(A),k.deserializeXml(this,B)}for(A=0;A<m;A++){k=q.get(A);if(this.dataBox.containsById(k.getId())){continue}C&&!k.getParent()&&k.setParent(C),this.dataBox.add(k)}this.settings.isDataBoxSerializable&&g.getElementsByTagName("dataBox").length===1&&this.dataBox.deserializeXml(this,g.getElementsByTagName("dataBox")[0]),_twaver.isDeserializing=!1},deserializePropertyXml:function(j,g,k){var h=this.settings.getPropertyType(k);h&&_twaver.setValue(j,k,this.deserializeValue(g,h))},deserializeStyleXml:function(j,g,k){var h=this.settings.getStyleType(k);h&&j.setStyle(k,this.deserializeValue(g,h))},deserializeClientXml:function(j,g,k){var h=this.settings.getClientType(k);h&&j.setClient(k,this.deserializeValue(g,h))},deserializeValue:function(v,z){if(v.hasAttribute("@none")){return null}if(z==="string"){return v.textContent}if(z==="number"){return parseFloat(v.textContent)}if(z==="boolean"){return v.textContent==="true"}if(z==="int"){return parseInt(v.textContent)}if(z==="point"){return{x:parseFloat(v.getAttribute("x")),y:parseFloat(v.getAttribute("y"))}}if(z==="data"){var g=v.getAttribute("ref"),m=this.refMap[g];return m?m:this.idMap[g]}var A,j,y,x;if(z==="list.point"){var q=new f,k=v.getElementsByTagName("p");A=k.length;for(x=0;x<A;x++){var w=k[x];q.add({x:parseFloat(w.getAttribute("x")),y:parseFloat(w.getAttribute("y"))})}return q}if(z==="list.string"){var p=new f;y=v.getElementsByTagName("s"),A=y.length;for(x=0;x<A;x++){p.add(y[x].textContent)}return p}if(z==="list.number"){j=new f,y=v.getElementsByTagName("s"),A=y.length;for(x=0;x<A;x++){j.add(parseFloat(y[x].textContent))}return j}if(z==="array.string"){return v.textContent.split(",")}if(z==="array.number"){j=v.textContent.split(","),A=j.length;for(x=0;x<A;x++){j[x]=parseFloat(j[x])}return j}return z==="rectangle"?{x:parseFloat(v.getAttribute("x")),y:parseFloat(v.getAttribute("y")),width:parseFloat(v.getAttribute("w")),height:parseFloat(v.getAttribute("h"))}:v.textContent}}),_twaver.addMethod(twaver.Data,{serializeXml:function(h,g){if(h.settings.isClientSerializable&&this._clientMap){for(var j in this._clientMap){this.serializeClientXml(h,j,g)}}this.serializePropertyXml(h,"name",g),this.serializePropertyXml(h,"icon",g),this.serializePropertyXml(h,"toolTip",g),this.serializePropertyXml(h,"parent",g)},serializePropertyXml:function(h,g,j){h.serializePropertyXml(this,g,j)},serializeClientXml:function(h,g,j){h.serializeClientXml(this,g,j)},deserializeXml:function(m,j){var q=j.getElementsByTagName("p"),l=q.length,h,k,p,g;for(h=0;h<l;h++){k=q[h],k.hasAttribute("n")&&this.deserializePropertyXml(m,k,k.getAttribute("n"))}if(m.settings.isClientSerializable){p=j.getElementsByTagName("c"),l=p.length;for(h=0;h<l;h++){g=p[h],g.hasAttribute("n")&&this.deserializeClientXml(m,g,g.getAttribute("n"))}}},deserializePropertyXml:function(h,g,j){h.deserializePropertyXml(this,g,j)},deserializeClientXml:function(h,g,j){h.deserializeClientXml(this,g,j)}}),_twaver.addMethod(twaver.Element,{serializeXml:function(h,g){if(h.settings.isStyleSerializable&&this._styleMap){for(var j in this._styleMap){this.serializeStyleXml(h,j,g)}}twaver.Element.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"layerId",g),this._alarmState.getHighestNativeAlarmSeverity()&&h.settings.getPropertyType("alarmState")==="alarmstate"&&(h.xmlString+="	<p n='alarmState'>\n",twaver.AlarmSeverity.forEach(function(e){var k=this.getNewAlarmCount(e);k>0&&(h.xmlString+="		<n n='"+e.name+"' c='"+k+"'/>\n")},this._alarmState),twaver.AlarmSeverity.forEach(function(e){var k=this.getAcknowledgedAlarmCount(e);k>0&&(h.xmlString+="		<a n='"+e.name+"' c='"+k+"'/>\n")},this._alarmState),h.xmlString+="	</p>\n")},serializeStyleXml:function(h,g,j){h.serializeStyleXml(this,g,j)},deserializeXml:function(l,h){twaver.Element.superClass.deserializeXml.call(this,l,h);if(l.settings.isStyleSerializable){var m=h.getElementsByTagName("s"),k=m.length,g,j;for(g=0;g<k;g++){j=m[g],j.hasAttribute("n")&&this.deserializeStyleXml(l,j,j.getAttribute("n"))}}},deserializeStyleXml:function(h,g,j){h.deserializeStyleXml(this,g,j)},deserializePropertyXml:function(m,j,q){if(q==="alarmState"){if(m.settings.getPropertyType("alarmState")==="alarmstate"){var l,h,k,p,g=j.getElementsByTagName("n");for(k=0;k<g.length;k++){p=g[k],h=twaver.AlarmSeverity.getByName(p.getAttribute("n")),this._alarmState.setNewAlarmCount(h,parseInt(p.getAttribute("c")))}g=j.getElementsByTagName("a");for(k=0;k<g.length;k++){p=g[k],h=twaver.AlarmSeverity.getByName(p.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(h,parseInt(p.getAttribute("c")))}}}else{twaver.Element.superClass.deserializePropertyXml.call(this,m,j,q)}}}),_twaver.addMethod(c,{serializeXml:function(h,g){c.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"image",g),this.serializePropertyXml(h,"location",g),_twaver.num(this._width)&&this._width>=0&&this.serializePropertyXml(h,"width",g),_twaver.num(this._height)&&this._height>=0&&this.serializePropertyXml(h,"height",g)}}),_twaver.addMethod(twaver.Link,{serializeXml:function(h,g){twaver.Link.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"fromNode",g),this.serializePropertyXml(h,"toNode",g)}}),_twaver.addMethod(twaver.Follower,{serializeXml:function(h,g){twaver.Follower.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"host",g)}}),_twaver.addMethod(a,{serializeXml:function(h,g){a.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"expanded",g)}}),_twaver.addMethod(twaver.ShapeNode,{serializeXml:function(h,g){twaver.ShapeNode.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"points",g),this.serializePropertyXml(h,"segments",g)}}),_twaver.addMethod(twaver.ShapeLink,{serializeXml:function(h,g){twaver.ShapeLink.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"points",g)}}),_twaver.addMethod(twaver.RotatableNode,{serializeXml:function(h,g){twaver.RotatableNode.superClass.serializeXml.call(this,h,g),this.serializePropertyXml(h,"angle",g)}}),_twaver.addMethod(twaver.DataBox,{serializeXml:function(h,g){if(h.settings.isClientSerializable&&this._clientMap){for(var j in this._clientMap){this.serializeClientXml(h,j,g)}}this.serializePropertyXml(h,"name",g),this.serializePropertyXml(h,"icon",g),this.serializePropertyXml(h,"toolTip",g)},serializePropertyXml:function(h,g,j){h.serializePropertyXml(this,g,j)},serializeClientXml:function(h,g,j){h.serializeClientXml(this,g,j)},deserializeXml:function(m,j){var q=j.getElementsByTagName("p"),l=q.length,h,k,p,g;for(h=0;h<l;h++){k=q[h],k.hasAttribute("n")&&this.deserializePropertyXml(m,k,k.getAttribute("n"))}if(m.settings.isClientSerializable){p=j.getElementsByTagName("c"),l=p.length;for(h=0;h<l;h++){g=p[h],g.hasAttribute("n")&&this.deserializeClientXml(m,g,g.getAttribute("n"))}}},deserializePropertyXml:function(h,g,j){h.deserializePropertyXml(this,g,j)},deserializeClientXml:function(h,g,j){h.deserializeClientXml(this,g,j)}}),_twaver.addMethod(twaver.ElementBox,{serializeXml:function(h,g){h.settings.isLayerBoxSerializable&&(h.xmlString+="	<layerBox>\n",this._layerBox.forEachByDepthFirst(function(e){this._layerBox.getDefaultLayer()===e?h.xmlString+="		<layer ":h.xmlString+="		<layer id='"+e.getId()+"' ",e.getName()&&(h.xmlString+="name='"+e.getName()+"' "),h.xmlString+="visible='"+e.isVisible()+"' editable='"+e.isEditable()+"' movable='"+e.isMovable()+"'/>\n"},null,this),h.xmlString+="	</layerBox>\n");if(h.settings.isStyleSerializable&&this._styleMap){for(var j in this._styleMap){this.serializeStyleXml(h,j,g)}}twaver.ElementBox.superClass.serializeXml.call(this,h,g)},serializeStyleXml:function(h,g,j){h.serializeStyleXml(this,g,j)},deserializeStyleXml:function(h,g,j){h.deserializeStyleXml(this,g,j)},deserializeXml:function(m,v){twaver.ElementBox.superClass.deserializeXml.call(this,m,v);if(m.settings.isLayerBoxSerializable&&v.getElementsByTagName("layerBox").length==1){this._layerBox.clear();var j=v.getElementsByTagName("layerBox")[0].getElementsByTagName("layer");for(var g=0;g<j.length;g++){var k=j[g],w;if(k.hasAttribute("id")){var h=m.settings.getPropertyType("layerId");if(h==="string"){w=new twaver.Layer(k.getAttribute("id"))}else{if(h==="int"){w=new twaver.Layer(parseInt(k.getAttribute("id")))}else{if(h!=="number"){throw"Unsupported layer id type '"+h+"'"}w=new twaver.Layer(parseFloat(k.getAttribute("id")))}}this._layerBox.add(w)}else{w=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(w)}k.hasAttribute("name")&&w.setName(k.getAttribute("name")),k.hasAttribute("visible")&&w.setVisible(k.getAttribute("visible")==="true"),k.hasAttribute("editable")&&w.setEditable(k.getAttribute("editable")==="true"),k.hasAttribute("movable")&&w.setMovable(k.getAttribute("movable")==="true")}}if(m.settings.isStyleSerializable){var q=v.getElementsByTagName("s"),p=q.length;for(var g=0;g<p;g++){var l=q[g];l.hasAttribute("n")&&this.deserializeStyleXml(m,l,l.getAttribute("n"))}}}})})(window);